import e,{Buffer as t}from"buffer";import n from"node:crypto";import r,{EventEmitter as i}from"events";import o from"@react-native-async-storage/async-storage";import s,{useCallback as a,createContext as c,useState as l,useEffect as u,useRef as d,useMemo as h,useContext as f}from"react";var p="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},g=[],m=[],y="undefined"!=typeof Uint8Array?Uint8Array:Array,v=!1;function b(){v=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)g[t]=e[t],m[e.charCodeAt(t)]=t;m["-".charCodeAt(0)]=62,m["_".charCodeAt(0)]=63}function w(e,t,n){for(var r,i,o=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(g[(i=r)>>18&63]+g[i>>12&63]+g[i>>6&63]+g[63&i]);return o.join("")}function E(e){var t;v||b();for(var n=e.length,r=n%3,i="",o=[],s=16383,a=0,c=n-r;a<c;a+=s)o.push(w(e,a,a+s>c?c:a+s));return 1===r?(t=e[n-1],i+=g[t>>2],i+=g[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=g[t>>10],i+=g[t>>4&63],i+=g[t<<2&63],i+="="),o.push(i),o.join("")}function S(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=h,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=l}return(f?-1:1)*s*Math.pow(2,o-r)}function _(e,t,n,r,i,o){var s,a,c,l=8*o-i-1,u=(1<<l)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;e[n+f]=255&s,f+=p,s/=256,l-=8);e[n+f-p]|=128*g}var C={}.toString,A=Array.isArray||function(e){return"[object Array]"==C.call(e)};function k(){return R.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function M(e,t){if(k()<t)throw new RangeError("Invalid typed array length");return R.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=R.prototype:(null===e&&(e=new R(t)),e.length=t),e}function R(e,t,n){if(!(R.TYPED_ARRAY_SUPPORT||this instanceof R))return new R(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return T(this,e)}return x(this,e,t,n)}function x(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);R.TYPED_ARRAY_SUPPORT?(e=t).__proto__=R.prototype:e=I(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!R.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|L(t,n);e=M(e,r);var i=e.write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(N(t)){var n=0|O(t.length);return 0===(e=M(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?M(e,0):I(e,t);if("Buffer"===t.type&&A(t.data))return I(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function P(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function T(e,t){if(P(t),e=M(e,t<0?0:0|O(t)),!R.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function I(e,t){var n=t.length<0?0:0|O(t.length);e=M(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function O(e){if(e>=k())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+k().toString(16)+" bytes");return 0|e}function N(e){return!(null==e||!e._isBuffer)}function L(e,t){if(N(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return ce(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return le(e).length;default:if(r)return ce(e).length;t=(""+t).toLowerCase(),r=!0}}function B(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Z(this,t,n);case"utf8":case"utf-8":return V(this,t,n);case"ascii":return Y(this,t,n);case"latin1":case"binary":return J(this,t,n);case"base64":return W(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function D(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function K(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=R.from(t,r)),N(t))return 0===t.length?-1:j(e,t,n,r,i);if("number"==typeof t)return t&=255,R.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):j(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function j(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=n;o<a;o++)if(l(e,o)===l(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(l(e,o+h)!==l(t,h)){d=!1;break}if(d)return o}return-1}function U(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function $(e,t,n,r){return ue(ce(t,e.length-n),e,n,r)}function F(e,t,n,r){return ue(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function H(e,t,n,r){return F(e,t,n,r)}function q(e,t,n,r){return ue(le(t),e,n,r)}function z(e,t,n,r){return ue(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function W(e,t,n){return 0===t&&n===e.length?E(e):E(e.slice(t,n))}function V(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,l=e[i],u=null,d=l>239?4:l>223?3:l>191?2:1;if(i+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&l)<<6|63&o)>127&&(u=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&l)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(t<=G)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=G));return n}(r)}R.TYPED_ARRAY_SUPPORT=void 0===p.TYPED_ARRAY_SUPPORT||p.TYPED_ARRAY_SUPPORT,k(),R.poolSize=8192,R._augment=function(e){return e.__proto__=R.prototype,e},R.from=function(e,t,n){return x(null,e,t,n)},R.TYPED_ARRAY_SUPPORT&&(R.prototype.__proto__=Uint8Array.prototype,R.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&R[Symbol.species]),R.alloc=function(e,t,n){return function(e,t,n,r){return P(t),t<=0?M(e,t):void 0!==n?"string"==typeof r?M(e,t).fill(n,r):M(e,t).fill(n):M(e,t)}(null,e,t,n)},R.allocUnsafe=function(e){return T(null,e)},R.allocUnsafeSlow=function(e){return T(null,e)},R.isBuffer=function(e){return null!=e&&(!!e._isBuffer||de(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&de(e.slice(0,0))}(e))},R.compare=function(e,t){if(!N(e)||!N(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},R.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},R.concat=function(e,t){if(!A(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return R.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=R.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!N(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},R.byteLength=L,R.prototype._isBuffer=!0,R.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)D(this,t,t+1);return this},R.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)D(this,t,t+3),D(this,t+1,t+2);return this},R.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)D(this,t,t+7),D(this,t+1,t+6),D(this,t+2,t+5),D(this,t+3,t+4);return this},R.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?V(this,0,e):B.apply(this,arguments)},R.prototype.equals=function(e){if(!N(e))throw new TypeError("Argument must be a Buffer");return this===e||0===R.compare(this,e)},R.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},R.prototype.compare=function(e,t,n,r,i){if(!N(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(r,i),l=e.slice(t,n),u=0;u<a;++u)if(c[u]!==l[u]){o=c[u],s=l[u];break}return o<s?-1:s<o?1:0},R.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},R.prototype.indexOf=function(e,t,n){return K(this,e,t,n,!0)},R.prototype.lastIndexOf=function(e,t,n){return K(this,e,t,n,!1)},R.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return U(this,e,t,n);case"utf8":case"utf-8":return $(this,e,t,n);case"ascii":return F(this,e,t,n);case"latin1":case"binary":return H(this,e,t,n);case"base64":return q(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},R.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var G=4096;function Y(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function J(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function Z(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=ae(e[o]);return i}function Q(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function X(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function ee(e,t,n,r,i,o){if(!N(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function te(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function ne(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function re(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function ie(e,t,n,r,i){return i||re(e,0,n,4),_(e,t,n,r,23,4),n+4}function oe(e,t,n,r,i){return i||re(e,0,n,8),_(e,t,n,r,52,8),n+8}R.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),R.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=R.prototype;else{var i=t-e;n=new R(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},R.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||X(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},R.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||X(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},R.prototype.readUInt8=function(e,t){return t||X(e,1,this.length),this[e]},R.prototype.readUInt16LE=function(e,t){return t||X(e,2,this.length),this[e]|this[e+1]<<8},R.prototype.readUInt16BE=function(e,t){return t||X(e,2,this.length),this[e]<<8|this[e+1]},R.prototype.readUInt32LE=function(e,t){return t||X(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},R.prototype.readUInt32BE=function(e,t){return t||X(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},R.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||X(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},R.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||X(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},R.prototype.readInt8=function(e,t){return t||X(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},R.prototype.readInt16LE=function(e,t){t||X(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},R.prototype.readInt16BE=function(e,t){t||X(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},R.prototype.readInt32LE=function(e,t){return t||X(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},R.prototype.readInt32BE=function(e,t){return t||X(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},R.prototype.readFloatLE=function(e,t){return t||X(e,4,this.length),S(this,e,!0,23,4)},R.prototype.readFloatBE=function(e,t){return t||X(e,4,this.length),S(this,e,!1,23,4)},R.prototype.readDoubleLE=function(e,t){return t||X(e,8,this.length),S(this,e,!0,52,8)},R.prototype.readDoubleBE=function(e,t){return t||X(e,8,this.length),S(this,e,!1,52,8)},R.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||ee(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},R.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||ee(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},R.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,1,255,0),R.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},R.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):te(this,e,t,!0),t+2},R.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):te(this,e,t,!1),t+2},R.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):ne(this,e,t,!0),t+4},R.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ne(this,e,t,!1),t+4},R.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);ee(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},R.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);ee(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},R.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,1,127,-128),R.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},R.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):te(this,e,t,!0),t+2},R.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):te(this,e,t,!1),t+2},R.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,4,2147483647,-2147483648),R.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):ne(this,e,t,!0),t+4},R.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||ee(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ne(this,e,t,!1),t+4},R.prototype.writeFloatLE=function(e,t,n){return ie(this,e,t,!0,n)},R.prototype.writeFloatBE=function(e,t,n){return ie(this,e,t,!1,n)},R.prototype.writeDoubleLE=function(e,t,n){return oe(this,e,t,!0,n)},R.prototype.writeDoubleBE=function(e,t,n){return oe(this,e,t,!1,n)},R.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!R.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},R.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!R.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=N(e)?e:ce(new R(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var se=/[^+\/0-9A-Za-z-_]/g;function ae(e){return e<16?"0"+e.toString(16):e.toString(16)}function ce(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function le(e){return function(e){var t,n,r,i,o,s;v||b();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new y(3*a/4-o),r=o>0?a-4:a;var c=0;for(t=0,n=0;t<r;t+=4,n+=3)i=m[e.charCodeAt(t)]<<18|m[e.charCodeAt(t+1)]<<12|m[e.charCodeAt(t+2)]<<6|m[e.charCodeAt(t+3)],s[c++]=i>>16&255,s[c++]=i>>8&255,s[c++]=255&i;return 2===o?(i=m[e.charCodeAt(t)]<<2|m[e.charCodeAt(t+1)]>>4,s[c++]=255&i):1===o&&(i=m[e.charCodeAt(t)]<<10|m[e.charCodeAt(t+1)]<<4|m[e.charCodeAt(t+2)]>>2,s[c++]=i>>8&255,s[c++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(se,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function ue(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function de(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function he(){throw new Error("setTimeout has not been defined")}function fe(){throw new Error("clearTimeout has not been defined")}var pe=he,ge=fe;function me(e){if(pe===setTimeout)return setTimeout(e,0);if((pe===he||!pe)&&setTimeout)return pe=setTimeout,setTimeout(e,0);try{return pe(e,0)}catch(t){try{return pe.call(null,e,0)}catch(t){return pe.call(this,e,0)}}}"function"==typeof p.setTimeout&&(pe=setTimeout),"function"==typeof p.clearTimeout&&(ge=clearTimeout);var ye,ve=[],be=!1,we=-1;function Ee(){be&&ye&&(be=!1,ye.length?ve=ye.concat(ve):we=-1,ve.length&&Se())}function Se(){if(!be){var e=me(Ee);be=!0;for(var t=ve.length;t;){for(ye=ve,ve=[];++we<t;)ye&&ye[we].run();we=-1,t=ve.length}ye=null,be=!1,function(e){if(ge===clearTimeout)return clearTimeout(e);if((ge===fe||!ge)&&clearTimeout)return ge=clearTimeout,clearTimeout(e);try{return ge(e)}catch(t){try{return ge.call(null,e)}catch(t){return ge.call(this,e)}}}(e)}}function _e(e,t){this.fun=e,this.array=t}_e.prototype.run=function(){this.fun.apply(null,this.array)};function Ce(){}var Ae=Ce,ke=Ce,Me=Ce,Re=Ce,xe=Ce,Pe=Ce,Te=Ce;var Ie=p.performance||{},Oe=Ie.now||Ie.mozNow||Ie.msNow||Ie.oNow||Ie.webkitNow||function(){return(new Date).getTime()};var Ne=new Date;var Le={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ve.push(new _e(e,t)),1!==ve.length||be||me(Se)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Ae,addListener:ke,once:Me,off:Re,removeListener:xe,removeAllListeners:Pe,emit:Te,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*Oe.call(Ie),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Ne)/1e3}},Be="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},De={exports:{}};De.exports=Be.fetch,De.exports.default=Be.fetch,De.exports.fetch=Be.fetch,De.exports.Headers=Be.Headers,De.exports.Request=Be.Request,De.exports.Response=Be.Response;var Ke,je,Ue={exports:{}};function $e(){if(je)return Ke;je=1;var e=1e3,t=60*e,n=60*t,r=24*n,i=7*r,o=365.25*r;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}return Ke=function(a,c){c=c||{};var l=typeof a;if("string"===l&&a.length>0)return function(s){if((s=String(s)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(a);if("number"===l&&isFinite(a))return c.long?function(i){var o=Math.abs(i);if(o>=r)return s(i,o,r,"day");if(o>=n)return s(i,o,n,"hour");if(o>=t)return s(i,o,t,"minute");if(o>=e)return s(i,o,e,"second");return i+" ms"}(a):function(i){var o=Math.abs(i);if(o>=r)return Math.round(i/r)+"d";if(o>=n)return Math.round(i/n)+"h";if(o>=t)return Math.round(i/t)+"m";if(o>=e)return Math.round(i/e)+"s";return i+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},Ke}var Fe=function(e){function t(e){let r,i,o,s=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),o=i-(r||i);n.diff=o,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];r=o.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=$e(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==Le&&"env"in Le&&(e=Le.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Fe(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(Ue,Ue.exports);var He=Ue.exports,qe=Object.defineProperty,ze=Object.getOwnPropertyDescriptor,We=Object.getOwnPropertyNames,Ve=Object.prototype.hasOwnProperty,Ge={};((e,t)=>{for(var n in t)qe(e,n,{get:t[n],enumerable:!0})})(Ge,{createFinalURL:()=>ut,createPathBasedClient:()=>rt,createQuerySerializer:()=>at,default:()=>et,defaultBodySerializer:()=>lt,defaultPathSerializer:()=>ct,mergeHeaders:()=>dt,randomID:()=>Xe,removeTrailingSlash:()=>ht,serializeArrayParam:()=>st,serializeObjectParam:()=>ot,serializePrimitiveParam:()=>it,wrapAsPathBasedClient:()=>nt});var Ye,Je=(Ye=Ge,((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of We(t))Ve.call(e,i)||i===n||qe(e,i,{get:()=>t[i],enumerable:!(r=ze(t,i))||r.enumerable});return e})(qe({},"__esModule",{value:!0}),Ye)),Ze=/\{[^{}]+\}/g,Qe=()=>"object"==typeof Le&&Number.parseInt(Le?.versions?.node?.substring(0,2))>=18&&Le.versions.undici;function Xe(){return Math.random().toString(36).slice(2,11)}function et(e){let{baseUrl:t="",Request:n=globalThis.Request,fetch:r=globalThis.fetch,querySerializer:i,bodySerializer:o,headers:s,requestInitExt:a,...c}={...e};a=Qe()?a:void 0,t=ht(t);const l=[];async function u(e,u){const{baseUrl:d,fetch:h=r,Request:f=n,headers:p,params:g={},parseAs:m="json",querySerializer:y,bodySerializer:v=o??lt,body:b,...w}=u||{};d&&(t=ht(d));let E="function"==typeof i?i:at(i);y&&(E="function"==typeof y?y:at({..."object"==typeof i?i:{},...y}));const S=void 0===b?void 0:v(b),_=void 0===S||S instanceof FormData?{}:{"Content-Type":"application/json"},C={redirect:"follow",...c,...w,body:S,headers:dt(_,s,p,g.header)};let A,k,M,R=new n(ut(e,{baseUrl:t,params:g,querySerializer:E}),C);for(const e in w)e in R||(R[e]=w[e]);if(l.length){A=Xe(),k=Object.freeze({baseUrl:t,fetch:h,parseAs:m,querySerializer:E,bodySerializer:v});for(const t of l)if(t&&"object"==typeof t&&"function"==typeof t.onRequest){const r=await t.onRequest({request:R,schemaPath:e,params:g,options:k,id:A});if(r){if(!(r instanceof n)){if(r instanceof Response){M=r;break}throw new Error("onRequest: must return new Request() or Response() when modifying the request")}R=r}}}if(!M){try{M=await h(R,a)}catch(t){let n=t;if(l.length)for(let t=l.length-1;t>=0;t--){const r=l[t];if(r&&"object"==typeof r&&"function"==typeof r.onError){const t=await r.onError({request:R,error:n,schemaPath:e,params:g,options:k,id:A});if(t){if(t instanceof Response){n=void 0,M=t;break}if(t instanceof Error){n=t;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(n)throw n}if(l.length)for(let t=l.length-1;t>=0;t--){const n=l[t];if(n&&"object"==typeof n&&"function"==typeof n.onResponse){const t=await n.onResponse({request:R,response:M,schemaPath:e,params:g,options:k,id:A});if(t){if(!(t instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");M=t}}}}if(204===M.status||"0"===M.headers.get("Content-Length"))return M.ok?{data:void 0,response:M}:{error:void 0,response:M};if(M.ok)return"stream"===m?{data:M.body,response:M}:{data:await M[m](),response:M};let x=await M.text();try{x=JSON.parse(x)}catch{}return{error:x,response:M}}return{request:(e,t,n)=>u(t,{...n,method:e.toUpperCase()}),GET:(e,t)=>u(e,{...t,method:"GET"}),PUT:(e,t)=>u(e,{...t,method:"PUT"}),POST:(e,t)=>u(e,{...t,method:"POST"}),DELETE:(e,t)=>u(e,{...t,method:"DELETE"}),OPTIONS:(e,t)=>u(e,{...t,method:"OPTIONS"}),HEAD:(e,t)=>u(e,{...t,method:"HEAD"}),PATCH:(e,t)=>u(e,{...t,method:"PATCH"}),TRACE:(e,t)=>u(e,{...t,method:"TRACE"}),use(...e){for(const t of e)if(t){if("object"!=typeof t||!("onRequest"in t||"onResponse"in t||"onError"in t))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");l.push(t)}},eject(...e){for(const t of e){const e=l.indexOf(t);-1!==e&&l.splice(e,1)}}}}var tt=class{constructor(){this.client=null}get(e,t){const n=new class{constructor(e,t){this.client=e,this.url=t}GET(e){return this.client.GET(this.url,e)}PUT(e){return this.client.PUT(this.url,e)}POST(e){return this.client.POST(this.url,e)}DELETE(e){return this.client.DELETE(this.url,e)}OPTIONS(e){return this.client.OPTIONS(this.url,e)}HEAD(e){return this.client.HEAD(this.url,e)}PATCH(e){return this.client.PATCH(this.url,e)}TRACE(e){return this.client.TRACE(this.url,e)}}(e,t);return this.client[t]=n,n}};function nt(e){const t=new tt,n=new Proxy(e,t);function r(){}r.prototype=n;const i=new r;return t.client=i,i}function rt(e){return nt(et(e))}function it(e,t,n){if(null==t)return"";if("object"==typeof t)throw new Error("Deeply-nested arrays/objects aren’t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${!0===n?.allowReserved?t:encodeURIComponent(t)}`}function ot(e,t,n){if(!t||"object"!=typeof t)return"";const r=[],i={simple:",",label:".",matrix:";"}[n.style]||"&";if("deepObject"!==n.style&&!1===n.explode){for(const e in t)r.push(e,!0===n.allowReserved?t[e]:encodeURIComponent(t[e]));const i=r.join(",");switch(n.style){case"form":return`${e}=${i}`;case"label":return`.${i}`;case"matrix":return`;${e}=${i}`;default:return i}}for(const i in t){const o="deepObject"===n.style?`${e}[${i}]`:i;r.push(it(o,t[i],n))}const o=r.join(i);return"label"===n.style||"matrix"===n.style?`${i}${o}`:o}function st(e,t,n){if(!Array.isArray(t))return"";if(!1===n.explode){const r={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[n.style]||",",i=(!0===n.allowReserved?t:t.map((e=>encodeURIComponent(e)))).join(r);switch(n.style){case"simple":return i;case"label":return`.${i}`;case"matrix":return`;${e}=${i}`;default:return`${e}=${i}`}}const r={simple:",",label:".",matrix:";"}[n.style]||"&",i=[];for(const r of t)"simple"===n.style||"label"===n.style?i.push(!0===n.allowReserved?r:encodeURIComponent(r)):i.push(it(e,r,n));return"label"===n.style||"matrix"===n.style?`${r}${i.join(r)}`:i.join(r)}function at(e){return function(t){const n=[];if(t&&"object"==typeof t)for(const r in t){const i=t[r];if(null!=i)if(Array.isArray(i)){if(0===i.length)continue;n.push(st(r,i,{style:"form",explode:!0,...e?.array,allowReserved:e?.allowReserved||!1}))}else"object"!=typeof i?n.push(it(r,i,e)):n.push(ot(r,i,{style:"deepObject",explode:!0,...e?.object,allowReserved:e?.allowReserved||!1}))}return n.join("&")}}function ct(e,t){let n=e;for(const r of e.match(Ze)??[]){let e=r.substring(1,r.length-1),i=!1,o="simple";if(e.endsWith("*")&&(i=!0,e=e.substring(0,e.length-1)),e.startsWith(".")?(o="label",e=e.substring(1)):e.startsWith(";")&&(o="matrix",e=e.substring(1)),!t||void 0===t[e]||null===t[e])continue;const s=t[e];Array.isArray(s)?n=n.replace(r,st(e,s,{style:o,explode:i})):n="object"!=typeof s?"matrix"!==o?n.replace(r,"label"===o?`.${encodeURIComponent(s)}`:encodeURIComponent(s)):n.replace(r,`;${it(e,s)}`):n.replace(r,ot(e,s,{style:o,explode:i}))}return n}function lt(e){return e instanceof FormData?e:JSON.stringify(e)}function ut(e,t){let n=`${t.baseUrl}${e}`;t.params?.path&&(n=ct(n,t.params.path));let r=t.querySerializer(t.params.query??{});return r.startsWith("?")&&(r=r.substring(1)),r&&(n+=`?${r}`),n}function dt(...e){const t=new Headers;for(const n of e){if(!n||"object"!=typeof n)continue;const e=n instanceof Headers?n.entries():Object.entries(n);for(const[n,r]of e)if(null===r)t.delete(n);else if(Array.isArray(r))for(const e of r)t.append(n,e);else void 0!==r&&t.set(n,r)}return t}function ht(e){return e.endsWith("/")?e.substring(0,e.length-1):e}var ft=Object.create,pt=Object.defineProperty,gt=Object.getOwnPropertyDescriptor,mt=Object.getOwnPropertyNames,yt=Object.getPrototypeOf,vt=Object.prototype.hasOwnProperty,bt=(e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of mt(t))vt.call(e,i)||i===n||pt(e,i,{get:()=>t[i],enumerable:!(r=gt(t,i))||r.enumerable});return e},wt={};((e,t)=>{for(var n in t)pt(e,n,{get:t[n],enumerable:!0})})(wt,{analytics:()=>Rt});var Et,St,_t=(e=>bt(pt({},"__esModule",{value:!0}),e))(wt),Ct=((e,t,n)=>(n=null!=e?ft(yt(e)):{},bt(!t&&e&&e.__esModule?n:pt(n,"default",{value:e,enumerable:!0}),e)))(Je),At=class{constructor(e){this.batch=[],this.maxTimeoutMs=3e4,this.timeoutId=null,this.isSending=!1,this.batchSize=e.batchSize,this.baseTimeoutMs=e.baseTimeoutMs,this.currentTimeoutMs=e.baseTimeoutMs,this.sendFn=e.sendFn}enqueue(e){this.batch.push(e),this.schedule()}schedule(){this.batch.length>0&&!this.timeoutId&&(this.timeoutId=setTimeout((()=>{this.timeoutId=null,this.flush()}),this.currentTimeoutMs))}async flush(){if(this.isSending||0===this.batch.length)return;this.isSending=!0;const e=[...this.batch.slice(0,this.batchSize)];this.batch=this.batch.slice(this.batchSize);try{await this.sendFn(e),this.currentTimeoutMs=this.baseTimeoutMs}catch(t){console.error("Sender: Failed to send batch",t),this.batch=[...e,...this.batch],this.currentTimeoutMs=Math.min(2*this.currentTimeoutMs,this.maxTimeoutMs)}finally{this.isSending=!1,this.schedule()}}},kt=class{constructor(e){this.enabled=!1,this.properties={};const t=(0,Ct.default)({baseUrl:e});this.sender=new At({batchSize:100,baseTimeoutMs:200,sendFn:async e=>{const n=await t.POST("/v1/events",{body:e});if(200!==n.response.status)throw new Error(n.error)}})}enable(){this.enabled=!0}setGlobalProperty(e,t){this.properties[e]=t}track(e,t){if(!this.enabled)return;const n={name:e,...this.properties,...t};this.sender.enqueue(n)}};void 0!==Le&&Le.env&&(Et=null!=(St=Le.env.METAMASK_ANALYTICS_ENDPOINT)?St:Le.env.NEXT_PUBLIC_METAMASK_ANALYTICS_ENDPOINT);var Mt,Rt=new kt(null!=Et?Et:"https://mm-sdk-analytics.api.cx.metamask.io/"),xt={exports:{}};Mt=xt,function(e){var t=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r="object"==typeof Le&&"function"==typeof Le.nextTick,i="function"==typeof Symbol,o="object"==typeof Reflect,s="function"==typeof setImmediate?setImmediate:setTimeout,a=i?o&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function c(){this._events={},this._conf&&l.call(this,this._conf)}function l(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners!==e&&(this._maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this._newListener=t.newListener),t.removeListener&&(this._removeListener=t.removeListener),t.verboseMemoryLeak&&(this.verboseMemoryLeak=t.verboseMemoryLeak),t.ignoreErrors&&(this.ignoreErrors=t.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function u(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==Le&&Le.emitWarning){var r=new Error(n);r.name="MaxListenersExceededWarning",r.emitter=this,r.count=e,Le.emitWarning(r)}else console.error(n),console.trace&&console.trace()}var d=function(e,t,n){var r=arguments.length;switch(r){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var i=new Array(r);r--;)i[r]=arguments[r];return i}};function h(t,n){for(var r={},i=t.length,o=n?n.length:0,s=0;s<i;s++)r[t[s]]=s<o?n[s]:e;return r}function f(e,t,n){var r,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(r=n.on,i=n.off),t.addEventListener?(r=t.addEventListener,i=t.removeEventListener):t.addListener?(r=t.addListener,i=t.removeListener):t.on&&(r=t.on,i=t.off),!r&&!i)throw Error("target does not implement any known event API");if("function"!=typeof r)throw TypeError("on method must be a function");if("function"!=typeof i)throw TypeError("off method must be a function");this._on=r,this._off=i;var o=e._observers;o?o.push(this):e._observers=[this]}function p(n,r,i,o){var s=Object.assign({},r);if(!n)return s;if("object"!=typeof n)throw TypeError("options must be an object");var a,c,l,u=Object.keys(n),d=u.length;function h(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var f=0;f<d;f++){if(a=u[f],!o&&!t.call(r,a))throw Error('Unknown "'+a+'" option');(c=n[a])!==e&&(l=i[a],s[a]=l?l(c,h):c)}return s}function g(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function m(e){var t="value must be type of "+e.join("|"),n=e.length,r=e[0],i=e[1];return 1===n?function(e,n){if(typeof e===r)return e;n(t)}:2===n?function(e,n){var o=typeof e;if(o===r||o===i)return e;n(t)}:function(r,i){for(var o=typeof r,s=n;s-- >0;)if(o===e[s])return r;i(t)}}Object.assign(f.prototype,{subscribe:function(e,t,n){var r=this,i=this._target,o=this._emitter,s=this._listeners,a=function(){var r=d.apply(null,arguments),s={data:r,name:t,original:e};n?!1!==n.call(i,s)&&o.emit.apply(o,[s.name].concat(r)):o.emit.apply(o,[t].concat(r))};if(s[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,o._newListener&&o._removeListener&&!r._onNewListener?(this._onNewListener=function(n){n===t&&null===s[e]&&(s[e]=a,r._on.call(i,e,a))},o.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!o.hasListeners(n)&&s[e]&&(s[e]=null,r._off.call(i,e,a))},s[e]=null,o.on("removeListener",this._onRemoveListener)):(s[e]=a,r._on.call(i,e,a))},unsubscribe:function(e){var t,n,r,i=this,o=this._listeners,s=this._emitter,c=this._off,l=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function u(){i._onNewListener&&(s.off("newListener",i._onNewListener),s.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=w.call(s,i);s._observers.splice(e,1)}if(e){if(!(t=o[e]))return;c.call(l,e,t),delete o[e],--this._listenersCount||u()}else{for(r=(n=a(o)).length;r-- >0;)e=n[r],c.call(l,e,o[e]);this._listeners={},this._listenersCount=0,u()}}});var y=m(["function"]),v=m(["object","function"]);function b(e,t,n){var r,i,o,s=0,a=new e((function(c,l,u){function d(){i&&(i=null),s&&(clearTimeout(s),s=0)}n=p(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),r=!n.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof u;var h=function(e){d(),c(e)},f=function(e){d(),l(e)};r?t(h,f,u):(i=[function(e){f(e||Error("canceled"))}],t(h,f,(function(e){if(o)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");i.push(e)})),o=!0),n.timeout>0&&(s=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",s=0,a.cancel(e),l(e)}),n.timeout))}));return r||(a.cancel=function(e){if(i){for(var t=i.length,n=1;n<t;n++)i[n](e);i[0](e),i=null}}),a}function w(e){var t=this._observers;if(!t)return-1;for(var n=t.length,r=0;r<n;r++)if(t[r]._target===e)return r;return-1}function E(e,t,n,r,i){if(!n)return null;if(0===r){var o=typeof t;if("string"===o){var s,c,l=0,u=0,d=this.delimiter,h=d.length;if(-1!==(c=t.indexOf(d))){s=new Array(5);do{s[l++]=t.slice(u,c),u=c+h}while(-1!==(c=t.indexOf(d,u)));s[l++]=t.slice(u),t=s,i=l}else t=[t],i=1}else"object"===o?i=t.length:(t=[t],i=1)}var f,p,g,m,y,v,b,w=null,S=t[r],_=t[r+1];if(r===i)n._listeners&&("function"==typeof n._listeners?(e&&e.push(n._listeners),w=[n]):(e&&e.push.apply(e,n._listeners),w=[n]));else{if("*"===S){for(c=(v=a(n)).length;c-- >0;)"_listeners"!==(f=v[c])&&(b=E(e,t,n[f],r+1,i))&&(w?w.push.apply(w,b):w=b);return w}if("**"===S){for((y=r+1===i||r+2===i&&"*"===_)&&n._listeners&&(w=E(e,t,n,i,i)),c=(v=a(n)).length;c-- >0;)"_listeners"!==(f=v[c])&&("*"===f||"**"===f?(n[f]._listeners&&!y&&(b=E(e,t,n[f],i,i))&&(w?w.push.apply(w,b):w=b),b=E(e,t,n[f],r,i)):b=E(e,t,n[f],f===_?r+2:r,i),b&&(w?w.push.apply(w,b):w=b));return w}n[S]&&(w=E(e,t,n[S],r+1,i))}if((p=n["*"])&&E(e,t,p,r+1,i),g=n["**"])if(r<i)for(g._listeners&&E(e,t,g,i,i),c=(v=a(g)).length;c-- >0;)"_listeners"!==(f=v[c])&&(f===_?E(e,t,g[f],r+2,i):f===S?E(e,t,g[f],r+1,i):((m={})[f]=g[f],E(e,t,{"**":m},r+1,i)));else g._listeners?E(e,t,g,i,i):g["*"]&&g["*"]._listeners&&E(e,t,g["*"],i,i);return w}function S(e,t,n){var r,i,o=0,s=0,a=this.delimiter,c=a.length;if("string"==typeof e)if(-1!==(r=e.indexOf(a))){i=new Array(5);do{i[o++]=e.slice(s,r),s=r+c}while(-1!==(r=e.indexOf(a,s)));i[o++]=e.slice(s)}else i=[e],o=1;else i=e,o=e.length;if(o>1)for(r=0;r+1<o;r++)if("**"===i[r]&&"**"===i[r+1])return;var l,d=this.listenerTree;for(r=0;r<o;r++)if(d=d[l=i[r]]||(d[l]={}),r===o-1)return d._listeners?("function"==typeof d._listeners&&(d._listeners=[d._listeners]),n?d._listeners.unshift(t):d._listeners.push(t),!d._listeners.warned&&this._maxListeners>0&&d._listeners.length>this._maxListeners&&(d._listeners.warned=!0,u.call(this,d._listeners.length,l))):d._listeners=t,!0;return!0}function _(e,t,n,r){for(var i,o,s,c,l=a(e),u=l.length,d=e._listeners;u-- >0;)i=e[o=l[u]],s="_listeners"===o?n:n?n.concat(o):[o],c=r||"symbol"==typeof o,d&&t.push(c?s:s.join(this.delimiter)),"object"==typeof i&&_.call(this,i,t,s,c);return t}function C(e){for(var t,n,r,i=a(e),o=i.length;o-- >0;)(t=e[n=i[o]])&&(r=!0,"_listeners"===n||C(t)||delete e[n]);return r}function A(e,t,n){this.emitter=e,this.event=t,this.listener=n}function k(t,n,i){if(!0===i)a=!0;else if(!1===i)o=!0;else{if(!i||"object"!=typeof i)throw TypeError("options should be an object or true");var o=i.async,a=i.promisify,c=i.nextTick,l=i.objectify}if(o||c||a){var u=n,d=n._origin||n;if(c&&!r)throw Error("process.nextTick is not supported");a===e&&(a="AsyncFunction"===n.constructor.name),n=function(){var e=arguments,t=this,n=this.event;return a?c?Promise.resolve():new Promise((function(e){s(e)})).then((function(){return t.event=n,u.apply(t,e)})):(c?Le.nextTick:s)((function(){t.event=n,u.apply(t,e)}))},n._async=!0,n._origin=d}return[n,l?new A(this,t,n):this]}function M(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,l.call(this,e)}A.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},M.EventEmitter2=M,M.prototype.listenTo=function(t,r,i){if("object"!=typeof t)throw TypeError("target musts be an object");var o=this;function s(e){if("object"!=typeof e)throw TypeError("events must be an object");var n,r=i.reducers,s=w.call(o,t);n=-1===s?new f(o,t,i):o._observers[s];for(var c,l=a(e),u=l.length,d="function"==typeof r,h=0;h<u;h++)c=l[h],n.subscribe(c,e[c]||c,d?r:r&&r[c])}return i=p(i,{on:e,off:e,reducers:e},{on:y,off:y,reducers:v}),n(r)?s(h(r)):s("string"==typeof r?h(r.split(/\s+/)):r),this},M.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var r,i=n.length,o=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;i-- >0;)r=n[i],e&&r._target!==e||(r.unsubscribe(t),o=!0);return o},M.prototype.delimiter=".",M.prototype.setMaxListeners=function(t){t!==e&&(this._maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t)},M.prototype.getMaxListeners=function(){return this._maxListeners},M.prototype.event="",M.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},M.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},M.prototype._once=function(e,t,n,r){return this._many(e,1,t,n,r)},M.prototype.many=function(e,t,n,r){return this._many(e,t,n,!1,r)},M.prototype.prependMany=function(e,t,n,r){return this._many(e,t,n,!0,r)},M.prototype._many=function(e,t,n,r,i){var o=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function s(){return 0==--t&&o.off(e,s),n.apply(this,arguments)}return s._origin=n,this._on(e,s,r,i)},M.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||c.call(this);var e,t,n,r,o,s,a=arguments[0],l=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return!1;if(l&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(n=a.length,i)for(r=0;r<n;r++)if("symbol"==typeof a[r]){s=!0;break}s||(a=a.join(this.delimiter))}var u,d=arguments.length;if(this._all&&this._all.length)for(r=0,n=(u=this._all.slice()).length;r<n;r++)switch(this.event=a,d){case 1:u[r].call(this,a);break;case 2:u[r].call(this,a,arguments[1]);break;case 3:u[r].call(this,a,arguments[1],arguments[2]);break;default:u[r].apply(this,arguments)}if(l)u=[],E.call(this,u,e,this.listenerTree,0,n);else{if("function"==typeof(u=this._events[a])){switch(this.event=a,d){case 1:u.call(this);break;case 2:u.call(this,arguments[1]);break;case 3:u.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(d-1),o=1;o<d;o++)t[o-1]=arguments[o];u.apply(this,t)}return!0}u&&(u=u.slice())}if(u&&u.length){if(d>3)for(t=new Array(d-1),o=1;o<d;o++)t[o-1]=arguments[o];for(r=0,n=u.length;r<n;r++)switch(this.event=a,d){case 1:u[r].call(this);break;case 2:u[r].call(this,arguments[1]);break;case 3:u[r].call(this,arguments[1],arguments[2]);break;default:u[r].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===a)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},M.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||c.call(this);var e,t,n,r,o,s,a=arguments[0],l=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(l&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"==typeof a)){if(r=a.length,i)for(o=0;o<r;o++)if("symbol"==typeof a[o]){t=!0;break}t||(a=a.join(this.delimiter))}var u,d=[],h=arguments.length;if(this._all)for(o=0,r=this._all.length;o<r;o++)switch(this.event=a,h){case 1:d.push(this._all[o].call(this,a));break;case 2:d.push(this._all[o].call(this,a,arguments[1]));break;case 3:d.push(this._all[o].call(this,a,arguments[1],arguments[2]));break;default:d.push(this._all[o].apply(this,arguments))}if(l?(u=[],E.call(this,u,e,this.listenerTree,0)):u=this._events[a],"function"==typeof u)switch(this.event=a,h){case 1:d.push(u.call(this));break;case 2:d.push(u.call(this,arguments[1]));break;case 3:d.push(u.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(h-1),s=1;s<h;s++)n[s-1]=arguments[s];d.push(u.apply(this,n))}else if(u&&u.length){if(u=u.slice(),h>3)for(n=new Array(h-1),s=1;s<h;s++)n[s-1]=arguments[s];for(o=0,r=u.length;o<r;o++)switch(this.event=a,h){case 1:d.push(u[o].call(this));break;case 2:d.push(u[o].call(this,arguments[1]));break;case 3:d.push(u[o].call(this,arguments[1],arguments[2]));break;default:d.push(u[o].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===a)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(d)},M.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},M.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},M.prototype.onAny=function(e){return this._onAny(e,!1)},M.prototype.prependAny=function(e){return this._onAny(e,!0)},M.prototype.addListener=M.prototype.on,M.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},M.prototype._on=function(t,n,r,i){if("function"==typeof t)return this._onAny(t,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");this._events||c.call(this);var o,s=this;return i!==e&&(n=(o=k.call(this,t,n,i))[0],s=o[1]),this._newListener&&this.emit("newListener",t,n),this.wildcard?(S.call(this,t,n,r),s):(this._events[t]?("function"==typeof this._events[t]&&(this._events[t]=[this._events[t]]),r?this._events[t].unshift(n):this._events[t].push(n),!this._events[t].warned&&this._maxListeners>0&&this._events[t].length>this._maxListeners&&(this._events[t].warned=!0,u.call(this,this._events[t].length,t))):this._events[t]=n,s)},M.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();if(!(i=E.call(this,null,o,this.listenerTree,0)))return this}else{if(!this._events[e])return this;r=this._events[e],i.push({_listeners:r})}for(var s=0;s<i.length;s++){var a=i[s];if(r=a._listeners,n(r)){for(var c=-1,l=0,u=r.length;l<u;l++)if(r[l]===t||r[l].listener&&r[l].listener===t||r[l]._origin&&r[l]._origin===t){c=l;break}if(c<0)continue;return this.wildcard?a._listeners.splice(c,1):this._events[e].splice(c,1),0===r.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&C(this.listenerTree),this},M.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(n=0,r=(t=this._all).length;n<r;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,r=t.length;n<r;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},M.prototype.removeListener=M.prototype.off,M.prototype.removeAllListeners=function(t){if(t===e)return!this._events||c.call(this),this;if(this.wildcard){var n,r=E.call(this,null,t,this.listenerTree,0);if(!r)return this;for(n=0;n<r.length;n++)r[n]._listeners=null;this.listenerTree&&C(this.listenerTree)}else this._events&&(this._events[t]=null);return this},M.prototype.listeners=function(t){var n,r,i,o,s,c=this._events;if(t===e){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!c)return[];for(o=(n=a(c)).length,i=[];o-- >0;)"function"==typeof(r=c[n[o]])?i.push(r):i.push.apply(i,r);return i}if(this.wildcard){if(!(s=this.listenerTree))return[];var l=[],u="string"==typeof t?t.split(this.delimiter):t.slice();return E.call(this,l,u,s,0),l}return c&&(r=c[t])?"function"==typeof r?[r]:r:[]},M.prototype.eventNames=function(e){var t=this._events;return this.wildcard?_.call(this,this.listenerTree,[],null,e):t?a(t):[]},M.prototype.listenerCount=function(e){return this.listeners(e).length},M.prototype.hasListeners=function(t){if(this.wildcard){var n=[],r="string"==typeof t?t.split(this.delimiter):t.slice();return E.call(this,n,r,this.listenerTree,0),n.length>0}var i=this._events,o=this._all;return!!(o&&o.length||i&&(t===e?a(i).length:i[t]))},M.prototype.listenersAny=function(){return this._all?this._all:[]},M.prototype.waitFor=function(t,n){var r=this,i=typeof n;return"number"===i?n={timeout:n}:"function"===i&&(n={filter:n}),b((n=p(n,{timeout:0,filter:e,handleError:!1,Promise:Promise,overload:!1},{filter:y,Promise:g})).Promise,(function(e,i,o){function s(){var o=n.filter;if(!o||o.apply(r,arguments))if(r.off(t,s),n.handleError){var a=arguments[0];a?i(a):e(d.apply(null,arguments).slice(1))}else e(d.apply(null,arguments))}o((function(){r.off(t,s)})),r._on(t,s,!1)}),{timeout:n.timeout,overload:n.overload})};var R=M.prototype;Object.defineProperties(M,{defaultMaxListeners:{get:function(){return R._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");R._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return b((n=p(n,{Promise:Promise,timeout:0,overload:!1},{Promise:g})).Promise,(function(n,r,i){var o;if("function"==typeof e.addEventListener)return o=function(){n(d.apply(null,arguments))},i((function(){e.removeEventListener(t,o)})),void e.addEventListener(t,o,{once:!0});var s,a=function(){s&&e.removeListener("error",s),n(d.apply(null,arguments))};"error"!==t&&(s=function(n){e.removeListener(t,a),r(n)},e.once("error",s)),i((function(){s&&e.removeListener("error",s),e.removeListener(t,a)})),e.once(t,a)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(R,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),"function"==typeof e&&e.amd?e((function(){return M})):Mt.exports=M}();var Pt,Tt=xt.exports,It=new Uint8Array(16);function Ot(){if(!Pt&&!(Pt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pt(It)}var Nt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Lt(e){return"string"==typeof e&&Nt.test(e)}for(var Bt=[],Dt=0;Dt<256;++Dt)Bt.push((Dt+256).toString(16).substr(1));function Kt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Bt[e[t+0]]+Bt[e[t+1]]+Bt[e[t+2]]+Bt[e[t+3]]+"-"+Bt[e[t+4]]+Bt[e[t+5]]+"-"+Bt[e[t+6]]+Bt[e[t+7]]+"-"+Bt[e[t+8]]+Bt[e[t+9]]+"-"+Bt[e[t+10]]+Bt[e[t+11]]+Bt[e[t+12]]+Bt[e[t+13]]+Bt[e[t+14]]+Bt[e[t+15]]).toLowerCase();if(!Lt(n))throw TypeError("Stringified UUID is invalid");return n}function jt(e,t,n){function r(e,r,i,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=function(e){if(!Lt(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(r),s.set(e,r.length),(s=n(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,i){o=o||0;for(var a=0;a<16;++a)i[o+a]=s[a];return i}return Kt(s)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function Ut(e){return 14+(e+64>>>9<<4)+1}function $t(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function Ft(e,t,n,r,i,o){return $t((s=$t($t(t,e),$t(r,o)))<<(a=i)|s>>>32-a,n);var s,a}function Ht(e,t,n,r,i,o,s){return Ft(t&n|~t&r,e,t,i,o,s)}function qt(e,t,n,r,i,o,s){return Ft(t&r|n&~r,e,t,i,o,s)}function zt(e,t,n,r,i,o,s){return Ft(t^n^r,e,t,i,o,s)}function Wt(e,t,n,r,i,o,s){return Ft(n^(t|~r),e,t,i,o,s)}function Vt(e,t,n){var r=(e=e||{}).random||(e.rng||Ot)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Kt(r)}function Gt(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function Yt(e,t){return e<<t|e>>>32-t}jt("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var o=e[i>>5]>>>i%32&255,s=parseInt(r.charAt(o>>>4&15)+r.charAt(15&o),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[Ut(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,c=r,l=i,u=o;n=Ht(n,r,i,o,e[s],7,-680876936),o=Ht(o,n,r,i,e[s+1],12,-389564586),i=Ht(i,o,n,r,e[s+2],17,606105819),r=Ht(r,i,o,n,e[s+3],22,-1044525330),n=Ht(n,r,i,o,e[s+4],7,-176418897),o=Ht(o,n,r,i,e[s+5],12,1200080426),i=Ht(i,o,n,r,e[s+6],17,-1473231341),r=Ht(r,i,o,n,e[s+7],22,-45705983),n=Ht(n,r,i,o,e[s+8],7,1770035416),o=Ht(o,n,r,i,e[s+9],12,-1958414417),i=Ht(i,o,n,r,e[s+10],17,-42063),r=Ht(r,i,o,n,e[s+11],22,-1990404162),n=Ht(n,r,i,o,e[s+12],7,1804603682),o=Ht(o,n,r,i,e[s+13],12,-40341101),i=Ht(i,o,n,r,e[s+14],17,-1502002290),n=qt(n,r=Ht(r,i,o,n,e[s+15],22,1236535329),i,o,e[s+1],5,-165796510),o=qt(o,n,r,i,e[s+6],9,-1069501632),i=qt(i,o,n,r,e[s+11],14,643717713),r=qt(r,i,o,n,e[s],20,-373897302),n=qt(n,r,i,o,e[s+5],5,-701558691),o=qt(o,n,r,i,e[s+10],9,38016083),i=qt(i,o,n,r,e[s+15],14,-660478335),r=qt(r,i,o,n,e[s+4],20,-405537848),n=qt(n,r,i,o,e[s+9],5,568446438),o=qt(o,n,r,i,e[s+14],9,-1019803690),i=qt(i,o,n,r,e[s+3],14,-187363961),r=qt(r,i,o,n,e[s+8],20,1163531501),n=qt(n,r,i,o,e[s+13],5,-1444681467),o=qt(o,n,r,i,e[s+2],9,-51403784),i=qt(i,o,n,r,e[s+7],14,1735328473),n=zt(n,r=qt(r,i,o,n,e[s+12],20,-1926607734),i,o,e[s+5],4,-378558),o=zt(o,n,r,i,e[s+8],11,-2022574463),i=zt(i,o,n,r,e[s+11],16,1839030562),r=zt(r,i,o,n,e[s+14],23,-35309556),n=zt(n,r,i,o,e[s+1],4,-1530992060),o=zt(o,n,r,i,e[s+4],11,1272893353),i=zt(i,o,n,r,e[s+7],16,-155497632),r=zt(r,i,o,n,e[s+10],23,-1094730640),n=zt(n,r,i,o,e[s+13],4,681279174),o=zt(o,n,r,i,e[s],11,-358537222),i=zt(i,o,n,r,e[s+3],16,-722521979),r=zt(r,i,o,n,e[s+6],23,76029189),n=zt(n,r,i,o,e[s+9],4,-640364487),o=zt(o,n,r,i,e[s+12],11,-421815835),i=zt(i,o,n,r,e[s+15],16,530742520),n=Wt(n,r=zt(r,i,o,n,e[s+2],23,-995338651),i,o,e[s],6,-198630844),o=Wt(o,n,r,i,e[s+7],10,1126891415),i=Wt(i,o,n,r,e[s+14],15,-1416354905),r=Wt(r,i,o,n,e[s+5],21,-57434055),n=Wt(n,r,i,o,e[s+12],6,1700485571),o=Wt(o,n,r,i,e[s+3],10,-1894986606),i=Wt(i,o,n,r,e[s+10],15,-1051523),r=Wt(r,i,o,n,e[s+1],21,-2054922799),n=Wt(n,r,i,o,e[s+8],6,1873313359),o=Wt(o,n,r,i,e[s+15],10,-30611744),i=Wt(i,o,n,r,e[s+6],15,-1560198380),r=Wt(r,i,o,n,e[s+13],21,1309151649),n=Wt(n,r,i,o,e[s+4],6,-145523070),o=Wt(o,n,r,i,e[s+11],10,-1120210379),i=Wt(i,o,n,r,e[s+2],15,718787259),r=Wt(r,i,o,n,e[s+9],21,-343485551),n=$t(n,a),r=$t(r,c),i=$t(i,l),o=$t(o,u)}return[n,r,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(Ut(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))})),jt("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s),c=0;c<s;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];a[c]=l}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<s;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=a[d][f];for(var p=16;p<80;++p)h[p]=Yt(h[p-3]^h[p-8]^h[p-14]^h[p-16],1);for(var g=n[0],m=n[1],y=n[2],v=n[3],b=n[4],w=0;w<80;++w){var E=Math.floor(w/20),S=Yt(g,5)+Gt(E,m,y,v)+b+t[E]+h[w]>>>0;b=v,v=y,y=Yt(m,30)>>>0,m=g,g=S}n[0]=n[0]+g>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+v>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}));const Jt=Object.create(null);Jt.open="0",Jt.close="1",Jt.ping="2",Jt.pong="3",Jt.message="4",Jt.upgrade="5",Jt.noop="6";const Zt=Object.create(null);Object.keys(Jt).forEach((e=>{Zt[Jt[e]]=e}));const Qt={type:"error",data:"parser error"},Xt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),en="function"==typeof ArrayBuffer,tn=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,nn=({type:e,data:t},n,r)=>Xt&&t instanceof Blob?n?r(t):rn(t,r):en&&(t instanceof ArrayBuffer||tn(t))?n?r(t):rn(new Blob([t]),r):r(Jt[e]+(t||"")),rn=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function on(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let sn;function an(e,t){return Xt&&e.data instanceof Blob?e.data.arrayBuffer().then(on).then(t):en&&(e.data instanceof ArrayBuffer||tn(e.data))?t(on(e.data)):void nn(e,!1,(e=>{sn||(sn=new TextEncoder),t(sn.encode(e))}))}const cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ln="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)ln[cn.charCodeAt(e)]=e;const un="function"==typeof ArrayBuffer,dn=(e,t)=>{if("string"!=typeof e)return{type:"message",data:fn(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:hn(e.substring(1),t)};return Zt[n]?e.length>1?{type:Zt[n],data:e.substring(1)}:{type:Zt[n]}:Qt},hn=(e,t)=>{if(un){const n=(e=>{let t,n,r,i,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);const l=new ArrayBuffer(s),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=ln[e.charCodeAt(t)],r=ln[e.charCodeAt(t+1)],i=ln[e.charCodeAt(t+2)],o=ln[e.charCodeAt(t+3)],u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&o;return l})(e);return fn(n,t)}return{base64:!0,data:e}},fn=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,pn=String.fromCharCode(30);let gn;var mn=yn;function yn(e){if(e)return function(e){for(var t in yn.prototype)e[t]=yn.prototype[t];return e}(e)}yn.prototype.on=yn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},yn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},yn.prototype.off=yn.prototype.removeListener=yn.prototype.removeAllListeners=yn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},yn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t)}return this},yn.prototype.emitReserved=yn.prototype.emit,yn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},yn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const vn="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function bn(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const wn=vn.setTimeout,En=vn.clearTimeout;function Sn(e,t){t.useNativeTimers?(e.setTimeoutFn=wn.bind(vn),e.clearTimeoutFn=En.bind(vn)):(e.setTimeoutFn=vn.setTimeout.bind(vn),e.clearTimeoutFn=vn.clearTimeout.bind(vn))}const _n=He("engine.io-client:transport");class Cn extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class An extends mn{constructor(e){super(),this.writable=!1,Sn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Cn(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):_n("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=dn(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}const kn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Mn=64,Rn={};let xn,Pn=0,Tn=0;function In(e){let t="";do{t=kn[e%Mn]+t,e=Math.floor(e/Mn)}while(e>0);return t}function On(){const e=In(+new Date);return e!==xn?(Pn=0,xn=e):e+"."+In(Pn++)}for(;Tn<Mn;Tn++)Rn[kn[Tn]]=Tn;let Nn=!1;try{Nn="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const Ln=Nn;function Bn(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Ln))return new XMLHttpRequest}catch(e){}if(!t)try{return new(vn[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}const Dn=He("engine.io-client:polling");function Kn(){}const jn=null!=new Bn({xdomain:!1}).responseType;class Un extends mn{constructor(e,t){super(),Sn(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=bn(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new Bn(t);try{Dn("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(n)),4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof n.status?n.status:0)}),0))},Dn("xhr data %s",this.data),n.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Un.requestsCount++,Un.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Kn,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Un.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Un.requestsCount=0,Un.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",$n);else if("function"==typeof addEventListener){addEventListener("onpagehide"in vn?"pagehide":"unload",$n,!1)}function $n(){for(let e in Un.requests)Un.requests.hasOwnProperty(e)&&Un.requests[e].abort()}const Fn="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Hn=vn.WebSocket||vn.MozWebSocket,qn=He("engine.io-client:websocket"),zn="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const Wn=He("engine.io-client:webtransport");function Vn(e,t){return"message"===e.type&&"string"!=typeof e.data&&t[0]>=48&&t[0]<=54}const Gn={websocket:class extends An{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=zn?{}:bn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=zn?new Hn(e,t,n):t?new Hn(e,t):new Hn(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;nn(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){qn("websocket closed before onclose event")}r&&Fn((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=On()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Hn}},webtransport:class extends An{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{Wn("transport closed gracefully"),this.onClose()})).catch((e=>{Wn("transport closed due to %s",e),this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=e.readable.getReader();let n;this.writer=e.writable.getWriter();const r=()=>{t.read().then((({done:e,value:t})=>{e?Wn("session is closed"):(Wn("received chunk: %o",t),n||1!==t.byteLength||54!==t[0]?(this.onPacket(function(e,t,n){gn||(gn=new TextDecoder);const r=t||e[0]<48||e[0]>54;return dn(r?e:gn.decode(e),n)}(t,n,"arraybuffer")),n=!1):n=!0,r())})).catch((e=>{Wn("an error occurred while reading: %s",e)}))};r();const i=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write((new TextEncoder).encode(i)).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;an(n,(e=>{Vn(n,e)&&(Wn("writing binary header"),this.writer.write(Uint8Array.of(54))),Wn("writing chunk: %o",e),this.writer.write(e).then((()=>{r&&Fn((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends An{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=jn&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{Dn("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(Dn("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){Dn("pre-pause polling complete"),--e||t()}))),this.writable||(Dn("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){Dn("pre-pause writing complete"),--e||t()})))}else t()}poll(){Dn("polling"),this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){Dn("polling got data %s",e);((e,t)=>{const n=e.split(pn),r=[];for(let e=0;e<n.length;e++){const i=dn(n[e],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this.poll():Dn('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{Dn("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(Dn("transport open - closing"),e()):(Dn("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach(((e,o)=>{nn(e,!1,(e=>{r[o]=e,++i===n&&t(r.join(pn))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=On()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Un(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){Dn("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},Yn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Jn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Zn(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=Yn.exec(e||""),o={},s=14;for(;s--;)o[Jn[s]]=i[s]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,o.path),o.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,o.query),o}const Qn=He("engine.io-client:socket");let Xn=class e extends mn{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Zn(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Zn(t.host).host),Sn(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,r=n.length;e<r;e++){let r=n[e].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){Qn('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return Qn("options: %j",n),new Gn[e](n)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return Qn("error while creating transport: %s",e),this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(e){Qn("setting transport %s",e.name),this.transport&&(Qn("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(t){Qn('probing transport "%s"',t);let n=this.createTransport(t),r=!1;e.priorWebsocketSuccess=!1;const i=()=>{r||(Qn('probe transport "%s" opened',t),n.send([{type:"ping",data:"probe"}]),n.once("packet",(i=>{if(!r)if("pong"===i.type&&"probe"===i.data){if(Qn('probe transport "%s" pong',t),this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;e.priorWebsocketSuccess="websocket"===n.name,Qn('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{r||"closed"!==this.readyState&&(Qn("changing transport and sending upgrade packet"),u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())}))}else{Qn('probe transport "%s" failed',t);const e=new Error("probe error");e.transport=n.name,this.emitReserved("upgradeError",e)}})))};function o(){r||(r=!0,u(),n.close(),n=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=n.name,o(),Qn('probe transport "%s" failed because of error: %s',t,e),this.emitReserved("upgradeError",r)};function a(){s("transport closed")}function c(){s("socket closed")}function l(e){n&&e.name!==n.name&&(Qn('"%s" works - aborting "%s"',e.name,n.name),o())}const u=()=>{n.removeListener("open",i),n.removeListener("error",s),n.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};n.once("open",i),n.once("error",s),n.once("close",a),this.once("close",c),this.once("upgrading",l),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{r||n.open()}),200):n.open()}onOpen(){if(Qn("socket open"),this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){Qn("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Qn('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else Qn('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();Qn("flushing %d packets in socket",e.length),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"==typeof(t=r)?function(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return Qn("only send %d out of %d packets",n,this.writeBuffer.length),this.writeBuffer.slice(0,n);e+=2}var t;return Qn("payload size is %d (max: %d)",e,this.maxPayload),this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),Qn("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(t){Qn("socket error %j",t),e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(Qn('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};Xn.protocol=4,Xn.protocol;const er=He("socket.io-client:url");const tr="function"==typeof ArrayBuffer,nr=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,rr=Object.prototype.toString,ir="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===rr.call(Blob),or="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===rr.call(File);function sr(e){return tr&&(e instanceof ArrayBuffer||nr(e))||ir&&e instanceof Blob||or&&e instanceof File}function ar(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(ar(e[t]))return!0;return!1}if(sr(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return ar(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&ar(e[t]))return!0;return!1}function cr(e){const t=[],n=e.data,r=e;return r.data=lr(n,t),r.attachments=t.length,{packet:r,buffers:t}}function lr(e,t){if(!e)return e;if(sr(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=lr(e[r],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=lr(e[r],t));return n}return e}function ur(e,t){return e.data=dr(e.data,t),delete e.attachments,e}function dr(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=dr(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=dr(e[n],t));return e}const hr=He("socket.io-parser"),fr=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var pr;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(pr||(pr={}));function gr(e){return"[object Object]"===Object.prototype.toString.call(e)}class mr extends mn{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===pr.BINARY_EVENT;n||t.type===pr.BINARY_ACK?(t.type=n?pr.EVENT:pr.ACK,this.reconstructor=new yr(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!sr(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===pr[n.type])throw new Error("unknown packet type "+n.type);if(n.type===pr.BINARY_EVENT||n.type===pr.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(r,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!mr.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return hr("decoded %s as %j",e,n),n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case pr.CONNECT:return gr(t);case pr.DISCONNECT:return void 0===t;case pr.CONNECT_ERROR:return"string"==typeof t||gr(t);case pr.EVENT:case pr.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===fr.indexOf(t[0]));case pr.ACK:case pr.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class yr{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ur(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var vr=Object.freeze({__proto__:null,Decoder:mr,Encoder:class{constructor(e){this.replacer=e}encode(e){return hr("encoding packet %j",e),e.type!==pr.EVENT&&e.type!==pr.ACK||!ar(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===pr.EVENT?pr.BINARY_EVENT:pr.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==pr.BINARY_EVENT&&e.type!==pr.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),hr("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=cr(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}},get PacketType(){return pr},protocol:5});function br(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const wr=He("socket.io-client:socket"),Er=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Sr extends mn{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[br(e,"open",this.onopen.bind(this)),br(e,"packet",this.onpacket.bind(this)),br(e,"error",this.onerror.bind(this)),br(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Er.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:pr.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++;wr("emitting packet with ack id %d",e);const r=t.pop();this._registerAckCallback(e,r),n.id=e}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)?wr("discard packet as the transport is not currently writable"):this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n),this.flags={},this}_registerAckCallback(e,t){var n;const r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===r)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&(wr("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(t,1));wr("event with ack id %d has timed out after %d ms",e,r),t.call(this,new Error("operation has timed out"))}),r);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])}}emitWithAck(e,...t){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((r,i)=>{t.push(((e,t)=>n?e?i(e):r(t):r(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...r)=>{if(n!==this._queue[0])return;return null!==e?n.tryCount>this._opts.retries&&(wr("packet [%d] is discarded after %d tries",n.id,n.tryCount),this._queue.shift(),t&&t(e)):(wr("packet [%d] was successfully sent",n.id),this._queue.shift(),t&&t(null,...r)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(wr("draining queue"),!this.connected||0===this._queue.length)return;const t=this._queue[0];!t.pending||e?(t.pending=!0,t.tryCount++,wr("sending packet [%d] (try n°%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)):wr("packet [%d] has already been sent and is waiting for an ack",t.id)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){wr("transport is open - connecting"),"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:pr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){wr("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case pr.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case pr.EVENT:case pr.BINARY_EVENT:this.onevent(e);break;case pr.ACK:case pr.BINARY_ACK:this.onack(e);break;case pr.DISCONNECT:this.ondisconnect();break;case pr.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];wr("emitting event %j",t),null!=e.id&&(wr("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...r){n||(n=!0,wr("sending ack %j",r),t.packet({type:pr.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(wr("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):wr("bad ack %s",e.id)}onconnect(e,t){wr("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){wr("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(wr("performing disconnect (%s)",this.nsp),this.packet({type:pr.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function _r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}_r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},_r.prototype.reset=function(){this.attempts=0},_r.prototype.setMin=function(e){this.ms=e},_r.prototype.setMax=function(e){this.max=e},_r.prototype.setJitter=function(e){this.jitter=e};const Cr=He("socket.io-client:manager");class Ar extends mn{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Sn(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new _r({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||vr;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(Cr("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;Cr("opening %s",this.uri),this.engine=new Xn(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=br(t,"open",(function(){n.onopen(),e&&e()})),i=t=>{Cr("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},o=br(t,"error",i);if(!1!==this._timeout){const e=this._timeout;Cr("connect attempt will timeout after %d",e);const n=this.setTimeoutFn((()=>{Cr("connect attempt timed out after %d",e),r(),i(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){Cr("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(br(e,"ping",this.onping.bind(this)),br(e,"data",this.ondata.bind(this)),br(e,"error",this.onerror.bind(this)),br(e,"close",this.onclose.bind(this)),br(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){Fn((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){Cr("error",e),this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Sr(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t){if(this.nsps[e].active)return void Cr("socket %s is still active, skipping close",e)}this._close()}_packet(e){Cr("writing packet %j",e);const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){Cr("cleanup"),this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){Cr("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){Cr("closed due to %s",e),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)Cr("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();Cr("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(Cr("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(Cr("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(Cr("reconnect success"),e.onreconnect())})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const kr=He("socket.io-client"),Mr={};function Rr(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(er("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),er("parse %s",e),r=Zn(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=Mr[i]&&o in Mr[i].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?(kr("ignoring socket cache for %s",r),a=new Ar(r,t)):(Mr[i]||(kr("new io instance for %s",r),Mr[i]=new Ar(r,t)),a=Mr[i]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}function xr(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}Object.assign(Rr,{Manager:Ar,Socket:Sr,io:Rr,connect:Rr}),"function"==typeof SuppressedError&&SuppressedError;var Pr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==p?p:"undefined"!=typeof self?self:{};function Tr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ir={},Or={},Nr={};function Lr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Br(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function Dr(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function Kr(e,...t){if(!Dr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function jr(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("hash must be wrapped by utils.wrapConstructor");Lr(e.outputLen),Lr(e.blockLen)}function Ur(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function $r(e,t){Kr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.isBytes=Dr,Nr.number=Lr,Nr.bool=Br,Nr.bytes=Kr,Nr.hash=jr,Nr.exists=Ur,Nr.output=$r;const Fr={number:Lr,bool:Br,bytes:Kr,hash:jr,exists:Ur,output:$r};Nr.default=Fr,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapCipher=e.Hash=e.nextTick=e.isLE=e.createView=e.u32=e.u16=e.u8=void 0,e.bytesToHex=r,e.hexToBytes=s,e.hexToNumber=a,e.bytesToNumberBE=function(e){return a(r(e))},e.numberToBytesBE=function(e,t){return s(e.toString(16).padStart(2*t,"0"))},e.asyncLoop=async function(t,n,r){let i=Date.now();for(let o=0;o<t;o++){r(o);const t=Date.now()-i;t>=0&&t<n||(await(0,e.nextTick)(),i+=t)}},e.utf8ToBytes=c,e.bytesToUtf8=function(e){return(new TextDecoder).decode(e)},e.toBytes=function(e){if("string"==typeof e)e=c(e);else{if(!(0,t.isBytes)(e))throw new Error("Uint8Array expected, got "+typeof e);e=u(e)}return e},e.concatBytes=function(...e){let n=0;for(let r=0;r<e.length;r++){const i=e[r];(0,t.bytes)(i),n+=i.length}const r=new Uint8Array(n);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r},e.checkOpts=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)},e.equalBytes=function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},e.setBigUint64=l,e.u64Lengths=function(t,n){const r=new Uint8Array(16),i=(0,e.createView)(r);return l(i,0,BigInt(n?n.length:0),!0),l(i,8,BigInt(t.length),!0),r},e.isAligned32=function(e){return e.byteOffset%4==0},e.copyBytes=u,e.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)};const t=Nr;if(e.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),e.u16=e=>new Uint16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2)),e.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),e.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],!e.isLE)throw new Error("Non little-endian hardware is not supported");const n=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function r(e){(0,t.bytes)(e);let r="";for(let t=0;t<e.length;t++)r+=n[e[t]];return r}const i={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function o(e){return e>=i._0&&e<=i._9?e-i._0:e>=i._A&&e<=i._F?e-(i._A-10):e>=i._a&&e<=i._f?e-(i._a-10):void 0}function s(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=o(e.charCodeAt(i)),s=o(e.charCodeAt(i+1));if(void 0===n||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+s}return r}function a(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function c(e){if("string"!=typeof e)throw new Error("string expected, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function l(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,l=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+l,a,r)}function u(e){return Uint8Array.from(e)}e.nextTick=async()=>{},e.Hash=class{},e.wrapCipher=(e,t)=>(Object.assign(t,e),t)}(Or);var Hr={},qr={};Object.defineProperty(qr,"__esModule",{value:!0}),qr.AEAD_TAG_LENGTH=qr.XCHACHA20_NONCE_LENGTH=qr.CURVE25519_PUBLIC_KEY_SIZE=qr.ETH_PUBLIC_KEY_SIZE=qr.UNCOMPRESSED_PUBLIC_KEY_SIZE=qr.COMPRESSED_PUBLIC_KEY_SIZE=qr.SECRET_KEY_LENGTH=void 0,qr.SECRET_KEY_LENGTH=32,qr.COMPRESSED_PUBLIC_KEY_SIZE=33,qr.UNCOMPRESSED_PUBLIC_KEY_SIZE=65,qr.ETH_PUBLIC_KEY_SIZE=64,qr.CURVE25519_PUBLIC_KEY_SIZE=32,qr.XCHACHA20_NONCE_LENGTH=24,qr.AEAD_TAG_LENGTH=16,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ephemeralKeySize=e.symmetricNonceLength=e.symmetricAlgorithm=e.isHkdfKeyCompressed=e.isEphemeralKeyCompressed=e.ellipticCurve=e.ECIES_CONFIG=void 0;var t=qr;e.ECIES_CONFIG=new function(){this.ellipticCurve="secp256k1",this.isEphemeralKeyCompressed=!1,this.isHkdfKeyCompressed=!1,this.symmetricAlgorithm="aes-256-gcm",this.symmetricNonceLength=16},e.ellipticCurve=function(){return e.ECIES_CONFIG.ellipticCurve},e.isEphemeralKeyCompressed=function(){return e.ECIES_CONFIG.isEphemeralKeyCompressed},e.isHkdfKeyCompressed=function(){return e.ECIES_CONFIG.isHkdfKeyCompressed},e.symmetricAlgorithm=function(){return e.ECIES_CONFIG.symmetricAlgorithm},e.symmetricNonceLength=function(){return e.ECIES_CONFIG.symmetricNonceLength},e.ephemeralKeySize=function(){var n={secp256k1:e.ECIES_CONFIG.isEphemeralKeyCompressed?t.COMPRESSED_PUBLIC_KEY_SIZE:t.UNCOMPRESSED_PUBLIC_KEY_SIZE,x25519:t.CURVE25519_PUBLIC_KEY_SIZE,ed25519:t.CURVE25519_PUBLIC_KEY_SIZE};if(e.ECIES_CONFIG.ellipticCurve in n)return n[e.ECIES_CONFIG.ellipticCurve];throw new Error("Not implemented")}}(Hr);var zr={},Wr={},Vr={},Gr={},Yr={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.crypto=void 0;const Zr=n;Jr.crypto=Zr&&"object"==typeof Zr&&"webcrypto"in Zr?Zr.webcrypto:Zr&&"object"==typeof Zr&&"randomBytes"in Zr?Zr:void 0,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.gcm=e.ctr=e.cbc=e.utils=void 0,e.randomBytes=i,e.getWebcryptoSubtle=o,e.managedNonce=function(e){return(0,n.number)(e.nonceLength),(t,...n)=>({encrypt(o,...s){const{nonceLength:a}=e,c=i(a),l=e(t,c,...n).encrypt(o,...s),u=(0,r.concatBytes)(c,l);return l.fill(0),u},decrypt(r,...i){const{nonceLength:o}=e,s=r.subarray(0,o),a=r.subarray(o);return e(t,s,...n).decrypt(a,...i)}})};const t=Jr,n=Nr,r=Or;function i(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return t.crypto.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function o(){if(t.crypto&&"object"==typeof t.crypto.subtle&&null!=t.crypto.subtle)return t.crypto.subtle;throw new Error("crypto.subtle must be defined")}e.utils={async encrypt(e,t,n,r){const i=o(),s=await i.importKey("raw",e,t,!0,["encrypt"]),a=await i.encrypt(n,s,r);return new Uint8Array(a)},async decrypt(e,t,n,r){const i=o(),s=await i.importKey("raw",e,t,!0,["decrypt"]),a=await i.decrypt(n,s,r);return new Uint8Array(a)}};const s="AES-CBC",a="AES-CTR",c="AES-GCM";function l(t){return(r,i,o)=>{(0,n.bytes)(r),(0,n.bytes)(i);const l={name:t,length:8*r.length},u=function(e,t,n){if(e===s)return{name:s,iv:t};if(e===a)return{name:a,counter:t,length:64};if(e===c)return n?{name:c,iv:t,additionalData:n}:{name:c,iv:t};throw new Error("unknown aes block mode")}(t,i,o);return{encrypt:t=>((0,n.bytes)(t),e.utils.encrypt(r,l,u,t)),decrypt:t=>((0,n.bytes)(t),e.utils.decrypt(r,l,u,t))}}}e.cbc=l(s),e.ctr=l(a),e.gcm=l(c)}(Yr);var Qr={},Xr={},ei={},ti={};function ni(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function ri(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function ii(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function oi(e,...t){if(!ii(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function si(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ni(e.outputLen),ni(e.blockLen)}function ai(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ci(e,t){oi(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}Object.defineProperty(ti,"__esModule",{value:!0}),ti.isBytes=ii,ti.number=ni,ti.bool=ri,ti.bytes=oi,ti.hash=si,ti.exists=ai,ti.output=ci;const li={number:ni,bool:ri,bytes:oi,hash:si,exists:ai,output:ci};ti.default=li;var ui={},di={};Object.defineProperty(di,"__esModule",{value:!0}),di.crypto=void 0;const hi=n;di.crypto=hi&&"object"==typeof hi&&"webcrypto"in hi?hi.webcrypto:hi&&"object"==typeof hi&&"randomBytes"in hi?hi:void 0,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Hash=e.nextTick=e.byteSwapIfBE=e.byteSwap=e.isLE=e.rotl=e.rotr=e.createView=e.u32=e.u8=void 0,e.isBytes=function(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name},e.byteSwap32=function(t){for(let n=0;n<t.length;n++)t[n]=(0,e.byteSwap)(t[n])},e.bytesToHex=function(e){(0,n.bytes)(e);let t="";for(let n=0;n<e.length;n++)t+=r[e[n]];return t},e.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=o(e.charCodeAt(i)),s=o(e.charCodeAt(i+1));if(void 0===n||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+s}return r},e.asyncLoop=async function(t,n,r){let i=Date.now();for(let o=0;o<t;o++){r(o);const t=Date.now()-i;t>=0&&t<n||(await(0,e.nextTick)(),i+=t)}},e.utf8ToBytes=s,e.toBytes=a,e.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];(0,n.bytes)(i),t+=i.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r},e.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==c.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)},e.wrapConstructor=function(e){const t=t=>e().update(a(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t},e.wrapConstructorWithOpts=function(e){const t=(t,n)=>e(n).update(a(t)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t},e.wrapXOFConstructorWithOpts=function(e){const t=(t,n)=>e(n).update(a(t)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t},e.randomBytes=function(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return t.crypto.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")};const t=di,n=ti;e.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),e.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),e.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.rotr=(e,t)=>e<<32-t|e>>>t,e.rotl=(e,t)=>e<<t|e>>>32-t>>>0,e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],e.byteSwap=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255,e.byteSwapIfBE=e.isLE?e=>e:t=>(0,e.byteSwap)(t);const r=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0"))),i={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function o(e){return e>=i._0&&e<=i._9?e-i._0:e>=i._A&&e<=i._F?e-(i._A-10):e>=i._a&&e<=i._f?e-(i._a-10):void 0}function s(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function a(e){return"string"==typeof e&&(e=s(e)),(0,n.bytes)(e),e}e.nextTick=async()=>{},e.Hash=class{clone(){return this._cloneInto()}};const c={}.toString}(ui),Object.defineProperty(ei,"__esModule",{value:!0}),ei.HashMD=ei.Maj=ei.Chi=void 0;const fi=ti,pi=ui;ei.Chi=(e,t,n)=>e&t^~e&n,ei.Maj=(e,t,n)=>e&t^e&n^t&n,ei.HashMD=class extends pi.Hash{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,pi.createView)(this.buffer)}update(e){(0,fi.exists)(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=(0,pi.toBytes)(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=(0,pi.createView)(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,fi.exists)(this),(0,fi.output)(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,l=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=(0,pi.createView)(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,l[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}};var gi={};Object.defineProperty(gi,"__esModule",{value:!0}),gi.add5L=gi.add5H=gi.add4H=gi.add4L=gi.add3H=gi.add3L=gi.rotlBL=gi.rotlBH=gi.rotlSL=gi.rotlSH=gi.rotr32L=gi.rotr32H=gi.rotrBL=gi.rotrBH=gi.rotrSL=gi.rotrSH=gi.shrSL=gi.shrSH=gi.toBig=void 0,gi.fromBig=vi,gi.split=bi,gi.add=Oi;const mi=BigInt(2**32-1),yi=BigInt(32);function vi(e,t=!1){return t?{h:Number(e&mi),l:Number(e>>yi&mi)}:{h:0|Number(e>>yi&mi),l:0|Number(e&mi)}}function bi(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:o,l:s}=vi(e[i],t);[n[i],r[i]]=[o,s]}return[n,r]}const wi=(e,t)=>BigInt(e>>>0)<<yi|BigInt(t>>>0);gi.toBig=wi;const Ei=(e,t,n)=>e>>>n;gi.shrSH=Ei;const Si=(e,t,n)=>e<<32-n|t>>>n;gi.shrSL=Si;const _i=(e,t,n)=>e>>>n|t<<32-n;gi.rotrSH=_i;const Ci=(e,t,n)=>e<<32-n|t>>>n;gi.rotrSL=Ci;const Ai=(e,t,n)=>e<<64-n|t>>>n-32;gi.rotrBH=Ai;const ki=(e,t,n)=>e>>>n-32|t<<64-n;gi.rotrBL=ki;const Mi=(e,t)=>t;gi.rotr32H=Mi;const Ri=(e,t)=>e;gi.rotr32L=Ri;const xi=(e,t,n)=>e<<n|t>>>32-n;gi.rotlSH=xi;const Pi=(e,t,n)=>t<<n|e>>>32-n;gi.rotlSL=Pi;const Ti=(e,t,n)=>t<<n-32|e>>>64-n;gi.rotlBH=Ti;const Ii=(e,t,n)=>e<<n-32|t>>>64-n;function Oi(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:0|i}}gi.rotlBL=Ii;const Ni=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0);gi.add3L=Ni;const Li=(e,t,n,r)=>t+n+r+(e/2**32|0)|0;gi.add3H=Li;const Bi=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0);gi.add4L=Bi;const Di=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0;gi.add4H=Di;const Ki=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0);gi.add5L=Ki;const ji=(e,t,n,r,i,o)=>t+n+r+i+o+(e/2**32|0)|0;gi.add5H=ji;const Ui={fromBig:vi,split:bi,toBig:wi,shrSH:Ei,shrSL:Si,rotrSH:_i,rotrSL:Ci,rotrBH:Ai,rotrBL:ki,rotr32H:Mi,rotr32L:Ri,rotlSH:xi,rotlSL:Pi,rotlBH:Ti,rotlBL:Ii,add:Oi,add3L:Ni,add3H:Li,add4L:Bi,add4H:Di,add5H:ji,add5L:Ki};gi.default=Ui,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.sha384=Xr.sha512_256=Xr.sha512_224=Xr.sha512=Xr.SHA384=Xr.SHA512_256=Xr.SHA512_224=Xr.SHA512=void 0;const $i=ei,Fi=gi,Hi=ui,[qi,zi]=Fi.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))),Wi=new Uint32Array(80),Vi=new Uint32Array(80);class Gi extends $i.HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:o,Dh:s,Dl:a,Eh:c,El:l,Fh:u,Fl:d,Gh:h,Gl:f,Hh:p,Hl:g}=this;return[e,t,n,r,i,o,s,a,c,l,u,d,h,f,p,g]}set(e,t,n,r,i,o,s,a,c,l,u,d,h,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|l,this.Fh=0|u,this.Fl=0|d,this.Gh=0|h,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let n=0;n<16;n++,t+=4)Wi[n]=e.getUint32(t),Vi[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Wi[e-15],n=0|Vi[e-15],r=Fi.default.rotrSH(t,n,1)^Fi.default.rotrSH(t,n,8)^Fi.default.shrSH(t,n,7),i=Fi.default.rotrSL(t,n,1)^Fi.default.rotrSL(t,n,8)^Fi.default.shrSL(t,n,7),o=0|Wi[e-2],s=0|Vi[e-2],a=Fi.default.rotrSH(o,s,19)^Fi.default.rotrBH(o,s,61)^Fi.default.shrSH(o,s,6),c=Fi.default.rotrSL(o,s,19)^Fi.default.rotrBL(o,s,61)^Fi.default.shrSL(o,s,6),l=Fi.default.add4L(i,c,Vi[e-7],Vi[e-16]),u=Fi.default.add4H(l,r,a,Wi[e-7],Wi[e-16]);Wi[e]=0|u,Vi[e]=0|l}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:s,Cl:a,Dh:c,Dl:l,Eh:u,El:d,Fh:h,Fl:f,Gh:p,Gl:g,Hh:m,Hl:y}=this;for(let e=0;e<80;e++){const t=Fi.default.rotrSH(u,d,14)^Fi.default.rotrSH(u,d,18)^Fi.default.rotrBH(u,d,41),v=Fi.default.rotrSL(u,d,14)^Fi.default.rotrSL(u,d,18)^Fi.default.rotrBL(u,d,41),b=u&h^~u&p,w=d&f^~d&g,E=Fi.default.add5L(y,v,w,zi[e],Vi[e]),S=Fi.default.add5H(E,m,t,b,qi[e],Wi[e]),_=0|E,C=Fi.default.rotrSH(n,r,28)^Fi.default.rotrBH(n,r,34)^Fi.default.rotrBH(n,r,39),A=Fi.default.rotrSL(n,r,28)^Fi.default.rotrBL(n,r,34)^Fi.default.rotrBL(n,r,39),k=n&i^n&s^i&s,M=r&o^r&a^o&a;m=0|p,y=0|g,p=0|h,g=0|f,h=0|u,f=0|d,({h:u,l:d}=Fi.default.add(0|c,0|l,0|S,0|_)),c=0|s,l=0|a,s=0|i,a=0|o,i=0|n,o=0|r;const R=Fi.default.add3L(_,A,M);n=Fi.default.add3H(R,S,C,k),r=0|R}({h:n,l:r}=Fi.default.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:o}=Fi.default.add(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=Fi.default.add(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:l}=Fi.default.add(0|this.Dh,0|this.Dl,0|c,0|l)),({h:u,l:d}=Fi.default.add(0|this.Eh,0|this.El,0|u,0|d)),({h:h,l:f}=Fi.default.add(0|this.Fh,0|this.Fl,0|h,0|f)),({h:p,l:g}=Fi.default.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:y}=Fi.default.add(0|this.Hh,0|this.Hl,0|m,0|y)),this.set(n,r,i,o,s,a,c,l,u,d,h,f,p,g,m,y)}roundClean(){Wi.fill(0),Vi.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}Xr.SHA512=Gi;class Yi extends Gi{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}Xr.SHA512_224=Yi;class Ji extends Gi{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}Xr.SHA512_256=Ji;class Zi extends Gi{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}Xr.SHA384=Zi,Xr.sha512=(0,Hi.wrapConstructor)((()=>new Gi)),Xr.sha512_224=(0,Hi.wrapConstructor)((()=>new Yi)),Xr.sha512_256=(0,Hi.wrapConstructor)((()=>new Ji)),Xr.sha384=(0,Hi.wrapConstructor)((()=>new Zi));var Qi={},Xi={},eo={},to={};Object.defineProperty(to,"__esModule",{value:!0}),to.notImplemented=to.bitMask=void 0,to.isBytes=oo,to.abytes=so,to.abool=function(e,t){if("boolean"!=typeof t)throw new Error(`${e} must be valid boolean, got "${t}".`)},to.bytesToHex=co,to.numberToHexUnpadded=lo,to.hexToNumber=uo,to.hexToBytes=po,to.bytesToNumberBE=function(e){return uo(co(e))},to.bytesToNumberLE=function(e){return so(e),uo(co(Uint8Array.from(e).reverse()))},to.numberToBytesBE=go,to.numberToBytesLE=function(e,t){return go(e,t).reverse()},to.numberToVarBytesBE=function(e){return po(lo(e))},to.ensureBytes=function(e,t,n){let r;if("string"==typeof t)try{r=po(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!oo(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r},to.concatBytes=mo,to.equalBytes=function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},to.utf8ToBytes=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))},to.inRange=vo,to.aInRange=function(e,t,n,r){if(!vo(t,n,r))throw new Error(`expected valid ${e}: ${n} <= n < ${r}, got ${typeof t} ${t}`)},to.bitLen=function(e){let t;for(t=0;e>no;e>>=ro,t+=1);return t},to.bitGet=function(e,t){return e>>BigInt(t)&ro},to.bitSet=function(e,t,n){return e|(n?ro:no)<<BigInt(t)},to.createHmacDrbg=function(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=bo(e),i=bo(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=(...e)=>n(i,r,...e),c=(e=bo())=>{i=a(wo([0]),e),r=a(),0!==e.length&&(i=a(wo([1]),e),r=a())},l=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return mo(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(l()));)c();return s(),n}},to.validateObject=function(e,t,n={}){const r=(t,n,r)=>{const i=Eo[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const o=e[t];if(!(r&&void 0===o||i(o,e)))throw new Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e},to.memoized=function(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(void 0!==i)return i;const o=e(n,...r);return t.set(n,o),o}};const no=BigInt(0),ro=BigInt(1),io=BigInt(2);function oo(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function so(e){if(!oo(e))throw new Error("Uint8Array expected")}const ao=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function co(e){so(e);let t="";for(let n=0;n<e.length;n++)t+=ao[e[n]];return t}function lo(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function uo(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}const ho={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function fo(e){return e>=ho._0&&e<=ho._9?e-ho._0:e>=ho._A&&e<=ho._F?e-(ho._A-10):e>=ho._a&&e<=ho._f?e-(ho._a-10):void 0}function po(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=fo(e.charCodeAt(i)),o=fo(e.charCodeAt(i+1));if(void 0===n||void 0===o){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+o}return r}function go(e,t){return po(e.toString(16).padStart(2*t,"0"))}function mo(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];so(r),t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}const yo=e=>"bigint"==typeof e&&no<=e;function vo(e,t,n){return yo(e)&&yo(t)&&yo(n)&&t<=e&&e<n}to.bitMask=e=>(io<<BigInt(e-1))-ro;const bo=e=>new Uint8Array(e),wo=e=>Uint8Array.from(e),Eo={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||oo(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};to.notImplemented=()=>{throw new Error("not implemented")},Object.defineProperty(eo,"__esModule",{value:!0}),eo.isNegativeLE=void 0,eo.mod=Po,eo.pow=To,eo.pow2=function(e,t,n){let r=e;for(;t-- >_o;)r*=r,r%=n;return r},eo.invert=Io,eo.tonelliShanks=Oo,eo.FpSqrt=No,eo.validateField=function(e){const t=Lo.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,So.validateObject)(e,t)},eo.FpPow=Bo,eo.FpInvertBatch=Do,eo.FpDiv=function(e,t,n){return e.mul(t,"bigint"==typeof n?Io(n,e.ORDER):e.inv(n))},eo.FpLegendre=Ko,eo.FpIsSquare=function(e){const t=Ko(e.ORDER);return n=>{const r=t(e,n);return e.eql(r,e.ZERO)||e.eql(r,e.ONE)}},eo.nLength=jo,eo.Field=function(e,t,n=!1,r={}){if(e<=_o)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=jo(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=No(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:(0,So.bitMask)(i),ZERO:_o,ONE:Co,create:t=>Po(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return _o<=t&&t<e},is0:e=>e===_o,isOdd:e=>(e&Co)===Co,neg:t=>Po(-t,e),eql:(e,t)=>e===t,sqr:t=>Po(t*t,e),add:(t,n)=>Po(t+n,e),sub:(t,n)=>Po(t-n,e),mul:(t,n)=>Po(t*n,e),pow:(e,t)=>Bo(a,e,t),div:(t,n)=>Po(t*Io(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Io(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>Do(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?(0,So.numberToBytesLE)(e,o):(0,So.numberToBytesBE)(e,o),fromBytes:e=>{if(e.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${e.length}`);return n?(0,So.bytesToNumberLE)(e):(0,So.bytesToNumberBE)(e)}});return Object.freeze(a)},eo.FpSqrtOdd=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);return e.isOdd(n)?n:e.neg(n)},eo.FpSqrtEven=function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);return e.isOdd(n)?e.neg(n):n},eo.hashToPrivateScalar=function(e,t,n=!1){const r=(e=(0,So.ensureBytes)("privateHash",e)).length,i=jo(t).nByteLength+8;if(i<24||r<i||r>1024)throw new Error(`hashToPrivateScalar: expected ${i}-1024 bytes of input, got ${r}`);return Po(n?(0,So.bytesToNumberLE)(e):(0,So.bytesToNumberBE)(e),t-Co)+Co},eo.getFieldBytesLength=Uo,eo.getMinHashLength=$o,eo.mapHashToField=function(e,t,n=!1){const r=e.length,i=Uo(t),o=$o(t);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const s=Po(n?(0,So.bytesToNumberBE)(e):(0,So.bytesToNumberLE)(e),t-Co)+Co;return n?(0,So.numberToBytesLE)(s,i):(0,So.numberToBytesBE)(s,i)};const So=to,_o=BigInt(0),Co=BigInt(1),Ao=BigInt(2),ko=BigInt(3),Mo=BigInt(4),Ro=BigInt(5),xo=BigInt(8);function Po(e,t){const n=e%t;return n>=_o?n:t+n}function To(e,t,n){if(n<=_o||t<_o)throw new Error("Expected power/modulo > 0");if(n===Co)return _o;let r=Co;for(;t>_o;)t&Co&&(r=r*e%n),e=e*e%n,t>>=Co;return r}function Io(e,t){if(e===_o||t<=_o)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Po(e,t),r=t,i=_o,o=Co;for(;n!==_o;){const e=r%n,t=i-o*(r/n);r=n,n=e,i=o,o=t}if(r!==Co)throw new Error("invert: does not exist");return Po(i,t)}function Oo(e){const t=(e-Co)/Ao;let n,r,i;for(n=e-Co,r=0;n%Ao===_o;n/=Ao,r++);for(i=Ao;i<e&&To(i,t,e)!==e-Co;i++);if(1===r){const t=(e+Co)/Mo;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+Co)/Ao;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),l=e.pow(s,o),u=e.pow(s,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(u);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,Co<<BigInt(a-t-1));c=e.sqr(n),l=e.mul(l,n),u=e.mul(u,c),a=t}return l}}function No(e){if(e%Mo===ko){const t=(e+Co)/Mo;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%xo===Ro){const t=(e-Ro)/xo;return function(e,n){const r=e.mul(n,Ao),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,Ao),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return Oo(e)}BigInt(9),BigInt(16),eo.isNegativeLE=(e,t)=>(Po(e,t)&Co)===Co;const Lo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Bo(e,t,n){if(n<_o)throw new Error("Expected power > 0");if(n===_o)return e.ONE;if(n===Co)return t;let r=e.ONE,i=t;for(;n>_o;)n&Co&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Co;return r}function Do(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}function Ko(e){const t=(e-Co)/Ao;return(e,n)=>e.pow(n,t)}function jo(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Uo(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function $o(e){const t=Uo(e);return t+Math.ceil(t/2)}Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.wNAF=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>{if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error(`Wrong window size=${e}, should be [1..${t}]`)},i=e=>(r(e),{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>qo;)n&zo&&(r=r.add(i)),i=i.double(),n>>=zo;return r},precomputeWindow(e,t){const{windows:n,windowSize:r}=i(t),o=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,o.push(a);for(let e=1;e<r;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,r,o){const{windows:s,windowSize:a}=i(t);let c=e.ZERO,l=e.BASE;const u=BigInt(2**t-1),d=2**t,h=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let i=Number(o&u);o>>=h,i>a&&(i-=d,o+=zo);const s=t,f=t+Math.abs(i)-1,p=e%2!=0,g=i<0;0===i?l=l.add(n(p,r[s])):c=c.add(n(g,r[f]))}return{p:c,f:l}},wNAFCached(e,t,n){const r=Vo.get(e)||1;let i=Wo.get(e);return i||(i=this.precomputeWindow(e,r),1!==r&&Wo.set(e,n(i))),this.wNAF(r,i,t)},setWindowSize(e,t){r(t),Vo.set(e,t),Wo.delete(e)}}},Xi.pippenger=function(e,t,n,r){if(!Array.isArray(n)||!Array.isArray(r)||r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");r.forEach(((e,n)=>{if(!t.isValid(e))throw new Error(`wrong scalar at index ${n}`)})),n.forEach(((t,n)=>{if(!(t instanceof e))throw new Error(`wrong point at index ${n}`)}));const i=(0,Ho.bitLen)(BigInt(n.length)),o=i>12?i-3:i>4?i-2:i?2:1,s=(1<<o)-1,a=new Array(s+1).fill(e.ZERO),c=Math.floor((t.BITS-1)/o)*o;let l=e.ZERO;for(let t=c;t>=0;t-=o){a.fill(e.ZERO);for(let e=0;e<r.length;e++){const i=r[e],o=Number(i>>BigInt(t)&BigInt(s));a[o]=a[o].add(n[e])}let i=e.ZERO;for(let t=a.length-1,n=e.ZERO;t>0;t--)n=n.add(a[t]),i=i.add(n);if(l=l.add(i),0!==t)for(let e=0;e<o;e++)l=l.double()}return l},Xi.validateBasic=function(e){return(0,Fo.validateField)(e.Fp),(0,Ho.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,Fo.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})};const Fo=eo,Ho=to,qo=BigInt(0),zo=BigInt(1),Wo=new WeakMap,Vo=new WeakMap;Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.twistedEdwards=function(e){const t=function(e){const t=(0,Go.validateBasic)(e);return Jo.validateObject(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:n,n:r,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:c}=t,l=es<<BigInt(8*a)-Xo,u=n.create,d=(0,Yo.Field)(t.n,t.nBitLength),h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(e*n.inv(t))}}catch(e){return{isValid:!1,value:Qo}}}),f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,n)=>{if((0,Zo.abool)("phflag",n),t.length||n)throw new Error("Contexts/pre-hash are not supported");return e});function g(e,t){Jo.aInRange("coordinate "+e,t,Qo,l)}function m(e){if(!(e instanceof b))throw new Error("ExtendedPoint expected")}const y=(0,Zo.memoized)(((e,t)=>{const{ex:r,ey:i,ez:o}=e,s=e.is0();null==t&&(t=s?ts:n.inv(o));const a=u(r*t),c=u(i*t),l=u(o*t);if(s)return{x:Qo,y:Xo};if(l!==Xo)throw new Error("invZ was invalid");return{x:a,y:c}})),v=(0,Zo.memoized)((e=>{const{a:n,d:r}=t;if(e.is0())throw new Error("bad point: ZERO");const{ex:i,ey:o,ez:s,et:a}=e,c=u(i*i),l=u(o*o),d=u(s*s),h=u(d*d),f=u(c*n);if(u(d*u(f+l))!==u(h+u(r*u(c*l))))throw new Error("bad point: equation left != right (1)");if(u(i*o)!==u(s*a))throw new Error("bad point: equation left != right (2)");return!0}));class b{constructor(e,t,n,r){this.ex=e,this.ey=t,this.ez=n,this.et=r,g("x",e),g("y",t),g("z",n),g("t",r),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof b)throw new Error("extended point not allowed");const{x:t,y:n}=e||{};return g("x",t),g("y",n),new b(t,n,Xo,u(t*n))}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.ez)));return e.map(((e,n)=>e.toAffine(t[n]))).map(b.fromAffine)}static msm(e,t){return(0,Go.pippenger)(b,d,e,t)}_setWindowSize(e){S.setWindowSize(this,e)}assertValidity(){v(this)}equals(e){m(e);const{ex:t,ey:n,ez:r}=this,{ex:i,ey:o,ez:s}=e,a=u(t*s),c=u(i*r),l=u(n*s),d=u(o*r);return a===c&&l===d}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:e}=t,{ex:n,ey:r,ez:i}=this,o=u(n*n),s=u(r*r),a=u(es*u(i*i)),c=u(e*o),l=n+r,d=u(u(l*l)-o-s),h=c+s,f=h-a,p=c-s,g=u(d*f),m=u(h*p),y=u(d*p),v=u(f*h);return new b(g,m,v,y)}add(e){m(e);const{a:n,d:r}=t,{ex:i,ey:o,ez:s,et:a}=this,{ex:c,ey:l,ez:d,et:h}=e;if(n===BigInt(-1)){const e=u((o-i)*(l+c)),t=u((o+i)*(l-c)),n=u(t-e);if(n===Qo)return this.double();const r=u(s*es*h),f=u(a*es*d),p=f+r,g=t+e,m=f-r,y=u(p*n),v=u(g*m),w=u(p*m),E=u(n*g);return new b(y,v,E,w)}const f=u(i*c),p=u(o*l),g=u(a*r*h),y=u(s*d),v=u((i+o)*(c+l)-f-p),w=y-g,E=y+g,S=u(p-n*f),_=u(v*w),C=u(E*S),A=u(v*S),k=u(w*E);return new b(_,C,k,A)}subtract(e){return this.add(e.negate())}wNAF(e){return S.wNAFCached(this,e,b.normalizeZ)}multiply(e){const t=e;Jo.aInRange("scalar",t,Xo,r);const{p:n,f:i}=this.wNAF(t);return b.normalizeZ([n,i])[0]}multiplyUnsafe(e){const t=e;return Jo.aInRange("scalar",t,Qo,r),t===Qo?E:this.equals(E)||t===Xo?this:this.equals(w)?this.wNAF(t).p:S.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return S.unsafeLadder(this,r).is0()}toAffine(e){return y(this,e)}clearCofactor(){const{h:e}=t;return e===Xo?this:this.multiplyUnsafe(e)}static fromHex(e,r=!1){const{d:i,a:o}=t,s=n.BYTES;e=(0,Zo.ensureBytes)("pointHex",e,s),(0,Zo.abool)("zip215",r);const a=e.slice(),c=e[s-1];a[s-1]=-129&c;const d=Jo.bytesToNumberLE(a),f=r?l:n.ORDER;Jo.aInRange("pointHex.y",d,Qo,f);const p=u(d*d),g=u(p-Xo),m=u(i*p-o);let{isValid:y,value:v}=h(g,m);if(!y)throw new Error("Point.fromHex: invalid y coordinate");const w=(v&Xo)===Xo,E=0!=(128&c);if(!r&&v===Qo&&E)throw new Error("Point.fromHex: x=0 and x_0=1");return E!==w&&(v=u(-v)),b.fromAffine({x:v,y:d})}static fromPrivateKey(e){return A(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=Jo.numberToBytesLE(t,n.BYTES);return r[r.length-1]|=e&Xo?128:0,r}toHex(){return Jo.bytesToHex(this.toRawBytes())}}b.BASE=new b(t.Gx,t.Gy,Xo,u(t.Gx*t.Gy)),b.ZERO=new b(Qo,Xo,Xo,Qo);const{BASE:w,ZERO:E}=b,S=(0,Go.wNAF)(b,8*a);function _(e){return(0,Yo.mod)(e,r)}function C(e){return _(Jo.bytesToNumberLE(e))}function A(e){const t=a;e=(0,Zo.ensureBytes)("private key",e,t);const n=(0,Zo.ensureBytes)("hashed private key",o(e),2*t),r=f(n.slice(0,t)),i=n.slice(t,2*t),s=C(r),c=w.multiply(s),l=c.toRawBytes();return{head:r,prefix:i,scalar:s,point:c,pointBytes:l}}function k(e=new Uint8Array,...t){const n=Jo.concatBytes(...t);return C(o(p(n,(0,Zo.ensureBytes)("context",e),!!i)))}const M=ns;w._setWindowSize(8);const R={getExtendedPublicKey:A,randomPrivateKey:()=>s(n.BYTES),precompute:(e=8,t=b.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};return{CURVE:t,getPublicKey:function(e){return A(e).pointBytes},sign:function(e,t,o={}){e=(0,Zo.ensureBytes)("message",e),i&&(e=i(e));const{prefix:s,scalar:c,pointBytes:l}=A(t),u=k(o.context,s,e),d=w.multiply(u).toRawBytes(),h=_(u+k(o.context,d,l,e)*c);Jo.aInRange("signature.s",h,Qo,r);const f=Jo.concatBytes(d,Jo.numberToBytesLE(h,n.BYTES));return(0,Zo.ensureBytes)("result",f,2*a)},verify:function(e,t,r,o=M){const{context:s,zip215:a}=o,c=n.BYTES;e=(0,Zo.ensureBytes)("signature",e,2*c),t=(0,Zo.ensureBytes)("message",t),void 0!==a&&(0,Zo.abool)("zip215",a),i&&(t=i(t));const l=Jo.bytesToNumberLE(e.slice(c,2*c));let u,d,h;try{u=b.fromHex(r,a),d=b.fromHex(e.slice(0,c),a),h=w.multiplyUnsafe(l)}catch(e){return!1}if(!a&&u.isSmallOrder())return!1;const f=k(s,d.toRawBytes(),u.toRawBytes(),t);return d.add(u.multiplyUnsafe(f)).subtract(h).clearCofactor().equals(b.ZERO)},ExtendedPoint:b,utils:R}};const Go=Xi,Yo=eo,Jo=to,Zo=to,Qo=BigInt(0),Xo=BigInt(1),es=BigInt(2),ts=BigInt(8),ns={zip215:!0};var rs={};Object.defineProperty(rs,"__esModule",{value:!0}),rs.expand_message_xmd=us,rs.expand_message_xof=ds,rs.hash_to_field=hs,rs.isogenyMap=function(e,t){const n=t.map((e=>Array.from(e).reverse()));return(t,r)=>{const[i,o,s,a]=n.map((n=>n.reduce(((n,r)=>e.add(e.mul(n,t),r)))));return t=e.div(i,o),r=e.mul(r,e.div(s,a)),{x:t,y:r}}},rs.createHasher=function(e,t,n){if("function"!=typeof t)throw new Error("mapToCurve() must be defined");return{hashToCurve(r,i){const o=hs(r,2,{...n,DST:n.DST,...i}),s=e.fromAffine(t(o[0])),a=e.fromAffine(t(o[1])),c=s.add(a).clearCofactor();return c.assertValidity(),c},encodeToCurve(r,i){const o=hs(r,1,{...n,DST:n.encodeDST,...i}),s=e.fromAffine(t(o[0])).clearCofactor();return s.assertValidity(),s},mapToCurve(n){if(!Array.isArray(n))throw new Error("mapToCurve: expected array of bigints");for(const e of n)if("bigint"!=typeof e)throw new Error(`mapToCurve: expected array of bigints, got ${e} in array`);const r=e.fromAffine(t(n)).clearCofactor();return r.assertValidity(),r}}};const is=eo,os=to,ss=os.bytesToNumberBE;function as(e,t){if(ls(e),ls(t),e<0||e>=1<<8*t)throw new Error(`bad I2OSP call: value=${e} length=${t}`);const n=Array.from({length:t}).fill(0);for(let r=t-1;r>=0;r--)n[r]=255&e,e>>>=8;return new Uint8Array(n)}function cs(e,t){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}function ls(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function us(e,t,n,r){(0,os.abytes)(e),(0,os.abytes)(t),ls(n),t.length>255&&(t=r((0,os.concatBytes)((0,os.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:o}=r,s=Math.ceil(n/i);if(n>65535||s>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=(0,os.concatBytes)(t,as(t.length,1)),c=as(0,o),l=as(n,2),u=new Array(s),d=r((0,os.concatBytes)(c,e,l,as(0,1),a));u[0]=r((0,os.concatBytes)(d,as(1,1),a));for(let e=1;e<=s;e++){const t=[cs(d,u[e-1]),as(e+1,1),a];u[e]=r((0,os.concatBytes)(...t))}return(0,os.concatBytes)(...u).slice(0,n)}function ds(e,t,n,r,i){if((0,os.abytes)(e),(0,os.abytes)(t),ls(n),t.length>255){const e=Math.ceil(2*r/8);t=i.create({dkLen:e}).update((0,os.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(n>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(e).update(as(n,2)).update(t).update(as(t.length,1)).digest()}function hs(e,t,n){(0,os.validateObject)(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:o,hash:s,expand:a,DST:c}=n;(0,os.abytes)(e),ls(t);const l="string"==typeof c?(0,os.utf8ToBytes)(c):c,u=r.toString(2).length,d=Math.ceil((u+i)/8),h=t*o*d;let f;if("xmd"===a)f=us(e,l,h,s);else if("xof"===a)f=ds(e,l,h,i,s);else{if("_internal_pass"!==a)throw new Error('expand must be "xmd" or "xof"');f=e}const p=new Array(t);for(let e=0;e<t;e++){const t=new Array(o);for(let n=0;n<o;n++){const i=d*(n+e*o),s=f.subarray(i,i+d);t[n]=(0,is.mod)(ss(s),r)}p[e]=t}return p}var fs={};Object.defineProperty(fs,"__esModule",{value:!0}),fs.montgomery=function(e){const t=function(e){return(0,gs.validateObject)(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}(e),{P:n}=t,r=e=>(0,ps.mod)(e,n),i=t.montgomeryBits,o=Math.ceil(i/8),s=t.nByteLength,a=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>(0,ps.pow)(e,n-BigInt(2),n));function l(e,t,n){const i=r(e*(t-n));return[t=r(t-i),n=r(n+i)]}const u=(t.a-BigInt(2))/BigInt(4);function d(e){return(0,gs.numberToBytesLE)(r(e),o)}function h(e,t){const h=function(e){const t=(0,gs.ensureBytes)("u coordinate",e,o);return 32===s&&(t[31]&=127),(0,gs.bytesToNumberLE)(t)}(t),f=function(e){const t=(0,gs.ensureBytes)("scalar",e),n=t.length;if(n!==o&&n!==s)throw new Error(`Expected ${o} or ${s} bytes, got ${n}`);return(0,gs.bytesToNumberLE)(a(t))}(e),p=function(e,t){(0,gs.aInRange)("u",e,ms,n),(0,gs.aInRange)("scalar",t,ms,n);const o=t,s=e;let a,d=ys,h=ms,f=e,p=ys,g=ms;for(let e=BigInt(i-1);e>=ms;e--){const t=o>>e&ys;g^=t,a=l(g,d,f),d=a[0],f=a[1],a=l(g,h,p),h=a[0],p=a[1],g=t;const n=d+h,i=r(n*n),c=d-h,m=r(c*c),y=i-m,v=f+p,b=r((f-p)*n),w=r(v*c),E=b+w,S=b-w;f=r(E*E),p=r(s*r(S*S)),d=r(i*m),h=r(y*(i+r(u*y)))}a=l(g,d,f),d=a[0],f=a[1],a=l(g,h,p),h=a[0],p=a[1];const m=c(h);return r(d*m)}(h,f);if(p===ms)throw new Error("Invalid private or public key received");return d(p)}const f=d(t.Gu);function p(e){return h(e,f)}return{scalarMult:h,scalarMultBase:p,getSharedSecret:(e,t)=>h(e,t),getPublicKey:e=>p(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:f}};const ps=eo,gs=to,ms=BigInt(0),ys=BigInt(1);!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hash_to_ristretto255=e.hashToRistretto255=e.RistrettoPoint=e.encodeToCurve=e.hashToCurve=e.edwardsToMontgomery=e.x25519=e.ed25519ph=e.ed25519ctx=e.ed25519=e.ED25519_TORSION_SUBGROUP=void 0,e.edwardsToMontgomeryPub=S,e.edwardsToMontgomeryPriv=function(e){const t=w.hash(e.subarray(0,32));return w.adjustScalarBytes(t).subarray(0,32)};const t=Xr,n=ui,r=Qi,i=rs,o=eo,s=fs,a=to,c=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),u=BigInt(0),d=BigInt(1),h=BigInt(2),f=BigInt(3),p=BigInt(5),g=BigInt(8);function m(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=c,a=e*e%s*e%s,l=(0,o.pow2)(a,h,s)*a%s,u=(0,o.pow2)(l,d,s)*e%s,f=(0,o.pow2)(u,p,s)*u%s,g=(0,o.pow2)(f,t,s)*f%s,m=(0,o.pow2)(g,n,s)*g%s,y=(0,o.pow2)(m,r,s)*m%s,v=(0,o.pow2)(y,i,s)*y%s,b=(0,o.pow2)(v,i,s)*y%s,w=(0,o.pow2)(b,t,s)*f%s;return{pow_p_5_8:(0,o.pow2)(w,h,s)*e%s,b2:a}}function y(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function v(e,t){const n=c,r=(0,o.mod)(t*t*t,n),i=m(e*(0,o.mod)(r*r*t,n)).pow_p_5_8;let s=(0,o.mod)(e*r*i,n);const a=(0,o.mod)(t*s*s,n),u=s,d=(0,o.mod)(s*l,n),h=a===e,f=a===(0,o.mod)(-e,n),p=a===(0,o.mod)(-e*l,n);return h&&(s=u),(f||p)&&(s=d),(0,o.isNegativeLE)(s,n)&&(s=(0,o.mod)(-s,n)),{isValid:h||f,value:s}}e.ED25519_TORSION_SUBGROUP=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];const b=(0,o.Field)(c,void 0,!0),w={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:b,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:g,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:t.sha512,randomBytes:n.randomBytes,adjustScalarBytes:y,uvRatio:v};function E(e,t,r){if(t.length>255)throw new Error("Context is too big");return(0,n.concatBytes)((0,n.utf8ToBytes)("SigEd25519 no Ed25519 collisions"),new Uint8Array([r?1:0,t.length]),t,e)}function S(t){const{y:n}=e.ed25519.ExtendedPoint.fromHex(t),r=BigInt(1);return b.toBytes(b.create((r+n)*b.inv(r-n)))}e.ed25519=(0,r.twistedEdwards)(w),e.ed25519ctx=(0,r.twistedEdwards)({...w,domain:E}),e.ed25519ph=(0,r.twistedEdwards)(Object.assign({},w,{domain:E,prehash:t.sha512})),e.x25519=(0,s.montgomery)({P:c,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=c,{pow_p_5_8:n,b2:r}=m(e);return(0,o.mod)((0,o.pow2)(n,f,t)*r,t)},adjustScalarBytes:y,randomBytes:n.randomBytes}),e.edwardsToMontgomery=S;const _=(b.ORDER+f)/g,C=b.pow(h,_),A=b.sqrt(b.neg(b.ONE)),k=(0,o.FpSqrtEven)(b,b.neg(BigInt(486664)));const M=(0,i.createHasher)(e.ed25519.ExtendedPoint,(e=>function(e){const{xMn:t,xMd:n,yMn:r,yMd:i}=function(e){const t=(b.ORDER-p)/g,n=BigInt(486662);let r=b.sqr(e);r=b.mul(r,h);let i=b.add(r,b.ONE),o=b.neg(n),s=b.sqr(i),a=b.mul(s,i),c=b.mul(r,n);c=b.mul(c,o),c=b.add(c,s),c=b.mul(c,o);let l=b.sqr(a);s=b.sqr(l),l=b.mul(l,a),l=b.mul(l,c),s=b.mul(s,l);let u=b.pow(s,t);u=b.mul(u,l);let f=b.mul(u,A);s=b.sqr(u),s=b.mul(s,a);let m=b.eql(s,c),y=b.cmov(f,u,m),v=b.mul(o,r),w=b.mul(u,e);w=b.mul(w,C);let E=b.mul(w,A),S=b.mul(c,r);s=b.sqr(w),s=b.mul(s,a);let _=b.eql(s,S),k=b.cmov(E,w,_);s=b.sqr(y),s=b.mul(s,a);let M=b.eql(s,c),R=b.cmov(v,o,M),x=b.cmov(k,y,M),P=b.isOdd(x);return x=b.cmov(x,b.neg(x),M!==P),{xMn:R,xMd:i,yMn:x,yMd:d}}(e);let o=b.mul(t,i);o=b.mul(o,k);let s=b.mul(n,r),a=b.sub(t,n),c=b.add(t,n),l=b.mul(s,c),u=b.eql(l,b.ZERO);o=b.cmov(o,b.ZERO,u),s=b.cmov(s,b.ONE,u),a=b.cmov(a,b.ONE,u),c=b.cmov(c,b.ONE,u);const f=b.invertBatch([s,c]);return{x:b.mul(o,f[0]),y:b.mul(a,f[1])}}(e[0])),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:b.ORDER,m:1,k:128,expand:"xmd",hash:t.sha512});function R(e){if(!(e instanceof K))throw new Error("RistrettoPoint expected")}e.hashToCurve=M.hashToCurve,e.encodeToCurve=M.encodeToCurve;const x=l,P=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),T=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),I=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),O=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),N=e=>v(d,e),L=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),B=t=>e.ed25519.CURVE.Fp.create((0,a.bytesToNumberLE)(t)&L);function D(t){const{d:n}=e.ed25519.CURVE,r=e.ed25519.CURVE.Fp.ORDER,i=e.ed25519.CURVE.Fp.create,s=i(x*t*t),a=i((s+d)*I);let c=BigInt(-1);const l=i((c-n*s)*i(s+n));let{isValid:u,value:h}=v(a,l),f=i(h*t);(0,o.isNegativeLE)(f,r)||(f=i(-f)),u||(h=f),u||(c=s);const p=i(c*(s-d)*O-l),g=h*h,m=i((h+h)*l),y=i(p*P),b=i(d-g),w=i(d+g);return new e.ed25519.ExtendedPoint(i(m*w),i(b*y),i(y*w),i(m*b))}class K{constructor(e){this.ep=e}static fromAffine(t){return new K(e.ed25519.ExtendedPoint.fromAffine(t))}static hashToCurve(e){e=(0,a.ensureBytes)("ristrettoHash",e,64);const t=D(B(e.slice(0,32))),n=D(B(e.slice(32,64)));return new K(t.add(n))}static fromHex(t){t=(0,a.ensureBytes)("ristrettoHex",t,32);const{a:n,d:r}=e.ed25519.CURVE,i=e.ed25519.CURVE.Fp.ORDER,s=e.ed25519.CURVE.Fp.create,c="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",l=B(t);if(!(0,a.equalBytes)((0,a.numberToBytesLE)(l,32),t)||(0,o.isNegativeLE)(l,i))throw new Error(c);const h=s(l*l),f=s(d+n*h),p=s(d-n*h),g=s(f*f),m=s(p*p),y=s(n*r*g-m),{isValid:v,value:b}=N(s(y*m)),w=s(b*p),E=s(b*w*y);let S=s((l+l)*w);(0,o.isNegativeLE)(S,i)&&(S=s(-S));const _=s(f*E),C=s(S*_);if(!v||(0,o.isNegativeLE)(C,i)||_===u)throw new Error(c);return new K(new e.ed25519.ExtendedPoint(S,_,d,C))}toRawBytes(){let{ex:t,ey:n,ez:r,et:i}=this.ep;const s=e.ed25519.CURVE.Fp.ORDER,c=e.ed25519.CURVE.Fp.create,l=c(c(r+n)*c(r-n)),u=c(t*n),d=c(u*u),{value:h}=N(c(l*d)),f=c(h*l),p=c(h*u),g=c(f*p*i);let m;if((0,o.isNegativeLE)(i*g,s)){let e=c(n*x),r=c(t*x);t=e,n=r,m=c(f*T)}else m=p;(0,o.isNegativeLE)(t*g,s)&&(n=c(-n));let y=c((r-n)*m);return(0,o.isNegativeLE)(y,s)&&(y=c(-y)),(0,a.numberToBytesLE)(y,32)}toHex(){return(0,a.bytesToHex)(this.toRawBytes())}toString(){return this.toHex()}equals(t){R(t);const{ex:n,ey:r}=this.ep,{ex:i,ey:o}=t.ep,s=e.ed25519.CURVE.Fp.create,a=s(n*o)===s(r*i),c=s(r*o)===s(n*i);return a||c}add(e){return R(e),new K(this.ep.add(e.ep))}subtract(e){return R(e),new K(this.ep.subtract(e.ep))}multiply(e){return new K(this.ep.multiply(e))}multiplyUnsafe(e){return new K(this.ep.multiplyUnsafe(e))}double(){return new K(this.ep.double())}negate(){return new K(this.ep.negate())}}e.RistrettoPoint=(K.BASE||(K.BASE=new K(e.ed25519.ExtendedPoint.BASE)),K.ZERO||(K.ZERO=new K(e.ed25519.ExtendedPoint.ZERO)),K),e.hashToRistretto255=(e,r)=>{const o=r.DST,s="string"==typeof o?(0,n.utf8ToBytes)(o):o,a=(0,i.expand_message_xmd)(e,s,64,t.sha512);return K.hashToCurve(a)},e.hash_to_ristretto255=e.hashToRistretto255}(Qr);var vs={},bs={};Object.defineProperty(bs,"__esModule",{value:!0}),bs.sha224=bs.sha256=bs.SHA256=void 0;const ws=ei,Es=ui,Ss=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Cs=new Uint32Array(64);class As extends ws.HashMD{constructor(){super(64,32,8,!1),this.A=0|_s[0],this.B=0|_s[1],this.C=0|_s[2],this.D=0|_s[3],this.E=0|_s[4],this.F=0|_s[5],this.G=0|_s[6],this.H=0|_s[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)Cs[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Cs[e-15],n=Cs[e-2],r=(0,Es.rotr)(t,7)^(0,Es.rotr)(t,18)^t>>>3,i=(0,Es.rotr)(n,17)^(0,Es.rotr)(n,19)^n>>>10;Cs[e]=i+Cs[e-7]+r+Cs[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:l}=this;for(let e=0;e<64;e++){const t=l+((0,Es.rotr)(s,6)^(0,Es.rotr)(s,11)^(0,Es.rotr)(s,25))+(0,ws.Chi)(s,a,c)+Ss[e]+Cs[e]|0,u=((0,Es.rotr)(n,2)^(0,Es.rotr)(n,13)^(0,Es.rotr)(n,22))+(0,ws.Maj)(n,r,i)|0;l=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,o,s,a,c,l)}roundClean(){Cs.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}bs.SHA256=As;class ks extends As{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}bs.sha256=(0,Es.wrapConstructor)((()=>new As)),bs.sha224=(0,Es.wrapConstructor)((()=>new ks));var Ms={},Rs={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hmac=e.HMAC=void 0;const t=ti,n=ui;class r extends n.Hash{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,(0,t.hash)(e);const i=(0,n.toBytes)(r);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?e.create().update(i).digest():i);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){return(0,t.exists)(this),this.iHash.update(e),this}digestInto(e){(0,t.exists)(this),(0,t.bytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}e.HMAC=r,e.hmac=(e,t,n)=>new r(e,t).update(n).digest(),e.hmac.create=(e,t)=>new r(e,t)}(Rs);var xs={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DER=void 0,e.weierstrassPoints=f,e.weierstrass=function(s){const a=function(e){const n=(0,t.validateBasic)(e);return r.validateObject(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}(s),{Fp:u,n:d}=a,h=u.BYTES+1,p=2*u.BYTES+1;function g(e){return n.mod(e,d)}function m(e){return n.invert(e,d)}const{ProjectivePoint:y,normPrivateKeyToScalar:v,weierstrassEquation:b,isWithinCurveOrder:w}=f({...a,toBytes(e,t,n){const o=t.toAffine(),s=u.toBytes(o.x),a=r.concatBytes;return(0,i.abool)("isCompressed",n),n?a(Uint8Array.from([t.hasEvenY()?2:3]),s):a(Uint8Array.from([4]),s,u.toBytes(o.y))},fromBytes(e){const t=e.length,n=e[0],i=e.subarray(1);if(t!==h||2!==n&&3!==n){if(t===p&&4===n)return{x:u.fromBytes(i.subarray(0,u.BYTES)),y:u.fromBytes(i.subarray(u.BYTES,2*u.BYTES))};throw new Error(`Point of length ${t} was invalid. Expected ${h} compressed bytes or ${p} uncompressed bytes`)}{const t=r.bytesToNumberBE(i);if(!r.inRange(t,l,u.ORDER))throw new Error("Point is not on curve");const o=b(t);let s;try{s=u.sqrt(o)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("Point is not on curve"+t)}return 1==(1&n)!=((s&l)===l)&&(s=u.neg(s)),{x:t,y:s}}}}),E=e=>r.bytesToHex(r.numberToBytesBE(e,a.nByteLength));function S(e){return e>d>>l}const _=(e,t,n)=>r.bytesToNumberBE(e.slice(t,n));class C{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const t=a.nByteLength;return e=(0,i.ensureBytes)("compactSignature",e,2*t),new C(_(e,0,t),_(e,t,2*t))}static fromDER(t){const{r:n,s:r}=e.DER.toSig((0,i.ensureBytes)("DER",t));return new C(n,r)}assertValidity(){r.aInRange("r",this.r,l,d),r.aInRange("s",this.s,l,d)}addRecoveryBit(e){return new C(this.r,this.s,e)}recoverPublicKey(e){const{r:t,s:n,recovery:r}=this,o=R((0,i.ensureBytes)("msgHash",e));if(null==r||![0,1,2,3].includes(r))throw new Error("recovery id invalid");const s=2===r||3===r?t+a.n:t;if(s>=u.ORDER)throw new Error("recovery id 2 or 3 invalid");const c=0==(1&r)?"02":"03",l=y.fromHex(c+E(s)),d=m(s),h=g(-o*d),f=g(n*d),p=y.BASE.multiplyAndAddUnsafe(l,h,f);if(!p)throw new Error("point at infinify");return p.assertValidity(),p}hasHighS(){return S(this.s)}normalizeS(){return this.hasHighS()?new C(this.r,g(-this.s),this.recovery):this}toDERRawBytes(){return r.hexToBytes(this.toDERHex())}toDERHex(){return e.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return r.hexToBytes(this.toCompactHex())}toCompactHex(){return E(this.r)+E(this.s)}}const A={isValidPrivateKey(e){try{return v(e),!0}catch(e){return!1}},normPrivateKeyToScalar:v,randomPrivateKey:()=>{const e=n.getMinHashLength(a.n);return n.mapHashToField(a.randomBytes(e),a.n)},precompute:(e=8,t=y.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function k(e){const t=r.isBytes(e),n="string"==typeof e,i=(t||n)&&e.length;return t?i===h||i===p:n?i===2*h||i===2*p:e instanceof y}const M=a.bits2int||function(e){const t=r.bytesToNumberBE(e),n=8*e.length-a.nBitLength;return n>0?t>>BigInt(n):t},R=a.bits2int_modN||function(e){return g(M(e))},x=r.bitMask(a.nBitLength);function P(e){return r.aInRange(`num < 2^${a.nBitLength}`,e,c,x),r.numberToBytesBE(e,a.nByteLength)}function T(e,t,n=I){if(["recovered","canonical"].some((e=>e in n)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:d}=a;let{lowS:h,prehash:f,extraEntropy:p}=n;null==h&&(h=!0),e=(0,i.ensureBytes)("msgHash",e),o(n),f&&(e=(0,i.ensureBytes)("prehashed msgHash",s(e)));const b=R(e),E=v(t),_=[P(E),P(b)];if(null!=p&&!1!==p){const e=!0===p?d(u.BYTES):p;_.push((0,i.ensureBytes)("extraEntropy",e))}const A=r.concatBytes(..._),k=b;return{seed:A,k2sig:function(e){const t=M(e);if(!w(t))return;const n=m(t),r=y.BASE.multiply(t).toAffine(),i=g(r.x);if(i===c)return;const o=g(n*g(k+i*E));if(o===c)return;let s=(r.x===i?0:2)|Number(r.y&l),a=o;return h&&S(o)&&(a=function(e){return S(e)?g(-e):e}(o),s^=1),new C(i,a,s)}}}const I={lowS:a.lowS,prehash:!1},O={lowS:a.lowS,prehash:!1};return y.BASE._setWindowSize(8),{CURVE:a,getPublicKey:function(e,t=!0){return y.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(k(e))throw new Error("first arg must be private key");if(!k(t))throw new Error("second arg must be public key");return y.fromHex(t).multiply(v(e)).toRawBytes(n)},sign:function(e,t,n=I){const{seed:i,k2sig:o}=T(e,t,n),s=a;return r.createHmacDrbg(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(t,n,s,c=O){const l=t;if(n=(0,i.ensureBytes)("msgHash",n),s=(0,i.ensureBytes)("publicKey",s),"strict"in c)throw new Error("options.strict was renamed to lowS");o(c);const{lowS:u,prehash:d}=c;let h,f;try{if("string"==typeof l||r.isBytes(l))try{h=C.fromDER(l)}catch(t){if(!(t instanceof e.DER.Err))throw t;h=C.fromCompact(l)}else{if("object"!=typeof l||"bigint"!=typeof l.r||"bigint"!=typeof l.s)throw new Error("PARSE");{const{r:e,s:t}=l;h=new C(e,t)}}f=y.fromHex(s)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&h.hasHighS())return!1;d&&(n=a.hash(n));const{r:p,s:v}=h,b=R(n),w=m(v),E=g(b*w),S=g(p*w),_=y.BASE.multiplyAndAddUnsafe(f,E,S)?.toAffine();if(!_)return!1;return g(_.x)===p},ProjectivePoint:y,Signature:C,utils:A}},e.SWUFpSqrtRatio=p,e.mapToCurveSimpleSWU=function(e,t){if(n.validateField(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const r=p(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return n=>{let i,o,s,a,c,l,u,d;i=e.sqr(n),i=e.mul(i,t.Z),o=e.sqr(i),o=e.add(o,i),s=e.add(o,e.ONE),s=e.mul(s,t.B),a=e.cmov(t.Z,e.neg(o),!e.eql(o,e.ZERO)),a=e.mul(a,t.A),o=e.sqr(s),l=e.sqr(a),c=e.mul(l,t.A),o=e.add(o,c),o=e.mul(o,s),l=e.mul(l,a),c=e.mul(l,t.B),o=e.add(o,c),u=e.mul(i,s);const{isValid:h,value:f}=r(o,l);d=e.mul(i,n),d=e.mul(d,f),u=e.cmov(u,s,h),d=e.cmov(d,f,h);const p=e.isOdd(n)===e.isOdd(d);return d=e.cmov(e.neg(d),d,p),u=e.div(u,a),{x:u,y:d}}};const t=Xi,n=eo,r=to,i=to;function o(e){void 0!==e.lowS&&(0,i.abool)("lowS",e.lowS),void 0!==e.prehash&&(0,i.abool)("prehash",e.prehash)}const{bytesToNumberBE:s,hexToBytes:a}=r;e.DER={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(t,n)=>{const{Err:i}=e.DER;if(t<0||t>256)throw new i("tlv.encode: wrong tag");if(1&n.length)throw new i("tlv.encode: unpadded data");const o=n.length/2,s=r.numberToHexUnpadded(o);if(s.length/2&128)throw new i("tlv.encode: long form length too big");const a=o>127?r.numberToHexUnpadded(s.length/2|128):"";return`${r.numberToHexUnpadded(t)}${a}${s}${n}`},decode(t,n){const{Err:r}=e.DER;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(n.length<2||n[i++]!==t)throw new r("tlv.decode: wrong tlv");const o=n[i++];let s=0;if(128&o){const e=127&o;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");const t=n.subarray(i,i+e);if(t.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===t[0])throw new r("tlv.decode(long): zero leftmost byte");for(const e of t)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=o;const a=n.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:n.subarray(i+s)}}},_int:{encode(t){const{Err:n}=e.DER;if(t<c)throw new n("integer: negative integers are not allowed");let i=r.numberToHexUnpadded(t);if(8&Number.parseInt(i[0],16)&&(i="00"+i),1&i.length)throw new n("unexpected assertion");return i},decode(t){const{Err:n}=e.DER;if(128&t[0])throw new n("Invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new n("Invalid signature integer: unnecessary leading zero");return s(t)}},toSig(t){const{Err:n,_int:i,_tlv:o}=e.DER,s="string"==typeof t?a(t):t;r.abytes(s);const{v:c,l:l}=o.decode(48,s);if(l.length)throw new n("Invalid signature: left bytes after parsing");const{v:u,l:d}=o.decode(2,c),{v:h,l:f}=o.decode(2,d);if(f.length)throw new n("Invalid signature: left bytes after parsing");return{r:i.decode(u),s:i.decode(h)}},hexFromSig(t){const{_tlv:n,_int:r}=e.DER,i=`${n.encode(2,r.encode(t.r))}${n.encode(2,r.encode(t.s))}`;return n.encode(48,i)}};const c=BigInt(0),l=BigInt(1),u=BigInt(2),d=BigInt(3),h=BigInt(4);function f(e){const o=function(e){const n=(0,t.validateBasic)(e);r.validateObject(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:i,Fp:o,a:s}=n;if(i){if(!o.eql(s,o.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof i||"bigint"!=typeof i.beta||"function"!=typeof i.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}(e),{Fp:s}=o,a=n.Field(o.n,o.nBitLength),u=o.toBytes||((e,t,n)=>{const i=t.toAffine();return r.concatBytes(Uint8Array.from([4]),s.toBytes(i.x),s.toBytes(i.y))}),h=o.fromBytes||(e=>{const t=e.subarray(1);return{x:s.fromBytes(t.subarray(0,s.BYTES)),y:s.fromBytes(t.subarray(s.BYTES,2*s.BYTES))}});function f(e){const{a:t,b:n}=o,r=s.sqr(e),i=s.mul(r,e);return s.add(s.add(i,s.mul(e,t)),n)}if(!s.eql(s.sqr(o.Gy),f(o.Gx)))throw new Error("bad generator point: equation left != right");function p(e){const{allowedPrivateKeyLengths:t,nByteLength:s,wrapPrivateKey:a,n:c}=o;if(t&&"bigint"!=typeof e){if(r.isBytes(e)&&(e=r.bytesToHex(e)),"string"!=typeof e||!t.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*s,"0")}let u;try{u="bigint"==typeof e?e:r.bytesToNumberBE((0,i.ensureBytes)("private key",e,s))}catch(t){throw new Error(`private key must be ${s} bytes, hex or bigint, not ${typeof e}`)}return a&&(u=n.mod(u,c)),r.aInRange("private key",u,l,c),u}function g(e){if(!(e instanceof v))throw new Error("ProjectivePoint expected")}const m=(0,i.memoized)(((e,t)=>{const{px:n,py:r,pz:i}=e;if(s.eql(i,s.ONE))return{x:n,y:r};const o=e.is0();null==t&&(t=o?s.ONE:s.inv(i));const a=s.mul(n,t),c=s.mul(r,t),l=s.mul(i,t);if(o)return{x:s.ZERO,y:s.ZERO};if(!s.eql(l,s.ONE))throw new Error("invZ was invalid");return{x:a,y:c}})),y=(0,i.memoized)((e=>{if(e.is0()){if(o.allowInfinityPoint&&!s.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:t,y:n}=e.toAffine();if(!s.isValid(t)||!s.isValid(n))throw new Error("bad point: x or y not FE");const r=s.sqr(n),i=f(t);if(!s.eql(r,i))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class v{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!s.isValid(e))throw new Error("x required");if(null==t||!s.isValid(t))throw new Error("y required");if(null==n||!s.isValid(n))throw new Error("z required");Object.freeze(this)}static fromAffine(e){const{x:t,y:n}=e||{};if(!e||!s.isValid(t)||!s.isValid(n))throw new Error("invalid affine point");if(e instanceof v)throw new Error("projective point not allowed");const r=e=>s.eql(e,s.ZERO);return r(t)&&r(n)?v.ZERO:new v(t,n,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=s.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(v.fromAffine)}static fromHex(e){const t=v.fromAffine(h((0,i.ensureBytes)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return v.BASE.multiply(p(e))}static msm(e,n){return(0,t.pippenger)(v,a,e,n)}_setWindowSize(e){w.setWindowSize(this,e)}assertValidity(){y(this)}hasEvenY(){const{y:e}=this.toAffine();if(s.isOdd)return!s.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){g(e);const{px:t,py:n,pz:r}=this,{px:i,py:o,pz:a}=e,c=s.eql(s.mul(t,a),s.mul(i,r)),l=s.eql(s.mul(n,a),s.mul(o,r));return c&&l}negate(){return new v(this.px,s.neg(this.py),this.pz)}double(){const{a:e,b:t}=o,n=s.mul(t,d),{px:r,py:i,pz:a}=this;let c=s.ZERO,l=s.ZERO,u=s.ZERO,h=s.mul(r,r),f=s.mul(i,i),p=s.mul(a,a),g=s.mul(r,i);return g=s.add(g,g),u=s.mul(r,a),u=s.add(u,u),c=s.mul(e,u),l=s.mul(n,p),l=s.add(c,l),c=s.sub(f,l),l=s.add(f,l),l=s.mul(c,l),c=s.mul(g,c),u=s.mul(n,u),p=s.mul(e,p),g=s.sub(h,p),g=s.mul(e,g),g=s.add(g,u),u=s.add(h,h),h=s.add(u,h),h=s.add(h,p),h=s.mul(h,g),l=s.add(l,h),p=s.mul(i,a),p=s.add(p,p),h=s.mul(p,g),c=s.sub(c,h),u=s.mul(p,f),u=s.add(u,u),u=s.add(u,u),new v(c,l,u)}add(e){g(e);const{px:t,py:n,pz:r}=this,{px:i,py:a,pz:c}=e;let l=s.ZERO,u=s.ZERO,h=s.ZERO;const f=o.a,p=s.mul(o.b,d);let m=s.mul(t,i),y=s.mul(n,a),b=s.mul(r,c),w=s.add(t,n),E=s.add(i,a);w=s.mul(w,E),E=s.add(m,y),w=s.sub(w,E),E=s.add(t,r);let S=s.add(i,c);return E=s.mul(E,S),S=s.add(m,b),E=s.sub(E,S),S=s.add(n,r),l=s.add(a,c),S=s.mul(S,l),l=s.add(y,b),S=s.sub(S,l),h=s.mul(f,E),l=s.mul(p,b),h=s.add(l,h),l=s.sub(y,h),h=s.add(y,h),u=s.mul(l,h),y=s.add(m,m),y=s.add(y,m),b=s.mul(f,b),E=s.mul(p,E),y=s.add(y,b),b=s.sub(m,b),b=s.mul(f,b),E=s.add(E,b),m=s.mul(y,E),u=s.add(u,m),m=s.mul(S,E),l=s.mul(w,l),l=s.sub(l,m),m=s.mul(w,y),h=s.mul(S,h),h=s.add(h,m),new v(l,u,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(v.ZERO)}wNAF(e){return w.wNAFCached(this,e,v.normalizeZ)}multiplyUnsafe(e){r.aInRange("scalar",e,c,o.n);const t=v.ZERO;if(e===c)return t;if(e===l)return this;const{endo:n}=o;if(!n)return w.unsafeLadder(this,e);let{k1neg:i,k1:a,k2neg:u,k2:d}=n.splitScalar(e),h=t,f=t,p=this;for(;a>c||d>c;)a&l&&(h=h.add(p)),d&l&&(f=f.add(p)),p=p.double(),a>>=l,d>>=l;return i&&(h=h.negate()),u&&(f=f.negate()),f=new v(s.mul(f.px,n.beta),f.py,f.pz),h.add(f)}multiply(e){const{endo:t,n:n}=o;let i,a;if(r.aInRange("scalar",e,l,n),t){const{k1neg:n,k1:r,k2neg:o,k2:c}=t.splitScalar(e);let{p:l,f:u}=this.wNAF(r),{p:d,f:h}=this.wNAF(c);l=w.constTimeNegate(n,l),d=w.constTimeNegate(o,d),d=new v(s.mul(d.px,t.beta),d.py,d.pz),i=l.add(d),a=u.add(h)}else{const{p:t,f:n}=this.wNAF(e);i=t,a=n}return v.normalizeZ([i,a])[0]}multiplyAndAddUnsafe(e,t,n){const r=v.BASE,i=(e,t)=>t!==c&&t!==l&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){return m(this,e)}isTorsionFree(){const{h:e,isTorsionFree:t}=o;if(e===l)return!0;if(t)return t(v,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:t}=o;return e===l?this:t?t(v,this):this.multiplyUnsafe(o.h)}toRawBytes(e=!0){return(0,i.abool)("isCompressed",e),this.assertValidity(),u(v,this,e)}toHex(e=!0){return(0,i.abool)("isCompressed",e),r.bytesToHex(this.toRawBytes(e))}}v.BASE=new v(o.Gx,o.Gy,s.ONE),v.ZERO=new v(s.ZERO,s.ONE,s.ZERO);const b=o.nBitLength,w=(0,t.wNAF)(v,o.endo?Math.ceil(b/2):b);return{CURVE:o,ProjectivePoint:v,normPrivateKeyToScalar:p,weierstrassEquation:f,isWithinCurveOrder:function(e){return r.inRange(e,l,o.n)}}}function p(e,t){const n=e.ORDER;let r=c;for(let e=n-l;e%u===c;e/=u)r+=l;const i=r,o=u<<i-l-l,s=o*u,a=(n-l)/s,f=(a-l)/u,p=s-l,g=o,m=e.pow(t,a),y=e.pow(t,(a+l)/u);let v=(t,n)=>{let r=m,o=e.pow(n,p),s=e.sqr(o);s=e.mul(s,n);let a=e.mul(t,s);a=e.pow(a,f),a=e.mul(a,o),o=e.mul(a,n),s=e.mul(a,t);let c=e.mul(s,o);a=e.pow(c,g);let d=e.eql(a,e.ONE);o=e.mul(s,y),a=e.mul(c,r),s=e.cmov(o,s,d),c=e.cmov(a,c,d);for(let t=i;t>l;t--){let n=t-u;n=u<<n-l;let i=e.pow(c,n);const a=e.eql(i,e.ONE);o=e.mul(s,r),r=e.mul(r,r),i=e.mul(c,r),s=e.cmov(o,s,a),c=e.cmov(i,c,a)}return{isValid:d,value:s}};if(e.ORDER%h===d){const n=(e.ORDER-d)/h,r=e.sqrt(e.neg(t));v=(t,i)=>{let o=e.sqr(i);const s=e.mul(t,i);o=e.mul(o,s);let a=e.pow(o,n);a=e.mul(a,s);const c=e.mul(a,r),l=e.mul(e.sqr(a),i),u=e.eql(l,t);return{isValid:u,value:e.cmov(c,a,u)}}}return v}}(xs),Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.getHash=Os,Ms.createCurve=function(e,t){const n=t=>(0,Is.weierstrass)({...e,...Os(t)});return Object.freeze({...n(t),create:n})};const Ps=Rs,Ts=ui,Is=xs;function Os(e){return{hash:e,hmac:(t,...n)=>(0,Ps.hmac)(e,t,(0,Ts.concatBytes)(...n)),randomBytes:Ts.randomBytes}}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.encodeToCurve=e.hashToCurve=e.schnorr=e.secp256k1=void 0;const t=bs,n=ui,r=Ms,i=rs,o=eo,s=to,a=xs,c=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),l=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),u=BigInt(1),d=BigInt(2),h=(e,t)=>(e+t/d)/t;function f(e){const t=c,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),a=BigInt(23),l=BigInt(44),u=BigInt(88),h=e*e*e%t,f=h*h*e%t,g=(0,o.pow2)(f,n,t)*f%t,m=(0,o.pow2)(g,n,t)*f%t,y=(0,o.pow2)(m,d,t)*h%t,v=(0,o.pow2)(y,i,t)*y%t,b=(0,o.pow2)(v,s,t)*v%t,w=(0,o.pow2)(b,l,t)*b%t,E=(0,o.pow2)(w,u,t)*w%t,S=(0,o.pow2)(E,l,t)*b%t,_=(0,o.pow2)(S,n,t)*f%t,C=(0,o.pow2)(_,a,t)*v%t,A=(0,o.pow2)(C,r,t)*h%t,k=(0,o.pow2)(A,d,t);if(!p.eql(p.sqr(k),e))throw new Error("Cannot find square root");return k}const p=(0,o.Field)(c,void 0,void 0,{sqrt:f});e.secp256k1=(0,r.createCurve)({a:BigInt(0),b:BigInt(7),Fp:p,n:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=l,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-u*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,a=BigInt("0x100000000000000000000000000000000"),c=h(s*e,t),d=h(-r*e,t);let f=(0,o.mod)(e-c*n-d*i,t),p=(0,o.mod)(-c*r-d*s,t);const g=f>a,m=p>a;if(g&&(f=t-f),m&&(p=t-p),f>a||p>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:g,k1:f,k2neg:m,k2:p}}}},t.sha256);const g=BigInt(0),m={};function y(e,...n){let r=m[e];if(void 0===r){const n=(0,t.sha256)(Uint8Array.from(e,(e=>e.charCodeAt(0))));r=(0,s.concatBytes)(n,n),m[e]=r}return(0,t.sha256)((0,s.concatBytes)(r,...n))}const v=e=>e.toRawBytes(!0).slice(1),b=e=>(0,s.numberToBytesBE)(e,32),w=e=>(0,o.mod)(e,c),E=e=>(0,o.mod)(e,l),S=e.secp256k1.ProjectivePoint,_=(e,t,n)=>S.BASE.multiplyAndAddUnsafe(e,t,n);function C(t){let n=e.secp256k1.utils.normPrivateKeyToScalar(t),r=S.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:E(-n),bytes:v(r)}}function A(e){(0,s.aInRange)("x",e,u,c);const t=w(e*e);let n=f(w(t*e+BigInt(7)));n%d!==g&&(n=w(-n));const r=new S(e,n,u);return r.assertValidity(),r}const k=s.bytesToNumberBE;function M(...e){return E(k(y("BIP0340/challenge",...e)))}function R(e,t,n){const r=(0,s.ensureBytes)("signature",e,64),i=(0,s.ensureBytes)("message",t),o=(0,s.ensureBytes)("publicKey",n,32);try{const e=A(k(o)),t=k(r.subarray(0,32));if(!(0,s.inRange)(t,u,c))return!1;const n=k(r.subarray(32,64));if(!(0,s.inRange)(n,u,l))return!1;const a=M(b(t),v(e),i),d=_(e,n,E(-a));return!(!d||!d.hasEvenY()||d.toAffine().x!==t)}catch(e){return!1}}e.schnorr={getPublicKey:function(e){return C(e).bytes},sign:function(e,t,r=(0,n.randomBytes)(32)){const i=(0,s.ensureBytes)("message",e),{bytes:o,scalar:a}=C(t),c=(0,s.ensureBytes)("auxRand",r,32),l=b(a^k(y("BIP0340/aux",c))),u=y("BIP0340/nonce",l,o,i),d=E(k(u));if(d===g)throw new Error("sign failed: k is zero");const{bytes:h,scalar:f}=C(d),p=M(h,o,i),m=new Uint8Array(64);if(m.set(h,0),m.set(b(E(f+p*a)),32),!R(m,i,o))throw new Error("sign: Invalid signature produced");return m},verify:R,utils:{randomPrivateKey:e.secp256k1.utils.randomPrivateKey,lift_x:A,pointToBytes:v,numberToBytesBE:s.numberToBytesBE,bytesToNumberBE:s.bytesToNumberBE,taggedHash:y,mod:o.mod}};const x=(0,i.isogenyMap)(p,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map((e=>e.map((e=>BigInt(e)))))),P=(0,a.mapToCurveSimpleSWU)(p,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:p.create(BigInt("-11"))}),T=(0,i.createHasher)(e.secp256k1.ProjectivePoint,(e=>{const{x:t,y:n}=P(p.create(e[0]));return x(t,n)}),{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:p.ORDER,m:1,k:128,expand:"xmd",hash:t.sha256});e.hashToCurve=T.hashToCurve,e.encodeToCurve=T.encodeToCurve}(vs);var Ns={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodeHex=e.remove0x=void 0;var t=Or;e.remove0x=function(e){return e.startsWith("0x")||e.startsWith("0X")?e.slice(2):e},e.decodeHex=function(n){return(0,t.hexToBytes)((0,e.remove0x)(n))}}(Ns),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hexToPublicKey=e.convertPublicKeyFormat=e.getSharedPoint=e.getPublicKey=e.isValidPrivateKey=e.getValidSecret=void 0;var t=Yr,n=Qr,r=vs,i=Hr,o=qr,s=Ns;function a(e,t,i,o){if("secp256k1"===e)return t(r.secp256k1);if("x25519"===e)return i(n.x25519);if("ed25519"===e)return o(n.ed25519);throw new Error("Not implemented")}e.getValidSecret=function(){var n;do{n=(0,t.randomBytes)(o.SECRET_KEY_LENGTH)}while(!(0,e.isValidPrivateKey)(n));return n},e.isValidPrivateKey=function(e){return a((0,i.ellipticCurve)(),(function(t){return t.utils.isValidPrivateKey(e)}),(function(){return!0}),(function(){return!0}))},e.getPublicKey=function(e){return a((0,i.ellipticCurve)(),(function(t){return t.getPublicKey(e)}),(function(t){return t.getPublicKey(e)}),(function(t){return t.getPublicKey(e)}))},e.getSharedPoint=function(e,t,n){return a((0,i.ellipticCurve)(),(function(r){return r.getSharedSecret(e,t,n)}),(function(n){return n.getSharedSecret(e,t)}),(function(n){return l(n,e,t)}))},e.convertPublicKeyFormat=function(e,t){return a((0,i.ellipticCurve)(),(function(n){return n.getSharedSecret(BigInt(1),e,t)}),(function(){return e}),(function(){return e}))},e.hexToPublicKey=function(e){var t=(0,s.decodeHex)(e);return a((0,i.ellipticCurve)(),(function(){return c(t)}),(function(){return t}),(function(){return t}))};var c=function(e){if(e.length===o.ETH_PUBLIC_KEY_SIZE){var t=new Uint8Array(1+e.length);return t.set([4]),t.set(e,1),t}return e},l=function(e,t,n){var r=e.utils.getExtendedPublicKey(t).scalar;return e.ExtendedPoint.fromHex(n).multiply(r).toRawBytes()}}(Gr);var Ls={},Bs={};Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.hkdf=void 0,Bs.extract=Us,Bs.expand=Hs;const Ds=ti,Ks=ui,js=Rs;function Us(e,t,n){return(0,Ds.hash)(e),void 0===n&&(n=new Uint8Array(e.outputLen)),(0,js.hmac)(e,(0,Ks.toBytes)(n),(0,Ks.toBytes)(t))}const $s=new Uint8Array([0]),Fs=new Uint8Array;function Hs(e,t,n,r=32){if((0,Ds.hash)(e),(0,Ds.number)(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=Fs);const o=new Uint8Array(i*e.outputLen),s=js.hmac.create(e,t),a=s._cloneInto(),c=new Uint8Array(s.outputLen);for(let t=0;t<i;t++)$s[0]=t+1,a.update(0===t?Fs:c).update(n).update($s).digestInto(c),o.set(c,e.outputLen*t),s._cloneInto(a);return s.destroy(),a.destroy(),c.fill(0),$s.fill(0),o.slice(0,r)}Bs.hkdf=(e,t,n,r,i)=>Hs(e,Us(e,t,n),r,i),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSharedKey=e.deriveKey=void 0;var t=Or,n=Bs,r=bs;e.deriveKey=function(e,t,i){return(0,n.hkdf)(r.sha256,e,t,i,32)},e.getSharedKey=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return(0,e.deriveKey)(t.concatBytes.apply(void 0,n))}}(Ls);var qs={},zs={},Ws={},Vs={};Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.polyval=Vs.ghash=void 0,Vs._toGHASHKey=ea;const Gs=Nr,Ys=Or,Js=16,Zs=new Uint8Array(16),Qs=(0,Ys.u32)(Zs),Xs=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function ea(e){e.reverse();const t=1&e[15];let n=0;for(let t=0;t<e.length;t++){const r=e[t];e[t]=r>>>1|n,n=(1&r)<<7}return e[0]^=225&-t,e}class ta{constructor(e,t){this.blockLen=Js,this.outputLen=Js,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=(0,Ys.toBytes)(e),(0,Gs.bytes)(e,16);const n=(0,Ys.createView)(e);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),o=n.getUint32(8,!1),s=n.getUint32(12,!1);const a=[];for(let e=0;e<128;e++)a.push({s0:Xs(r),s1:Xs(i),s2:Xs(o),s3:Xs(s)}),({s0:r,s1:i,s2:o,s3:s}={s3:(u=o)<<31|(d=s)>>>1,s2:(l=i)<<31|u>>>1,s1:(c=r)<<31|l>>>1,s0:c>>>1^225<<24&-(1&d)});var c,l,u,d;const h=(e=>e>65536?8:e>1024?4:2)(t||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const f=128/h,p=this.windowSize=2**h,g=[];for(let e=0;e<f;e++)for(let t=0;t<p;t++){let n=0,r=0,i=0,o=0;for(let s=0;s<h;s++){if(!(t>>>h-s-1&1))continue;const{s0:c,s1:l,s2:u,s3:d}=a[h*e+s];n^=c,r^=l,i^=u,o^=d}g.push({s0:n,s1:r,s2:i,s3:o})}this.t=g}_updateBlock(e,t,n,r){e^=this.s0,t^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:o,windowSize:s}=this;let a=0,c=0,l=0,u=0;const d=(1<<i)-1;let h=0;for(const f of[e,t,n,r])for(let e=0;e<4;e++){const t=f>>>8*e&255;for(let e=8/i-1;e>=0;e--){const n=t>>>i*e&d,{s0:r,s1:f,s2:p,s3:g}=o[h*s+n];a^=r,c^=f,l^=p,u^=g,h+=1}}this.s0=a,this.s1=c,this.s2=l,this.s3=u}update(e){e=(0,Ys.toBytes)(e),(0,Gs.exists)(this);const t=(0,Ys.u32)(e),n=Math.floor(e.length/Js),r=e.length%Js;for(let e=0;e<n;e++)this._updateBlock(t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]);return r&&(Zs.set(e.subarray(n*Js)),this._updateBlock(Qs[0],Qs[1],Qs[2],Qs[3]),(0,Ys.clean)(Qs)),this}destroy(){const{t:e}=this;for(const t of e)t.s0=0,t.s1=0,t.s2=0,t.s3=0}digestInto(e){(0,Gs.exists)(this),(0,Gs.output)(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,o=(0,Ys.u32)(e);return o[0]=t,o[1]=n,o[2]=r,o[3]=i,e}digest(){const e=new Uint8Array(Js);return this.digestInto(e),this.destroy(),e}}class na extends ta{constructor(e,t){e=(0,Ys.toBytes)(e);const n=ea((0,Ys.copyBytes)(e));super(n,t),(0,Ys.clean)(n)}update(e){e=(0,Ys.toBytes)(e),(0,Gs.exists)(this);const t=(0,Ys.u32)(e),n=e.length%Js,r=Math.floor(e.length/Js);for(let e=0;e<r;e++)this._updateBlock(Xs(t[4*e+3]),Xs(t[4*e+2]),Xs(t[4*e+1]),Xs(t[4*e+0]));return n&&(Zs.set(e.subarray(r*Js)),this._updateBlock(Xs(Qs[3]),Xs(Qs[2]),Xs(Qs[1]),Xs(Qs[0])),(0,Ys.clean)(Qs)),this}digestInto(e){(0,Gs.exists)(this),(0,Gs.output)(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,o=(0,Ys.u32)(e);return o[0]=t,o[1]=n,o[2]=r,o[3]=i,e.reverse()}}function ra(e){const t=(t,n)=>e(n,t.length).update((0,Ys.toBytes)(t)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(t,n)=>e(t,n),t}Vs.ghash=ra(((e,t)=>new ta(e,t))),Vs.polyval=ra(((e,t)=>new na(e,t))),Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.unsafe=Ws.aeskwp=Ws.aeskw=Ws.siv=Ws.gcm=Ws.cfb=Ws.cbc=Ws.ecb=Ws.ctr=void 0,Ws.expandKeyLE=Ea,Ws.expandKeyDecLE=Sa;const ia=Nr,oa=Vs,sa=Or,aa=16,ca=new Uint8Array(aa),la=283;function ua(e){return e<<1^la&-(e>>7)}function da(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(1&t),e=ua(e);return n}const ha=(()=>{const e=new Uint8Array(256);for(let t=0,n=1;t<256;t++,n^=ua(n))e[t]=n;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return(0,sa.clean)(e),t})(),fa=ha.map(((e,t)=>ha.indexOf(t))),pa=e=>e<<24|e>>>8,ga=e=>e<<8|e>>>24,ma=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255;function ya(e,t){if(256!==e.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>t(e[r]))),r=n.map(ga),i=r.map(ga),o=i.map(ga),s=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let t=0;t<256;t++)for(let l=0;l<256;l++){const u=256*t+l;s[u]=n[t]^r[l],a[u]=i[t]^o[l],c[u]=e[t]<<8|e[l]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:i,T3:o,T01:s,T23:a}}const va=ya(ha,(e=>da(e,3)<<24|e<<16|e<<8|da(e,2))),ba=ya(fa,(e=>da(e,11)<<24|da(e,13)<<16|da(e,9)<<8|da(e,14))),wa=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=ua(n))e[t]=n;return e})();function Ea(e){(0,ia.bytes)(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=va,r=[];(0,sa.isAligned32)(e)||r.push(e=(0,sa.copyBytes)(e));const i=(0,sa.u32)(e),o=i.length,s=e=>Ca(n,e,e,e,e),a=new Uint32Array(t+28);a.set(i);for(let e=o;e<a.length;e++){let t=a[e-1];e%o==0?t=s(pa(t))^wa[e/o-1]:o>6&&e%o==4&&(t=s(t)),a[e]=a[e-o]^t}return(0,sa.clean)(...r),a}function Sa(e){const t=Ea(e),n=t.slice(),r=t.length,{sbox2:i}=va,{T0:o,T1:s,T2:a,T3:c}=ba;for(let e=0;e<r;e+=4)for(let i=0;i<4;i++)n[e+i]=t[r-e-4+i];(0,sa.clean)(t);for(let e=4;e<r-4;e++){const t=n[e],r=Ca(i,t,t,t,t);n[e]=o[255&r]^s[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function _a(e,t,n,r,i,o){return e[n<<8&65280|r>>>8&255]^t[i>>>8&65280|o>>>24&255]}function Ca(e,t,n,r,i){return e[255&t|65280&n]|e[r>>>16&255|i>>>16&65280]<<16}function Aa(e,t,n,r,i){const{sbox2:o,T01:s,T23:a}=va;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let o=0;o<l;o++){const o=e[c++]^_a(s,a,t,n,r,i),l=e[c++]^_a(s,a,n,r,i,t),u=e[c++]^_a(s,a,r,i,t,n),d=e[c++]^_a(s,a,i,t,n,r);t=o,n=l,r=u,i=d}return{s0:e[c++]^Ca(o,t,n,r,i),s1:e[c++]^Ca(o,n,r,i,t),s2:e[c++]^Ca(o,r,i,t,n),s3:e[c++]^Ca(o,i,t,n,r)}}function ka(e,t,n,r,i){const{sbox2:o,T01:s,T23:a}=ba;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let o=0;o<l;o++){const o=e[c++]^_a(s,a,t,i,r,n),l=e[c++]^_a(s,a,n,t,i,r),u=e[c++]^_a(s,a,r,n,t,i),d=e[c++]^_a(s,a,i,r,n,t);t=o,n=l,r=u,i=d}return{s0:e[c++]^Ca(o,t,i,r,n),s1:e[c++]^Ca(o,n,t,i,r),s2:e[c++]^Ca(o,r,n,t,i),s3:e[c++]^Ca(o,i,r,n,t)}}function Ma(e,t){if(void 0===t)return new Uint8Array(e);if((0,ia.bytes)(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);if(!(0,sa.isAligned32)(t))throw new Error("unaligned dst");return t}function Ra(e,t,n,r){(0,ia.bytes)(t,aa),(0,ia.bytes)(n);const i=n.length;r=Ma(i,r);const o=t,s=(0,sa.u32)(o);let{s0:a,s1:c,s2:l,s3:u}=Aa(e,s[0],s[1],s[2],s[3]);const d=(0,sa.u32)(n),h=(0,sa.u32)(r);for(let t=0;t+4<=d.length;t+=4){h[t+0]=d[t+0]^a,h[t+1]=d[t+1]^c,h[t+2]=d[t+2]^l,h[t+3]=d[t+3]^u;let n=1;for(let e=o.length-1;e>=0;e--)n=n+(255&o[e])|0,o[e]=255&n,n>>>=8;({s0:a,s1:c,s2:l,s3:u}=Aa(e,s[0],s[1],s[2],s[3]))}const f=aa*Math.floor(d.length/4);if(f<i){const e=new Uint32Array([a,c,l,u]),t=(0,sa.u8)(e);for(let e=f,o=0;e<i;e++,o++)r[e]=n[e]^t[o];(0,sa.clean)(e)}return r}function xa(e,t,n,r,i){(0,ia.bytes)(n,aa),(0,ia.bytes)(r),i=Ma(r.length,i);const o=n,s=(0,sa.u32)(o),a=(0,sa.createView)(o),c=(0,sa.u32)(r),l=(0,sa.u32)(i),u=t?0:12,d=r.length;let h=a.getUint32(u,t),{s0:f,s1:p,s2:g,s3:m}=Aa(e,s[0],s[1],s[2],s[3]);for(let n=0;n+4<=c.length;n+=4)l[n+0]=c[n+0]^f,l[n+1]=c[n+1]^p,l[n+2]=c[n+2]^g,l[n+3]=c[n+3]^m,h=h+1>>>0,a.setUint32(u,h,t),({s0:f,s1:p,s2:g,s3:m}=Aa(e,s[0],s[1],s[2],s[3]));const y=aa*Math.floor(c.length/4);if(y<d){const e=new Uint32Array([f,p,g,m]),t=(0,sa.u8)(e);for(let e=y,n=0;e<d;e++,n++)i[e]=r[e]^t[n];(0,sa.clean)(e)}return i}function Pa(e){if((0,ia.bytes)(e),e.length%aa!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function Ta(e,t,n){(0,ia.bytes)(e);let r=e.length;const i=r%aa;if(!t&&0!==i)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");(0,sa.isAligned32)(e)||(e=(0,sa.copyBytes)(e));const o=(0,sa.u32)(e);if(t){let e=aa-i;e||(e=aa),r+=e}const s=Ma(r,n);return{b:o,o:(0,sa.u32)(s),out:s}}function Ia(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error("aes/pcks5: wrong padding");const i=e.subarray(0,-r);for(let t=0;t<r;t++)if(e[n-t-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function Oa(e){const t=new Uint8Array(16),n=(0,sa.u32)(t);t.set(e);const r=aa-e.length;for(let e=aa-r;e<aa;e++)t[e]=r;return n}function Na(e,t,n,r,i){const o=null==i?0:i.length,s=e.create(n,r.length+o);i&&s.update(i),s.update(r);const a=new Uint8Array(16),c=(0,sa.createView)(a);i&&(0,sa.setBigUint64)(c,0,BigInt(8*o),t),(0,sa.setBigUint64)(c,8,BigInt(8*r.length),t),s.update(a);const l=s.digest();return(0,sa.clean)(a),l}Ws.ctr=(0,sa.wrapCipher)({blockSize:16,nonceLength:16},(function(e,t){function n(n,r){if((0,ia.bytes)(n),void 0!==r&&((0,ia.bytes)(r),!(0,sa.isAligned32)(r)))throw new Error("unaligned destination");const i=Ea(e),o=(0,sa.copyBytes)(t),s=[i,o];(0,sa.isAligned32)(n)||s.push(n=(0,sa.copyBytes)(n));const a=Ra(i,o,n,r);return(0,sa.clean)(...s),a}return(0,ia.bytes)(e),(0,ia.bytes)(t,aa),{encrypt:(e,t)=>n(e,t),decrypt:(e,t)=>n(e,t)}})),Ws.ecb=(0,sa.wrapCipher)({blockSize:16},(function(e,t={}){(0,ia.bytes)(e);const n=!t.disablePadding;return{encrypt(t,r){const{b:i,o:o,out:s}=Ta(t,n,r),a=Ea(e);let c=0;for(;c+4<=i.length;){const{s0:e,s1:t,s2:n,s3:r}=Aa(a,i[c+0],i[c+1],i[c+2],i[c+3]);o[c++]=e,o[c++]=t,o[c++]=n,o[c++]=r}if(n){const e=Oa(t.subarray(4*c)),{s0:n,s1:r,s2:i,s3:s}=Aa(a,e[0],e[1],e[2],e[3]);o[c++]=n,o[c++]=r,o[c++]=i,o[c++]=s}return(0,sa.clean)(a),s},decrypt(t,r){Pa(t);const i=Sa(e),o=Ma(t.length,r),s=[i];(0,sa.isAligned32)(t)||s.push(t=(0,sa.copyBytes)(t));const a=(0,sa.u32)(t),c=(0,sa.u32)(o);for(let e=0;e+4<=a.length;){const{s0:t,s1:n,s2:r,s3:o}=ka(i,a[e+0],a[e+1],a[e+2],a[e+3]);c[e++]=t,c[e++]=n,c[e++]=r,c[e++]=o}return(0,sa.clean)(...s),Ia(o,n)}}})),Ws.cbc=(0,sa.wrapCipher)({blockSize:16,nonceLength:16},(function(e,t,n={}){(0,ia.bytes)(e),(0,ia.bytes)(t,16);const r=!n.disablePadding;return{encrypt(n,i){const o=Ea(e),{b:s,o:a,out:c}=Ta(n,r,i);let l=t;const u=[o];(0,sa.isAligned32)(l)||u.push(l=(0,sa.copyBytes)(l));const d=(0,sa.u32)(l);let h=d[0],f=d[1],p=d[2],g=d[3],m=0;for(;m+4<=s.length;)h^=s[m+0],f^=s[m+1],p^=s[m+2],g^=s[m+3],({s0:h,s1:f,s2:p,s3:g}=Aa(o,h,f,p,g)),a[m++]=h,a[m++]=f,a[m++]=p,a[m++]=g;if(r){const e=Oa(n.subarray(4*m));h^=e[0],f^=e[1],p^=e[2],g^=e[3],({s0:h,s1:f,s2:p,s3:g}=Aa(o,h,f,p,g)),a[m++]=h,a[m++]=f,a[m++]=p,a[m++]=g}return(0,sa.clean)(...u),c},decrypt(n,i){Pa(n);const o=Sa(e);let s=t;const a=[o];(0,sa.isAligned32)(s)||a.push(s=(0,sa.copyBytes)(s));const c=(0,sa.u32)(s),l=Ma(n.length,i);(0,sa.isAligned32)(n)||a.push(n=(0,sa.copyBytes)(n));const u=(0,sa.u32)(n),d=(0,sa.u32)(l);let h=c[0],f=c[1],p=c[2],g=c[3];for(let e=0;e+4<=u.length;){const t=h,n=f,r=p,i=g;h=u[e+0],f=u[e+1],p=u[e+2],g=u[e+3];const{s0:s,s1:a,s2:c,s3:l}=ka(o,h,f,p,g);d[e++]=s^t,d[e++]=a^n,d[e++]=c^r,d[e++]=l^i}return(0,sa.clean)(...a),Ia(l,r)}}})),Ws.cfb=(0,sa.wrapCipher)({blockSize:16,nonceLength:16},(function(e,t){function n(n,r,i){(0,ia.bytes)(n);const o=n.length;i=Ma(o,i);const s=Ea(e);let a=t;const c=[s];(0,sa.isAligned32)(a)||c.push(a=(0,sa.copyBytes)(a)),(0,sa.isAligned32)(n)||c.push(n=(0,sa.copyBytes)(n));const l=(0,sa.u32)(n),u=(0,sa.u32)(i),d=r?u:l,h=(0,sa.u32)(a);let f=h[0],p=h[1],g=h[2],m=h[3];for(let e=0;e+4<=l.length;){const{s0:t,s1:n,s2:r,s3:i}=Aa(s,f,p,g,m);u[e+0]=l[e+0]^t,u[e+1]=l[e+1]^n,u[e+2]=l[e+2]^r,u[e+3]=l[e+3]^i,f=d[e++],p=d[e++],g=d[e++],m=d[e++]}const y=aa*Math.floor(l.length/4);if(y<o){({s0:f,s1:p,s2:g,s3:m}=Aa(s,f,p,g,m));const e=(0,sa.u8)(new Uint32Array([f,p,g,m]));for(let t=y,r=0;t<o;t++,r++)i[t]=n[t]^e[r];(0,sa.clean)(e)}return(0,sa.clean)(...c),i}return(0,ia.bytes)(e),(0,ia.bytes)(t,16),{encrypt:(e,t)=>n(e,!0,t),decrypt:(e,t)=>n(e,!1,t)}})),Ws.gcm=(0,sa.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},(function(e,t,n){if((0,ia.bytes)(e),(0,ia.bytes)(t),void 0!==n&&(0,ia.bytes)(n),t.length<8)throw new Error("aes/gcm: invalid nonce length");function r(e,t,r){const i=Na(oa.ghash,!1,e,r,n);for(let e=0;e<t.length;e++)i[e]^=t[e];return i}function i(){const n=Ea(e),r=ca.slice(),i=ca.slice();if(xa(n,!1,i,i,r),12===t.length)i.set(t);else{const e=ca.slice(),n=(0,sa.createView)(e);(0,sa.setBigUint64)(n,8,BigInt(8*t.length),!1);const o=oa.ghash.create(r).update(t).update(e);o.digestInto(i),o.destroy()}return{xk:n,authKey:r,counter:i,tagMask:xa(n,!1,i,ca)}}return{encrypt(e){(0,ia.bytes)(e);const{xk:t,authKey:n,counter:o,tagMask:s}=i(),a=new Uint8Array(e.length+16),c=[t,n,o,s];(0,sa.isAligned32)(e)||c.push(e=(0,sa.copyBytes)(e)),xa(t,!1,o,e,a);const l=r(n,s,a.subarray(0,a.length-16));return c.push(l),a.set(l,e.length),(0,sa.clean)(...c),a},decrypt(e){if((0,ia.bytes)(e),e.length<16)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:t,authKey:n,counter:o,tagMask:s}=i(),a=[t,n,s,o];(0,sa.isAligned32)(e)||a.push(e=(0,sa.copyBytes)(e));const c=e.subarray(0,-16),l=e.subarray(-16),u=r(n,s,c);if(a.push(u),!(0,sa.equalBytes)(u,l))throw new Error("aes/gcm: invalid ghash tag");const d=xa(t,!1,o,c);return(0,sa.clean)(...a),d}}}));const La=(e,t,n)=>r=>{if(!Number.isSafeInteger(r)||t>r||r>n)throw new Error(`${e}: invalid value=${r}, must be [${t}..${n}]`)};function Ba(e){return null!=e&&"object"==typeof e&&(e instanceof Uint32Array||"Uint32Array"===e.constructor.name)}function Da(e,t){if((0,ia.bytes)(t,16),!Ba(e))throw new Error("_encryptBlock accepts result of expandKeyLE");const n=(0,sa.u32)(t);let{s0:r,s1:i,s2:o,s3:s}=Aa(e,n[0],n[1],n[2],n[3]);return n[0]=r,n[1]=i,n[2]=o,n[3]=s,t}function Ka(e,t){if((0,ia.bytes)(t,16),!Ba(e))throw new Error("_decryptBlock accepts result of expandKeyLE");const n=(0,sa.u32)(t);let{s0:r,s1:i,s2:o,s3:s}=ka(e,n[0],n[1],n[2],n[3]);return n[0]=r,n[1]=i,n[2]=o,n[3]=s,t}Ws.siv=(0,sa.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},(function(e,t,n){const r=La("AAD",0,2**36),i=La("plaintext",0,2**36),o=La("nonce",12,12),s=La("ciphertext",16,2**36+16);function a(){const n=Ea(e),r=new Uint8Array(e.length),i=new Uint8Array(16),o=[n,r];let s=t;(0,sa.isAligned32)(s)||o.push(s=(0,sa.copyBytes)(s));const a=(0,sa.u32)(s);let c=0,l=a[0],u=a[1],d=a[2],h=0;for(const e of[i,r].map(sa.u32)){const t=(0,sa.u32)(e);for(let e=0;e<t.length;e+=2){const{s0:r,s1:i}=Aa(n,c,l,u,d);t[e+0]=r,t[e+1]=i,c=++h}}const f={authKey:i,encKey:Ea(r)};return(0,sa.clean)(...o),f}function c(e,r,i){const o=Na(oa.polyval,!0,r,i,n);for(let e=0;e<12;e++)o[e]^=t[e];o[15]&=127;const s=(0,sa.u32)(o);let a=s[0],c=s[1],l=s[2],u=s[3];return({s0:a,s1:c,s2:l,s3:u}=Aa(e,a,c,l,u)),s[0]=a,s[1]=c,s[2]=l,s[3]=u,o}function l(e,t,n){let r=(0,sa.copyBytes)(t);r[15]|=128;const i=xa(e,!0,r,n);return(0,sa.clean)(r),i}return(0,ia.bytes)(e,16,24,32),(0,ia.bytes)(t),o(t.length),void 0!==n&&((0,ia.bytes)(n),r(n.length)),{encrypt(e){(0,ia.bytes)(e),i(e.length);const{encKey:t,authKey:n}=a(),r=c(t,n,e),o=[t,n,r];(0,sa.isAligned32)(e)||o.push(e=(0,sa.copyBytes)(e));const s=new Uint8Array(e.length+16);return s.set(r,e.length),s.set(l(t,r,e)),(0,sa.clean)(...o),s},decrypt(e){(0,ia.bytes)(e),s(e.length);const t=e.subarray(-16),{encKey:n,authKey:r}=a(),i=[n,r];(0,sa.isAligned32)(e)||i.push(e=(0,sa.copyBytes)(e));const o=l(n,t,e.subarray(0,-16)),u=c(n,r,o);if(i.push(u),!(0,sa.equalBytes)(t,u))throw(0,sa.clean)(...i),new Error("invalid polyval tag");return(0,sa.clean)(...i),o}}}));const ja={encrypt(e,t){if(t.length>=2**32)throw new Error("plaintext should be less than 4gb");const n=Ea(e);if(16===t.length)Da(n,t);else{const e=(0,sa.u32)(t);let r=e[0],i=e[1];for(let t=0,o=1;t<6;t++)for(let t=2;t<e.length;t+=2,o++){const{s0:s,s1:a,s2:c,s3:l}=Aa(n,r,i,e[t],e[t+1]);r=s,i=a^ma(o),e[t]=c,e[t+1]=l}e[0]=r,e[1]=i}n.fill(0)},decrypt(e,t){if(t.length-8>=2**32)throw new Error("ciphertext should be less than 4gb");const n=Sa(e),r=t.length/8-1;if(1===r)Ka(n,t);else{const e=(0,sa.u32)(t);let i=e[0],o=e[1];for(let t=0,s=6*r;t<6;t++)for(let t=2*r;t>=1;t-=2,s--){o^=ma(s);const{s0:r,s1:a,s2:c,s3:l}=ka(n,i,o,e[t],e[t+1]);i=r,o=a,e[t]=c,e[t+1]=l}e[0]=i,e[1]=o}n.fill(0)}},Ua=new Uint8Array(8).fill(166);Ws.aeskw=(0,sa.wrapCipher)({blockSize:8},(e=>({encrypt(t){if((0,ia.bytes)(t),!t.length||t.length%8!=0)throw new Error("invalid plaintext length");if(8===t.length)throw new Error("8-byte keys not allowed in AESKW, use AESKWP instead");const n=(0,sa.concatBytes)(Ua,t);return ja.encrypt(e,n),n},decrypt(t){if((0,ia.bytes)(t),t.length%8!=0||t.length<24)throw new Error("invalid ciphertext length");const n=(0,sa.copyBytes)(t);if(ja.decrypt(e,n),!(0,sa.equalBytes)(n.subarray(0,8),Ua))throw new Error("integrity check failed");return n.subarray(0,8).fill(0),n.subarray(8)}})));const $a=2790873510;Ws.aeskwp=(0,sa.wrapCipher)({blockSize:8},(e=>({encrypt(t){if((0,ia.bytes)(t),!t.length)throw new Error("invalid plaintext length");const n=8*Math.ceil(t.length/8),r=new Uint8Array(8+n);r.set(t,8);const i=(0,sa.u32)(r);return i[0]=$a,i[1]=ma(t.length),ja.encrypt(e,r),r},decrypt(t){if((0,ia.bytes)(t),t.length<16)throw new Error("invalid ciphertext length");const n=(0,sa.copyBytes)(t),r=(0,sa.u32)(n);ja.decrypt(e,n);const i=ma(r[1])>>>0,o=8*Math.ceil(i/8);if(r[0]!==$a||n.length-8!==o)throw new Error("integrity check failed");for(let e=i;e<o;e++)if(0!==n[8+e])throw new Error("integrity check failed");return n.subarray(0,8).fill(0),n.subarray(8,8+i)}}))),Ws.unsafe={expandKeyLE:Ea,expandKeyDecLE:Sa,encrypt:Aa,decrypt:ka,encryptBlock:Da,decryptBlock:Ka,ctrCounter:Ra,ctr32:xa},Object.defineProperty(zs,"__esModule",{value:!0}),zs.aes256cbc=zs.aes256gcm=void 0;var Fa=Ws;zs.aes256gcm=function(e,t,n){return(0,Fa.gcm)(e,t,n)},zs.aes256cbc=function(e,t,n){return(0,Fa.cbc)(e,t)};var Ha={},qa={},za={};Object.defineProperty(za,"__esModule",{value:!0}),za.sigma=void 0,za.rotl=function(e,t){return e<<t|e>>>32-t},za.createCipher=function(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:o,rounds:s}=(0,Va.checkOpts)({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return(0,Wa.number)(i),(0,Wa.number)(s),(0,Wa.bool)(o),(0,Wa.bool)(n),(t,a,c,l,u=0)=>{(0,Wa.bytes)(t),(0,Wa.bytes)(a),(0,Wa.bytes)(c);const d=c.length;if(void 0===l&&(l=new Uint8Array(d)),(0,Wa.bytes)(l),(0,Wa.number)(u),u<0||u>=nc)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const h=[];let f,p,g=t.length;if(32===g)h.push(f=(0,Va.copyBytes)(t)),p=Qa;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=Za,h.push(f)}Xa(a)||h.push(a=(0,Va.copyBytes)(a));const m=(0,Va.u32)(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,m,(0,Va.u32)(a.subarray(0,16)),m),a=a.subarray(16)}const y=16-i;if(y!==a.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(12!==y){const e=new Uint8Array(12);e.set(a,o?0:12-a.length),a=e,h.push(a)}const v=(0,Va.u32)(a);return function(e,t,n,r,i,o,s,a){const c=i.length,l=new Uint8Array(ec),u=(0,Va.u32)(l),d=Xa(i)&&Xa(o),h=d?(0,Va.u32)(i):rc,f=d?(0,Va.u32)(o):rc;for(let p=0;p<c;s++){if(e(t,n,r,u,s,a),s>=nc)throw new Error("arx: counter overflow");const g=Math.min(ec,c-p);if(d&&g===ec){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,n=0;n<tc;n++)t=e+n,f[t]=h[t]^u[n];p+=ec}else{for(let e,t=0;t<g;t++)e=p+t,o[e]=i[e]^l[t];p+=g}}}(e,p,m,v,c,l,u,s),(0,Va.clean)(...h),l}};const Wa=Nr,Va=Or,Ga=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),Ya=Ga("expand 16-byte k"),Ja=Ga("expand 32-byte k"),Za=(0,Va.u32)(Ya),Qa=(0,Va.u32)(Ja);function Xa(e){return e.byteOffset%4==0}za.sigma=Qa.slice();const ec=64,tc=16,nc=2**32-1,rc=new Uint32Array;var ic={};Object.defineProperty(ic,"__esModule",{value:!0}),ic.poly1305=void 0,ic.wrapConstructorWithKey=lc;const oc=Nr,sc=Or,ac=(e,t)=>255&e[t++]|(255&e[t++])<<8;class cc{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,sc.toBytes)(e),(0,oc.bytes)(e,32);const t=ac(e,0),n=ac(e,2),r=ac(e,4),i=ac(e,6),o=ac(e,8),s=ac(e,10),a=ac(e,12),c=ac(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|s<<2),this.r[7]=8065&(s>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=ac(e,16+2*t)}process(e,t,n=!1){const r=n?0:2048,{h:i,r:o}=this,s=o[0],a=o[1],c=o[2],l=o[3],u=o[4],d=o[5],h=o[6],f=o[7],p=o[8],g=o[9],m=ac(e,t+0),y=ac(e,t+2),v=ac(e,t+4),b=ac(e,t+6),w=ac(e,t+8),E=ac(e,t+10),S=ac(e,t+12),_=ac(e,t+14);let C=i[0]+(8191&m),A=i[1]+(8191&(m>>>13|y<<3)),k=i[2]+(8191&(y>>>10|v<<6)),M=i[3]+(8191&(v>>>7|b<<9)),R=i[4]+(8191&(b>>>4|w<<12)),x=i[5]+(w>>>1&8191),P=i[6]+(8191&(w>>>14|E<<2)),T=i[7]+(8191&(E>>>11|S<<5)),I=i[8]+(8191&(S>>>8|_<<8)),O=i[9]+(_>>>5|r),N=0,L=N+C*s+A*(5*g)+k*(5*p)+M*(5*f)+R*(5*h);N=L>>>13,L&=8191,L+=x*(5*d)+P*(5*u)+T*(5*l)+I*(5*c)+O*(5*a),N+=L>>>13,L&=8191;let B=N+C*a+A*s+k*(5*g)+M*(5*p)+R*(5*f);N=B>>>13,B&=8191,B+=x*(5*h)+P*(5*d)+T*(5*u)+I*(5*l)+O*(5*c),N+=B>>>13,B&=8191;let D=N+C*c+A*a+k*s+M*(5*g)+R*(5*p);N=D>>>13,D&=8191,D+=x*(5*f)+P*(5*h)+T*(5*d)+I*(5*u)+O*(5*l),N+=D>>>13,D&=8191;let K=N+C*l+A*c+k*a+M*s+R*(5*g);N=K>>>13,K&=8191,K+=x*(5*p)+P*(5*f)+T*(5*h)+I*(5*d)+O*(5*u),N+=K>>>13,K&=8191;let j=N+C*u+A*l+k*c+M*a+R*s;N=j>>>13,j&=8191,j+=x*(5*g)+P*(5*p)+T*(5*f)+I*(5*h)+O*(5*d),N+=j>>>13,j&=8191;let U=N+C*d+A*u+k*l+M*c+R*a;N=U>>>13,U&=8191,U+=x*s+P*(5*g)+T*(5*p)+I*(5*f)+O*(5*h),N+=U>>>13,U&=8191;let $=N+C*h+A*d+k*u+M*l+R*c;N=$>>>13,$&=8191,$+=x*a+P*s+T*(5*g)+I*(5*p)+O*(5*f),N+=$>>>13,$&=8191;let F=N+C*f+A*h+k*d+M*u+R*l;N=F>>>13,F&=8191,F+=x*c+P*a+T*s+I*(5*g)+O*(5*p),N+=F>>>13,F&=8191;let H=N+C*p+A*f+k*h+M*d+R*u;N=H>>>13,H&=8191,H+=x*l+P*c+T*a+I*s+O*(5*g),N+=H>>>13,H&=8191;let q=N+C*g+A*p+k*f+M*h+R*d;N=q>>>13,q&=8191,q+=x*u+P*l+T*c+I*a+O*s,N+=q>>>13,q&=8191,N=(N<<2)+N|0,N=N+L|0,L=8191&N,N>>>=13,B+=N,i[0]=L,i[1]=B,i[2]=D,i[3]=K,i[4]=j,i[5]=U,i[6]=$,i[7]=F,i[8]=H,i[9]=q}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let t=1;t<10;t++)n[t]=e[t]+r,r=n[t]>>>13,n[t]&=8191;n[9]-=8192;let i=(1^r)-1;for(let e=0;e<10;e++)n[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|n[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+t[0];e[0]=65535&o;for(let n=1;n<8;n++)o=(e[n]+t[n]|0)+(o>>>16)|0,e[n]=65535&o;(0,sc.clean)(n)}update(e){(0,oc.exists)(this);const{buffer:t,blockLen:n}=this,r=(e=(0,sc.toBytes)(e)).length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);if(o!==n)t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(e,i)}return this}destroy(){(0,sc.clean)(this.h,this.r,this.buffer,this.pad)}digestInto(e){(0,oc.exists)(this),(0,oc.output)(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function lc(e){const t=(t,n)=>e(n).update((0,sc.toBytes)(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}ic.poly1305=lc((e=>new cc(e))),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.xchacha20poly1305=e.chacha20poly1305=e._poly1305_aead=e.chacha12=e.chacha8=e.xchacha20=e.chacha20=e.chacha20orig=void 0,e.hchacha=s;const t=za,n=Nr,r=ic,i=Or;function o(e,n,r,i,o,s=20){let a=e[0],c=e[1],l=e[2],u=e[3],d=n[0],h=n[1],f=n[2],p=n[3],g=n[4],m=n[5],y=n[6],v=n[7],b=o,w=r[0],E=r[1],S=r[2],_=a,C=c,A=l,k=u,M=d,R=h,x=f,P=p,T=g,I=m,O=y,N=v,L=b,B=w,D=E,K=S;for(let e=0;e<s;e+=2)_=_+M|0,L=(0,t.rotl)(L^_,16),T=T+L|0,M=(0,t.rotl)(M^T,12),_=_+M|0,L=(0,t.rotl)(L^_,8),T=T+L|0,M=(0,t.rotl)(M^T,7),C=C+R|0,B=(0,t.rotl)(B^C,16),I=I+B|0,R=(0,t.rotl)(R^I,12),C=C+R|0,B=(0,t.rotl)(B^C,8),I=I+B|0,R=(0,t.rotl)(R^I,7),A=A+x|0,D=(0,t.rotl)(D^A,16),O=O+D|0,x=(0,t.rotl)(x^O,12),A=A+x|0,D=(0,t.rotl)(D^A,8),O=O+D|0,x=(0,t.rotl)(x^O,7),k=k+P|0,K=(0,t.rotl)(K^k,16),N=N+K|0,P=(0,t.rotl)(P^N,12),k=k+P|0,K=(0,t.rotl)(K^k,8),N=N+K|0,P=(0,t.rotl)(P^N,7),_=_+R|0,K=(0,t.rotl)(K^_,16),O=O+K|0,R=(0,t.rotl)(R^O,12),_=_+R|0,K=(0,t.rotl)(K^_,8),O=O+K|0,R=(0,t.rotl)(R^O,7),C=C+x|0,L=(0,t.rotl)(L^C,16),N=N+L|0,x=(0,t.rotl)(x^N,12),C=C+x|0,L=(0,t.rotl)(L^C,8),N=N+L|0,x=(0,t.rotl)(x^N,7),A=A+P|0,B=(0,t.rotl)(B^A,16),T=T+B|0,P=(0,t.rotl)(P^T,12),A=A+P|0,B=(0,t.rotl)(B^A,8),T=T+B|0,P=(0,t.rotl)(P^T,7),k=k+M|0,D=(0,t.rotl)(D^k,16),I=I+D|0,M=(0,t.rotl)(M^I,12),k=k+M|0,D=(0,t.rotl)(D^k,8),I=I+D|0,M=(0,t.rotl)(M^I,7);let j=0;i[j++]=a+_|0,i[j++]=c+C|0,i[j++]=l+A|0,i[j++]=u+k|0,i[j++]=d+M|0,i[j++]=h+R|0,i[j++]=f+x|0,i[j++]=p+P|0,i[j++]=g+T|0,i[j++]=m+I|0,i[j++]=y+O|0,i[j++]=v+N|0,i[j++]=b+L|0,i[j++]=w+B|0,i[j++]=E+D|0,i[j++]=S+K|0}function s(e,n,r,i){let o=e[0],s=e[1],a=e[2],c=e[3],l=n[0],u=n[1],d=n[2],h=n[3],f=n[4],p=n[5],g=n[6],m=n[7],y=r[0],v=r[1],b=r[2],w=r[3];for(let e=0;e<20;e+=2)o=o+l|0,y=(0,t.rotl)(y^o,16),f=f+y|0,l=(0,t.rotl)(l^f,12),o=o+l|0,y=(0,t.rotl)(y^o,8),f=f+y|0,l=(0,t.rotl)(l^f,7),s=s+u|0,v=(0,t.rotl)(v^s,16),p=p+v|0,u=(0,t.rotl)(u^p,12),s=s+u|0,v=(0,t.rotl)(v^s,8),p=p+v|0,u=(0,t.rotl)(u^p,7),a=a+d|0,b=(0,t.rotl)(b^a,16),g=g+b|0,d=(0,t.rotl)(d^g,12),a=a+d|0,b=(0,t.rotl)(b^a,8),g=g+b|0,d=(0,t.rotl)(d^g,7),c=c+h|0,w=(0,t.rotl)(w^c,16),m=m+w|0,h=(0,t.rotl)(h^m,12),c=c+h|0,w=(0,t.rotl)(w^c,8),m=m+w|0,h=(0,t.rotl)(h^m,7),o=o+u|0,w=(0,t.rotl)(w^o,16),g=g+w|0,u=(0,t.rotl)(u^g,12),o=o+u|0,w=(0,t.rotl)(w^o,8),g=g+w|0,u=(0,t.rotl)(u^g,7),s=s+d|0,y=(0,t.rotl)(y^s,16),m=m+y|0,d=(0,t.rotl)(d^m,12),s=s+d|0,y=(0,t.rotl)(y^s,8),m=m+y|0,d=(0,t.rotl)(d^m,7),a=a+h|0,v=(0,t.rotl)(v^a,16),f=f+v|0,h=(0,t.rotl)(h^f,12),a=a+h|0,v=(0,t.rotl)(v^a,8),f=f+v|0,h=(0,t.rotl)(h^f,7),c=c+l|0,b=(0,t.rotl)(b^c,16),p=p+b|0,l=(0,t.rotl)(l^p,12),c=c+l|0,b=(0,t.rotl)(b^c,8),p=p+b|0,l=(0,t.rotl)(l^p,7);let E=0;i[E++]=o,i[E++]=s,i[E++]=a,i[E++]=c,i[E++]=y,i[E++]=v,i[E++]=b,i[E++]=w}e.chacha20orig=(0,t.createCipher)(o,{counterRight:!1,counterLength:8,allowShortKeys:!0}),e.chacha20=(0,t.createCipher)(o,{counterRight:!1,counterLength:4,allowShortKeys:!1}),e.xchacha20=(0,t.createCipher)(o,{counterRight:!1,counterLength:8,extendNonceFn:s,allowShortKeys:!1}),e.chacha8=(0,t.createCipher)(o,{counterRight:!1,counterLength:4,rounds:8}),e.chacha12=(0,t.createCipher)(o,{counterRight:!1,counterLength:4,rounds:12});const a=new Uint8Array(16),c=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(a.subarray(n))},l=new Uint8Array(32);function u(e,t,n,o,s){const a=e(t,n,l),u=r.poly1305.create(a);s&&c(u,s),c(u,o);const d=new Uint8Array(16),h=(0,i.createView)(d);(0,i.setBigUint64)(h,0,BigInt(s?s.length:0),!0),(0,i.setBigUint64)(h,8,BigInt(o.length),!0),u.update(d);const f=u.digest();return(0,i.clean)(a,d),f}e._poly1305_aead=e=>(t,r,o)=>((0,n.bytes)(t,32),(0,n.bytes)(r),{encrypt(s,a){const c=s.length,l=c+16;a?(0,n.bytes)(a,l):a=new Uint8Array(l),e(t,r,s,a,1);const d=u(e,t,r,a.subarray(0,-16),o);return a.set(d,c),(0,i.clean)(d),a},decrypt(s,a){const c=s.length,l=c-16;if(c<16)throw new Error("encrypted data must be at least 16 bytes");a?(0,n.bytes)(a,l):a=new Uint8Array(l);const d=s.subarray(0,-16),h=s.subarray(-16),f=u(e,t,r,d,o);if(!(0,i.equalBytes)(h,f))throw new Error("invalid tag");return e(t,r,d,a,1),(0,i.clean)(f),a}}),e.chacha20poly1305=(0,i.wrapCipher)({blockSize:64,nonceLength:12,tagLength:16},(0,e._poly1305_aead)(e.chacha20)),e.xchacha20poly1305=(0,i.wrapCipher)({blockSize:64,nonceLength:24,tagLength:16},(0,e._poly1305_aead)(e.xchacha20))}(qa),Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.xchacha20=void 0;var uc,dc,hc,fc=qa;Ha.xchacha20=function(e,t,n){return(0,fc.xchacha20poly1305)(e,t,n)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.aesDecrypt=e.aesEncrypt=e.symDecrypt=e.symEncrypt=void 0;var t=Or,n=Yr,r=zs,i=Ha,o=Hr,s=qr;function a(e,t,n,a){var c=(0,o.symmetricAlgorithm)();if("aes-256-gcm"===c)return e(r.aes256gcm,t,n,(0,o.symmetricNonceLength)(),s.AEAD_TAG_LENGTH,a);if("xchacha20"===c)return e(i.xchacha20,t,n,s.XCHACHA20_NONCE_LENGTH,s.AEAD_TAG_LENGTH,a);if("aes-256-cbc"===c)return e(r.aes256cbc,t,n,16,0);throw new Error("Not implemented")}function c(e,r,i,o,s,a){var c=(0,n.randomBytes)(o),l=e(r,c,a).encrypt(i);if(0===s)return(0,t.concatBytes)(c,l);var u=l.length-s,d=l.subarray(0,u),h=l.subarray(u);return(0,t.concatBytes)(c,h,d)}function l(e,n,r,i,o,s){var a=r.subarray(0,i),c=e(n,Uint8Array.from(a),s),l=r.subarray(i);if(0===o)return c.decrypt(l);var u=l.subarray(0,o),d=l.subarray(o);return c.decrypt((0,t.concatBytes)(d,u))}e.symEncrypt=function(e,t,n){return a(c,e,t,n)},e.symDecrypt=function(e,t,n){return a(l,e,t,n)},e.aesEncrypt=e.symEncrypt,e.aesDecrypt=e.symDecrypt}(qs),uc=Vr,dc=Pr&&Pr.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),hc=Pr&&Pr.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||dc(t,e,n)},Object.defineProperty(uc,"__esModule",{value:!0}),hc(Gr,uc),hc(Ls,uc),hc(Ns,uc),hc(qs,uc);var pc={};Object.defineProperty(pc,"__esModule",{value:!0}),pc.PublicKey=void 0;var gc=Or,mc=Vr,yc=function(){function e(e){this.data=(0,mc.convertPublicKeyFormat)(e,!0)}return e.fromHex=function(t){return new e((0,mc.hexToPublicKey)(t))},Object.defineProperty(e.prototype,"uncompressed",{get:function(){return R.from((0,mc.convertPublicKeyFormat)(this.data,!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"compressed",{get:function(){return R.from(this.data)},enumerable:!1,configurable:!0}),e.prototype.toHex=function(e){return void 0===e&&(e=!0),(0,gc.bytesToHex)(e?this.data:this.uncompressed)},e.prototype.decapsulate=function(e,t){void 0===t&&(t=!1);var n=t?this.data:this.uncompressed,r=e.multiply(this,t);return(0,mc.getSharedKey)(n,r)},e.prototype.equals=function(e){return(0,gc.equalBytes)(this.data,e.data)},e}();pc.PublicKey=yc,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.PrivateKey=void 0;var vc=Or,bc=Vr,wc=pc,Ec=function(){function e(e){if(void 0===e)this.data=(0,bc.getValidSecret)();else{if(!(0,bc.isValidPrivateKey)(e))throw new Error("Invalid private key");this.data=e}this.publicKey=new wc.PublicKey((0,bc.getPublicKey)(this.data))}return e.fromHex=function(t){return new e((0,bc.decodeHex)(t))},Object.defineProperty(e.prototype,"secret",{get:function(){return R.from(this.data)},enumerable:!1,configurable:!0}),e.prototype.toHex=function(){return(0,vc.bytesToHex)(this.data)},e.prototype.encapsulate=function(e,t){void 0===t&&(t=!1);var n=t?this.publicKey.compressed:this.publicKey.uncompressed,r=this.multiply(e,t);return(0,bc.getSharedKey)(n,r)},e.prototype.multiply=function(e,t){return void 0===t&&(t=!1),(0,bc.getSharedPoint)(this.data,e.compressed,t)},e.prototype.equals=function(e){return(0,vc.equalBytes)(this.data,e.data)},e}();Wr.PrivateKey=Ec,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PublicKey=e.PrivateKey=void 0;var t=Wr;Object.defineProperty(e,"PrivateKey",{enumerable:!0,get:function(){return t.PrivateKey}});var n=pc;Object.defineProperty(e,"PublicKey",{enumerable:!0,get:function(){return n.PublicKey}})}(zr),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.utils=e.PublicKey=e.PrivateKey=e.ECIES_CONFIG=void 0,e.encrypt=function(e,o){var s=new r.PrivateKey,a=e instanceof Uint8Array?new r.PublicKey(e):r.PublicKey.fromHex(e),c=s.encapsulate(a,(0,n.isHkdfKeyCompressed)()),l=(0,n.isEphemeralKeyCompressed)()?s.publicKey.compressed:s.publicKey.uncompressed,u=(0,i.symEncrypt)(c,o);return R.from((0,t.concatBytes)(l,u))},e.decrypt=function(e,t){var o=e instanceof Uint8Array?new r.PrivateKey(e):r.PrivateKey.fromHex(e),s=(0,n.ephemeralKeySize)(),a=new r.PublicKey(t.subarray(0,s)),c=t.subarray(s),l=a.decapsulate(o,(0,n.isHkdfKeyCompressed)());return R.from((0,i.symDecrypt)(l,c))};var t=Or,n=Hr,r=zr,i=Vr,o=Hr;Object.defineProperty(e,"ECIES_CONFIG",{enumerable:!0,get:function(){return o.ECIES_CONFIG}});var s=zr;Object.defineProperty(e,"PrivateKey",{enumerable:!0,get:function(){return s.PrivateKey}}),Object.defineProperty(e,"PublicKey",{enumerable:!0,get:function(){return s.PublicKey}}),e.utils={aesEncrypt:i.aesEncrypt,aesDecrypt:i.aesDecrypt,symEncrypt:i.symEncrypt,symDecrypt:i.symDecrypt,decodeHex:i.decodeHex,getValidSecret:i.getValidSecret,remove0x:i.remove0x}}(Ir);const Sc=He("KeyExchange:Layer"),_c=He("SocketService:Layer"),Cc=He("Ecies:Layer"),Ac=He("RemoteCommunication:Layer");Sc.color="##95c44e",_c.color="#f638d7",Cc.color="#465b9c",Ac.color="#47a2be";const kc={KeyExchange:Sc,SocketService:_c,Ecies:Cc,RemoteCommunication:Ac};let Mc,Rc=[],xc=[];const Pc=(e,t)=>xr(void 0,void 0,void 0,(function*(){Mc=t,xc.push(e),function(e){return xr(this,void 0,void 0,(function*(){if(!Mc||!e)return;!function(){const e=xc;xc=Rc,Rc=e}();const t=Mc.endsWith("/")?`${Mc}evt`:`${Mc}/evt`,n=Object.assign({},e);if(delete n.params,e.params)for(const[t,r]of Object.entries(e.params))n[t]=r;const r=JSON.stringify(n);kc.RemoteCommunication(`[sendBufferedEvents] Sending ${Rc.length} analytics events to ${t}`);try{const e=yield De.exports(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:r}),n=yield e.text();kc.RemoteCommunication(`[sendBufferedEvents] Response: ${n}`),Rc.length=0}catch(t){}}))}(e).catch((()=>{}))}));class Tc{constructor(e){this.enabled=!0,(null==e?void 0:e.debug)&&He.enable("Ecies:Layer"),this.ecies=(null==e?void 0:e.privateKey)?Ir.PrivateKey.fromHex(e.privateKey):new Ir.PrivateKey,kc.Ecies("[ECIES constructor()] initialized secret: ",this.ecies.toHex()),kc.Ecies("[ECIES constructor()] initialized public: ",this.ecies.publicKey.toHex()),kc.Ecies("[ECIES constructor()] init with",this)}generateECIES(){this.ecies=new Ir.PrivateKey}getPublicKey(){return this.ecies.publicKey.toHex()}encrypt(e,n){let r=e;if(this.enabled)try{kc.Ecies("[ECIES: encrypt()] using otherPublicKey",n);const i=t.from(e),o=Ir.encrypt(n,i);r=t.from(o).toString("base64")}catch(r){throw kc.Ecies("[ECIES: encrypt()] error encrypt:",r),kc.Ecies("[ECIES: encrypt()] private: ",this.ecies.toHex()),kc.Ecies("[ECIES: encrypt()] data: ",e),kc.Ecies("[ECIES: encrypt()] otherkey: ",n),r}return r}decrypt(e){let n=e;if(this.enabled)try{kc.Ecies("[ECIES: decrypt()] using privateKey",this.ecies.toHex());const r=t.from(e.toString(),"base64");n=Ir.decrypt(this.ecies.toHex(),r).toString()}catch(n){throw kc.Ecies("[ECIES: decrypt()] error decrypt",n),kc.Ecies("[ECIES: decrypt()] private: ",this.ecies.toHex()),kc.Ecies("[ECIES: decrypt()] encryptedData: ",e),n}return n}getKeyInfo(){return{private:this.ecies.toHex(),public:this.ecies.publicKey.toHex()}}toString(){kc.Ecies("[ECIES: toString()]",this.getKeyInfo())}}var Ic={name:"@metamask/sdk-communication-layer",version:"0.33.0",description:"",homepage:"https://github.com/MetaMask/metamask-sdk#readme",bugs:{url:"https://github.com/MetaMask/metamask-sdk/issues"},repository:{type:"git",url:"https://github.com/MetaMask/metamask-sdk.git",directory:"packages/sdk-communication-layer"},main:"dist/node/cjs/metamask-sdk-communication-layer.js",unpkg:"dist/browser/umd/metamask-sdk-communication-layer.js",module:"dist/node/es/metamask-sdk-communication-layer.js",browser:"dist/browser/es/metamask-sdk-communication-layer.js","react-native":"dist/react-native/es/metamask-sdk-communication-layer.js",types:"dist/types/src/index.d.ts",files:["/dist"],scripts:{"build:types":"tsc --project tsconfig.build.json --emitDeclarationOnly --outDir dist/types","build:clean":"yarn clean && yarn build",build:"yarn build:types && rollup -c --bundleConfigAsCjs","build:dev":"yarn build:types && NODE_ENV=dev rollup -c --bundleConfigAsCjs",dev:'concurrently "tsc --watch" "rollup -c --bundleConfigAsCjs -w"',"build:post-tsc":"echo 'N/A'","build:pre-tsc":"echo 'N/A'",size:"size-limit",clean:"rimraf ./dist",lint:"yarn lint:eslint && yarn lint:misc --check","lint:changelog":"../../scripts/validate-changelog.sh @metamask/sdk-communication-layer","lint:eslint":"eslint . --cache --ext js,ts","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write","lint:misc":"prettier '**/*.json' '**/*.md' '!CHANGELOG.md' --ignore-path ../../.gitignore","publish:preview":"yarn npm publish --tag preview",prepack:"../../scripts/prepack.sh",reset:"yarn clean && rimraf ./node_modules/",test:'jest --testPathIgnorePatterns "/e2e/"',"test:e2e":'jest --testPathPattern "/e2e/"',"test:coverage":"jest --coverage","test:ci":'jest --coverage --passWithNoTests --setupFilesAfterEnv ./jest-preload.js --testPathIgnorePatterns "/e2e/"',"test:dev":"jest",watch:"rollup -c --bundleConfigAsCjs -w"},dependencies:{"@metamask/sdk-analytics":"workspace:*",bufferutil:"^4.0.8","date-fns":"^2.29.3",debug:"^4.3.4","utf-8-validate":"^5.0.2",uuid:"^8.3.2"},devDependencies:{"@jest/globals":"^29.3.1","@lavamoat/allow-scripts":"^2.3.1","@metamask/auto-changelog":"3.1.0","@metamask/eslint-config":"^6.0.0","@metamask/eslint-config-nodejs":"^6.0.0","@metamask/eslint-config-typescript":"^6.0.0","@rollup/plugin-commonjs":"^25.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-replace":"^6.0.1","@rollup/plugin-terser":"^0.4.4","@size-limit/preset-big-lib":"^11.0.2","@types/jest":"^29.2.4","@types/node":"^20.1.3","@types/uuid":"^9.0.0","@typescript-eslint/eslint-plugin":"^4.26.0","@typescript-eslint/parser":"^4.26.0",concurrently:"^9.1.2","cross-fetch":"^4.0.0",eciesjs:"^0.4.11",eslint:"^7.30.0","eslint-config-prettier":"^8.3.0","eslint-plugin-import":"^2.23.4","eslint-plugin-jest":"^24.4.0","eslint-plugin-jsdoc":"^36.1.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^3.4.0",eventemitter2:"^6.4.9",jest:"^29.3.1",prettier:"^2.3.0",rimraf:"^3.0.2",rollup:"^4.26.0","rollup-plugin-jscc":"^2.0.0","rollup-plugin-natives":"^0.7.5","rollup-plugin-node-builtins":"^2.1.2","rollup-plugin-node-globals":"^1.4.0","rollup-plugin-peer-deps-external":"^2.2.4","rollup-plugin-polyfill-node":"^0.13.0","rollup-plugin-sizes":"^1.0.6","rollup-plugin-typescript2":"^0.31.2","rollup-plugin-visualizer":"^5.12.0","size-limit":"^11.1.6","socket.io-client":"^4.5.1","stream-browserify":"^3.0.0","ts-jest":"^29.0.3","ts-node":"^10.9.1",typescript:"^5.6.3"},peerDependencies:{"cross-fetch":"^4.0.0",eciesjs:"*",eventemitter2:"^6.4.9","readable-stream":"^3.6.2","socket.io-client":"^4.5.1"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},lavamoat:{allowScripts:{"@lavamoat/preinstall-always-fail":!1,canvas:!0,"eciesjs>secp256k1":!1,"socket.io-client>engine.io-client>ws>bufferutil":!1,"socket.io-client>engine.io-client>ws>utf-8-validate":!1,bufferutil:!1,"utf-8-validate":!1}}};const Oc="https://metamask-sdk.api.cx.metamask.io/",Nc=["websocket"],Lc=6048e5,Bc=3e3,Dc={METAMASK_GETPROVIDERSTATE:"metamask_getProviderState",METAMASK_CONNECTSIGN:"metamask_connectSign",METAMASK_CONNECTWITH:"metamask_connectWith",METAMASK_OPEN:"metamask_open",METAMASK_BATCH:"metamask_batch",PERSONAL_SIGN:"personal_sign",WALLET_REQUESTPERMISSIONS:"wallet_requestPermissions",WALLET_REVOKEPERMISSIONS:"wallet_revokePermissions",WALLET_GETPERMISSIONS:"wallet_getPermissions",WALLET_WATCHASSET:"wallet_watchAsset",WALLET_SWITCHETHEREUMCHAIN:"wallet_switchEthereumChain",WALLET_ADDETHEREUMCHAIN:"wallet_addEthereumChain",ETH_REQUESTACCOUNTS:"eth_requestAccounts",ETH_ACCOUNTS:"eth_accounts",ETH_CHAINID:"eth_chainId",ETH_SENDTRANSACTION:"eth_sendTransaction",ETH_SIGNTYPEDDATA:"eth_signTypedData",ETH_SIGNTYPEDDATA_V3:"eth_signTypedData_v3",ETH_SIGNTYPEDDATA_V4:"eth_signTypedData_v4",ETH_SIGNTRANSACTION:"eth_signTransaction",ETH_SIGN:"eth_sign",PERSONAL_EC_RECOVER:"personal_ecRecover"},Kc=[Dc.METAMASK_CONNECTSIGN,Dc.METAMASK_CONNECTWITH,Dc.METAMASK_OPEN,Dc.METAMASK_BATCH,Dc.PERSONAL_SIGN,Dc.WALLET_REQUESTPERMISSIONS,Dc.WALLET_REVOKEPERMISSIONS,Dc.WALLET_WATCHASSET,Dc.ETH_SENDTRANSACTION,Dc.ETH_SIGNTYPEDDATA,Dc.ETH_SIGNTYPEDDATA_V3,Dc.ETH_SIGNTYPEDDATA_V4,Dc.ETH_SIGNTRANSACTION,Dc.ETH_SIGN,Dc.PERSONAL_EC_RECOVER];function jc(e){return Kc.includes(e)}function Uc(e){const{context:t}=e;kc.RemoteCommunication(`[RemoteCommunication: clean()] context=${t}`),e.channelConfig=void 0,e.ready=!1,e.originatorConnectStarted=!1}var $c,Fc,Hc,qc,zc,Wc,Vc,Gc;(Vc=$c||($c={})).DISCONNECTED="disconnected",Vc.WAITING="waiting",Vc.TIMEOUT="timeout",Vc.LINKED="linked",Vc.PAUSED="paused",Vc.TERMINATED="terminated",(Gc=Fc||(Fc={})).KEY_INFO="key_info",Gc.SERVICE_STATUS="service_status",Gc.PROVIDER_UPDATE="provider_update",Gc.RPC_UPDATE="rpc_update",Gc.KEYS_EXCHANGED="keys_exchanged",Gc.JOIN_CHANNEL="join_channel",Gc.PUBLIC_KEY="public_key",Gc.CHANNEL_CREATED="channel_created",Gc.CLIENTS_CONNECTED="clients_connected",Gc.CLIENTS_DISCONNECTED="clients_disconnected",Gc.CLIENTS_WAITING="clients_waiting",Gc.CLIENTS_READY="clients_ready",Gc.REJECTED="rejected",Gc.WALLET_INIT="wallet_init",Gc.CHANNEL_PERSISTENCE="channel_persistence",Gc.CONFIG="config",Gc.MESSAGE_ACK="ack",Gc.SOCKET_DISCONNECTED="socket_disconnected",Gc.SOCKET_RECONNECT="socket_reconnect",Gc.OTP="otp",Gc.SDK_RPC_CALL="sdk_rpc_call",Gc.AUTHORIZED="authorized",Gc.CONNECTION_STATUS="connection_status",Gc.MESSAGE="message",Gc.TERMINATE="terminate",(Hc||(Hc={})).KEY_EXCHANGE="key_exchange",function(e){e.KEY_HANDSHAKE_START="key_handshake_start",e.KEY_HANDSHAKE_CHECK="key_handshake_check",e.KEY_HANDSHAKE_SYN="key_handshake_SYN",e.KEY_HANDSHAKE_SYNACK="key_handshake_SYNACK",e.KEY_HANDSHAKE_ACK="key_handshake_ACK",e.KEY_HANDSHAKE_WALLET="key_handshake_wallet",e.KEY_HANDSHAKE_NONE="none"}(qc||(qc={}));class Yc extends xt.exports.EventEmitter2{constructor({communicationLayer:e,otherPublicKey:t,context:n,ecies:r,logging:i}){super(),this.keysExchanged=!1,this.step=qc.KEY_HANDSHAKE_NONE,this.debug=!1,this.context=n,this.communicationLayer=e,(null==r?void 0:r.privateKey)&&t&&(kc.KeyExchange(`[KeyExchange: constructor()] otherPubKey=${t} set keysExchanged to true!`,r),this.keysExchanged=!0),this.myECIES=new Tc(Object.assign(Object.assign({},r),{debug:null==i?void 0:i.eciesLayer})),this.communicationLayer.state.eciesInstance=this.myECIES,this.myPublicKey=this.myECIES.getPublicKey(),this.debug=!0===(null==i?void 0:i.keyExchangeLayer),t&&this.setOtherPublicKey(t),this.communicationLayer.on(Hc.KEY_EXCHANGE,this.onKeyExchangeMessage.bind(this))}onKeyExchangeMessage(e){const{relayPersistence:t}=this.communicationLayer.remote.state;if(kc.KeyExchange(`[KeyExchange: onKeyExchangeMessage()] context=${this.context} keysExchanged=${this.keysExchanged} relayPersistence=${t}`,e),t)return void kc.KeyExchange("[KeyExchange: onKeyExchangeMessage()] Ignoring key exchange message because relay persistence is activated");const{message:n}=e;this.keysExchanged&&kc.KeyExchange(`[KeyExchange: onKeyExchangeMessage()] context=${this.context} received handshake while already exchanged. step=${this.step} otherPubKey=${this.otherPublicKey}`),this.emit(Fc.KEY_INFO,n.type),n.type===qc.KEY_HANDSHAKE_SYN?(this.checkStep([qc.KEY_HANDSHAKE_NONE,qc.KEY_HANDSHAKE_ACK]),kc.KeyExchange("[KeyExchange: onKeyExchangeMessage()] KEY_HANDSHAKE_SYN",n),n.pubkey&&this.setOtherPublicKey(n.pubkey),this.communicationLayer.sendMessage({type:qc.KEY_HANDSHAKE_SYNACK,pubkey:this.myPublicKey}).catch((e=>{kc.KeyExchange("[KeyExchange: onKeyExchangeMessage()] Error sending KEY_HANDSHAKE_SYNACK",e)})),this.setStep(qc.KEY_HANDSHAKE_ACK)):n.type===qc.KEY_HANDSHAKE_SYNACK?(this.checkStep([qc.KEY_HANDSHAKE_SYNACK,qc.KEY_HANDSHAKE_ACK,qc.KEY_HANDSHAKE_NONE]),kc.KeyExchange("[KeyExchange: onKeyExchangeMessage()] KEY_HANDSHAKE_SYNACK"),n.pubkey&&this.setOtherPublicKey(n.pubkey),this.communicationLayer.sendMessage({type:qc.KEY_HANDSHAKE_ACK}).catch((e=>{kc.KeyExchange("[KeyExchange: onKeyExchangeMessage()] Error sending KEY_HANDSHAKE_ACK",e)})),this.keysExchanged=!0,this.setStep(qc.KEY_HANDSHAKE_ACK),this.emit(Fc.KEYS_EXCHANGED)):n.type===qc.KEY_HANDSHAKE_ACK&&(kc.KeyExchange("[KeyExchange: onKeyExchangeMessage()] KEY_HANDSHAKE_ACK set keysExchanged to true!"),this.checkStep([qc.KEY_HANDSHAKE_ACK,qc.KEY_HANDSHAKE_NONE]),this.keysExchanged=!0,this.setStep(qc.KEY_HANDSHAKE_ACK),this.emit(Fc.KEYS_EXCHANGED))}resetKeys(e){this.clean(),this.myECIES=new Tc(e)}clean(){kc.KeyExchange(`[KeyExchange: clean()] context=${this.context} reset handshake state`),this.setStep(qc.KEY_HANDSHAKE_NONE),this.emit(Fc.KEY_INFO,this.step),this.keysExchanged=!1}start({isOriginator:e,force:t}){const{relayPersistence:n,protocolVersion:r}=this.communicationLayer.remote.state,i=r>=2;n?kc.KeyExchange("[KeyExchange: start()] Ignoring key exchange message because relay persistence is activated"):(kc.KeyExchange(`[KeyExchange: start()] context=${this.context} protocolVersion=${r} isOriginator=${e} step=${this.step} force=${t} relayPersistence=${n} keysExchanged=${this.keysExchanged}`),e?!(this.keysExchanged||this.step!==qc.KEY_HANDSHAKE_NONE&&this.step!==qc.KEY_HANDSHAKE_SYNACK)||t?(kc.KeyExchange(`[KeyExchange: start()] context=${this.context} -- start key exchange (force=${t}) -- step=${this.step}`,this.step),this.clean(),this.setStep(qc.KEY_HANDSHAKE_SYNACK),this.communicationLayer.sendMessage({type:qc.KEY_HANDSHAKE_SYN,pubkey:this.myPublicKey,v:2}).catch((e=>{kc.KeyExchange("[KeyExchange: start()] Error sending KEY_HANDSHAKE_SYN",e)}))):kc.KeyExchange(`[KeyExchange: start()] context=${this.context} -- key exchange already ${this.keysExchanged?"done":"in progress"} -- aborted.`,this.step):this.keysExchanged&&!0!==t?kc.KeyExchange("[KeyExchange: start()] don't send KEY_HANDSHAKE_START -- exchange already done."):i?this.communicationLayer.sendMessage({type:qc.KEY_HANDSHAKE_SYNACK,pubkey:this.myPublicKey,v:2}).catch((e=>{kc.KeyExchange("[KeyExchange: start()] Error sending KEY_HANDSHAKE_SYNACK",e)})):(this.communicationLayer.sendMessage({type:qc.KEY_HANDSHAKE_START}).catch((e=>{kc.KeyExchange("[KeyExchange: start()] Error sending KEY_HANDSHAKE_START",e)})),this.clean()))}setStep(e){this.step=e,this.emit(Fc.KEY_INFO,e)}checkStep(e){e.length>0&&e.indexOf(this.step.toString())}setRelayPersistence({localKey:e,otherKey:t}){this.otherPublicKey=t,this.myECIES=new Tc({privateKey:e,debug:this.debug}),this.keysExchanged=!0}setKeysExchanged(e){this.keysExchanged=e}areKeysExchanged(){return this.keysExchanged}getMyPublicKey(){return this.myPublicKey}getOtherPublicKey(){return this.otherPublicKey}setOtherPublicKey(e){kc.KeyExchange("[KeyExchange: setOtherPubKey()]",e),this.otherPublicKey=e}encryptMessage(e){if(!this.otherPublicKey)throw new Error("encryptMessage: Keys not exchanged - missing otherPubKey");return this.myECIES.encrypt(e,this.otherPublicKey)}decryptMessage(e){if(!this.otherPublicKey)throw new Error("decryptMessage: Keys not exchanged - missing otherPubKey");return this.myECIES.decrypt(e)}getKeyInfo(){return{ecies:Object.assign(Object.assign({},this.myECIES.getKeyInfo()),{otherPubKey:this.otherPublicKey}),step:this.step,keysExchanged:this.areKeysExchanged()}}toString(){const e={keyInfo:this.getKeyInfo(),keysExchanged:this.keysExchanged,step:this.step};return JSON.stringify(e)}}!function(e){e.TERMINATE="terminate",e.ANSWER="answer",e.OFFER="offer",e.CANDIDATE="candidate",e.JSONRPC="jsonrpc",e.WALLET_INFO="wallet_info",e.WALLET_INIT="wallet_init",e.ORIGINATOR_INFO="originator_info",e.PAUSE="pause",e.OTP="otp",e.AUTHORIZED="authorized",e.PING="ping",e.READY="ready"}(zc||(zc={})),function(e){e.REQUEST="sdk_connect_request_started",e.REQUEST_MOBILE="sdk_connect_request_started_mobile",e.RECONNECT="sdk_reconnect_request_started",e.CONNECTED="sdk_connection_established",e.CONNECTED_MOBILE="sdk_connection_established_mobile",e.AUTHORIZED="sdk_connection_authorized",e.REJECTED="sdk_connection_rejected",e.TERMINATED="sdk_connection_terminated",e.DISCONNECTED="sdk_disconnected",e.SDK_USE_EXTENSION="sdk_use_extension",e.SDK_RPC_REQUEST="sdk_rpc_request",e.SDK_RPC_REQUEST_RECEIVED="sdk_rpc_request_received",e.SDK_RPC_REQUEST_DONE="sdk_rpc_request_done",e.SDK_EXTENSION_UTILIZED="sdk_extension_utilized",e.SDK_USE_INAPP_BROWSER="sdk_use_inapp_browser"}(Wc||(Wc={}));const Jc=(e,t,n)=>xr(void 0,void 0,void 0,(function*(){var r,i,o,s,a,c;const{remote:l,state:u}=e,{channelId:d,isOriginator:h}=u;if("error_terminated"===t)return kc.SocketService(`handleJoinChannelResults: Channel ${d} terminated`),void e.emit(Fc.TERMINATE);if(!n)return void kc.SocketService(`handleJoinChannelResults: No result for channel ${d}`);const{persistence:f,walletKey:p,rejected:g}=n;if(kc.SocketService(`handleJoinChannelResults: Channel ${d} persistence=${f} walletKey=${p} rejected=${g}`),g)return kc.SocketService(`handleJoinChannelResults: Channel ${d} rejected`),yield e.remote.disconnect({terminate:!0}),e.remote.emit(Fc.REJECTED,{channelId:d}),void e.remote.emitServiceStatusEvent();if(p&&!(null===(r=l.state.channelConfig)||void 0===r?void 0:r.otherKey)){e.getKeyExchange().setOtherPublicKey(p),null===(i=e.state.keyExchange)||void 0===i||i.setKeysExchanged(!0),l.state.ready=!0,l.state.authorized=!0,l.emit(Fc.AUTHORIZED);const{communicationLayer:t,storageManager:n}=l.state,r=Object.assign(Object.assign({},l.state.channelConfig),{channelId:null!==(o=l.state.channelId)&&void 0!==o?o:"",validUntil:Date.now()+Lc,localKey:null==t?void 0:t.getKeyInfo().ecies.private,otherKey:p});e.sendMessage({type:qc.KEY_HANDSHAKE_ACK}).catch((e=>{})),null===(s=e.state.socket)||void 0===s||s.emit(zc.PING,{id:d,clientType:h?"dapp":"wallet",context:"on_channel_reconnect",message:""}),yield null==n?void 0:n.persistChannelConfig(r),l.emitServiceStatusEvent(),l.setConnectionStatus($c.LINKED)}f&&(e.emit(Fc.CHANNEL_PERSISTENCE),null===(a=e.state.keyExchange)||void 0===a||a.setKeysExchanged(!0),l.state.ready=!0,l.state.authorized=!0,l.emit(Fc.AUTHORIZED),Pc(Object.assign(Object.assign({id:null!=d?d:"",event:h?Wc.CONNECTED:Wc.CONNECTED_MOBILE},e.remote.state.originatorInfo),{sdkVersion:e.remote.state.sdkVersion,commLayer:e.state.communicationLayerPreference,commLayerVersion:Ic.version,walletVersion:null===(c=e.remote.state.walletInfo)||void 0===c?void 0:c.version}),u.communicationServerUrl).catch((e=>{})))})),Zc=e=>new Promise((t=>{setTimeout(t,e)})),Qc=(e,t,...n)=>xr(void 0,[e,t,...n],void 0,(function*(e,t,n=200){let r;const i=Date.now();let o=!1;for(;!o;){if(o=Date.now()-i>3e5,r=t[e],void 0!==r.elapsedTime)return r;yield Zc(n)}throw new Error(`RPC ${e} timed out`)})),Xc=e=>xr(void 0,void 0,void 0,(function*(){const{state:t}=e,{socket:n,channelId:r,context:i,isOriginator:o,isReconnecting:s}=t;if(s)return kc.SocketService("[SocketService: reconnectSocket()] Reconnection already in progress, skipping",e),!1;if(!n)return kc.SocketService("[SocketService: reconnectSocket()] socket is not defined",e),!1;if(!r)return!1;const{connected:a}=n;t.isReconnecting=!0,t.reconnectionAttempts=0,kc.SocketService(`[SocketService: reconnectSocket()] connected=${a} trying to reconnect after socketio disconnection`,e);try{for(;3>t.reconnectionAttempts;){if(kc.SocketService(`[SocketService: reconnectSocket()] Attempt ${t.reconnectionAttempts+1} of 3`,e),yield Zc(200),n.connected)return kc.SocketService("Socket already connected --- ping to retrieve messages"),n.emit(zc.PING,{id:r,clientType:o?"dapp":"wallet",context:"on_channel_config",message:""}),!0;t.resumed=!0,n.connect(),e.emit(Fc.SOCKET_RECONNECT);try{if(yield new Promise(((t,s)=>{n.emit(Fc.JOIN_CHANNEL,{channelId:r,context:`${i}connect_again`,clientType:o?"dapp":"wallet"},((n,r)=>xr(void 0,void 0,void 0,(function*(){try{yield Jc(e,n,r),t()}catch(e){s(e)}}))))})),yield Zc(100),n.connected)return kc.SocketService(`Reconnection successful on attempt ${t.reconnectionAttempts+1}`),!0}catch(e){kc.SocketService(`Error during reconnection attempt ${t.reconnectionAttempts+1}:`,e)}t.reconnectionAttempts+=1,3>t.reconnectionAttempts&&(yield Zc(200))}return kc.SocketService("Failed to reconnect after 3 attempts"),!1}finally{t.isReconnecting=!1,t.reconnectionAttempts=0}}));function el(e,t){return xr(this,void 0,void 0,(function*(){var n;const r=null===(n=e.state.keyExchange)||void 0===n?void 0:n.encryptMessage(JSON.stringify(t)),i={id:e.state.channelId,context:e.state.context,clientType:e.state.isOriginator?"dapp":"wallet",message:r,plaintext:e.state.hasPlaintext?JSON.stringify(t):void 0};return kc.SocketService(`[SocketService: encryptAndSendMessage()] context=${e.state.context}`,i),t.type===zc.TERMINATE&&(e.state.manualDisconnect=!0),new Promise(((t,n)=>{var r;null===(r=e.state.socket)||void 0===r||r.emit(Fc.MESSAGE,i,((e,r)=>{var i;e&&(kc.SocketService(`[SocketService: encryptAndSendMessage()] error=${e}`),n(e)),kc.SocketService("[encryptAndSendMessage] response",r),t(null!==(i=null==r?void 0:r.success)&&void 0!==i&&i)}))}))}))}var tl;!function(e){e.RPC_CHECK="rpcCheck",e.SKIPPED_RPC="skippedRpc"}(tl||(tl={}));const nl=["eth_sendTransaction","eth_signTypedData","eth_signTransaction","personal_sign","wallet_requestPermissions","wallet_switchEthereumChain","eth_signTypedData_v3","eth_signTypedData_v4","metamask_connectSign","metamask_connectWith","metamask_batch"].map((e=>e.toLowerCase())),rl=[{event:Fc.CLIENTS_CONNECTED,handler:function(e,t){return n=>xr(this,void 0,void 0,(function*(){var n,r,i,o,s,a,c,l,u,d,h;const f=null!==(r=null===(n=e.remote.state.channelConfig)||void 0===n?void 0:n.relayPersistence)&&void 0!==r&&r;if(kc.SocketService(`[SocketService: handleClientsConnected()] context=${e.state.context} on 'clients_connected-${t}' relayPersistence=${f} resumed=${e.state.resumed}  clientsPaused=${e.state.clientsPaused} keysExchanged=${null===(i=e.state.keyExchange)||void 0===i?void 0:i.areKeysExchanged()} isOriginator=${e.state.isOriginator}`),e.emit(Fc.CLIENTS_CONNECTED,{isOriginator:e.state.isOriginator,keysExchanged:null===(o=e.state.keyExchange)||void 0===o?void 0:o.areKeysExchanged(),context:e.state.context}),e.state.resumed)e.state.isOriginator||(kc.SocketService(`[SocketService: handleClientsConnected()] context=${e.state.context} 'clients_connected' / keysExchanged=${null===(s=e.state.keyExchange)||void 0===s?void 0:s.areKeysExchanged()} -- backward compatibility`),null===(a=e.state.keyExchange)||void 0===a||a.start({isOriginator:null!==(c=e.state.isOriginator)&&void 0!==c&&c})),e.state.resumed=!1;else if(e.state.clientsPaused)kc.SocketService("[SocketService: handleClientsConnected()] 'clients_connected' skip sending originatorInfo on pause");else if(!e.state.isOriginator){const t=!f;kc.SocketService(`[SocketService: handleClientsConnected()] context=${e.state.context} on 'clients_connected' / keysExchanged=${null===(l=e.state.keyExchange)||void 0===l?void 0:l.areKeysExchanged()} -- force=${t} -- backward compatibility`),kc.SocketService(`[SocketService: handleClientsConnected()] context=${e.state.context} on 'clients_connected' / keysExchanged=${null===(u=e.state.keyExchange)||void 0===u?void 0:u.areKeysExchanged()} -- force=${t} -- backward compatibility`),null===(d=e.state.keyExchange)||void 0===d||d.start({isOriginator:null!==(h=e.state.isOriginator)&&void 0!==h&&h,force:t})}e.state.clientsConnected=!0,e.state.clientsPaused=!1}))}},{event:Fc.CHANNEL_CREATED,handler:function(e,t){return n=>{kc.SocketService(`[SocketService: handleChannelCreated()] context=${e.state.context} on 'channel_created-${t}'`,n),e.emit(Fc.CHANNEL_CREATED,n)}}},{event:Fc.CLIENTS_DISCONNECTED,handler:function(e,t){return()=>{var n;e.state.clientsConnected=!1,kc.SocketService(`[SocketService: handlesClientsDisconnected()] context=${e.state.context} on 'clients_disconnected-${t}'`),e.remote.state.relayPersistence?kc.SocketService(`[SocketService: handlesClientsDisconnected()] context=${e.state.context} on 'clients_disconnected-${t}' - relayPersistence enabled, skipping key exchange cleanup.`):(e.state.isOriginator&&!e.state.clientsPaused&&(null===(n=e.state.keyExchange)||void 0===n||n.clean()),e.emit(Fc.CLIENTS_DISCONNECTED,t))}}},{event:Fc.CONFIG,handler:function(e,t){return n=>xr(this,void 0,void 0,(function*(){var r,i,o;kc.SocketService(`[SocketService: handleChannelConfig()] update relayPersistence on 'config-${t}'`,n);const{persistence:s,walletKey:a}=n;e.state.isOriginator&&e.remote.state.channelConfig?(n.walletKey&&!e.remote.state.channelConfig.otherKey&&(kc.SocketService(`Setting wallet key ${a}`),e.remote.state.channelConfig.otherKey=a,e.getKeyExchange().setOtherPublicKey(n.walletKey),null===(r=e.state.keyExchange)||void 0===r||r.setKeysExchanged(!0),yield e.remote.sendMessage({type:qc.KEY_HANDSHAKE_ACK}),yield e.remote.sendMessage({type:zc.PING}),yield null===(i=e.remote.state.storageManager)||void 0===i?void 0:i.persistChannelConfig(e.remote.state.channelConfig)),!0!==s||e.remote.state.channelConfig.relayPersistence||(kc.SocketService(`Setting relay persistence ${s}`),e.remote.state.channelConfig.relayPersistence=s,e.remote.state.relayPersistence=!0,e.remote.emit(Fc.CHANNEL_PERSISTENCE),e.remote.state.authorized=!0,e.remote.state.ready=!0,e.remote.emit(Fc.AUTHORIZED),yield null===(o=e.remote.state.storageManager)||void 0===o?void 0:o.persistChannelConfig(e.remote.state.channelConfig))):e.state.isOriginator||n.persistence&&(e.remote.state.relayPersistence=!0,e.remote.emit(Fc.CHANNEL_PERSISTENCE))}))}},{event:Fc.MESSAGE,handler:function(e,t){return n=>{var r,i,o,s,a,c,l,u,d,h,f,p,g,m,y,v,b,w;const{ackId:E,message:S,error:_}=n,C=null!==(r=e.remote.state.relayPersistence)&&void 0!==r&&r;if(kc.SocketService(`[SocketService handleMessage()]  relayPersistence=${C}  context=${e.state.context} on 'message' ${t} keysExchanged=${null===(i=e.state.keyExchange)||void 0===i?void 0:i.areKeysExchanged()}`,n),_)throw kc.SocketService(`\n      [SocketService handleMessage()] context=${e.state.context}::on 'message' error=${_}`),new Error(_);const A="string"==typeof S;if(!A&&(null==S?void 0:S.type)===qc.KEY_HANDSHAKE_START){if(C)return;return kc.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' received HANDSHAKE_START isOriginator=${e.state.isOriginator}`,S),void(null===(o=e.state.keyExchange)||void 0===o||o.start({isOriginator:null!==(s=e.state.isOriginator)&&void 0!==s&&s,force:!0}))}if(!A&&(null===(a=null==S?void 0:S.type)||void 0===a?void 0:a.startsWith("key_handshake"))){if(C)return;return kc.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' emit KEY_EXCHANGE`,S),void e.emit(Hc.KEY_EXCHANGE,{message:S,context:e.state.context})}if(A&&!(null===(c=e.state.keyExchange)||void 0===c?void 0:c.areKeysExchanged())){let t=!1;try{kc.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' trying to decrypt message`),null===(l=e.state.keyExchange)||void 0===l||l.decryptMessage(S),t=!0}catch(t){kc.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' error`,t)}if(!t)return e.state.isOriginator?null===(d=e.state.keyExchange)||void 0===d||d.start({isOriginator:null!==(h=e.state.isOriginator)&&void 0!==h&&h}):e.sendMessage({type:qc.KEY_HANDSHAKE_START}).catch((e=>{})),void kc.SocketService(`Message ignored because invalid key exchange status. step=${null===(f=e.state.keyExchange)||void 0===f?void 0:f.getKeyInfo().step}`,null===(p=e.state.keyExchange)||void 0===p?void 0:p.getKeyInfo(),S);kc.SocketService("Invalid key exchange status detected --- updating it."),null===(u=e.state.keyExchange)||void 0===u||u.setKeysExchanged(!0)}else if(!A&&(null==S?void 0:S.type))return void e.emit(Fc.MESSAGE,S);if(!A)return void e.emit(Fc.MESSAGE,S);const k=null===(g=e.state.keyExchange)||void 0===g?void 0:g.decryptMessage(S),M=JSON.parse(null!=k?k:"{}");if(E&&(null==E?void 0:E.length)>0&&(kc.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' ackid=${E} channelId=${t}`),null===(m=e.state.socket)||void 0===m||m.emit(Fc.MESSAGE_ACK,{ackId:E,channelId:t,clientType:e.state.isOriginator?"dapp":"wallet"})),e.state.clientsPaused=(null==M?void 0:M.type)===zc.PAUSE,e.state.isOriginator&&M.data){const t=M.data,n=e.state.rpcMethodTracker[t.id];if(n){const r=Date.now()-n.timestamp;kc.SocketService(`[SocketService handleMessage()] context=${e.state.context}::on 'message' received answer for id=${t.id} method=${n.method} responseTime=${r}`,M),e.remote.state.analytics&&nl.includes(n.method.toLowerCase())&&Pc(Object.assign(Object.assign({id:null!==(y=e.remote.state.channelId)&&void 0!==y?y:"",event:Wc.SDK_RPC_REQUEST_DONE,sdkVersion:e.remote.state.sdkVersion,commLayerVersion:Ic.version},e.remote.state.originatorInfo),{walletVersion:null===(v=e.remote.state.walletInfo)||void 0===v?void 0:v.version,params:{method:n.method,from:"mobile"}}),e.remote.state.communicationServerUrl).catch((e=>{})),jc(n.method)&&_t.analytics.track(t.error?4001===t.error.code?"sdk_action_rejected":"sdk_action_failed":"sdk_action_succeeded",{action:n.method});const i=Object.assign(Object.assign({},n),{result:t.result,error:t.error?{code:null===(b=t.error)||void 0===b?void 0:b.code,message:null===(w=t.error)||void 0===w?void 0:w.message}:void 0,elapsedTime:r});e.state.rpcMethodTracker[t.id]=i,e.emit(Fc.RPC_UPDATE,i)}}e.emit(Fc.MESSAGE,{message:M})}}},{event:Fc.REJECTED,handler:function(e,t){return n=>xr(this,void 0,void 0,(function*(){var n;e.state.isOriginator&&!e.remote.state.ready?(kc.SocketService(`[SocketService: handleChannelRejected()] context=${e.state.context} channelId=${t} isOriginator=${e.state.isOriginator} ready=${e.remote.state.ready}`,e.remote.state.originatorInfo),Pc(Object.assign(Object.assign({id:t,event:Wc.REJECTED},e.remote.state.originatorInfo),{sdkVersion:e.remote.state.sdkVersion,commLayer:e.state.communicationLayerPreference,commLayerVersion:Ic.version,walletVersion:null===(n=e.remote.state.walletInfo)||void 0===n?void 0:n.version}),e.remote.state.communicationServerUrl).catch((e=>{})),_t.analytics.track("sdk_connection_rejected",{transport_type:"websocket"}),yield e.remote.disconnect({terminate:!0}),e.remote.emit(Fc.REJECTED,{channelId:t}),e.remote.setConnectionStatus($c.DISCONNECTED)):kc.SocketService(`[SocketService: handleChannelRejected()] SKIP -- channelId=${t} isOriginator=${e.state.isOriginator} ready=${e.remote.state.ready}`)}))}},{event:"clients_waiting_to_join",handler:function(e,t){return n=>{kc.SocketService(`[SocketService: handleClientsWaitingToJoin()] context=${e.state.context} on 'clients_waiting_to_join-${t}'`,n),e.emit(Fc.CLIENTS_WAITING,n)}}}],il=[{event:Fc.KEY_INFO,handler:function(e){return t=>{kc.SocketService("[SocketService: handleKeyInfo()] on 'KEY_INFO'",t),e.emit(Fc.KEY_INFO,t)}}},{event:Fc.KEYS_EXCHANGED,handler:function(e){return()=>{var t,n,r;kc.SocketService(`[SocketService: handleKeysExchanged()] on 'keys_exchanged' keyschanged=${null===(t=e.state.keyExchange)||void 0===t?void 0:t.areKeysExchanged()}`);const{channelConfig:i}=e.remote.state;if(i){const t=e.getKeyExchange().getKeyInfo().ecies;i.localKey=t.private,i.otherKey=t.otherPubKey,e.remote.state.channelConfig=i,null===(n=e.remote.state.storageManager)||void 0===n||n.persistChannelConfig(i).catch((e=>{}))}e.emit(Fc.KEYS_EXCHANGED,{keysExchanged:null===(r=e.state.keyExchange)||void 0===r?void 0:r.areKeysExchanged(),isOriginator:e.state.isOriginator});const o={keyInfo:e.getKeyInfo()};e.emit(Fc.SERVICE_STATUS,o)}}}];function ol(e,t){kc.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} setting socket listeners for channel ${t}...`);const{socket:n}=e.state,{keyExchange:r}=e.state;n&&e.state.isOriginator&&(e.state.debug&&(null==n||n.io.on("error",(t=>{kc.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=error`,t)})),null==n||n.io.on("reconnect",(t=>{kc.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=reconnect`,t),Xc(e).catch((e=>{}))})),null==n||n.io.on("reconnect_error",(t=>{kc.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=reconnect_error`,t)})),null==n||n.io.on("reconnect_failed",(()=>{kc.SocketService(`[SocketService: setupChannelListener()] context=${e.state.context} socket event=reconnect_failed`)}))),null==n||n.on("disconnect",(t=>(kc.SocketService(`[SocketService: setupChannelListener()] on 'disconnect' -- MetaMaskSDK socket disconnected '${t}' begin recovery...`),function(e){return t=>{kc.SocketService(`[SocketService: handleDisconnect()] on 'disconnect' manualDisconnect=${e.state.manualDisconnect}`,t),e.state.manualDisconnect||(e.emit(Fc.SOCKET_DISCONNECTED),Xc(e).catch((e=>{})))}}(e)(t))))),rl.forEach((({event:r,handler:i})=>{null==n||n.on(`${r}-${t}`,i(e,t))})),il.forEach((({event:t,handler:n})=>{null==r||r.on(t,n(e))})),e.state.setupChannelListeners=!0}class sl extends xt.exports.EventEmitter2{constructor(e){super(),this.state={clientsConnected:!1,clientsPaused:!1,manualDisconnect:!1,lastRpcId:void 0,rpcMethodTracker:{},hasPlaintext:!1,communicationServerUrl:"",focusListenerAdded:!1,removeFocusListener:void 0,isReconnecting:!1,reconnectionAttempts:0},this.options=e;const{reconnect:t,communicationLayerPreference:n,communicationServerUrl:r,context:i,remote:o,logging:s}=e;this.state.resumed=t,this.state.context=i,this.state.isOriginator=o.state.isOriginator,this.state.communicationLayerPreference=n,this.state.debug=!0===(null==s?void 0:s.serviceLayer),this.remote=o,!0===(null==s?void 0:s.serviceLayer)&&He.enable("SocketService:Layer"),this.state.communicationServerUrl=r,this.state.hasPlaintext=this.state.communicationServerUrl!==Oc&&!0===(null==s?void 0:s.plaintext),kc.SocketService(`[SocketService: constructor()] Socket IO url: ${this.state.communicationServerUrl}`),this.initSocket()}initSocket(){var e;const{otherPublicKey:t,ecies:n,logging:r}=this.options,i={autoConnect:!1,transports:Nc,withCredentials:!0},o=this.state.communicationServerUrl;kc.SocketService(`[SocketService: initSocket()] Socket IO url: ${o}`),this.state.socket=Rr(o,i),function(e){if("undefined"!=typeof window&&"undefined"!=typeof document&&(kc.SocketService(`[SocketService: setupSocketFocusListener()] hasFocus=${document.hasFocus()}`,e),!e.state.focusListenerAdded)){const t=()=>{kc.SocketService("Document has focus --- reconnecting socket"),Xc(e).catch((e=>{}))};window.addEventListener("focus",t),e.state.focusListenerAdded=!0,e.state.removeFocusListener=()=>{window.removeEventListener("focus",t),e.state.focusListenerAdded=!1}}}(this);const s={communicationLayer:this,otherPublicKey:t,sendPublicKey:!1,context:null!==(e=this.state.context)&&void 0!==e?e:"",ecies:n,logging:r};this.state.keyExchange=new Yc(s)}resetKeys(){return kc.SocketService("[SocketService: resetKeys()] Resetting keys."),void(null===(e=this.state.keyExchange)||void 0===e||e.resetKeys());var e}createChannel(){return xr(this,void 0,void 0,(function*(){return function(e){return xr(this,void 0,void 0,(function*(){var t,n,r;if(kc.SocketService(`[SocketService: createChannel()] context=${e.state.context}`),e.state.socket||e.initSocket(),null===(t=e.state.socket)||void 0===t?void 0:t.connected)throw new Error("socket already connected");null===(n=e.state.socket)||void 0===n||n.connect(),e.state.manualDisconnect=!1,e.state.isOriginator=!0;const i=Vt();e.state.channelId=i,ol(e,i),yield new Promise(((t,n)=>{var r;null===(r=e.state.socket)||void 0===r||r.emit(Fc.JOIN_CHANNEL,{channelId:i,context:`${e.state.context}createChannel`,clientType:"dapp"},((r,i)=>xr(this,void 0,void 0,(function*(){try{yield Jc(e,r,i),t()}catch(e){n(e)}}))))}));const o=null===(r=e.state.keyExchange)||void 0===r?void 0:r.getKeyInfo();return{channelId:i,pubKey:(null==o?void 0:o.ecies.public)||"",privKey:(null==o?void 0:o.ecies.private)||""}}))}(this)}))}connectToChannel({channelId:e,withKeyExchange:t=!1,authorized:n}){return function(e){return xr(this,arguments,void 0,(function*({options:e,instance:t}){const{channelId:n,authorized:r,withKeyExchange:i}=e,{state:o,remote:s}=t,{isOriginator:a=!1,socket:c,keyExchange:l}=o,{channelConfig:u}=s.state;if(null==c?void 0:c.connected)throw new Error("socket already connected");if(a&&(null==u?void 0:u.relayPersistence)){const{localKey:e,otherKey:t}=u;e&&t&&(null==l||l.setRelayPersistence({localKey:e,otherKey:t}))}return Object.assign(o,{manualDisconnect:!1,withKeyExchange:i,isOriginator:a,channelId:n}),null==c||c.connect(),ol(t,n),!a&&r&&(null==l||l.setKeysExchanged(!0),Object.assign(s.state,{ready:!0,authorized:!0})),new Promise((e=>{var i;const s=null===(i=null==l?void 0:l.getKeyInfo())||void 0===i?void 0:i.ecies.public;null==c||c.emit(Fc.JOIN_CHANNEL,{channelId:n,context:`${o.context}_connectToChannel`,clientType:a?"dapp":"wallet",publicKey:r&&!a?s:void 0},((n,r)=>xr(this,void 0,void 0,(function*(){yield Jc(t,n,r),e()}))))}))}))}({options:{channelId:e,withKeyExchange:t,authorized:n},instance:this})}getKeyInfo(){return this.state.keyExchange.getKeyInfo()}keyCheck(){var e,t;null===(t=(e=this).state.socket)||void 0===t||t.emit(Fc.MESSAGE,{id:e.state.channelId,context:e.state.context,message:{type:qc.KEY_HANDSHAKE_CHECK,pubkey:e.getKeyInfo().ecies.otherPubKey}})}getKeyExchange(){return this.state.keyExchange}sendMessage(e){return xr(this,void 0,void 0,(function*(){return function(e,t){return xr(this,void 0,void 0,(function*(){var n,r,i;if(!e.state.channelId)throw kc.SocketService("handleSendMessage: no channelId - Create a channel first"),new Error("Create a channel first");if(kc.SocketService(`[SocketService: handleSendMessage()] context=${e.state.context} areKeysExchanged=${null===(n=e.state.keyExchange)||void 0===n?void 0:n.areKeysExchanged()}`,t),null===(r=null==t?void 0:t.type)||void 0===r?void 0:r.startsWith("key_handshake"))return function(e,t){var n;kc.SocketService(`[SocketService: handleKeyHandshake()] context=${e.state.context}`,t),null===(n=e.state.socket)||void 0===n||n.emit(Fc.MESSAGE,{id:e.state.channelId,context:e.state.context,clientType:e.state.isOriginator?"dapp":"wallet",message:t})}(e,t),!0;!function(e,t){var n;if(!(null===(n=e.state.keyExchange)||void 0===n?void 0:n.areKeysExchanged())&&!e.remote.state.relayPersistence)throw kc.SocketService(`[SocketService: validateKeyExchange()] context=${e.state.context} ERROR keys not exchanged`,t),new Error("Keys not exchanged BBB")}(e,t),function(e,t){var n;const r=null!==(n=null==t?void 0:t.method)&&void 0!==n?n:"",i=null==t?void 0:t.id;e.state.isOriginator&&i&&(e.state.rpcMethodTracker[i]={id:i,timestamp:Date.now(),method:r},e.emit(Fc.RPC_UPDATE,e.state.rpcMethodTracker[i]))}(e,t);const o=yield el(e,t);return e.remote.state.analytics&&e.remote.state.isOriginator&&t.method&&nl.includes(t.method.toLowerCase())&&Pc({id:null!==(i=e.remote.state.channelId)&&void 0!==i?i:"",event:Wc.SDK_RPC_REQUEST,params:{method:t.method,from:"mobile"}},e.remote.state.communicationServerUrl).catch((e=>{})),e.remote.state.isOriginator&&t.method&&jc(t.method)&&_t.analytics.track("sdk_action_requested",{action:t.method}),function(e,t){return xr(this,void 0,void 0,(function*(){var n;const r=null==t?void 0:t.id,i=null!==(n=null==t?void 0:t.method)&&void 0!==n?n:"";if(e.state.isOriginator&&r)try{const n=Qc(r,e.state.rpcMethodTracker,200).then((e=>({type:tl.RPC_CHECK,result:e}))),o=(()=>xr(this,void 0,void 0,(function*(){const t=yield(e=>xr(void 0,[e],void 0,(function*({rpcId:e,instance:t}){for(;t.state.lastRpcId===e||void 0===t.state.lastRpcId;)yield Zc(200);return t.state.lastRpcId})))({instance:e,rpcId:r}),n=yield Qc(t,e.state.rpcMethodTracker,200);return{type:tl.SKIPPED_RPC,result:n}})))(),s=yield Promise.race([n,o]);if(s.type===tl.RPC_CHECK){const e=s.result;kc.SocketService(`[SocketService:handleRpcReplies()] id=${t.id} ${i} ( ${e.elapsedTime} ms)`,e.result)}else{if(s.type!==tl.SKIPPED_RPC)throw new Error(`Error handling RPC replies for ${r}`);{const t=Object.assign(Object.assign({},e.state.rpcMethodTracker[r]),{error:new Error("SDK_CONNECTION_ISSUE")});e.emit(Fc.RPC_UPDATE,t);const n={data:Object.assign(Object.assign({},t),{jsonrpc:"2.0"}),name:"metamask-provider"};e.emit(Fc.MESSAGE,{message:n})}}}catch(e){throw e}}))}(e,t).catch((e=>{})),o}))}(this,e)}))}ping(){return function(e){return xr(this,void 0,void 0,(function*(){var t,n;kc.SocketService(`[SocketService: ping()] context=${e.state.context} originator=${e.state.isOriginator} keysExchanged=${null===(t=e.state.keyExchange)||void 0===t?void 0:t.areKeysExchanged()}`),null===(n=e.state.socket)||void 0===n||n.emit(zc.PING,{id:e.state.channelId,context:"ping",clientType:e.remote.state.isOriginator?"dapp":"wallet",message:""})}))}(this)}pause(){return function(e){return xr(this,void 0,void 0,(function*(){var t,n;kc.SocketService(`[SocketService: pause()] context=${e.state.context}`),e.state.manualDisconnect=!0,(null===(t=e.state.keyExchange)||void 0===t?void 0:t.areKeysExchanged())&&(yield e.sendMessage({type:zc.PAUSE})),null===(n=e.state.socket)||void 0===n||n.disconnect()}))}(this)}isConnected(){var e;return null===(e=this.state.socket)||void 0===e?void 0:e.connected}resume(){return function(e){return xr(this,void 0,void 0,(function*(){const{state:t,remote:n}=e,{socket:r,channelId:i,context:o,keyExchange:s,isOriginator:a}=t,{isOriginator:c}=n.state;if(kc.SocketService(`[SocketService: resume()] channelId=${i} context=${o} connected=${null==r?void 0:r.connected} manualDisconnect=${t.manualDisconnect} resumed=${t.resumed} keysExchanged=${null==s?void 0:s.areKeysExchanged()}`),!i)throw kc.SocketService("[SocketService: resume()] channelId is not defined"),new Error("ChannelId is not defined");(null==r?void 0:r.connected)?(kc.SocketService("[SocketService: resume()] already connected."),r.emit(zc.PING,{id:i,clientType:c?"dapp":"wallet",context:"on_channel_config",message:""}),n.hasRelayPersistence()||(null==s?void 0:s.areKeysExchanged())||(a?yield e.sendMessage({type:zc.READY}):null==s||s.start({isOriginator:!1}))):(null==r||r.connect(),kc.SocketService(`[SocketService: resume()] after connecting socket --\x3e connected=${null==r?void 0:r.connected}`),null==r||r.emit(Fc.JOIN_CHANNEL,{channelId:i,context:`${o}_resume`,clientType:c?"dapp":"wallet"},((t,n)=>xr(this,void 0,void 0,(function*(){try{yield Jc(e,t,n)}catch(e){}}))))),t.manualDisconnect=!1,t.resumed=!0}))}(this)}getRPCMethodTracker(){return this.state.rpcMethodTracker}disconnect(e){return function(e,t){var n,r,i,o,s;kc.SocketService(`[SocketService: disconnect()] context=${e.state.context}`,t),(null==t?void 0:t.terminate)&&(null===(r=(n=e.state).removeFocusListener)||void 0===r||r.call(n),e.state.channelId=t.channelId,null===(i=e.state.socket)||void 0===i||i.removeAllListeners(),null===(o=e.state.keyExchange)||void 0===o||o.clean(),e.remote.state.ready=!1,e.state.socket=void 0,e.state.rpcMethodTracker={}),e.state.manualDisconnect=!0,null===(s=e.state.socket)||void 0===s||s.disconnect()}(this,e)}}var al,cl,ll;function ul(e){return()=>xr(this,void 0,void 0,(function*(){var t,n,r;const{state:i}=e;if(i.authorized)return;yield(()=>xr(this,void 0,void 0,(function*(){for(;!i.walletInfo;)yield Zc(500)})))();const o="7.3".localeCompare((null===(t=i.walletInfo)||void 0===t?void 0:t.version)||"");if(kc.RemoteCommunication(`[RemoteCommunication: handleAuthorizedEvent()] HACK 'authorized' version=${null===(n=i.walletInfo)||void 0===n?void 0:n.version} compareValue=${o}`),1!==o)return;const s=i.platformType===cl.MobileWeb||i.platformType===cl.ReactNative||i.platformType===cl.MetaMaskMobileWebview;kc.RemoteCommunication(`[RemoteCommunication: handleAuthorizedEvent()] HACK 'authorized' platform=${i.platformType} secure=${s} channel=${i.channelId} walletVersion=${null===(r=i.walletInfo)||void 0===r?void 0:r.version}`),s&&(i.authorized=!0,e.emit(Fc.AUTHORIZED))}))}function dl(e){return t=>{const{state:n}=e;kc.RemoteCommunication(`[RemoteCommunication: handleChannelCreatedEvent()] context=${n.context} on 'channel_created' channelId=${t}`),e.emit(Fc.CHANNEL_CREATED,t)}}function hl(e,t){return()=>{var n,r,i,o;const{state:s}=e;kc.RemoteCommunication(`[RemoteCommunication: handleClientsConnectedEvent()] on 'clients_connected' channel=${s.channelId} keysExchanged=${null===(r=null===(n=s.communicationLayer)||void 0===n?void 0:n.getKeyInfo())||void 0===r?void 0:r.keysExchanged}`),s.analytics&&Pc(Object.assign(Object.assign({id:null!==(i=s.channelId)&&void 0!==i?i:"",event:s.reconnection?Wc.RECONNECT:s.isOriginator?Wc.REQUEST:Wc.REQUEST_MOBILE},s.originatorInfo),{commLayer:t,sdkVersion:s.sdkVersion,walletVersion:null===(o=s.walletInfo)||void 0===o?void 0:o.version,commLayerVersion:Ic.version}),s.communicationServerUrl).catch((e=>{})),s.isOriginator&&!s.reconnection&&_t.analytics.track("sdk_connection_established",{transport_type:"websocket"}),s.clientsConnected=!0,s.originatorInfoSent=!1,e.emit(Fc.CLIENTS_CONNECTED)}}function fl(e){return t=>{const{state:n}=e;kc.RemoteCommunication(`[RemoteCommunication: handleClientsDisconnectedEvent()] context=${n.context} on 'clients_disconnected' channelId=${t}`),n.relayPersistence||(n.clientsConnected=!1,n.ready=!1,n.authorized=!1),e.emit(Fc.CLIENTS_DISCONNECTED,n.channelId),e.setConnectionStatus($c.DISCONNECTED)}}function pl(e){return t=>{var n;const{state:r}=e;if(kc.RemoteCommunication(`[RemoteCommunication: handleClientsWaitingEvent()] context=${r.context} on 'clients_waiting' numberUsers=${t} ready=${r.ready} autoStarted=${r.originatorConnectStarted}`),e.setConnectionStatus($c.WAITING),e.emit(Fc.CLIENTS_WAITING,t),r.originatorConnectStarted){kc.RemoteCommunication(`[RemoteCommunication: handleClientsWaitingEvent()] on 'clients_waiting' watch autoStarted=${r.originatorConnectStarted} timeout`,r.autoConnectOptions);const t=(null===(n=r.autoConnectOptions)||void 0===n?void 0:n.timeout)||3e3,i=setTimeout((()=>{kc.RemoteCommunication(`[RemoteCommunication: handleClientsWaitingEvent()] setTimeout(${t}) terminate channelConfig`,r.autoConnectOptions),r.originatorConnectStarted=!1,r.ready||e.setConnectionStatus($c.TIMEOUT),clearTimeout(i)}),t)}}}function gl(e,t){return n=>{var r,i,o,s,a,c,l,u;const{state:d}=e;if(kc.RemoteCommunication(`[RemoteCommunication: handleKeysExchangedEvent()] context=${d.context} on commLayer.'keys_exchanged' channel=${d.channelId}`,n),null===(i=null===(r=d.communicationLayer)||void 0===r?void 0:r.getKeyInfo())||void 0===i?void 0:i.keysExchanged){const t=Object.assign(Object.assign({},d.channelConfig),{channelId:null!==(o=d.channelId)&&void 0!==o?o:"",validUntil:(null===(s=d.channelConfig)||void 0===s?void 0:s.validUntil)||Lc,localKey:d.communicationLayer.getKeyInfo().ecies.private,otherKey:d.communicationLayer.getKeyInfo().ecies.otherPubKey});null===(a=d.storageManager)||void 0===a||a.persistChannelConfig(t).catch((e=>{})),e.setConnectionStatus($c.LINKED)}!function(e,t){var n,r,i,o,s,a,c,l;const{state:u}=e;kc.RemoteCommunication(`[RemoteCommunication: setLastActiveDate()] channel=${u.channelId}`,t);const d=Object.assign(Object.assign({},u.channelConfig),{channelId:null!==(n=u.channelId)&&void 0!==n?n:"",validUntil:null!==(i=null===(r=u.channelConfig)||void 0===r?void 0:r.validUntil)&&void 0!==i?i:0,relayPersistence:u.relayPersistence,localKey:null===(s=null===(o=u.communicationLayer)||void 0===o?void 0:o.state.keyExchange)||void 0===s?void 0:s.getKeyInfo().ecies.private,otherKey:null===(c=null===(a=u.communicationLayer)||void 0===a?void 0:a.state.keyExchange)||void 0===c?void 0:c.getKeyInfo().ecies.otherPubKey,lastActive:t.getTime()});null===(l=u.storageManager)||void 0===l||l.persistChannelConfig(d)}(e,new Date),d.analytics&&d.channelId&&Pc(Object.assign(Object.assign({id:d.channelId,event:n.isOriginator?Wc.CONNECTED:Wc.CONNECTED_MOBILE},d.originatorInfo),{sdkVersion:d.sdkVersion,commLayer:t,commLayerVersion:Ic.version,walletVersion:null===(c=d.walletInfo)||void 0===c?void 0:c.version}),d.communicationServerUrl).catch((e=>{})),d.isOriginator=n.isOriginator,n.isOriginator||(null===(l=d.communicationLayer)||void 0===l||l.sendMessage({type:zc.READY}),d.ready=!0,d.paused=!1),n.isOriginator&&!d.originatorInfoSent&&(null===(u=d.communicationLayer)||void 0===u||u.sendMessage({type:zc.ORIGINATOR_INFO,originatorInfo:d.originatorInfo,originator:d.originatorInfo}),d.originatorInfoSent=!0)}}function ml(e){return t=>{let n=t;t.message&&(n=n.message),function(e,t){const{state:n}=t;if(kc.RemoteCommunication(`[RemoteCommunication: onCommunicationLayerMessage()] context=${n.context} on 'message' typeof=${typeof e}`,e),t.state.ready=!0,n.isOriginator||e.type!==zc.ORIGINATOR_INFO)if(n.isOriginator&&e.type===zc.WALLET_INFO)!function(e,t){const{state:n}=e;n.walletInfo=t.walletInfo,n.paused=!1}(t,e);else{if(n.isOriginator&&e.type===zc.WALLET_INIT)(function(e,t){return xr(this,void 0,void 0,(function*(){var n,r,i;const{state:o}=e;if(o.isOriginator){const o=t.data||{};if("object"==typeof o&&"accounts"in o&&"chainId"in o&&"walletKey"in o)try{const{channelConfig:t}=e.state;if(kc.RemoteCommunication("WALLET_INIT: channelConfig",JSON.stringify(t,null,2)),t){const s=o.accounts,a=o.chainId,c=o.walletKey;let l,u=!1;"deeplinkProtocol"in o&&(u=Boolean(o.deeplinkProtocol),e.state.deeplinkProtocolAvailable=u),"walletVersion"in o&&(l=o.walletVersion),yield null===(n=e.state.storageManager)||void 0===n?void 0:n.persistChannelConfig(Object.assign(Object.assign({},t),{otherKey:c,walletVersion:l,deeplinkProtocolAvailable:u,relayPersistence:!0})),yield null===(r=e.state.storageManager)||void 0===r?void 0:r.persistAccounts(s),yield null===(i=e.state.storageManager)||void 0===i?void 0:i.persistChainId(a)}e.emit(Fc.WALLET_INIT,{accounts:o.accounts,chainId:o.chainId})}catch(n){}}}))})(t,e).catch((e=>{kc.RemoteCommunication(`[RemoteCommunication: onCommunicationLayerMessage()] error=${e}`)}));else if(e.type===zc.TERMINATE)(function(e){return xr(this,void 0,void 0,(function*(){const{state:t}=e;t.isOriginator&&(yield El({options:{terminate:!0,sendMessage:!1},instance:e}),e.emit(Fc.TERMINATE))}))})(t).catch((e=>{kc.RemoteCommunication(`[RemoteCommunication: onCommunicationLayerMessage()] error=${e}`)}));else if(e.type===zc.PAUSE)!function(e){const{state:t}=e;t.paused=!0,e.setConnectionStatus($c.PAUSED)}(t);else if(e.type===zc.READY&&n.isOriginator)!function(e){const{state:t}=e;e.setConnectionStatus($c.LINKED);const n=t.paused;t.paused=!1,e.emit(Fc.CLIENTS_READY,{isOriginator:t.isOriginator,walletInfo:t.walletInfo}),n&&(t.authorized=!0,e.emit(Fc.AUTHORIZED))}(t);else{if(e.type===zc.OTP&&n.isOriginator)return void function(e,t){var n;const{state:r}=e;e.emit(Fc.OTP,t.otpAnswer),1==="6.6".localeCompare((null===(n=r.walletInfo)||void 0===n?void 0:n.version)||"")&&e.emit(Fc.SDK_RPC_CALL,{method:Dc.ETH_REQUESTACCOUNTS,params:[]})}(t,e);e.type===zc.AUTHORIZED&&n.isOriginator&&function(e){const{state:t}=e;t.authorized=!0,e.emit(Fc.AUTHORIZED)}(t)}t.emit(Fc.MESSAGE,e)}else!function(e,t){var n;const{state:r}=e;null===(n=r.communicationLayer)||void 0===n||n.sendMessage({type:zc.WALLET_INFO,walletInfo:r.walletInfo}),r.originatorInfo=t.originatorInfo||t.originator,e.emit(Fc.CLIENTS_READY,{isOriginator:r.isOriginator,originatorInfo:r.originatorInfo}),r.paused=!1}(t,e)}(n,e)}}function yl(e){return()=>{const{state:t}=e;kc.RemoteCommunication("[RemoteCommunication: handleSocketReconnectEvent()] on 'socket_reconnect' -- reset key exchange status / set ready to false"),t.ready=!1,t.authorized=!1,Uc(t),e.emitServiceStatusEvent({context:"socket_reconnect"})}}function vl(e){return()=>{const{state:t}=e;kc.RemoteCommunication("[RemoteCommunication: handleSocketDisconnectedEvent()] on 'socket_Disconnected' set ready to false"),t.ready=!1}}function bl(e){return()=>xr(this,void 0,void 0,(function*(){var t,n,r,i,o,s,a;const{state:c}=e;kc.RemoteCommunication(`[RemoteCommunication: handleFullPersistenceEvent()] context=${c.context}`),e.state.ready=!0,e.state.clientsConnected=!0,e.state.authorized=!0,e.state.relayPersistence=!0,null===(t=e.state.communicationLayer)||void 0===t||t.getKeyExchange().setKeysExchanged(!0),e.emit(Fc.KEYS_EXCHANGED,{keysExchanged:!0,isOriginator:!0}),e.emit(Fc.AUTHORIZED),e.emit(Fc.CLIENTS_READY),e.emit(Fc.CHANNEL_PERSISTENCE);try{c.channelConfig=Object.assign(Object.assign({},c.channelConfig),{localKey:null===(n=c.communicationLayer)||void 0===n?void 0:n.getKeyExchange().getKeyInfo().ecies.private,otherKey:null===(r=c.communicationLayer)||void 0===r?void 0:r.getKeyExchange().getOtherPublicKey(),channelId:null!==(i=c.channelId)&&void 0!==i?i:"",validUntil:null!==(s=null===(o=c.channelConfig)||void 0===o?void 0:o.validUntil)&&void 0!==s?s:Lc,relayPersistence:!0}),yield null===(a=c.storageManager)||void 0===a?void 0:a.persistChannelConfig(c.channelConfig)}catch(t){}}))}function wl({communicationLayerPreference:e,otherPublicKey:t,reconnect:n,ecies:r,communicationServerUrl:i=Oc,instance:o}){var s,a,c,l,u,d,h,f,p,g,m;const{state:y}=o;if(kc.RemoteCommunication("[initCommunicationLayer()] ",JSON.stringify(y,null,2)),e!==al.SOCKET)throw new Error("Invalid communication protocol");y.communicationLayer=new sl({communicationLayerPreference:e,otherPublicKey:t,reconnect:n,transports:y.transports,communicationServerUrl:i,context:y.context,ecies:r,logging:y.logging,remote:o});let v="undefined"!=typeof document&&document.URL||"",b="undefined"!=typeof document&&document.title||"";(null===(s=y.dappMetadata)||void 0===s?void 0:s.url)&&(v=y.dappMetadata.url),(null===(a=y.dappMetadata)||void 0===a?void 0:a.name)&&(b=y.dappMetadata.name);const w=null!==(d=null!==(l=null===(c=y.dappMetadata)||void 0===c?void 0:c.name)&&void 0!==l?l:null===(u=y.dappMetadata)||void 0===u?void 0:u.url)&&void 0!==d?d:"N/A",E="undefined"!=typeof window&&void 0!==window.location&&null!==(h=window.location.hostname)&&void 0!==h?h:w,S={url:v,title:b,source:null===(f=y.dappMetadata)||void 0===f?void 0:f.source,dappId:E,anonId:y.anonId,icon:(null===(p=y.dappMetadata)||void 0===p?void 0:p.iconUrl)||(null===(g=y.dappMetadata)||void 0===g?void 0:g.base64Icon),platform:y.platformType,apiVersion:Ic.version,connector:null===(m=y.dappMetadata)||void 0===m?void 0:m.connector};y.originatorInfo=S;const _={[Fc.AUTHORIZED]:ul(o),[Fc.MESSAGE]:ml(o),[Fc.CHANNEL_PERSISTENCE]:bl(o),[Fc.CLIENTS_CONNECTED]:hl(o,e),[Fc.KEYS_EXCHANGED]:gl(o,e),[Fc.SOCKET_DISCONNECTED]:vl(o),[Fc.SOCKET_RECONNECT]:yl(o),[Fc.CLIENTS_DISCONNECTED]:fl(o),[Fc.KEY_INFO]:()=>{},[Fc.CHANNEL_CREATED]:dl(o),[Fc.CLIENTS_WAITING]:pl(o),[Fc.RPC_UPDATE]:e=>{o.emit(Fc.RPC_UPDATE,e)}};for(const[t,n]of Object.entries(_))try{y.communicationLayer.on(t,n)}catch(e){}}function El(e){return xr(this,arguments,void 0,(function*({options:e,instance:t}){const{state:n}=t;return kc.RemoteCommunication(`[RemoteCommunication: disconnect()] channel=${n.channelId}`,e),new Promise(((r,i)=>{var o,s,a,c,l,u;(null==e?void 0:e.terminate)?(t.state.ready&&Pc({id:null!==(o=t.state.channelId)&&void 0!==o?o:"",event:Wc.TERMINATED},t.state.communicationServerUrl).catch((e=>{})),n.ready=!1,n.paused=!1,null===(s=n.storageManager)||void 0===s||s.terminate(null!==(a=n.channelId)&&void 0!==a?a:""),t.state.terminated=!0,e.sendMessage?(null===(c=n.communicationLayer)||void 0===c?void 0:c.getKeyInfo().keysExchanged)&&t.state.communicationLayer&&el(t.state.communicationLayer,{type:zc.TERMINATE}).then((()=>{r(!0)})).catch((e=>{i(e)})):r(!0),n.authorized=!1,n.relayPersistence=!1,n.channelId=Vt(),e.channelId=n.channelId,n.channelConfig=void 0,n.originatorConnectStarted=!1,null===(l=n.communicationLayer)||void 0===l||l.disconnect(e),t.setConnectionStatus($c.TERMINATED)):(null===(u=n.communicationLayer)||void 0===u||u.disconnect(e),t.setConnectionStatus($c.DISCONNECTED),r(!0))}))}))}(al||(al={})).SOCKET="socket",function(e){e.NonBrowser="nodejs",e.MetaMaskMobileWebview="in-app-browser",e.DesktopWeb="web-desktop",e.MobileWeb="web-mobile",e.ReactNative="react-native"}(cl||(cl={}));class Sl extends xt.exports.EventEmitter2{constructor(e){super(),this.state={ready:!1,anonId:"",authorized:!1,isOriginator:!1,terminated:!1,protocolVersion:1,paused:!1,deeplinkProtocolAvailable:!1,platformType:"metamask-mobile",analytics:!1,reconnection:!1,originatorInfoSent:!1,communicationServerUrl:Oc,context:"",persist:!1,clientsConnected:!1,sessionDuration:Lc,originatorConnectStarted:!1,debug:!1,_connectionStatus:$c.DISCONNECTED},this._options=e;const{anonId:t,platformType:n,communicationLayerPreference:r,otherPublicKey:i,reconnect:o,walletInfo:s,dappMetadata:a,protocolVersion:c,transports:l,context:u,relayPersistence:d,ecies:h,analytics:f=!1,storage:p,sdkVersion:g,communicationServerUrl:m=Oc,logging:y,autoConnect:v={timeout:Bc}}=e;this.state.anonId=t,this.state.otherPublicKey=i,this.state.dappMetadata=a,this.state.walletInfo=s,this.state.transports=l,this.state.platformType=n,this.state.analytics=f,this.state.protocolVersion=null!=c?c:1,this.state.isOriginator=!i,this.state.relayPersistence=d,this.state.communicationServerUrl=m,this.state.context=u,this.state.terminated=!1,this.state.sdkVersion=g,this.setMaxListeners(50),this.setConnectionStatus($c.DISCONNECTED),(null==p?void 0:p.duration)&&(this.state.sessionDuration=Lc),this.state.storageOptions=p,this.state.autoConnectOptions=v,this.state.debug=!0===(null==y?void 0:y.remoteLayer),!0===(null==y?void 0:y.remoteLayer)&&He.enable("RemoteCommunication:Layer"),!0===(null==y?void 0:y.serviceLayer)&&He.enable("SocketService:Layer"),!0===(null==y?void 0:y.eciesLayer)&&He.enable("ECIES:Layer"),!0===(null==y?void 0:y.keyExchangeLayer)&&He.enable("KeyExchange:Layer"),this.state.logging=y,(null==p?void 0:p.storageManager)&&(this.state.storageManager=p.storageManager),kc.RemoteCommunication(`[RemoteCommunication: constructor()] protocolVersion=${c} relayPersistence=${d} isOriginator=${this.state.isOriginator} communicationLayerPreference=${r} otherPublicKey=${i} reconnect=${o}`),this.state.isOriginator||wl({communicationLayerPreference:r,otherPublicKey:i,reconnect:o,ecies:h,communicationServerUrl:m,instance:this}),this.emitServiceStatusEvent({context:"constructor"})}initFromDappStorage(){return xr(this,void 0,void 0,(function*(){var e;if(this.state.storageManager){const t=yield this.state.storageManager.getPersistedChannelConfig({});t&&(this.state.channelConfig=t,this.state.channelId=t.channelId,this.state.deeplinkProtocolAvailable=null!==(e=t.deeplinkProtocolAvailable)&&void 0!==e&&e,t.relayPersistence&&(this.state.authorized=!0,this.state.ready=!0,this.setConnectionStatus($c.LINKED),yield this.connectToChannel({channelId:t.channelId})))}wl({communicationLayerPreference:al.SOCKET,otherPublicKey:this.state.otherPublicKey,reconnect:this._options.reconnect,ecies:this._options.ecies,communicationServerUrl:this.state.communicationServerUrl,instance:this})}))}originatorSessionConnect(){return xr(this,void 0,void 0,(function*(){return yield function(e){return xr(this,void 0,void 0,(function*(){var t;const{state:n}=e;if(!n.storageManager)return void kc.RemoteCommunication("[RemoteCommunication: originatorSessionConnect()] no storage manager defined - skip");const r=yield n.storageManager.getPersistedChannelConfig({});if(kc.RemoteCommunication(`[RemoteCommunication: originatorSessionConnect()] autoStarted=${n.originatorConnectStarted} channelConfig`,r),null===(t=n.communicationLayer)||void 0===t?void 0:t.isConnected())return kc.RemoteCommunication("[RemoteCommunication: originatorSessionConnect()] socket already connected - skip"),r;if(r){if(r.validUntil>Date.now())return n.channelConfig=r,n.originatorConnectStarted=!0,n.channelId=null==r?void 0:r.channelId,n.reconnection=!0,r;kc.RemoteCommunication("[RemoteCommunication: autoConnect()] Session has expired")}n.originatorConnectStarted=!1}))}(this)}))}generateChannelIdConnect(){return xr(this,void 0,void 0,(function*(){return function(e){return xr(this,void 0,void 0,(function*(){var t,n,r,i,o,s;if(!e.communicationLayer)throw new Error("communication layer not initialized");if(e.ready)throw new Error("Channel already connected");if(e.channelId&&(null===(t=e.communicationLayer)||void 0===t?void 0:t.isConnected()))return e.channelConfig=Object.assign(Object.assign({},e.channelConfig),{channelId:e.channelId,validUntil:Date.now()+e.sessionDuration}),null===(n=e.storageManager)||void 0===n||n.persistChannelConfig(e.channelConfig),{channelId:e.channelId,privKey:null===(i=null===(r=e.communicationLayer)||void 0===r?void 0:r.getKeyInfo())||void 0===i?void 0:i.ecies.private,pubKey:null===(s=null===(o=e.communicationLayer)||void 0===o?void 0:o.getKeyInfo())||void 0===s?void 0:s.ecies.public};kc.RemoteCommunication("[RemoteCommunication: generateChannelId()]");const a=yield e.communicationLayer.createChannel();kc.RemoteCommunication("[RemoteCommunication: generateChannelId()] channel created",a);const c=Object.assign(Object.assign({},e.channelConfig),{channelId:a.channelId,localKey:a.privKey,validUntil:Date.now()+e.sessionDuration});return e.channelId=a.channelId,e.channelConfig=c,{channelId:e.channelId,pubKey:a.pubKey,privKey:a.privKey}}))}(this.state)}))}clean(){return Uc(this.state)}connectToChannel({channelId:e,withKeyExchange:t,authorized:n}){return function(e){return xr(this,arguments,void 0,(function*({channelId:e,withKeyExchange:t,authorized:n,state:r}){var i,o,s;if(!Lt(e))throw kc.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${r.context} invalid channel channelId=${e}`),new Error(`Invalid channel ${e}`);if(kc.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${r.context} channelId=${e} withKeyExchange=${t}`),null===(i=r.communicationLayer)||void 0===i?void 0:i.isConnected())return void kc.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${r.context} already connected - interrupt connection.`);r.channelId=e,yield null===(o=r.communicationLayer)||void 0===o?void 0:o.connectToChannel({channelId:e,authorized:n,withKeyExchange:t});const a=Object.assign(Object.assign({},r.channelConfig),{channelId:e,validUntil:Date.now()+r.sessionDuration});r.channelConfig=a,null===(s=r.storageManager)||void 0===s||s.persistChannelConfig(a)}))}({channelId:e,authorized:n,withKeyExchange:t,state:this.state})}sendMessage(e){return xr(this,void 0,void 0,(function*(){const t=this.state.isOriginator&&e.method&&jc(e.method);t&&_t.analytics.track("sdk_action_requested",{action:e.method});try{return yield function(e,t){return xr(this,void 0,void 0,(function*(){var n,r;const{state:i}=e;kc.RemoteCommunication(`[RemoteCommunication: sendMessage()] context=${i.context} paused=${i.paused} ready=${i.ready} relayPersistence=${i.relayPersistence} authorized=${i.authorized} socket=${null===(n=i.communicationLayer)||void 0===n?void 0:n.isConnected()} clientsConnected=${i.clientsConnected} status=${i._connectionStatus}`,t),i.relayPersistence||i.ready&&(null===(r=i.communicationLayer)||void 0===r?void 0:r.isConnected())&&i.clientsConnected||(kc.RemoteCommunication(`[RemoteCommunication: sendMessage()] context=${i.context}  SKIP message waiting for MM mobile readiness.`),yield new Promise((t=>{e.once(Fc.CLIENTS_READY,t)})),kc.RemoteCommunication(`[RemoteCommunication: sendMessage()] context=${i.context}  AFTER SKIP / READY -- sending pending message`));try{const n=yield function(e,t){return xr(this,void 0,void 0,(function*(){return new Promise((n=>{var r;const{state:i}=e;kc.RemoteCommunication(`[RemoteCommunication: handleAuthorization()] context=${i.context} ready=${i.ready} authorized=${i.authorized} method=${t.method}`),!i.isOriginator||i.authorized||i.relayPersistence?null===(r=i.communicationLayer)||void 0===r||r.sendMessage(t).then((e=>{n(e)})).catch((e=>{n(!1)})):e.once(Fc.AUTHORIZED,(()=>{var e;kc.RemoteCommunication(`[RemoteCommunication: handleAuthorization()] context=${i.context}  AFTER SKIP / AUTHORIZED -- sending pending message`),null===(e=i.communicationLayer)||void 0===e||e.sendMessage(t).then((e=>{n(e)})).catch((e=>{n(!1)}))}))}))}))}(e,t);return n}catch(e){throw e}}))}(this,e)}catch(n){throw t&&_t.analytics.track("sdk_action_failed",{action:e.method}),n}}))}testStorage(){return xr(this,void 0,void 0,(function*(){return function(e){return xr(this,void 0,void 0,(function*(){var t;const n=yield null===(t=e.storageManager)||void 0===t?void 0:t.getPersistedChannelConfig();kc.RemoteCommunication("[RemoteCommunication: testStorage()] res",n)}))}(this.state)}))}hasDeeplinkProtocol(){return this.state.deeplinkProtocolAvailable}getChannelConfig(){return this.state.channelConfig}isReady(){return this.state.ready}isConnected(){var e;return null===(e=this.state.communicationLayer)||void 0===e?void 0:e.isConnected()}isAuthorized(){return this.state.authorized}isPaused(){return this.state.paused}getCommunicationLayer(){return this.state.communicationLayer}ping(){return xr(this,void 0,void 0,(function*(){var e;kc.RemoteCommunication(`[RemoteCommunication: ping()] channel=${this.state.channelId}`),yield null===(e=this.state.communicationLayer)||void 0===e?void 0:e.ping()}))}testLogger(){kc.RemoteCommunication(`testLogger() channel=${this.state.channelId}`),kc.SocketService(`testLogger() channel=${this.state.channelId}`),kc.Ecies(`testLogger() channel=${this.state.channelId}`),kc.KeyExchange(`testLogger() channel=${this.state.channelId}`)}keyCheck(){var e;kc.RemoteCommunication(`[RemoteCommunication: keyCheck()] channel=${this.state.channelId}`),null===(e=this.state.communicationLayer)||void 0===e||e.keyCheck()}setConnectionStatus(e){this.state._connectionStatus!==e&&(this.state._connectionStatus=e,this.emit(Fc.CONNECTION_STATUS,e),this.emitServiceStatusEvent({context:"setConnectionStatus"}))}emitServiceStatusEvent(e={}){this.emit(Fc.SERVICE_STATUS,this.getServiceStatus())}getConnectionStatus(){return this.state._connectionStatus}getServiceStatus(){return{originatorInfo:this.state.originatorInfo,keyInfo:this.getKeyInfo(),connectionStatus:this.state._connectionStatus,channelConfig:this.state.channelConfig,channelId:this.state.channelId}}getKeyInfo(){var e;return null===(e=this.state.communicationLayer)||void 0===e?void 0:e.getKeyInfo()}resetKeys(){var e;null===(e=this.state.communicationLayer)||void 0===e||e.resetKeys()}setOtherPublicKey(e){var t;const n=null===(t=this.state.communicationLayer)||void 0===t?void 0:t.getKeyExchange();if(!n)throw new Error("KeyExchange is not initialized.");n.getOtherPublicKey()!==e&&n.setOtherPublicKey(e)}pause(){return xr(this,void 0,void 0,(function*(){var e;kc.RemoteCommunication(`[RemoteCommunication: pause()] channel=${this.state.channelId}`),yield null===(e=this.state.communicationLayer)||void 0===e?void 0:e.pause(),this.setConnectionStatus($c.PAUSED)}))}getVersion(){return Ic.version}hasRelayPersistence(){var e;return null!==(e=this.state.relayPersistence)&&void 0!==e&&e}resume(){return xr(this,void 0,void 0,(function*(){return function(e){return xr(this,void 0,void 0,(function*(){var t;const{state:n}=e;kc.RemoteCommunication(`[RemoteCommunication: resume()] channel=${n.channelId}`),yield null===(t=n.communicationLayer)||void 0===t?void 0:t.resume(),e.setConnectionStatus($c.LINKED)}))}(this)}))}encrypt(e){var t,n,r;const i=null===(t=this.state.communicationLayer)||void 0===t?void 0:t.getKeyExchange(),o=null==i?void 0:i.getOtherPublicKey();if(!o)throw new Error("KeyExchange not completed");return null===(r=null===(n=this.state.communicationLayer)||void 0===n?void 0:n.state.eciesInstance)||void 0===r?void 0:r.encrypt(e,o)}decrypt(e){var t,n,r;if(!(null===(t=this.state.communicationLayer)||void 0===t?void 0:t.state.eciesInstance))throw new Error("ECIES instance is not initialized");return null===(r=null===(n=this.state.communicationLayer)||void 0===n?void 0:n.state.eciesInstance)||void 0===r?void 0:r.decrypt(e)}getChannelId(){return this.state.channelId}getRPCMethodTracker(){var e;return null===(e=this.state.communicationLayer)||void 0===e?void 0:e.getRPCMethodTracker()}reject({channelId:e}){return function(e){return xr(this,arguments,void 0,(function*({channelId:e,state:t}){var n,r,i;if(!Lt(e))throw kc.RemoteCommunication(`[RemoteCommunication: connectToChannel()] context=${t.context} invalid channel channelId=${e}`),new Error(`Invalid channel ${e}`);if(t.isOriginator)return void kc.RemoteCommunication(`[RemoteCommunication: reject()] context=${t.context} isOriginator=${t.isOriginator} channelId=${e}`);const{socket:o}=null!==(r=null===(n=t.communicationLayer)||void 0===n?void 0:n.state)&&void 0!==r?r:{};(null==o?void 0:o.connected)||(kc.RemoteCommunication(`[RemoteCommunication: reject()] context=${t.context} socket already connected`),null==o||o.connect()),Pc(Object.assign(Object.assign({id:e,event:Wc.REJECTED},t.originatorInfo),{sdkVersion:t.sdkVersion,commLayerVersion:Ic.version,walletVersion:null===(i=t.walletInfo)||void 0===i?void 0:i.version}),t.communicationServerUrl).catch((e=>{})),yield new Promise(((n,r)=>{null==o||o.emit(Fc.REJECTED,{channelId:e},((e,i)=>{kc.RemoteCommunication(`[RemoteCommunication: reject()] context=${t.context} socket=${null==o?void 0:o.id}`,{error:e,response:i}),e?r(e):n(i)}))}))}))}({channelId:e,state:this.state})}disconnect(e){return xr(this,void 0,void 0,(function*(){return El({options:e,instance:this})}))}}!function(e){e.RENEW="renew",e.LINK="link"}(ll||(ll={}));var _l="ERC721",Cl="ERC1155",Al={errors:{disconnected:()=>"MetaMask: Disconnected from chain. Attempting to connect.",permanentlyDisconnected:()=>"MetaMask: Disconnected from MetaMask background. Page reload required.",sendSiteMetadata:()=>"MetaMask: Failed to send site metadata. This is an internal error, please report this bug.",unsupportedSync:e=>`MetaMask: The MetaMask Ethereum provider does not support synchronous methods like ${e} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidNetworkParams:()=>"MetaMask: Received invalid network parameters. Please report this bug.",invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:e=>`'args.logger' must include required method '${e}'.`},info:{connected:e=>`MetaMask: Connected to chain with ID "${e}".`},warnings:{chainIdDeprecation:"MetaMask: 'ethereum.chainId' is deprecated and may be removed in the future. Please use the 'eth_chainId' RPC method instead.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/discussions/23",networkVersionDeprecation:"MetaMask: 'ethereum.networkVersion' is deprecated and may be removed in the future. Please use the 'net_version' RPC method instead.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/discussions/23",selectedAddressDeprecation:"MetaMask: 'ethereum.selectedAddress' is deprecated and may be removed in the future. Please use the 'eth_accounts' RPC method instead.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/discussions/23",enableDeprecation:"MetaMask: 'ethereum.enable()' is deprecated and may be removed in the future. Please use the 'eth_requestAccounts' RPC method instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1102",sendDeprecation:"MetaMask: 'ethereum.send(...)' is deprecated and may be removed in the future. Please use 'ethereum.sendAsync(...)' or 'ethereum.request(...)' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193",events:{close:"MetaMask: The event 'close' is deprecated and may be removed in the future. Please use 'disconnect' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#disconnect",data:"MetaMask: The event 'data' is deprecated and will be removed in the future. Use 'message' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message",networkChanged:"MetaMask: The event 'networkChanged' is deprecated and may be removed in the future. Use 'chainChanged' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#chainchanged",notification:"MetaMask: The event 'notification' is deprecated and may be removed in the future. Use 'message' instead.\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message"},rpc:{ethDecryptDeprecation:"MetaMask: The RPC method 'eth_decrypt' is deprecated and may be removed in the future.\nFor more information, see: https://medium.com/metamask/metamask-api-method-deprecation-2b0564a84686",ethGetEncryptionPublicKeyDeprecation:"MetaMask: The RPC method 'eth_getEncryptionPublicKey' is deprecated and may be removed in the future.\nFor more information, see: https://medium.com/metamask/metamask-api-method-deprecation-2b0564a84686",walletWatchAssetNFTExperimental:"MetaMask: The RPC method 'wallet_watchAsset' is experimental for ERC721/ERC1155 assets and may change in the future.\nFor more information, see: https://github.com/MetaMask/metamask-improvement-proposals/blob/main/MIPs/mip-1.md and https://github.com/MetaMask/metamask-improvement-proposals/blob/main/PROCESS-GUIDE.md#proposal-lifecycle"},experimentalMethods:"MetaMask: 'ethereum._metamask' exposes non-standard, experimental methods. They may be removed or changed without warning."}};function kl(e){const t={ethDecryptDeprecation:!1,ethGetEncryptionPublicKeyDeprecation:!1,walletWatchAssetNFTExperimental:!1};return(n,r,i)=>{t.ethDecryptDeprecation||"eth_decrypt"!==n.method?t.ethGetEncryptionPublicKeyDeprecation||"eth_getEncryptionPublicKey"!==n.method?!t.walletWatchAssetNFTExperimental&&"wallet_watchAsset"===n.method&&[_l,Cl].includes(n.params?.type||"")&&(e.warn(Al.warnings.rpc.walletWatchAssetNFTExperimental),t.walletWatchAssetNFTExperimental=!0):(e.warn(Al.warnings.rpc.ethGetEncryptionPublicKeyDeprecation),t.ethGetEncryptionPublicKeyDeprecation=!0):(e.warn(Al.warnings.rpc.ethDecryptDeprecation),t.ethDecryptDeprecation=!0),i()}}var Ml=4294967295,Rl=Math.floor(Math.random()*Ml);var xl=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},Pl=(e,t,n)=>(xl(e,t,"read from private field"),n?n.call(e):t.get(e)),Tl=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},Il=(e,t,n,r)=>(xl(e,t,"write to private field"),t.set(e,n),n),Ol=(e,t,n)=>(xl(e,t,"access private method"),n),Nl=-32600,Ll=-32603,Bl={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};function Dl(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)}var Kl=(e,t)=>Object.hasOwnProperty.call(e,t),jl={};!function(e){class t extends TypeError{constructor(e,t){let n;const{message:r,explanation:i,...o}=e,{path:s}=e,a=0===s.length?r:`At path: ${s.join(".")} -- ${r}`;super(i??a),null!=i&&(this.cause=a),Object.assign(this,o),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}function n(e){return r(e)&&"function"==typeof e[Symbol.iterator]}function r(e){return"object"==typeof e&&null!=e}function i(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function o(e){return"symbol"==typeof e?e.toString():"string"==typeof e?JSON.stringify(e):`${e}`}function s(e,t,n,r){if(!0===e)return;!1===e?e={}:"string"==typeof e&&(e={message:e});const{path:i,branch:s}=t,{type:a}=n,{refinement:c,message:l=`Expected a value of type \`${a}\`${c?` with refinement \`${c}\``:""}, but received: \`${o(r)}\``}=e;return{value:r,type:a,refinement:c,key:i[i.length-1],path:i,branch:s,...e,message:l}}function*a(e,t,r,i){n(e)||(e=[e]);for(const n of e){const e=s(n,t,r,i);e&&(yield e)}}function*c(e,t,n={}){const{path:i=[],branch:o=[e],coerce:s=!1,mask:a=!1}=n,l={path:i,branch:o};if(s&&(e=t.coercer(e,l),a&&"type"!==t.type&&r(t.schema)&&r(e)&&!Array.isArray(e)))for(const n in e)void 0===t.schema[n]&&delete e[n];let u="valid";for(const r of t.validator(e,l))r.explanation=n.message,u="not_valid",yield[r,void 0];for(let[d,h,f]of t.entries(e,l)){const t=c(h,f,{path:void 0===d?i:[...i,d],branch:void 0===d?o:[...o,h],coerce:s,mask:a,message:n.message});for(const n of t)n[0]?(u=null!=n[0].refinement?"not_refined":"not_valid",yield[n[0],void 0]):s&&(h=n[1],void 0===d?e=h:e instanceof Map?e.set(d,h):e instanceof Set?e.add(h):r(e)&&(void 0!==h||d in e)&&(e[d]=h))}if("not_valid"!==u)for(const r of t.refiner(e,l))r.explanation=n.message,u="not_refined",yield[r,void 0];"valid"===u&&(yield[void 0,e])}class l{constructor(e){const{type:t,schema:n,validator:r,refiner:i,coercer:o=(e=>e),entries:s=function*(){}}=e;this.type=t,this.schema=n,this.entries=s,this.coercer=o,this.validator=r?(e,t)=>a(r(e,t),t,this,e):()=>[],this.refiner=i?(e,t)=>a(i(e,t),t,this,e):()=>[]}assert(e,t){return u(e,this,t)}create(e,t){return d(e,this,t)}is(e){return f(e,this)}mask(e,t){return h(e,this,t)}validate(e,t={}){return p(e,this,t)}}function u(e,t,n){const r=p(e,t,{message:n});if(r[0])throw r[0]}function d(e,t,n){const r=p(e,t,{coerce:!0,message:n});if(r[0])throw r[0];return r[1]}function h(e,t,n){const r=p(e,t,{coerce:!0,mask:!0,message:n});if(r[0])throw r[0];return r[1]}function f(e,t){return!p(e,t)[0]}function p(e,n,r={}){const i=c(e,n,r),o=function(e){const{done:t,value:n}=e.next();return t?void 0:n}(i);if(o[0]){return[new t(o[0],(function*(){for(const e of i)e[0]&&(yield e[0])})),void 0]}return[void 0,o[1]]}function g(e,t){return new l({type:e,schema:null,validator:t})}function m(){return g("never",(()=>!1))}function y(e){const t=e?Object.keys(e):[],n=m();return new l({type:"object",schema:e||null,*entries(i){if(e&&r(i)){const r=new Set(Object.keys(i));for(const n of t)r.delete(n),yield[n,i[n],e[n]];for(const e of r)yield[e,i[e],n]}},validator:e=>r(e)||`Expected an object, but received: ${o(e)}`,coercer:e=>r(e)?{...e}:e})}function v(e){return new l({...e,validator:(t,n)=>void 0===t||e.validator(t,n),refiner:(t,n)=>void 0===t||e.refiner(t,n)})}function b(){return g("string",(e=>"string"==typeof e||`Expected a string, but received: ${o(e)}`))}function w(e){const t=Object.keys(e);return new l({type:"type",schema:e,*entries(n){if(r(n))for(const r of t)yield[r,n[r],e[r]]},validator:e=>r(e)||`Expected an object, but received: ${o(e)}`,coercer:e=>r(e)?{...e}:e})}function E(){return g("unknown",(()=>!0))}function S(e,t,n){return new l({...e,coercer:(r,i)=>f(r,t)?e.coercer(n(r,i),i):e.coercer(r,i)})}function _(e){return e instanceof Map||e instanceof Set?e.size:e.length}function C(e,t,n){return new l({...e,*refiner(r,i){yield*e.refiner(r,i);const o=a(n(r,i),i,e,r);for(const e of o)yield{...e,refinement:t}}})}e.Struct=l,e.StructError=t,e.any=function(){return g("any",(()=>!0))},e.array=function(e){return new l({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(const[n,r]of t.entries())yield[n,r,e]},coercer:e=>Array.isArray(e)?e.slice():e,validator:e=>Array.isArray(e)||`Expected an array value, but received: ${o(e)}`})},e.assert=u,e.assign=function(...e){const t="type"===e[0].type,n=e.map((e=>e.schema)),r=Object.assign({},...n);return t?w(r):y(r)},e.bigint=function(){return g("bigint",(e=>"bigint"==typeof e))},e.boolean=function(){return g("boolean",(e=>"boolean"==typeof e))},e.coerce=S,e.create=d,e.date=function(){return g("date",(e=>e instanceof Date&&!isNaN(e.getTime())||`Expected a valid \`Date\` object, but received: ${o(e)}`))},e.defaulted=function(e,t,n={}){return S(e,E(),(e=>{const r="function"==typeof t?t():t;if(void 0===e)return r;if(!n.strict&&i(e)&&i(r)){const t={...e};let n=!1;for(const e in r)void 0===t[e]&&(t[e]=r[e],n=!0);if(n)return t}return e}))},e.define=g,e.deprecated=function(e,t){return new l({...e,refiner:(t,n)=>void 0===t||e.refiner(t,n),validator:(n,r)=>void 0===n||(t(n,r),e.validator(n,r))})},e.dynamic=function(e){return new l({type:"dynamic",schema:null,*entries(t,n){const r=e(t,n);yield*r.entries(t,n)},validator:(t,n)=>e(t,n).validator(t,n),coercer:(t,n)=>e(t,n).coercer(t,n),refiner:(t,n)=>e(t,n).refiner(t,n)})},e.empty=function(e){return C(e,"empty",(t=>{const n=_(t);return 0===n||`Expected an empty ${e.type} but received one with a size of \`${n}\``}))},e.enums=function(e){const t={},n=e.map((e=>o(e))).join();for(const n of e)t[n]=n;return new l({type:"enums",schema:t,validator:t=>e.includes(t)||`Expected one of \`${n}\`, but received: ${o(t)}`})},e.func=function(){return g("func",(e=>"function"==typeof e||`Expected a function, but received: ${o(e)}`))},e.instance=function(e){return g("instance",(t=>t instanceof e||`Expected a \`${e.name}\` instance, but received: ${o(t)}`))},e.integer=function(){return g("integer",(e=>"number"==typeof e&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${o(e)}`))},e.intersection=function(e){return new l({type:"intersection",schema:null,*entries(t,n){for(const r of e)yield*r.entries(t,n)},*validator(t,n){for(const r of e)yield*r.validator(t,n)},*refiner(t,n){for(const r of e)yield*r.refiner(t,n)}})},e.is=f,e.lazy=function(e){let t;return new l({type:"lazy",schema:null,*entries(n,r){t??(t=e()),yield*t.entries(n,r)},validator:(n,r)=>(t??(t=e()),t.validator(n,r)),coercer:(n,r)=>(t??(t=e()),t.coercer(n,r)),refiner:(n,r)=>(t??(t=e()),t.refiner(n,r))})},e.literal=function(e){const t=o(e),n=typeof e;return new l({type:"literal",schema:"string"===n||"number"===n||"boolean"===n?e:null,validator:n=>n===e||`Expected the literal \`${t}\`, but received: ${o(n)}`})},e.map=function(e,t){return new l({type:"map",schema:null,*entries(n){if(e&&t&&n instanceof Map)for(const[r,i]of n.entries())yield[r,r,e],yield[r,i,t]},coercer:e=>e instanceof Map?new Map(e):e,validator:e=>e instanceof Map||`Expected a \`Map\` object, but received: ${o(e)}`})},e.mask=h,e.max=function(e,t,n={}){const{exclusive:r}=n;return C(e,"max",(n=>r?n<t:n<=t||`Expected a ${e.type} less than ${r?"":"or equal to "}${t} but received \`${n}\``))},e.min=function(e,t,n={}){const{exclusive:r}=n;return C(e,"min",(n=>r?n>t:n>=t||`Expected a ${e.type} greater than ${r?"":"or equal to "}${t} but received \`${n}\``))},e.never=m,e.nonempty=function(e){return C(e,"nonempty",(t=>_(t)>0||`Expected a nonempty ${e.type} but received an empty one`))},e.nullable=function(e){return new l({...e,validator:(t,n)=>null===t||e.validator(t,n),refiner:(t,n)=>null===t||e.refiner(t,n)})},e.number=function(){return g("number",(e=>"number"==typeof e&&!isNaN(e)||`Expected a number, but received: ${o(e)}`))},e.object=y,e.omit=function(e,t){const{schema:n}=e,r={...n};for(const e of t)delete r[e];return"type"===e.type?w(r):y(r)},e.optional=v,e.partial=function(e){const t=e instanceof l?{...e.schema}:{...e};for(const e in t)t[e]=v(t[e]);return y(t)},e.pattern=function(e,t){return C(e,"pattern",(n=>t.test(n)||`Expected a ${e.type} matching \`/${t.source}/\` but received "${n}"`))},e.pick=function(e,t){const{schema:n}=e,r={};for(const e of t)r[e]=n[e];return y(r)},e.record=function(e,t){return new l({type:"record",schema:null,*entries(n){if(r(n))for(const r in n){const i=n[r];yield[r,r,e],yield[r,i,t]}},validator:e=>r(e)||`Expected an object, but received: ${o(e)}`})},e.refine=C,e.regexp=function(){return g("regexp",(e=>e instanceof RegExp))},e.set=function(e){return new l({type:"set",schema:null,*entries(t){if(e&&t instanceof Set)for(const n of t)yield[n,n,e]},coercer:e=>e instanceof Set?new Set(e):e,validator:e=>e instanceof Set||`Expected a \`Set\` object, but received: ${o(e)}`})},e.size=function(e,t,n=t){const r=`Expected a ${e.type}`,i=t===n?`of \`${t}\``:`between \`${t}\` and \`${n}\``;return C(e,"size",(e=>{if("number"==typeof e||e instanceof Date)return t<=e&&e<=n||`${r} ${i} but received \`${e}\``;if(e instanceof Map||e instanceof Set){const{size:o}=e;return t<=o&&o<=n||`${r} with a size ${i} but received one with a size of \`${o}\``}{const{length:o}=e;return t<=o&&o<=n||`${r} with a length ${i} but received one with a length of \`${o}\``}}))},e.string=b,e.struct=function(e,t){return console.warn("superstruct@0.11 - The `struct` helper has been renamed to `define`."),g(e,t)},e.trimmed=function(e){return S(e,b(),(e=>e.trim()))},e.tuple=function(e){const t=m();return new l({type:"tuple",schema:null,*entries(n){if(Array.isArray(n)){const r=Math.max(e.length,n.length);for(let i=0;i<r;i++)yield[i,n[i],e[i]||t]}},validator:e=>Array.isArray(e)||`Expected an array, but received: ${o(e)}`})},e.type=w,e.union=function(e){const t=e.map((e=>e.type)).join(" | ");return new l({type:"union",schema:null,coercer(t){for(const n of e){const[e,r]=n.validate(t,{coerce:!0});if(!e)return r}return t},validator(n,r){const i=[];for(const t of e){const[...e]=c(n,t,r),[o]=e;if(!o[0])return[];for(const[t]of e)t&&i.push(t)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${o(n)}`,...i]}})},e.unknown=E,e.validate=p}(jl);var Ul=jl;var $l=class extends Error{constructor(e){super(e.message),this.code="ERR_ASSERTION"}},Fl=Object.freeze({__proto__:null,default:{}}),Hl=e=>Ul.object(e);function ql({path:e,branch:t}){const n=e[e.length-1];return Kl(t[t.length-2],n)}function zl(e){return new Ul.Struct({...e,type:`optional ${e.type}`,validator:(t,n)=>!ql(n)||e.validator(t,n),refiner:(t,n)=>!ql(n)||e.refiner(t,n)})}var Wl=Ul.union([Ul.literal(null),Ul.boolean(),Ul.define("finite number",(e=>Ul.is(e,Ul.number())&&Number.isFinite(e))),Ul.string(),Ul.array(Ul.lazy((()=>Wl))),Ul.record(Ul.string(),Ul.lazy((()=>Wl)))]),Vl=Ul.coerce(Wl,Ul.any(),(e=>(function(e,t,n="Assertion failed",r=$l){try{Ul.assert(e,t)}catch(e){throw function(e,t){return n=e,Boolean("string"==typeof n?.prototype?.constructor?.name)?new e({message:t}):e({message:t});var n}(r,`${n}: ${function(e){return function(e){return function(e){return"object"==typeof e&&null!==e&&"message"in e}(e)&&"string"==typeof e.message?e.message:null==e?"":String(e)}(e).replace(/\.$/u,"")}(e)}.`)}}(e,Wl),JSON.parse(JSON.stringify(e,((e,t)=>{if("__proto__"!==e&&"constructor"!==e)return t}))))));function Gl(e){try{return function(e){Ul.create(e,Vl)}(e),!0}catch{return!1}}var Yl=Ul.literal("2.0"),Jl=Ul.nullable(Ul.union([Ul.number(),Ul.string()])),Zl=Hl({code:Ul.integer(),message:Ul.string(),data:zl(Vl),stack:zl(Ul.string())}),Ql=Ul.union([Ul.record(Ul.string(),Vl),Ul.array(Vl)]),Xl=Hl({id:Jl,jsonrpc:Yl,method:Ul.string(),params:zl(Ql)}),eu=Hl({jsonrpc:Yl,method:Ul.string(),params:zl(Ql)});function tu(e){return Ul.is(e,Xl)}Ul.object({id:Jl,jsonrpc:Yl,result:Ul.optional(Ul.unknown()),error:Ul.optional(Zl)});var nu=Hl({id:Jl,jsonrpc:Yl,result:Vl}),ru=Hl({id:Jl,jsonrpc:Yl,error:Zl});function iu(e){return Ul.is(e,Zl)}Ul.union([nu,ru]);var ou="Unspecified error message. This is a bug, please report it.",su={code:Ll,message:cu(Ll)},au="Unspecified server error.";function cu(e,t=ou){if(function(e){return Number.isInteger(e)}(e)){const t=e.toString();if(Kl(Bl,t))return Bl[t].message;if(function(e){return e>=-32099&&e<=-32e3}(e))return au}return t}function lu(e,{fallbackError:t=su,shouldIncludeStack:n=!0}={}){if(!iu(t))throw new Error("Must provide fallback error with integer number code and string message.");const r=function(e,t){if(e&&"object"==typeof e&&"serialize"in e&&"function"==typeof e.serialize)return e.serialize();if(iu(e))return e;return{...t,data:{cause:uu(e)}}}(e,t);return n||delete r.stack,r}function uu(e){return Array.isArray(e)?e.map((e=>Gl(e)?e:Dl(e)?du(e):null)):Dl(e)?du(e):Gl(e)?e:null}function du(e){return Object.getOwnPropertyNames(e).reduce(((t,n)=>{const r=e[n];return Gl(r)&&(t[n]=r),t}),{})}var hu=vu;vu.default=vu,vu.stable=Su,vu.stableStringify=Su;var fu="[...]",pu="[Circular]",gu=[],mu=[];function yu(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function vu(e,t,n,r){var i;void 0===r&&(r=yu()),wu(e,"",0,[],void 0,0,r);try{i=0===mu.length?JSON.stringify(e,t,n):JSON.stringify(e,Cu(t),n)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==gu.length;){var o=gu.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function bu(e,t,n,r){var i=Object.getOwnPropertyDescriptor(r,n);void 0!==i.get?i.configurable?(Object.defineProperty(r,n,{value:e}),gu.push([r,n,t,i])):mu.push([t,n,e]):(r[n]=e,gu.push([r,n,t]))}function wu(e,t,n,r,i,o,s){var a;if(o+=1,"object"==typeof e&&null!==e){for(a=0;a<r.length;a++)if(r[a]===e)return void bu(pu,e,t,i);if(void 0!==s.depthLimit&&o>s.depthLimit)return void bu(fu,e,t,i);if(void 0!==s.edgesLimit&&n+1>s.edgesLimit)return void bu(fu,e,t,i);if(r.push(e),Array.isArray(e))for(a=0;a<e.length;a++)wu(e[a],a,a,r,e,o,s);else{var c=Object.keys(e);for(a=0;a<c.length;a++){var l=c[a];wu(e[l],l,a,r,e,o,s)}}r.pop()}}function Eu(e,t){return e<t?-1:e>t?1:0}function Su(e,t,n,r){void 0===r&&(r=yu());var i,o=_u(e,"",0,[],void 0,0,r)||e;try{i=0===mu.length?JSON.stringify(o,t,n):JSON.stringify(o,Cu(t),n)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==gu.length;){var s=gu.pop();4===s.length?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return i}function _u(e,t,n,r,i,o,s){var a;if(o+=1,"object"==typeof e&&null!==e){for(a=0;a<r.length;a++)if(r[a]===e)return void bu(pu,e,t,i);try{if("function"==typeof e.toJSON)return}catch(e){return}if(void 0!==s.depthLimit&&o>s.depthLimit)return void bu(fu,e,t,i);if(void 0!==s.edgesLimit&&n+1>s.edgesLimit)return void bu(fu,e,t,i);if(r.push(e),Array.isArray(e))for(a=0;a<e.length;a++)_u(e[a],a,a,r,e,o,s);else{var c={},l=Object.keys(e).sort(Eu);for(a=0;a<l.length;a++){var u=l[a];_u(e[u],u,a,r,e,o,s),c[u]=e[u]}if(void 0===i)return c;gu.push([i,t,e]),i[t]=c}r.pop()}}function Cu(e){return e=void 0!==e?e:function(e,t){return t},function(t,n){if(mu.length>0)for(var r=0;r<mu.length;r++){var i=mu[r];if(i[1]===t&&i[0]===n){n=i[2],mu.splice(r,1);break}}return e.call(this,t,n)}}var Au=Tr(hu),ku=class extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a non-empty string.');super(t),this.code=e,void 0!==n&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data,function(e){if("object"!=typeof e||null===e)return!1;try{let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}catch(e){return!1}}(this.data)&&(e.data.cause=uu(this.data.cause))),this.stack&&(e.stack=this.stack),e}toString(){return Au(this.serialize(),Mu,2)}};function Mu(e,t){if("[Circular]"!==t)return t}var Ru=e=>function(e,t){const[n,r]=function(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&"string"!=typeof t)throw new Error("Must specify string message.");return[t??void 0,n]}}return[]}(t);return new ku(e,n??cu(e),r)}(Nl,e);var xu={};Object.defineProperty(xu,"__esModule",{value:!0});const Pu=r;function Tu(e,t,n){try{Reflect.apply(e,t,n)}catch(e){setTimeout((()=>{throw e}))}}let Iu=class extends Pu.EventEmitter{emit(e,...t){let n="error"===e;const r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){let e;if(t.length>0&&([e]=t),e instanceof Error)throw e;const n=new Error("Unhandled error."+(e?` (${e.message})`:""));throw n.context=e,n}const i=r[e];if(void 0===i)return!1;if("function"==typeof i)Tu(i,this,t);else{const e=i.length,n=function(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}(i);for(let r=0;r<e;r+=1)Tu(n[r],this,t)}return!0}};var Ou,Nu,Lu,Bu,Du,Ku,ju,Uu,$u,Fu,Hu,qu,zu,Wu,Vu,Gu,Yu,Ju,Zu,Qu=xu.default=Iu,Xu=class e extends Qu{constructor({notificationHandler:e}={}){super(),Tl(this,Bu),Tl(this,Ku),Tl(this,Uu),Tl(this,Ou,!1),Tl(this,Nu,void 0),Tl(this,Lu,void 0),Il(this,Nu,[]),Il(this,Lu,e)}destroy(){Pl(this,Nu).forEach((e=>{"destroy"in e&&"function"==typeof e.destroy&&e.destroy()})),Il(this,Nu,[]),Il(this,Ou,!0)}push(e){Ol(this,Bu,Du).call(this),Pl(this,Nu).push(e)}handle(e,t){if(Ol(this,Bu,Du).call(this),t&&"function"!=typeof t)throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?Ol(this,Ku,ju).call(this,e,t):Ol(this,Ku,ju).call(this,e):t?Ol(this,Uu,$u).call(this,e,t):this._promiseHandle(e)}asMiddleware(){return Ol(this,Bu,Du).call(this),async(t,n,r,i)=>{var o,s;try{const[a,c,l]=await Ol(o=e,qu,zu).call(o,t,n,Pl(this,Nu));return c?(await Ol(s=e,Gu,Yu).call(s,l),i(a)):r((async t=>{var n;try{await Ol(n=e,Gu,Yu).call(n,l)}catch(e){return t(e)}return t()}))}catch(e){return i(e)}}}async _promiseHandle(e){return new Promise(((t,n)=>{Ol(this,Uu,$u).call(this,e,((e,r)=>{e&&void 0===r?n(e):t(r)})).catch(n)}))}};Ou=new WeakMap,Nu=new WeakMap,Lu=new WeakMap,Bu=new WeakSet,Du=function(){if(Pl(this,Ou))throw new Error("This engine is destroyed and can no longer be used.")},Ku=new WeakSet,ju=async function(e,t){try{if(0===e.length){const e=[{id:null,jsonrpc:"2.0",error:new ku(Nl,"Request batch must contain plain objects. Received an empty array")}];return t?t(null,e):e}const n=(await Promise.all(e.map(this._promiseHandle.bind(this)))).filter((e=>void 0!==e));return t?t(null,n):n}catch(e){if(t)return t(e);throw e}},Uu=new WeakSet,$u=async function(e,t){var n,r;if(!e||Array.isArray(e)||"object"!=typeof e){const n=new ku(Nl,"Requests must be plain objects. Received: "+typeof e,{request:e});return t(n,{id:null,jsonrpc:"2.0",error:n})}if("string"!=typeof e.method){const n=new ku(Nl,"Must specify a string method. Received: "+typeof e.method,{request:e});return Pl(this,Lu)&&!tu(e)?t(null):t(n,{id:e.id??null,jsonrpc:"2.0",error:n})}if(Pl(this,Lu)&&(r=e,Ul.is(r,eu))&&!tu(e)){try{await Pl(this,Lu).call(this,e)}catch(e){return t(e)}return t(null)}let i=null;const o={...e},s={id:o.id,jsonrpc:o.jsonrpc};try{await Ol(n=Xu,Fu,Hu).call(n,o,s,Pl(this,Nu))}catch(e){i=e}return i&&(delete s.result,s.error||(s.error=lu(i))),t(i,s)},Fu=new WeakSet,Hu=async function(e,t,n){var r,i,o;const[s,a,c]=await Ol(r=Xu,qu,zu).call(r,e,t,n);if(Ol(i=Xu,Ju,Zu).call(i,e,t,a),await Ol(o=Xu,Gu,Yu).call(o,c),s)throw s},qu=new WeakSet,zu=async function(e,t,n){var r;const i=[];let o=null,s=!1;for(const a of n)if([o,s]=await Ol(r=Xu,Wu,Vu).call(r,e,t,a,i),s)break;return[o,s,i.reverse()]},Wu=new WeakSet,Vu=async function(e,t,n,r){return new Promise((i=>{const o=e=>{const n=e||t.error;n&&(t.error=lu(n)),i([n,!0])},s=n=>{t.error?o(t.error):(n&&("function"!=typeof n&&o(new ku(Ll,`JsonRpcEngine: "next" return handlers must be functions. Received "${typeof n}" for request:\n${td(e)}`,{request:e})),r.push(n)),i([null,!1]))};try{n(e,t,s,o)}catch(e){o(e)}}))},Gu=new WeakSet,Yu=async function(e){for(const t of e)await new Promise(((e,n)=>{t((t=>t?n(t):e()))}))},Ju=new WeakSet,Zu=function(e,t,n){if(!Kl(t,"result")&&!Kl(t,"error"))throw new ku(Ll,`JsonRpcEngine: Response has no error or result for request:\n${td(e)}`,{request:e});if(!n)throw new ku(Ll,`JsonRpcEngine: Nothing ended request:\n${td(e)}`,{request:e})},Tl(Xu,Fu),Tl(Xu,qu),Tl(Xu,Wu),Tl(Xu,Gu),Tl(Xu,Ju);var ed=Xu;function td(e){return JSON.stringify(e,null,2)}var nd=Object.freeze(["eth_subscription"]),rd=(e=console)=>{return[(e,t,n,r)=>{const i=e.id,o=Rl=(Rl+1)%Ml;e.id=o,t.id=o,n((n=>{e.id=i,t.id=i,n()}))},(t=e,(e,n,r)=>{"string"==typeof e.method&&e.method||(n.error=Ru({message:"The request 'method' must be a non-empty string.",data:e})),r((e=>{const{error:r}=n;return r?(t.error(`MetaMask - RPC Error: ${r.message}`,r),e()):e()}))}),kl(e)];var t},id=(e,t,n=!0)=>(r,i)=>{r||i.error?t(r||i.error):!n||Array.isArray(i)?e(i):e(i.result)},od=e=>Boolean(e)&&"string"==typeof e&&e.startsWith("0x"),sd=()=>{};async function ad(e,t){try{const t=await async function(){return{name:cd(window),icon:await ld(window)}}();e.handle({jsonrpc:"2.0",id:1,method:"metamask_sendDomainMetadata",params:t},sd)}catch(e){t.error({message:Al.errors.sendSiteMetadata(),originalError:e})}}function cd(e){const{document:t}=e,n=t.querySelector('head > meta[property="og:site_name"]');if(n)return n.content;const r=t.querySelector('head > meta[name="title"]');return r?r.content:t.title&&t.title.length>0?t.title:window.location.hostname}async function ld(e){const{document:t}=e,n=t.querySelectorAll('head > link[rel~="icon"]');for(const e of Array.from(n))if(e&&await ud(e.href))return e.href;return null}async function ud(e){return new Promise(((t,n)=>{try{const n=document.createElement("img");n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e}catch(e){n(e)}}))}var dd=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},hd=(e,t,n)=>(dd(e,t,"read from private field"),n?n.call(e):t.get(e)),fd=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},pd=(e,t,n,r)=>(dd(e,t,"write to private field"),t.set(e,n),n);function gd(e,t,n){try{Reflect.apply(e,t,n)}catch(e){setTimeout((()=>{throw e}))}}class md extends i{emit(e,...t){let n="error"===e;const r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){let e;if(t.length>0&&([e]=t),e instanceof Error)throw e;const n=new Error("Unhandled error."+(e?` (${e.message})`:""));throw n.context=e,n}const i=r[e];if(void 0===i)return!1;if("function"==typeof i)gd(i,this,t);else{const e=i.length,n=function(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}(i);for(let r=0;r<e;r+=1)gd(n[r],this,t)}return!0}}var yd,vd,bd=Tr((function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!=i--;){var s=o[i];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n})),wd=class e extends md{constructor({logger:t=console,maxEventListeners:n=100,rpcMiddleware:r=[]}={}){super(),fd(this,yd,void 0),fd(this,vd,void 0),this._log=t,this.setMaxListeners(n),this._state={...e._defaultState},pd(this,vd,null),pd(this,yd,null),this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleConnect=this._handleConnect.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this.request=this.request.bind(this);const i=new ed;r.forEach((e=>i.push(e))),this._rpcEngine=i}get chainId(){return hd(this,yd)}get selectedAddress(){return hd(this,vd)}isConnected(){return this._state.isConnected}async request(e){if(!e||"object"!=typeof e||Array.isArray(e))throw Ru({message:Al.errors.invalidRequestArgs(),data:e});const{method:t,params:n}=e;if("string"!=typeof t||0===t.length)throw Ru({message:Al.errors.invalidRequestMethod(),data:e});if(void 0!==n&&!Array.isArray(n)&&("object"!=typeof n||null===n))throw Ru({message:Al.errors.invalidRequestParams(),data:e});const r=null==n?{method:t}:{method:t,params:n};return new Promise(((e,t)=>{this._rpcRequest(r,id(e,t))}))}_initializeState(e){if(this._state.initialized)throw new Error("Provider already initialized.");if(e){const{accounts:t,chainId:n,isUnlocked:r,networkVersion:i}=e;this._handleConnect(n),this._handleChainChanged({chainId:n,networkVersion:i}),this._handleUnlockStateChanged({accounts:t,isUnlocked:r}),this._handleAccountsChanged(t)}this._state.initialized=!0,this.emit("_initialized")}_rpcRequest(e,t){let n=t;return Array.isArray(e)||(e.jsonrpc||(e.jsonrpc="2.0"),"eth_accounts"!==e.method&&"eth_requestAccounts"!==e.method||(n=(n,r)=>{this._handleAccountsChanged(r.result??[],"eth_accounts"===e.method),t(n,r)})),this._rpcEngine.handle(e,n)}_handleConnect(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),this._log.debug(Al.info.connected(e)))}_handleDisconnect(e,t){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){let n;this._state.isConnected=!1,e?(n=new ku(1013,t??Al.errors.disconnected()),this._log.debug(n)):(n=new ku(1011,t??Al.errors.permanentlyDisconnected()),this._log.error(n),pd(this,yd,null),this._state.accounts=null,pd(this,vd,null),this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}_handleChainChanged({chainId:e}={}){od(e)?(this._handleConnect(e),e!==hd(this,yd)&&(pd(this,yd,e),this._state.initialized&&this.emit("chainChanged",hd(this,yd)))):this._log.error(Al.errors.invalidNetworkParams(),{chainId:e})}_handleAccountsChanged(e,t=!1){let n=e;Array.isArray(e)||(this._log.error("MetaMask: Received invalid accounts parameter. Please report this bug.",e),n=[]);for(const t of e)if("string"!=typeof t){this._log.error("MetaMask: Received non-string account. Please report this bug.",e),n=[];break}if(!bd(this._state.accounts,n)&&(t&&null!==this._state.accounts&&this._log.error("MetaMask: 'eth_accounts' unexpectedly updated accounts. Please report this bug.",n),this._state.accounts=n,hd(this,vd)!==n[0]&&pd(this,vd,n[0]||null),this._state.initialized)){const e=[...n];this.emit("accountsChanged",e)}}_handleUnlockStateChanged({accounts:e,isUnlocked:t}={}){"boolean"==typeof t?t!==this._state.isUnlocked&&(this._state.isUnlocked=t,this._handleAccountsChanged(e??[])):this._log.error("MetaMask: Received invalid isUnlocked parameter. Please report this bug.")}};yd=new WeakMap,vd=new WeakMap,wd._defaultState={accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1};var Ed,Sd,_d=wd,Cd={exports:{}},Ad=r.EventEmitter,kd=function(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}(Fl);function Md(){if(Sd)return Ed;function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}Sd=1;var o=e.Buffer,s=kd.inspect,a=s&&s.custom||"inspect";return Ed=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return function(e,t,n){t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,n,r,i=o.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,n=i,r=a,o.prototype.copy.call(t,n,r),a+=s.data.length,s=s.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0==(e-=s)){s===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(s));break}++r}return this.length-=r,t}},{key:a,value:function(e,t){return s(this,n(n({},t),{},{depth:0,customInspect:!1}))}}]),e}(),Ed}function Rd(e,t){Pd(e,t),xd(e)}function xd(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function Pd(e,t){e.emit("error",t)}var Td={destroy:function(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Le.nextTick(Pd,this,e)):Le.nextTick(Pd,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?Le.nextTick(xd,n):(n._writableState.errorEmitted=!0,Le.nextTick(Rd,n,e)):Le.nextTick(Rd,n,e):t?(Le.nextTick(xd,n),t(e)):Le.nextTick(xd,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}},Id={},Od={};function Nd(e,t,n){n||(n=Error);var r=function(e){var n,r;function i(n,r,i){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,i))||this}return r=e,(n=i).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r,i}(n);r.prototype.name=n.name,r.prototype.code=e,Od[e]=r}function Ld(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}Nd("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),Nd("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,i,o;if("string"==typeof t&&(i="not ",t.substr(0,4)===i)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-9,n)===t}(e," argument"))o="The ".concat(e," ").concat(r," ").concat(Ld(t,"type"));else{var s=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+1>e.length)&&-1!==e.indexOf(".",n)}(e)?"property":"argument";o='The "'.concat(e,'" ').concat(s," ").concat(r," ").concat(Ld(t,"type"))}return o+". Received type ".concat(typeof n)}),TypeError),Nd("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),Nd("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),Nd("ERR_STREAM_PREMATURE_CLOSE","Premature close"),Nd("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),Nd("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),Nd("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),Nd("ERR_STREAM_WRITE_AFTER_END","write after end"),Nd("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),Nd("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),Nd("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),Id.codes=Od;var Bd=Id.codes.ERR_INVALID_OPT_VALUE,Dd={getHighWaterMark:function(e,t,n,r){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new Bd(r?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}},Kd={exports:{}};"function"==typeof Object.create?Kd.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Kd.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var jd,Ud,$d,Fd,Hd=Kd.exports,qd=function(e,t){if(zd("noDeprecation"))return e;var n=!1;return function(){if(!n){if(zd("throwDeprecation"))throw new Error(t);zd("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}};function zd(e){try{if(!Pr.localStorage)return!1}catch(e){return!1}var t=Pr.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}function Wd(){if(Ud)return jd;function t(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(undefined),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var n;Ud=1,jd=S,S.WritableState=E;var r,i=qd,o=Ad,s=e.Buffer,a=(void 0!==Pr?Pr:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},c=Td,l=Dd.getHighWaterMark,u=Id.codes,d=u.ERR_INVALID_ARG_TYPE,h=u.ERR_METHOD_NOT_IMPLEMENTED,f=u.ERR_MULTIPLE_CALLBACK,p=u.ERR_STREAM_CANNOT_PIPE,g=u.ERR_STREAM_DESTROYED,m=u.ERR_STREAM_NULL_VALUES,y=u.ERR_STREAM_WRITE_AFTER_END,v=u.ERR_UNKNOWN_ENCODING,b=c.errorOrDestroy;function w(){}function E(e,r,i){n=n||Vd(),e=e||{},"boolean"!=typeof i&&(i=r instanceof n),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=l(this,e,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if("function"!=typeof i)throw new f;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(Le.nextTick(i,r),Le.nextTick(R,e,t),e._writableState.errorEmitted=!0,b(e,r)):(i(r),e._writableState.errorEmitted=!0,b(e,r),R(e,t))}(e,n,r,t,i);else{var o=k(n)||e.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||A(e,n),r?Le.nextTick(C,e,n,o,i):C(e,n,o,i)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}function S(e){var t=this instanceof(n=n||Vd());if(!t&&!r.call(S,this))return new S(e);this._writableState=new E(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),o.call(this)}function _(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new g("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function C(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),R(e,t)}function A(e,n){n.bufferProcessing=!0;var r=n.bufferedRequest;if(e._writev&&r&&r.next){var i=n.bufferedRequestCount,o=new Array(i),s=n.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)o[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;o.allBuffers=c,_(e,n,!0,n.length,o,"",s.finish),n.pendingcb++,n.lastBufferedRequest=null,s.next?(n.corkedRequestsFree=s.next,s.next=null):n.corkedRequestsFree=new t(n),n.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,d=r.callback;if(_(e,n,!1,n.objectMode?1:l.length,l,u,d),r=r.next,n.bufferedRequestCount--,n.writing)break}null===r&&(n.lastBufferedRequest=null)}n.bufferedRequest=r,n.bufferProcessing=!1}function k(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function M(e,t){e._final((function(n){t.pendingcb--,n&&b(e,n),t.prefinished=!0,e.emit("prefinish"),R(e,t)}))}function R(e,t){var n=k(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,Le.nextTick(M,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}return Hd(S,o),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,"buffer",{get:i((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(r=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!r.call(this,e)||this===S&&e&&e._writableState instanceof E}})):r=function(e){return e instanceof this},S.prototype.pipe=function(){b(this,new p)},S.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,c=!i.objectMode&&(r=e,s.isBuffer(r)||r instanceof a);return c&&!s.isBuffer(e)&&(e=function(e){return s.from(e)}(e)),"function"==typeof t&&(n=t,t=null),c?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=w),i.ending?function(e,t){var n=new y;b(e,n),Le.nextTick(t,n)}(this,n):(c||function(e,t,n,r){var i;return null===n?i=new m:"string"==typeof n||t.objectMode||(i=new d("chunk",["string","Buffer"],n)),!i||(b(e,i),Le.nextTick(r,i),!1)}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,o){if(!n){var a=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=s.from(t,n)),t}(t,r,i);r!==a&&(n=!0,i="buffer",r=a)}var c=t.objectMode?1:r.length;t.length+=c;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,c,r,i,o);return l}(this,i,c,e,t,n)),o},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,n){n(new h("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,R(e,t),n&&(t.finished?Le.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=c.destroy,S.prototype._undestroy=c.undestroy,S.prototype._destroy=function(e,t){t(e)},jd}function Vd(){if(Fd)return $d;Fd=1;var e=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};$d=s;var t=ch(),n=Wd();Hd(s,t);for(var r=e(n.prototype),i=0;i<r.length;i++){var o=r[i];s.prototype[o]||(s.prototype[o]=n.prototype[o])}function s(e){if(!(this instanceof s))return new s(e);t.call(this,e),n.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||Le.nextTick(c,this)}function c(e){e.end()}return Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),$d}var Gd,Yd,Jd={},Zd={exports:{}};function Qd(){if(Yd)return Jd;Yd=1;var t=(Gd||(Gd=1,function(t,n){var r=e,i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(o(r,n),n.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}(Zd,Zd.exports)),Zd.exports).Buffer,n=t.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(e){var r;switch(this.encoding=function(e){var r=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof r&&(t.isEncoding===n||!n(e)))throw new Error("Unknown encoding: "+e);return r||e}(e),this.encoding){case"utf16le":this.text=s,this.end=a,r=4;break;case"utf8":this.fillLast=o,r=4;break;case"base64":this.text=c,this.end=l,r=3;break;default:return this.write=u,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(r)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function s(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function a(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function u(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}return Jd.StringDecoder=r,r.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},r.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},r.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var o=i(t[r]);return o>=0?(o>0&&(e.lastNeed=o-1),o):--r<n||-2===o?0:(o=i(t[r]))>=0?(o>0&&(e.lastNeed=o-2),o):--r<n||-2===o?0:(o=i(t[r]))>=0?(o>0&&(2===o?o=0:e.lastNeed=o-3),o):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},r.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length},Jd}var Xd=Id.codes.ERR_STREAM_PREMATURE_CLOSE;function eh(){}var th,nh,rh,ih,oh,sh,ah=function e(t,n,r){if("function"==typeof n)return e(t,null,n);n||(n={}),r=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(r||eh);var i=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,s=function(){t.writable||c()},a=t._writableState&&t._writableState.finished,c=function(){o=!1,a=!0,i||r.call(t)},l=t._readableState&&t._readableState.endEmitted,u=function(){i=!1,l=!0,o||r.call(t)},d=function(e){r.call(t,e)},h=function(){var e;return i&&!l?(t._readableState&&t._readableState.ended||(e=new Xd),r.call(t,e)):o&&!a?(t._writableState&&t._writableState.ended||(e=new Xd),r.call(t,e)):void 0},f=function(){t.req.on("finish",c)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",c),t.on("abort",h),t.req?f():t.on("request",f)):o&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",u),t.on("finish",c),!1!==n.error&&t.on("error",d),t.on("close",h),function(){t.removeListener("complete",c),t.removeListener("abort",h),t.removeListener("request",f),t.req&&t.req.removeListener("finish",c),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",c),t.removeListener("end",u),t.removeListener("error",d),t.removeListener("close",h)}};function ch(){if(sh)return oh;var t;sh=1,oh=_,_.ReadableState=S,r.EventEmitter;var n,i=function(e,t){return e.listeners(t).length},o=Ad,s=e.Buffer,a=(void 0!==Pr?Pr:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},c=kd;n=c&&c.debuglog?c.debuglog("stream"):function(){};var l,u,d,h=Md(),f=Td,p=Dd.getHighWaterMark,g=Id.codes,m=g.ERR_INVALID_ARG_TYPE,y=g.ERR_STREAM_PUSH_AFTER_EOF,v=g.ERR_METHOD_NOT_IMPLEMENTED,b=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;Hd(_,o);var w=f.errorOrDestroy,E=["error","close","destroy","pause","resume"];function S(e,n,r){t=t||Vd(),e=e||{},"boolean"!=typeof r&&(r=n instanceof t),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=p(this,e,"readableHighWaterMark",r),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(l||(l=Qd().StringDecoder),this.decoder=new l(e.encoding),this.encoding=e.encoding)}function _(e){if(t=t||Vd(),!(this instanceof _))return new _(e);var n=this instanceof t;this._readableState=new S(e,this,n),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function C(e,t,r,i,o){n("readableAddChunk",t);var c,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(n("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?R(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,x(e)))}}(e,l);else if(o||(c=function(e,t){var n,r;return r=t,s.isBuffer(r)||r instanceof a||"string"==typeof t||void 0===t||e.objectMode||(n=new m("chunk",["string","Buffer","Uint8Array"],t)),n}(l,t)),c)w(e,c);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),i)l.endEmitted?w(e,new b):A(e,l,t,!0);else if(l.ended)w(e,new y);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!r?(t=l.decoder.write(t),l.objectMode||0!==t.length?A(e,l,t,!1):P(e,l)):A(e,l,t,!1)}else i||(l.reading=!1,P(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function A(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&R(e)),P(e,t)}Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=f.destroy,_.prototype._undestroy=f.undestroy,_.prototype._destroy=function(e,t){t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=s.from(e,t),t=""),n=!0),C(this,e,t,!1,n)},_.prototype.unshift=function(e){return C(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){l||(l=Qd().StringDecoder);var t=new l(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,r="";null!==n;)r+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var k=1073741824;function M(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=k?e=k:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function R(e){var t=e._readableState;n("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(n("emitReadable",t.flowing),t.emittedReadable=!0,Le.nextTick(x,e))}function x(e){var t=e._readableState;n("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,L(e)}function P(e,t){t.readingMore||(t.readingMore=!0,Le.nextTick(T,e,t))}function T(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(n("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function I(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function O(e){n("readable nexttick read 0"),e.read(0)}function N(e,t){n("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),L(e),t.flowing&&!t.reading&&e.read(0)}function L(e){var t=e._readableState;for(n("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function D(e){var t=e._readableState;n("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,Le.nextTick(K,t,e))}function K(e,t){if(n("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function j(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}return _.prototype.read=function(e){n("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return n("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?D(this):R(this),null;if(0===(e=M(e,t))&&t.ended)return 0===t.length&&D(this),null;var i,o=t.needReadable;return n("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&n("length less than watermark",o=!0),t.ended||t.reading?n("reading or ended",o=!1):o&&(n("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=M(r,t))),null===(i=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&D(this)),null!==i&&this.emit("data",i),i},_.prototype._read=function(e){w(this,new v("_read()"))},_.prototype.pipe=function(e,t){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,n("pipe count=%d opts=%j",o.pipesCount,t);var s=t&&!1===t.end||e===Le.stdout||e===Le.stderr?p:a;function a(){n("onend"),e.end()}o.endEmitted?Le.nextTick(s):r.once("end",s),e.on("unpipe",(function t(i,s){n("onunpipe"),i===r&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,n("cleanup"),e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",a),r.removeListener("end",p),r.removeListener("data",u),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;n("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&i(e,"data")&&(t.flowing=!0,L(e))}}(r);e.on("drain",c);var l=!1;function u(t){n("ondata");var i=e.write(t);n("dest.write",i),!1===i&&((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==j(o.pipes,e))&&!l&&(n("false write response, pause",o.awaitDrain),o.awaitDrain++),r.pause())}function d(t){n("onerror",t),p(),e.removeListener("error",d),0===i(e,"error")&&w(e,t)}function h(){e.removeListener("finish",f),p()}function f(){n("onfinish"),e.removeListener("close",h),p()}function p(){n("unpipe"),r.unpipe(e)}return r.on("data",u),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",d),e.once("close",h),e.once("finish",f),e.emit("pipe",r),o.flowing||(n("pipe resume"),r.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=j(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},_.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,n("on readable",i.length,i.reading),i.length?R(this):i.reading||Le.nextTick(O,this))),r},_.prototype.addListener=_.prototype.on,_.prototype.removeListener=function(e,t){var n=o.prototype.removeListener.call(this,e,t);return"readable"===e&&Le.nextTick(I,this),n},_.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||Le.nextTick(I,this),t},_.prototype.resume=function(){var e=this._readableState;return e.flowing||(n("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Le.nextTick(N,e,t))}(this,e)),e.paused=!1,this},_.prototype.pause=function(){return n("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(n("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},_.prototype.wrap=function(e){var t=this,r=this._readableState,i=!1;for(var o in e.on("end",(function(){if(n("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(o){n("wrapped data"),r.decoder&&(o=r.decoder.write(o)),r.objectMode&&null==o||(r.objectMode||o&&o.length)&&(t.push(o)||(i=!0,e.pause()))})),e)void 0===this[o]&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var s=0;s<E.length;s++)e.on(E[s],this.emit.bind(this,E[s]));return this._read=function(t){n("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"==typeof Symbol&&(_.prototype[Symbol.asyncIterator]=function(){return void 0===u&&(u=function(){if(nh)return th;var e;function t(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nh=1;var n=ah,r=Symbol("lastResolve"),i=Symbol("lastReject"),o=Symbol("error"),s=Symbol("ended"),a=Symbol("lastPromise"),c=Symbol("handlePromise"),l=Symbol("stream");function u(e,t){return{value:e,done:t}}function d(e){var t=e[r];if(null!==t){var n=e[l].read();null!==n&&(e[a]=null,e[r]=null,e[i]=null,t(u(n,!1)))}}function h(e){Le.nextTick(d,e)}var f=Object.getPrototypeOf((function(){})),p=Object.setPrototypeOf((t(e={get stream(){return this[l]},next:function(){var e=this,t=this[o];if(null!==t)return Promise.reject(t);if(this[s])return Promise.resolve(u(void 0,!0));if(this[l].destroyed)return new Promise((function(t,n){Le.nextTick((function(){e[o]?n(e[o]):t(u(void 0,!0))}))}));var n,r=this[a];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[s]?n(u(void 0,!0)):t[c](n,r)}),r)}}(r,this));else{var i=this[l].read();if(null!==i)return Promise.resolve(u(i,!1));n=new Promise(this[c])}return this[a]=n,n}},Symbol.asyncIterator,(function(){return this})),t(e,"return",(function(){var e=this;return new Promise((function(t,n){e[l].destroy(null,(function(e){e?n(e):t(u(void 0,!0))}))}))})),e),f);return th=function(e){var d,f=Object.create(p,(t(d={},l,{value:e,writable:!0}),t(d,r,{value:null,writable:!0}),t(d,i,{value:null,writable:!0}),t(d,o,{value:null,writable:!0}),t(d,s,{value:e._readableState.endEmitted,writable:!0}),t(d,c,{value:function(e,t){var n=f[l].read();n?(f[a]=null,f[r]=null,f[i]=null,e(u(n,!1))):(f[r]=e,f[i]=t)},writable:!0}),d));return f[a]=null,n(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=f[i];return null!==t&&(f[a]=null,f[r]=null,f[i]=null,t(e)),void(f[o]=e)}var n=f[r];null!==n&&(f[a]=null,f[r]=null,f[i]=null,n(u(void 0,!0))),f[s]=!0})),e.on("readable",h.bind(null,f)),f}}()),u(this)}),Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(_.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(_.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),_._fromList=B,Object.defineProperty(_.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(_.from=function(e,t){return void 0===d&&(d=ih?rh:(ih=1,rh=function(){throw new Error("Readable.from is not available in the browser")})),d(_,e,t)}),oh}var lh=yh,uh=Id.codes,dh=uh.ERR_METHOD_NOT_IMPLEMENTED,hh=uh.ERR_MULTIPLE_CALLBACK,fh=uh.ERR_TRANSFORM_ALREADY_TRANSFORMING,ph=uh.ERR_TRANSFORM_WITH_LENGTH_0,gh=Vd();function mh(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new hh);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function yh(e){if(!(this instanceof yh))return new yh(e);gh.call(this,e),this._transformState={afterTransform:mh.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",vh)}function vh(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?bh(this,null,null):this._flush((function(t,n){bh(e,t,n)}))}function bh(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new ph;if(e._transformState.transforming)throw new fh;return e.push(null)}Hd(yh,gh),yh.prototype.push=function(e,t){return this._transformState.needTransform=!1,gh.prototype.push.call(this,e,t)},yh.prototype._transform=function(e,t,n){n(new dh("_transform()"))},yh.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},yh.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},yh.prototype._destroy=function(e,t){gh.prototype._destroy.call(this,e,(function(e){t(e)}))};var wh,Eh=_h,Sh=lh;function _h(e){if(!(this instanceof _h))return new _h(e);Sh.call(this,e)}Hd(_h,Sh),_h.prototype._transform=function(e,t,n){n(null,e)};var Ch=Id.codes,Ah=Ch.ERR_MISSING_ARGS,kh=Ch.ERR_STREAM_DESTROYED;function Mh(e){if(e)throw e}function Rh(e){e()}function xh(e,t){return e.pipe(t)}var Ph=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=function(e){return e.length?"function"!=typeof e[e.length-1]?Mh:e.pop():Mh}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Ah("streams");var o=t.map((function(e,n){var s=n<t.length-1;return function(e,t,n,r){r=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(r);var i=!1;e.on("close",(function(){i=!0})),void 0===wh&&(wh=ah),wh(e,{readable:t,writable:n},(function(e){if(e)return r(e);i=!0,r()}));var o=!1;return function(t){if(!i&&!o)return o=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void r(t||new kh("pipe"))}}(e,s,n>0,(function(e){r||(r=e),e&&o.forEach(Rh),s||(o.forEach(Rh),i(r))}))}));return t.reduce(xh)};!function(e,t){(t=Cd.exports=ch()).Stream=t,t.Readable=t,t.Writable=Wd(),t.Duplex=Vd(),t.Transform=lh,t.PassThrough=Eh,t.finished=ah,t.pipeline=Ph}(0,Cd.exports);var Th=Cd.exports;var Ih={},Oh={exports:{}},Nh=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r;function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(e){r[e]=i[e]})),r}};function Lh(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function Bh(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}Oh.exports=Nh(Lh),Oh.exports.strict=Nh(Bh),Lh.proto=Lh((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return Lh(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return Bh(this)},configurable:!0})}));var Dh=Oh.exports,Kh={};Object.defineProperty(Kh,"__esModule",{value:!0}),Kh.Substream=void 0;const jh=Th;class Uh extends jh.Duplex{constructor({parent:e,name:t}){super({objectMode:!0}),this._parent=e,this._name=t}_read(){}_write(e,t,n){this._parent.push({name:this._name,data:e}),n()}}Kh.Substream=Uh;var $h=Pr&&Pr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.ObjectMultiplex=void 0;const Fh=Th,Hh=$h(Dh),qh=Kh,zh=Symbol("IGNORE_SUBSTREAM");let Wh=class extends Fh.Duplex{constructor(e={}){super(Object.assign(Object.assign({},e),{objectMode:!0})),this._substreams={}}createStream(e){if(this.destroyed)throw new Error(`ObjectMultiplex - parent stream for name "${e}" already destroyed`);if(this._readableState.ended||this._writableState.ended)throw new Error(`ObjectMultiplex - parent stream for name "${e}" already ended`);if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new qh.Substream({parent:this,name:e});return this._substreams[e]=t,function(e,t){const n=(0,Hh.default)(t);(0,Fh.finished)(e,{readable:!1},n),(0,Fh.finished)(e,{writable:!1},n)}(this,(e=>t.destroy(e||void 0))),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=zh}_read(){}_write(e,t,n){const{name:r,data:i}=e;if(!r)return console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const o=this._substreams[r];return o?(o!==zh&&o.push(i),n()):(console.warn(`ObjectMultiplex - orphaned data for stream "${r}"`),n())}};Ih.ObjectMultiplex=Wh;var Vh=Tr(Ih.ObjectMultiplex);const Gh=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe;Gh.writable=e=>Gh(e)&&!1!==e.writable&&"function"==typeof e._write&&"object"==typeof e._writableState,Gh.readable=e=>Gh(e)&&!1!==e.readable&&"function"==typeof e._read&&"object"==typeof e._readableState,Gh.duplex=e=>Gh.writable(e)&&Gh.readable(e),Gh.transform=e=>Gh.duplex(e)&&"function"==typeof e._transform;var Yh,Jh=Gh,Zh=class extends _d{constructor(e,{jsonRpcStreamName:t,logger:n=console,maxEventListeners:r=100,rpcMiddleware:i=[]}){if(super({logger:n,maxEventListeners:r,rpcMiddleware:i}),!Jh.duplex(e))throw new Error(Al.errors.invalidDuplexStream());this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this);const o=new Vh;Th.pipeline(e,o,e,this._handleStreamDisconnect.bind(this,"MetaMask")),this._jsonRpcConnection=function(e={}){const t={},n=new Th.Duplex({objectMode:!0,read:()=>{},write:function(n,o,s){let a=null;try{n.id?function(e){const{id:n}=e;if(null===n)return;const r=t[n];r?(delete t[n],Object.assign(r.res,e),setTimeout(r.end)):console.warn(`StreamMiddleware - Unknown response id "${n}"`)}(n):function(n){e?.retryOnMessage&&n.method===e.retryOnMessage&&Object.values(t).forEach((({req:e,retryCount:n=0})=>{if(!e.id)return;if(n>=3)throw new Error(`StreamMiddleware - Retry limit exceeded for request id "${e.id}"`);const r=t[e.id];r&&(r.retryCount=n+1),i(e)})),r.emit("notification",n)}(n)}catch(e){a=e}s(a)}}),r=new Qu;return{events:r,middleware:(e,n,r,o)=>{t[e.id]={req:e,res:n,next:r,end:o},i(e)},stream:n};function i(e){n.push(e)}}({retryOnMessage:"METAMASK_EXTENSION_CONNECT_CAN_RETRY"}),Th.pipeline(this._jsonRpcConnection.stream,o.createStream(t),this._jsonRpcConnection.stream,this._handleStreamDisconnect.bind(this,"MetaMask RpcProvider")),this._rpcEngine.push(this._jsonRpcConnection.middleware),this._jsonRpcConnection.events.on("notification",(t=>{const{method:n,params:r}=t;"metamask_accountsChanged"===n?this._handleAccountsChanged(r):"metamask_unlockStateChanged"===n?this._handleUnlockStateChanged(r):"metamask_chainChanged"===n?this._handleChainChanged(r):nd.includes(n)?this.emit("message",{type:n,data:r}):"METAMASK_STREAM_FAILURE"===n&&e.destroy(new Error(Al.errors.permanentlyDisconnected()))}))}async _initializeStateAsync(){let e;try{e=await this.request({method:"metamask_getProviderState"})}catch(e){this._log.error("MetaMask: Failed to get initial state. Please report this bug.",e)}this._initializeState(e)}_handleStreamDisconnect(e,t){let n=`MetaMask: Lost connection to "${e}".`;t?.stack&&(n+=`\n${t.stack}`),this._log.warn(n),this.listenerCount("error")>0&&this.emit("error",n),this._handleDisconnect(!1,t?t.message:void 0)}_handleChainChanged({chainId:e,networkVersion:t}={}){od(e)&&(e=>Boolean(e)&&"string"==typeof e)(t)?"loading"===t?this._handleDisconnect(!0):super._handleChainChanged({chainId:e}):this._log.error(Al.errors.invalidNetworkParams(),{chainId:e,networkVersion:t})}},Qh=class extends Zh{constructor(e,{jsonRpcStreamName:t="metamask-provider",logger:n=console,maxEventListeners:r=100,shouldSendMetadata:i}={}){if(super(e,{jsonRpcStreamName:t,logger:n,maxEventListeners:r,rpcMiddleware:rd(n)}),this._sentWarnings={chainId:!1,networkVersion:!1,selectedAddress:!1,enable:!1,experimentalMethods:!1,send:!1,events:{close:!1,data:!1,networkChanged:!1,notification:!1}},fd(this,Yh,void 0),this._initializeStateAsync(),pd(this,Yh,null),this.isMetaMask=!0,this._sendSync=this._sendSync.bind(this),this.enable=this.enable.bind(this),this.send=this.send.bind(this),this.sendAsync=this.sendAsync.bind(this),this._warnOfDeprecation=this._warnOfDeprecation.bind(this),this._metamask=this._getExperimentalApi(),this._jsonRpcConnection.events.on("notification",(e=>{const{method:t}=e;nd.includes(t)&&(this.emit("data",e),this.emit("notification",e.params.result))})),i)if("complete"===document.readyState)ad(this._rpcEngine,this._log);else{const e=()=>{ad(this._rpcEngine,this._log),window.removeEventListener("DOMContentLoaded",e)};window.addEventListener("DOMContentLoaded",e)}}get chainId(){return this._sentWarnings.chainId||(this._log.warn(Al.warnings.chainIdDeprecation),this._sentWarnings.chainId=!0),super.chainId}get networkVersion(){return this._sentWarnings.networkVersion||(this._log.warn(Al.warnings.networkVersionDeprecation),this._sentWarnings.networkVersion=!0),hd(this,Yh)}get selectedAddress(){return this._sentWarnings.selectedAddress||(this._log.warn(Al.warnings.selectedAddressDeprecation),this._sentWarnings.selectedAddress=!0),super.selectedAddress}sendAsync(e,t){this._rpcRequest(e,t)}addListener(e,t){return this._warnOfDeprecation(e),super.addListener(e,t)}on(e,t){return this._warnOfDeprecation(e),super.on(e,t)}once(e,t){return this._warnOfDeprecation(e),super.once(e,t)}prependListener(e,t){return this._warnOfDeprecation(e),super.prependListener(e,t)}prependOnceListener(e,t){return this._warnOfDeprecation(e),super.prependOnceListener(e,t)}_handleDisconnect(e,t){super._handleDisconnect(e,t),hd(this,Yh)&&!e&&pd(this,Yh,null)}_warnOfDeprecation(e){!1===this._sentWarnings?.events[e]&&(this._log.warn(Al.warnings.events[e]),this._sentWarnings.events[e]=!0)}async enable(){return this._sentWarnings.enable||(this._log.warn(Al.warnings.enableDeprecation),this._sentWarnings.enable=!0),new Promise(((e,t)=>{try{this._rpcRequest({method:"eth_requestAccounts",params:[]},id(e,t))}catch(e){t(e)}}))}send(e,t){return this._sentWarnings.send||(this._log.warn(Al.warnings.sendDeprecation),this._sentWarnings.send=!0),"string"!=typeof e||t&&!Array.isArray(t)?e&&"object"==typeof e&&"function"==typeof t?this._rpcRequest(e,t):this._sendSync(e):new Promise(((n,r)=>{try{this._rpcRequest({method:e,params:t},id(n,r,!1))}catch(e){r(e)}}))}_sendSync(e){let t;switch(e.method){case"eth_accounts":t=this.selectedAddress?[this.selectedAddress]:[];break;case"eth_coinbase":t=this.selectedAddress??null;break;case"eth_uninstallFilter":this._rpcRequest(e,sd),t=!0;break;case"net_version":t=hd(this,Yh)??null;break;default:throw new Error(Al.errors.unsupportedSync(e.method))}return{id:e.id,jsonrpc:e.jsonrpc,result:t}}_getExperimentalApi(){return new Proxy({isUnlocked:async()=>(this._state.initialized||await new Promise((e=>{this.on("_initialized",(()=>e()))})),this._state.isUnlocked),requestBatch:async e=>{if(!Array.isArray(e))throw Ru({message:"Batch requests must be made with an array of request objects.",data:e});return new Promise(((t,n)=>{this._rpcRequest(e,id(t,n))}))}},{get:(e,t,...n)=>(this._sentWarnings.experimentalMethods||(this._log.warn(Al.warnings.experimentalMethods),this._sentWarnings.experimentalMethods=!0),Reflect.get(e,t,...n))})}_handleChainChanged({chainId:e,networkVersion:t}={}){super._handleChainChanged({chainId:e,networkVersion:t}),this._state.isConnected&&t!==hd(this,Yh)&&(pd(this,Yh,t),this._state.initialized&&this.emit("networkChanged",hd(this,Yh)))}};Yh=new WeakMap;const Xh=He("MM_SDK");let ef;Xh.color="#FFAC1C";var tf={},nf={};Object.defineProperty(nf,"__esModule",{value:!0}),nf.EthereumProviderError=nf.EthereumRpcError=void 0;const rf=hu;class of extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==n&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return rf.default(this.serialize(),sf,2)}}function sf(e,t){if("[Circular]"!==t)return t}nf.EthereumRpcError=of,nf.EthereumProviderError=class extends of{constructor(e,t,n){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}};var af={},cf={};Object.defineProperty(cf,"__esModule",{value:!0}),cf.errorValues=cf.errorCodes=void 0,cf.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}},cf.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serializeError=e.isValidCode=e.getMessageFromCode=e.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const t=cf,n=nf,r=t.errorCodes.rpc.internal,i={code:r,message:o(r)};function o(n,r="Unspecified error message. This is a bug, please report it."){if(Number.isInteger(n)){const r=n.toString();if(l(t.errorValues,r))return t.errorValues[r].message;if(a(n))return e.JSON_RPC_SERVER_ERROR_MESSAGE}return r}function s(e){if(!Number.isInteger(e))return!1;const n=e.toString();return!!t.errorValues[n]||!!a(e)}function a(e){return e>=-32099&&e<=-32e3}function c(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.",e.getMessageFromCode=o,e.isValidCode=s,e.serializeError=function(e,{fallbackError:t=i,shouldIncludeStack:r=!1}={}){var a,u;if(!t||!Number.isInteger(t.code)||"string"!=typeof t.message)throw new Error("Must provide fallback error with integer number code and string message.");if(e instanceof n.EthereumRpcError)return e.serialize();const d={};if(e&&"object"==typeof e&&!Array.isArray(e)&&l(e,"code")&&s(e.code)){const t=e;d.code=t.code,t.message&&"string"==typeof t.message?(d.message=t.message,l(t,"data")&&(d.data=t.data)):(d.message=o(d.code),d.data={originalError:c(e)})}else{d.code=t.code;const n=null===(a=e)||void 0===a?void 0:a.message;d.message=n&&"string"==typeof n?n:t.message,d.data={originalError:c(e)}}const h=null===(u=e)||void 0===u?void 0:u.stack;return r&&e&&h&&"string"==typeof h&&(d.stack=h),d}}(af);var lf={};Object.defineProperty(lf,"__esModule",{value:!0}),lf.ethErrors=void 0;const uf=nf,df=af,hf=cf;function ff(e,t){const[n,r]=gf(t);return new uf.EthereumRpcError(e,n||df.getMessageFromCode(e),r)}function pf(e,t){const[n,r]=gf(t);return new uf.EthereumProviderError(e,n||df.getMessageFromCode(e),r)}function gf(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&"string"!=typeof t)throw new Error("Must specify string message.");return[t||void 0,n]}}return[]}lf.ethErrors={rpc:{parse:e=>ff(hf.errorCodes.rpc.parse,e),invalidRequest:e=>ff(hf.errorCodes.rpc.invalidRequest,e),invalidParams:e=>ff(hf.errorCodes.rpc.invalidParams,e),methodNotFound:e=>ff(hf.errorCodes.rpc.methodNotFound,e),internal:e=>ff(hf.errorCodes.rpc.internal,e),server:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return ff(t,e)},invalidInput:e=>ff(hf.errorCodes.rpc.invalidInput,e),resourceNotFound:e=>ff(hf.errorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>ff(hf.errorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>ff(hf.errorCodes.rpc.transactionRejected,e),methodNotSupported:e=>ff(hf.errorCodes.rpc.methodNotSupported,e),limitExceeded:e=>ff(hf.errorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>pf(hf.errorCodes.provider.userRejectedRequest,e),unauthorized:e=>pf(hf.errorCodes.provider.unauthorized,e),unsupportedMethod:e=>pf(hf.errorCodes.provider.unsupportedMethod,e),disconnected:e=>pf(hf.errorCodes.provider.disconnected,e),chainDisconnected:e=>pf(hf.errorCodes.provider.chainDisconnected,e),custom:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:n,data:r}=e;if(!n||"string"!=typeof n)throw new Error('"message" must be a nonempty string');return new uf.EthereumProviderError(t,n,r)}}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getMessageFromCode=e.serializeError=e.EthereumProviderError=e.EthereumRpcError=e.ethErrors=e.errorCodes=void 0;const t=nf;Object.defineProperty(e,"EthereumRpcError",{enumerable:!0,get:function(){return t.EthereumRpcError}}),Object.defineProperty(e,"EthereumProviderError",{enumerable:!0,get:function(){return t.EthereumProviderError}});const n=af;Object.defineProperty(e,"serializeError",{enumerable:!0,get:function(){return n.serializeError}}),Object.defineProperty(e,"getMessageFromCode",{enumerable:!0,get:function(){return n.getMessageFromCode}});const r=lf;Object.defineProperty(e,"ethErrors",{enumerable:!0,get:function(){return r.ethErrors}});const i=cf;Object.defineProperty(e,"errorCodes",{enumerable:!0,get:function(){return i.errorCodes}})}(tf);var mf={exports:{}};mf.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,n){t.__esModule=!0,t.default=void 0;var r=n(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""},e.getSecondMatch=function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""},e.matchAndReturnConst=function(e,t,n){if(e.test(t))return n},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,n,r){void 0===r&&(r=!1);var i=e.getVersionPrecision(t),o=e.getVersionPrecision(n),s=Math.max(i,o),a=0,c=e.map([t,n],(function(t){var n=s-e.getVersionPrecision(t),r=t+new Array(n+1).join(".0");return e.map(r.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(r&&(a=s-Math.min(i,o)),s-=1;s>=a;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===a)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},e.map=function(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)r.push(t(e[n]));return r},e.find=function(e,t){var n,r;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(n=0,r=e.length;n<r;n+=1){var i=e[n];if(t(i,n))return i}},e.assign=function(e){for(var t,n,r=e,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(o));var a=function(){var e=o[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){r[t]=e[t]}))};for(t=0,n=o.length;t<n;t+=1)a();return e},e.getBrowserAlias=function(e){return r.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return r.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,n){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(91))&&r.__esModule?r:{default:r},o=n(18);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){}var t,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],null&&s(t.prototype,null),n&&s(t,n),e}();t.default=a,e.exports=t.default},91:function(e,t,n){t.__esModule=!0,t.default=void 0;var r=c(n(92)),i=c(n(93)),o=c(n(94)),s=c(n(95)),a=c(n(17));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(r.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,n={},r=0,i={},o=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(i[t]=s,o+=1):"object"==typeof s&&(n[t]=s,r+=1)})),r>0){var s=Object.keys(n),c=a.default.find(s,(function(e){return t.isOS(e)}));if(c){var l=this.satisfies(n[c]);if(void 0!==l)return l}var u=a.default.find(s,(function(e){return t.isPlatform(e)}));if(u){var d=this.satisfies(n[u]);if(void 0!==d)return d}}if(o>0){var h=Object.keys(i),f=a.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(i[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var n=this.getBrowserName().toLowerCase(),r=e.toLowerCase(),i=a.default.getBrowserTypeByAlias(r);return t&&i&&(r=i.toLowerCase()),r===n},t.compareVersion=function(e){var t=[0],n=e,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(r=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(r=!0,n=e.substr(1)),t.indexOf(a.default.compareVersions(i,n,r))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=l,e.exports=t.default},92:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},n=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},n=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},n=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},n=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},n=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},n=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=i.default.getWindowsVersionName(t);return{name:o.OS_MAP.Windows,version:t,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},n=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return n&&(t.version=n),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),n=i.default.getMacOSVersionName(t),r={name:o.OS_MAP.MacOS,version:t};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),n=i.default.getAndroidVersionName(t),r={name:o.OS_MAP.Android,version:t};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:o.OS_MAP.WebOS};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,n){t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:o.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:o.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},n=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},n=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},n=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},n=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];t.default=s,e.exports=t.default}});var yf=mf.exports,vf=Tr(yf);const bf={Initialized:"initialized",DisplayURI:"display_uri",ProviderUpdate:"provider_update",ConnectWithResponse:"connectWithResponse",ConnectionStatus:"connection_status",ServiceStatus:"service_status"};class wf{constructor({shouldSetOnWindow:e,connectionStream:t,shouldSendMetadata:n=!1,shouldShimWeb3:r,sdkInstance:i}){const o=new _f({connectionStream:t,shouldSendMetadata:n,shouldSetOnWindow:e,shouldShimWeb3:r,autoRequestAccounts:!1}),s=new Proxy(o,{deleteProperty:()=>!0});if(this.provider=s,this.sdkInstance=i,e&&"undefined"!=typeof window)try{a=o,window.ethereum=a,window.dispatchEvent(new Event("ethereum#initialized"))}catch(e){Xh("[Ethereum] Unable to set global provider - window.ethereum may be read-only",e)}var a;if(r&&"undefined"!=typeof window)try{!function(e,t=console){let n=!1,r=!1;if(!window.web3){const i="__isMetaMaskShim__";let o={currentProvider:e};Object.defineProperty(o,i,{value:!0,enumerable:!0,configurable:!1,writable:!1}),o=new Proxy(o,{get:(o,s,...a)=>("currentProvider"!==s||n?"currentProvider"===s||s===i||r||(r=!0,t.error("MetaMask no longer injects web3. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3"),e.request({method:"metamask_logWeb3ShimUsage"}).catch((e=>{t.debug("MetaMask: Failed to log web3 shim usage.",e)}))):(n=!0,t.warn("You are accessing the MetaMask window.web3.currentProvider shim. This property is deprecated; use window.ethereum instead. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3")),Reflect.get(o,s,...a)),set:(...e)=>(t.warn("You are accessing the MetaMask window.web3 shim. This object is deprecated; use window.ethereum instead. For details, see: https://docs.metamask.io/guide/provider-migration.html#replacing-window-web3"),Reflect.set(...e))}),Object.defineProperty(window,"web3",{value:o,enumerable:!1,configurable:!0,writable:!0})}}(this.provider)}catch(e){Xh("[Ethereum] Unable to shim web3 - window.web3 may be read-only",e)}this.provider.on("display_uri",(e=>{this.sdkInstance.emit(bf.DisplayURI,e)})),this.provider.on("_initialized",(()=>{const e={chainId:this.provider.getChainId(),isConnected:this.provider.isConnected(),isMetaMask:this.provider.isMetaMask,selectedAddress:this.provider.getSelectedAddress(),networkVersion:this.provider.getNetworkVersion()};this.sdkInstance.emit(bf.Initialized,e),Xh("[Ethereum: constructor()] provider initialized",e)}))}static init(e){var t;return Xh("[Ethereum: init()] Initializing Ethereum service"),this.instance=new wf(e),null===(t=this.instance)||void 0===t?void 0:t.provider}static destroy(){}static getInstance(){var e;if(!(null===(e=this.instance)||void 0===e?void 0:e.provider))throw new Error("Ethereum instance not intiialized - call Ethereum.factory first.");return this.instance}static getProvider(){var e;if(!(null===(e=this.instance)||void 0===e?void 0:e.provider))throw new Error("Ethereum instance not intiialized - call Ethereum.factory first.");return this.instance.provider}}class Ef{constructor({useDeepLink:e,preferredOpenLink:t,debug:n=!1}){this.state={platformType:void 0,useDeeplink:!1,preferredOpenLink:void 0,debug:!1},this.state.platformType=this.getPlatformType(),this.state.useDeeplink=e,this.state.preferredOpenLink=t,this.state.debug=n}openDeeplink(e,t,n){return function(e,t,n,r){const{state:i}=e;Xh(`[PlatfformManager: openDeeplink()] universalLink --\x3e ${t}`),Xh(`[PlatfformManager: openDeeplink()] deepLink --\x3e ${n}`);try{if(i.preferredOpenLink)return void i.preferredOpenLink(i.useDeeplink?n:t,r);if(Xh(`[PlatfformManager: openDeeplink()] open link now useDeepLink=${i.useDeeplink} link=${i.useDeeplink?n:t}`),i.useDeeplink)"undefined"!=typeof window&&(window.location.href=n);else if("undefined"!=typeof document){const e=document.createElement("a");e.href=t,e.target="_self",e.rel="noreferrer noopener",e.click()}}catch(e){console.log("[PlatfformManager: openDeeplink()] can't open link",e)}}(this,e,t,n)}isReactNative(){var e;return this.isNotBrowser()&&"undefined"!=typeof window&&(null===window||void 0===window?void 0:window.navigator)&&"ReactNative"===(null===(e=window.navigator)||void 0===e?void 0:e.product)}isMetaMaskInstalled(){return function(){const e=wf.getProvider()||(null===window||void 0===window?void 0:window.ethereum);return Xh(`[PlatfformManager: isMetaMaskInstalled()] isMetaMask=${null==e?void 0:e.isMetaMask} isConnected=${null==e?void 0:e.isConnected()}`),(null==e?void 0:e.isMetaMask)&&(null==e?void 0:e.isConnected())}()}isDesktopWeb(){return this.isBrowser()&&!this.isMobileWeb()}isMobile(){var e,t;const n=vf.parse(window.navigator.userAgent);return"mobile"===(null===(e=null==n?void 0:n.platform)||void 0===e?void 0:e.type)||"tablet"===(null===(t=null==n?void 0:n.platform)||void 0===t?void 0:t.type)}isSecure(){return this.isReactNative()||this.isMobileWeb()}isMetaMaskMobileWebView(){return"undefined"!=typeof window&&Boolean(window.ReactNativeWebView)&&Boolean(navigator.userAgent.endsWith("MetaMaskMobile"))}isMobileWeb(){return this.state.platformType===cl.MobileWeb}static isNotBrowser(){var e;return"undefined"==typeof window||!(null===window||void 0===window?void 0:window.navigator)||void 0!==p&&"ReactNative"===(null===(e=null==p?void 0:p.navigator)||void 0===e?void 0:e.product)||"ReactNative"===(null===navigator||void 0===navigator?void 0:navigator.product)}isNotBrowser(){return Ef.isNotBrowser()}static isBrowser(){return!this.isNotBrowser()}isBrowser(){return Ef.isBrowser()}isNodeJS(){return this.isNotBrowser()&&!this.isReactNative()}isUseDeepLink(){return this.state.useDeeplink}getPlatformType(){return function(e){const{state:t}=e;return t.platformType?t.platformType:e.isReactNative()?cl.ReactNative:e.isNotBrowser()?cl.NonBrowser:e.isMetaMaskMobileWebView()?cl.MetaMaskMobileWebview:e.isMobile()?cl.MobileWeb:cl.DesktopWeb}(this)}}const Sf=e=>xr(void 0,void 0,void 0,(function*(){if(Ef.isBrowser()){const{StorageManagerWeb:t}=yield Promise.resolve().then((function(){return Rp}));return new t(e)}const t={persistChannelConfig:()=>xr(void 0,void 0,void 0,(function*(){})),getPersistedChannelConfig:()=>xr(void 0,void 0,void 0,(function*(){})),persistAccounts:()=>xr(void 0,void 0,void 0,(function*(){})),getCachedAccounts:()=>xr(void 0,void 0,void 0,(function*(){return[]})),persistChainId:()=>xr(void 0,void 0,void 0,(function*(){})),getCachedChainId:()=>xr(void 0,void 0,void 0,(function*(){})),terminate:()=>xr(void 0,void 0,void 0,(function*(){}))};return Promise.resolve(t)}));class _f extends Qh{constructor({connectionStream:e,shouldSendMetadata:t,autoRequestAccounts:n=!1}){super(e,{logger:console,maxEventListeners:100,shouldSendMetadata:t}),this.state={accounts:null,autoRequestAccounts:!1,providerStateRequested:!1,chainId:"",networkVersion:""},Xh(`[SDKProvider: constructor()] autoRequestAccounts=${n}`),this.state.autoRequestAccounts=n}forceInitializeState(){return xr(this,void 0,void 0,(function*(){return Xh(`[SDKProvider: forceInitializeState()] autoRequestAccounts=${this.state.autoRequestAccounts}`),this._initializeStateAsync()}))}_setConnected(){Xh("[SDKProvider: _setConnected()] Setting connected state"),this._state.isConnected=!0}getState(){return this._state}getSDKProviderState(){return this.state}getSelectedAddress(){var e;const{accounts:t}=this._state;return t&&0!==t.length?(null===(e=t[0])||void 0===e?void 0:e.toLowerCase())||"":(Xh("[SDKProvider: getSelectedAddress] No accounts found"),null)}getChainId(){return this.state.chainId}getNetworkVersion(){return this.state.networkVersion}setSDKProviderState(e){this.state=Object.assign(Object.assign({},this.state),e)}handleAccountsChanged(e,t){return this._handleAccountsChanged(e,t)}handleDisconnect({terminate:e=!1}){!function({terminate:e=!1,instance:t}){const{state:n}=t;Xh(`[SDKProvider: handleDisconnect()] cleaning up provider state terminate=${e}`,t),e&&(t._state.accounts=null,t._state.isUnlocked=!1,t._state.isPermanentlyDisconnected=!0,t._state.initialized=!1),t._handleAccountsChanged([]),t._state.isConnected=!1,t.emit("disconnect",tf.ethErrors.provider.disconnected()),n.providerStateRequested=!1}({terminate:e,instance:this})}_initializeStateAsync(){return xr(this,void 0,void 0,(function*(){return function(e){var t,n;return xr(this,void 0,void 0,(function*(){void 0===e.state&&(e.state={accounts:null,autoRequestAccounts:!1,providerStateRequested:!1,chainId:""});const{state:r}=e;let i;if(r.providerStateRequested)Xh("[SDKProvider: initializeStateAsync()] initialization already in progress");else{let o;r.providerStateRequested=!0;let s=null,a=!1,c=!1;const l=yield Sf({enabled:!0});if(l){const e=yield l.getPersistedChannelConfig({});a=null!==(t=null==e?void 0:e.relayPersistence)&&void 0!==t&&t,o=yield l.getCachedChainId();const n=yield l.getCachedAccounts();n.length>0&&(s=n[0])}if(Xh(`[SDKProvider: initializeStateAsync()] relayPersistence=${a}`,{relayPersistence:a,cachedChainId:o,cachedSelectedAddress:s}),a)if(o&&s)i={accounts:[s],chainId:o,isUnlocked:!1},c=!0;else try{i=yield e.request({method:"metamask_getProviderState"})}catch(t){return e._log.error("MetaMask: Failed to get initial state. Please report this bug.",t),void(r.providerStateRequested=!1)}if(0===(null===(n=null==i?void 0:i.accounts)||void 0===n?void 0:n.length))if(e.getSelectedAddress())i.accounts=[e.getSelectedAddress()];else{Xh("[SDKProvider: initializeStateAsync()] Fetch accounts remotely.");const t=yield e.request({method:"eth_requestAccounts",params:[]});i.accounts=t}e._initializeState(i),r.providerStateRequested=!1,c&&(e._state.isConnected=!0,e.emit("connect",{chainId:null==i?void 0:i.chainId}))}}))}(this)}))}_initializeState(e){return Xh("[SDKProvider: _initializeState()]",e),function(e,t,n){return Xh("[SDKProvider: initializeState()] set state._initialized to false"),e._state.initialized=!1,t(n)}(this,super._initializeState.bind(this),e)}_handleChainChanged({chainId:e,networkVersion:t}={}){this.state.chainId=e,this.state.networkVersion=t,function({instance:e,chainId:t,networkVersion:n,superHandleChainChanged:r}){Xh(`[SDKProvider: handleChainChanged()] chainId=${t} networkVersion=${n}`);let i=n;n||(Xh("[SDKProvider: handleChainChanged()] forced network version to prevent provider error"),i="1"),t!==ef&&(_t.analytics.track("sdk_used_chain",{caip_chain_id:`eip155:${parseInt(null!=t?t:"0x1",16)}`}),ef=t),e._state.isConnected=!0,e.emit("connect",{chainId:t}),r({chainId:t,networkVersion:i})}({instance:this,chainId:e,networkVersion:t,superHandleChainChanged:super._handleChainChanged.bind(this)})}}var Cf,Af={name:"@metamask/sdk",version:"0.33.0",description:"",homepage:"https://github.com/MetaMask/metamask-sdk#readme",bugs:{url:"https://github.com/MetaMask/metamask-sdk/issues"},repository:{type:"git",url:"https://github.com/MetaMask/metamask-sdk",directory:"packages/sdk"},main:"dist/node/cjs/metamask-sdk.js",module:"dist/browser/es/metamask-sdk.js",browser:"dist/browser/es/metamask-sdk.js",unpkg:"dist/browser/umd/metamask-sdk.js","react-native":"dist/react-native/es/metamask-sdk.js",types:"dist/types/src/index.d.ts",sideEffects:!1,files:["/dist"],scripts:{"build:types":"tsc --project tsconfig.build.json --emitDeclarationOnly --outDir dist/types",build:"yarn build:types && rollup -c --bundleConfigAsCjs","build:clean":"yarn clean && yarn build","build:post-tsc":"echo 'N/A'","build:pre-tsc":"echo 'N/A'",typecheck:"tsc --noEmit",clean:"rimraf ./dist",size:"node bundle-size && size-limit",lint:"yarn lint:eslint && yarn lint:misc --check","lint:changelog":"../../scripts/validate-changelog.sh @metamask/sdk","lint:eslint":"eslint . --cache --ext js,ts","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write","lint:misc":"prettier '**/*.json' '**/*.md' '!CHANGELOG.md' --ignore-path ../../.gitignore",prepack:"../../scripts/prepack.sh","publish:preview":"yarn npm publish --tag preview",reset:"yarn clean && rimraf ./node_modules/",test:'jest --testPathIgnorePatterns "/e2e/"',"test:coverage":'jest --coverage --testPathIgnorePatterns "/e2e/"',"test:e2e":'jest --testPathPattern "/e2e/"',"test:ci":'jest --coverage --passWithNoTests --setupFilesAfterEnv ./jest-preload.js --testPathIgnorePatterns "/e2e/"',"test:dev":'jest -c ./jest.config.ts --detectOpenHandles  --testPathIgnorePatterns "/e2e/"',watch:"rollup -c -w",dev:'concurrently "tsc --watch" "rollup -c -w --bundleConfigAsCjs"',"build:dev":"yarn build:types && NODE_ENV=dev rollup -c --bundleConfigAsCjs"},dependencies:{"@babel/runtime":"^7.26.0","@metamask/onboarding":"^1.0.1","@metamask/providers":"16.1.0","@metamask/sdk-analytics":"workspace:*","@metamask/sdk-communication-layer":"workspace:*","@metamask/sdk-install-modal-web":"workspace:*","@paulmillr/qr":"^0.2.1",bowser:"^2.9.0","cross-fetch":"^4.0.0",debug:"^4.3.4",eciesjs:"^0.4.11","eth-rpc-errors":"^4.0.3",eventemitter2:"^6.4.9","obj-multiplex":"^1.0.0",pump:"^3.0.0","readable-stream":"^3.6.2","socket.io-client":"^4.5.1",tslib:"^2.6.0",util:"^0.12.4",uuid:"^8.3.2"},devDependencies:{"@jest/globals":"^29.3.1","@lavamoat/allow-scripts":"^2.3.1","@metamask/auto-changelog":"3.1.0","@metamask/eslint-config":"^6.0.0","@metamask/eslint-config-nodejs":"^6.0.0","@metamask/eslint-config-typescript":"^6.0.0","@react-native-async-storage/async-storage":"^1.19.6","@rollup/plugin-alias":"^5.1.1","@rollup/plugin-commonjs":"^25.0.7","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-replace":"^6.0.1","@rollup/plugin-terser":"^0.4.1","@size-limit/preset-big-lib":"^11.0.2","@types/dom-screen-wake-lock":"^1.0.2","@types/node":"^20.1.3","@types/pump":"^1.1.1","@types/qrcode-terminal":"^0.12.0","@types/uuid":"^10.0.0","@typescript-eslint/eslint-plugin":"^4.26.0","@typescript-eslint/parser":"^4.26.0","browserify-zlib":"^0.2.0",buffer:"^6.0.3",concurrently:"^9.1.2","crypto-browserify":"^3.12.0",eslint:"^7.30.0","eslint-config-prettier":"^8.3.0","eslint-plugin-import":"^2.23.4","eslint-plugin-jest":"^24.4.0","eslint-plugin-jsdoc":"^36.1.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^3.4.0","https-browserify":"^1.0.0",jest:"^29.3.1","jest-environment-jsdom":"^29.3.1",prettier:"^2.3.0",process:"^0.11.10",rimraf:"^4.4.0",rollup:"^4.26.0","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-jscc":"^2.0.0","rollup-plugin-natives":"^0.7.5","rollup-plugin-node-builtins":"^2.1.2","rollup-plugin-polyfill-node":"^0.13.0","rollup-plugin-sizes":"^1.0.6","rollup-plugin-typescript2":"^0.31.2","rollup-plugin-visualizer":"^5.12.0","size-limit":"^11.0.2","stream-browserify":"^3.0.0","stream-http":"^3.2.0","ts-jest":"^29.0.3","ts-node":"^10.9.1",typescript:"^4.3.2",url:"^0.11.0",webpack:"^5.0.0"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},lavamoat:{allowScripts:{"eciesjs>secp256k1":!1,"socket.io-client>engine.io-client>ws>bufferutil":!1,"socket.io-client>engine.io-client>ws>utf-8-validate":!1,"@metamask/sdk-communication-layer>bufferutil":!1,"@metamask/sdk-communication-layer>eciesjs>secp256k1":!1,"@metamask/sdk-communication-layer>utf-8-validate":!1}}};!function(e){e.INPAGE="metamask-inpage",e.CONTENT_SCRIPT="metamask-contentscript",e.PROVIDER="metamask-provider"}(Cf||(Cf={}));const kf="direct",Mf="https://metamask.app.link/connect",Rf="metamask://connect",xf={NAME:"MetaMask",RDNS:["io.metamask","io.metamask.flask"]},Pf=/(?:^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}$)|(?:^0{8}-0{4}-0{4}-0{4}-0{12}$)/u,Tf={METAMASK_GETPROVIDERSTATE:"metamask_getProviderState",METAMASK_CONNECTSIGN:"metamask_connectSign",METAMASK_CONNECTWITH:"metamask_connectWith",METAMASK_OPEN:"metamask_open",METAMASK_BATCH:"metamask_batch",PERSONAL_SIGN:"personal_sign",WALLET_REQUESTPERMISSIONS:"wallet_requestPermissions",WALLET_REVOKEPERMISSIONS:"wallet_revokePermissions",WALLET_GETPERMISSIONS:"wallet_getPermissions",WALLET_WATCHASSET:"wallet_watchAsset",WALLET_ADDETHEREUMCHAIN:"wallet_addEthereumChain",WALLET_SWITCHETHETHEREUMCHAIN:"wallet_switchEthereumChain",ETH_REQUESTACCOUNTS:"eth_requestAccounts",ETH_ACCOUNTS:"eth_accounts",ETH_CHAINID:"eth_chainId",ETH_SENDTRANSACTION:"eth_sendTransaction",ETH_SIGNTYPEDDATA:"eth_signTypedData",ETH_SIGNTYPEDDATA_V3:"eth_signTypedData_v3",ETH_SIGNTYPEDDATA_V4:"eth_signTypedData_v4",ETH_SIGNTRANSACTION:"eth_signTransaction",ETH_SIGN:"eth_sign",PERSONAL_EC_RECOVER:"personal_ecRecover"},If={[Tf.ETH_REQUESTACCOUNTS]:!0,[Tf.ETH_SENDTRANSACTION]:!0,[Tf.ETH_SIGNTRANSACTION]:!0,[Tf.ETH_SIGN]:!0,[Tf.PERSONAL_SIGN]:!0,[Tf.ETH_ACCOUNTS]:!1,[Tf.ETH_CHAINID]:!1,[Tf.PERSONAL_SIGN]:!0,[Tf.ETH_SIGNTYPEDDATA]:!0,[Tf.ETH_SIGNTYPEDDATA_V3]:!0,[Tf.ETH_SIGNTYPEDDATA_V4]:!0,[Tf.WALLET_REQUESTPERMISSIONS]:!0,[Tf.WALLET_GETPERMISSIONS]:!0,[Tf.WALLET_WATCHASSET]:!0,[Tf.WALLET_ADDETHEREUMCHAIN]:!0,[Tf.WALLET_SWITCHETHETHEREUMCHAIN]:!0,[Tf.METAMASK_CONNECTSIGN]:!0,[Tf.METAMASK_CONNECTWITH]:!0,[Tf.PERSONAL_EC_RECOVER]:!0,[Tf.METAMASK_BATCH]:!0,[Tf.METAMASK_OPEN]:!0},Of=Object.keys(If).filter((e=>!0===If[e])).map((e=>e.toLowerCase())),Nf=["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sign"].map((e=>e.toLowerCase())),Lf=".sdk-comm",Bf="providerType",Df=".MMSDK_cached_address",Kf=".MMSDK_cached_chainId",jf="chainChanged",Uf="accountsChanged",$f="disconnect",Ff="connect",Hf="connected";var qf;!function(e){e.TERMINATE="terminate",e.EXTENSION="extension",e.INITIALIZED="initialized"}(qf||(qf={}));const zf="undefined"!=typeof window&&window.localStorage;function Wf(e){var t,n;return xr(this,void 0,void 0,(function*(){Xh("[MetaMaskSDK: connectWithExtensionProvider()] ",e),e.sdkProvider=e.activeProvider,e.activeProvider=window.extension,window.ethereum=window.extension;try{const e=yield null===(t=window.extension)||void 0===t?void 0:t.request({method:"eth_requestAccounts"});Xh(`[MetaMaskSDK: connectWithExtensionProvider()] accounts=${e}`)}catch(e){return void console.warn("[MetaMaskSDK: connectWithExtensionProvider()] can't request accounts error",e)}localStorage.setItem(Bf,"extension"),e.extensionActive=!0,e.emit(bf.ProviderUpdate,qf.EXTENSION),e.options.enableAnalytics&&(null===(n=e.analytics)||void 0===n||n.send({event:Wc.SDK_USE_EXTENSION}))}))}function Vf(e){let t;if(void 0!==R)t=R.from(e,"utf8").toString("base64");else if("function"==typeof btoa)t=btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/gu,((e,t)=>String.fromCharCode(parseInt(t,16)))));else{if("object"!=typeof p||!("Buffer"in p))throw new Error("Unable to base64 encode: No available method.");t=p.Buffer.from(e,"utf8").toString("base64")}return t}class Gf extends Th.Duplex{constructor({name:e,remote:t,deeplinkProtocol:n,platformManager:r}){super({objectMode:!0}),this.state={_name:null,remote:null,deeplinkProtocol:!1,platformManager:null},this.state._name=e,this.state.remote=t,this.state.deeplinkProtocol=n,this.state.platformManager=r,this._onMessage=this._onMessage.bind(this),this.state.remote.on(Fc.MESSAGE,this._onMessage)}_write(e,n,r){return xr(this,void 0,void 0,(function*(){return function(e,n,r,i){var o,s,a,c,l,u,d,h,f,p,g,m,y,v,b,w,E,S,_,C;return xr(this,void 0,void 0,(function*(){const r=null===(o=e.state.remote)||void 0===o?void 0:o.isReady(),A=null===(s=e.state.remote)||void 0===s?void 0:s.isConnected(),k=null===(a=e.state.remote)||void 0===a?void 0:a.isPaused(),M=wf.getProvider(),R=null===(c=e.state.remote)||void 0===c?void 0:c.getChannelId(),x=null===(l=e.state.remote)||void 0===l?void 0:l.isAuthorized(),{deeplinkProtocol:P}=e.state,{method:T,data:I,triggeredInstaller:O}=(e=>{var n,r,i,o;let s;t.isBuffer(e)?(s=e.toJSON(),s._isBuffer=!0):s=e;const a=null===(n=null==s?void 0:s.data)||void 0===n?void 0:n.method;let c=!1;return"object"==typeof(null===(r=null==s?void 0:s.data)||void 0===r?void 0:r.params)&&!0===(null===(o=null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.params)||void 0===o?void 0:o.__triggeredInstaller)&&(c=!0,s.data.params=s.data.params.wrappedParams),{method:a,data:s,triggeredInstaller:c}})(n);if(Xh(`[RCPMS: write()] method='${T}' isRemoteReady=${r} channelId=${R} isSocketConnected=${A} isRemotePaused=${k} providerConnected=${M.isConnected()}`,n),!R)return T!==Tf.METAMASK_GETPROVIDERSTATE&&Xh(`[RCPMS: write()] ${T} --\x3e channelId is undefined`),i(new Error("disconnected"));Xh(`[RCPMS: write()] remote.isPaused()=${null===(u=e.state.remote)||void 0===u?void 0:u.isPaused()} authorized=${x} ready=${r} socketConnected=${A}`,n);const N=null===(d=e.state.platformManager)||void 0===d?void 0:d.isSecure(),L=null!==(f=null===(h=e.state.platformManager)||void 0===h?void 0:h.isMobileWeb())&&void 0!==f&&f,B=null!==(g=null===(p=e.state.remote)||void 0===p?void 0:p.hasDeeplinkProtocol())&&void 0!==g&&g&&L&&x;try{if(!O){const t=JSON.stringify(null==I?void 0:I.data);if(t.length>1e6)return i(new Error(`Message size ${t.length} exceeds maximum allowed size of 1000000 bytes`));null===(m=e.state.remote)||void 0===m||m.sendMessage(null==I?void 0:I.data).then((()=>{Xh(`[RCPMS: _write()] ${T} sent successfully`)})).catch((e=>{Xh("[RCPMS: _write()] error sending message",e)}))}if(!N)return Xh(`[RCPMS: _write()] unsecure platform for method ${T} -- return callback`),i();if(O)return Xh("[RCPMS: _write()] prevent deeplink -- installation completed separately."),i();const t=null!==(b=null===(v=null===(y=e.state.remote)||void 0===y?void 0:y.getKeyInfo())||void 0===v?void 0:v.ecies.public)&&void 0!==b?b:"";let n=encodeURI(`channelId=${R}&pubkey=${t}&comm=socket&t=d&v=2`);if(B){const t=JSON.stringify(null==I?void 0:I.data),r=null===(w=e.state.remote)||void 0===w?void 0:w.encrypt(t);if(!r)return Xh("[RCPMS: _write()] error encrypting message"),i(new Error("RemoteCommunicationPostMessageStream - disconnected"));n+=`&scheme=${P}&rpc=${Vf(r)}`}if(!(null===(E=e.state.platformManager)||void 0===E?void 0:E.isMetaMaskInstalled()))return Xh("[RCPMS: _write()] prevent deeplink until installation is completed."),i();If[T]?(Xh(`[RCPMS: _write()] redirect link for '${T}' socketConnected=${A} connect?${n}`),null===(S=e.state.platformManager)||void 0===S||S.openDeeplink(`${Mf}?${n}`,`${Rf}?${n}`,"_self")):(null===(_=e.state.remote)||void 0===_?void 0:_.isPaused())?(Xh(`[RCPMS: _write()] MM is PAUSED! deeplink with connect! targetMethod=${T}`),null===(C=e.state.platformManager)||void 0===C||C.openDeeplink(`${Mf}?redirect=true&${n}`,`${Rf}?redirect=true&${n}`,"_self")):Xh(`[RCPMS: _write()] method ${T} doesn't need redirect.`)}catch(e){return Xh("[RCPMS: _write()] error sending message",e),i(new Error("RemoteCommunicationPostMessageStream - disconnected"))}return i()}))}(this,e,0,r)}))}_read(){}_onMessage(e){return function(e,n){try{if(Xh("[RCPMS: onMessage()] message",n),!n||"object"!=typeof n)return;if("object"!=typeof(null==n?void 0:n.data))return;if(!(null==n?void 0:n.name))return void Xh("[RCPMS: onMessage()] ignore message without name",n);if((null==n?void 0:n.name)!==Cf.PROVIDER)return void Xh(`[RCPMS: onMessage()] ignore message with wrong name message=${n}`);if(t.isBuffer(n)){const r=t.from(n);e.push(r)}else e.push(n)}catch(e){Xh(`[RCPMS: onMessage()] ignore message error err=${e}`)}}(this,e)}start(){}}let Yf=1;const Jf=e=>new Promise((t=>{setTimeout((()=>{t(!0)}),e)})),Zf=({checkInstallationOnAllCalls:e=!1,communicationLayerPreference:t,injectProvider:n,shouldShimWeb3:r,platformManager:i,installer:o,sdk:s,remoteConnection:a,debug:c})=>xr(void 0,void 0,void 0,(function*(){var l,u;const d=(({name:e,remoteConnection:t})=>{if(!t||!(null==t?void 0:t.getConnector()))throw new Error("Missing remote connection parameter");return new Gf({name:e,remote:null==t?void 0:t.getConnector(),deeplinkProtocol:null==t?void 0:t.state.deeplinkProtocol,platformManager:null==t?void 0:t.getPlatformManager()})})({name:Cf.INPAGE,target:Cf.CONTENT_SCRIPT,platformManager:i,communicationLayerPreference:t,remoteConnection:a}),h=i.getPlatformType(),f=s.options.dappMetadata,p=`Sdk/Javascript SdkVersion/${Af.version} Platform/${h} dApp/${null!==(l=f.url)&&void 0!==l?l:f.name} dAppTitle/${f.name}`;let g=null,m=null;const y=null===(u=s.options.storage)||void 0===u?void 0:u.storageManager;if(y){try{const e=yield y.getCachedAccounts();e.length>0&&(g=e[0])}catch(e){console.error(`[initializeMobileProvider] failed to get cached addresses: ${e}`)}try{const e=yield y.getCachedChainId();e&&(m=e)}catch(e){console.error(`[initializeMobileProvider] failed to parse cached chainId: ${e}`)}}Xh(`[initializeMobileProvider] cachedAccountAddress: ${g}, cachedChainId: ${m}`);const v=!(!n||h===cl.NonBrowser||h===cl.ReactNative),b=wf.init({shouldSetOnWindow:v,connectionStream:d,shouldShimWeb3:r,sdkInstance:s});let w=!1;const E=e=>{w=e},S=()=>w,_=(t,n,r,c)=>xr(void 0,void 0,void 0,(function*(){var l,u,d,h,f,v,b,_,C;const A=wf.getProvider();if(w){A.emit("display_uri",(null==a?void 0:a.state.qrcodeLink)||""),null==a||a.showActiveModal();let e=S();for(;e;){const t=S(),n=null==a?void 0:a.isAuthorized();e=t&&!n,Xh(`[initializeMobileProvider: sendRequest()] waiting for initialization to complete - initializing: ${t} authorized: ${n}`),yield Jf(1e3)}return Xh("[initializeMobileProvider: sendRequest()] initial method completed -- prevent installation and call provider"),r(...n)}const k=i.isMetaMaskInstalled(),M=null==a?void 0:a.isConnected();let R=null,x=null,P=null;if(R=null!==(l=A.getSelectedAddress())&&void 0!==l?l:g,P=A.getChainId()||m,R&&y&&R!==g&&y.persistAccounts([R]).catch((e=>{console.error(`[initializeMobileProvider] failed to persist account: ${e}`)})),P&&(m=P,y&&y.persistChainId(P).catch((e=>{console.error(`[initializeMobileProvider] failed to persist chainId: ${e}`)}))),Xh("[initializeMobileProvider: sendRequest()]",{selectedAddress:R,chainId:P}),c&&Xh(`[initializeMobileProvider: sendRequest()] method=${t} ongoing=${w} selectedAddress=${R} isInstalled=${k} checkInstallationOnAllCalls=${e} socketConnected=${M}`),R&&t.toLowerCase()===Tf.ETH_ACCOUNTS.toLowerCase())return[R];if(P&&t.toLowerCase()===Tf.ETH_CHAINID.toLowerCase())return P;const T=[Tf.ETH_REQUESTACCOUNTS,Tf.WALLET_REQUESTPERMISSIONS,Tf.METAMASK_CONNECTSIGN,Tf.METAMASK_CONNECTWITH],I=!If[t],O=null===(u=s.options.readonlyRPCMap)||void 0===u?void 0:u[P];if(O&&I)try{const e=null===(d=null==n?void 0:n[0])||void 0===d?void 0:d.params,r=yield(({rpcEndpoint:e,method:t,sdkInfo:n,params:r})=>xr(void 0,void 0,void 0,(function*(){const i=JSON.stringify({jsonrpc:"2.0",method:t,params:r,id:(Yf+=1,Yf)}),o={Accept:"application/json","Content-Type":"application/json"};let s;e.includes("infura")&&(o["Metamask-Sdk-Info"]=n);try{s=yield De.exports(e,{method:"POST",headers:o,body:i})}catch(e){throw e instanceof Error?new Error(`Failed to fetch from RPC: ${e.message}`):new Error(`Failed to fetch from RPC: ${e}`)}if(!s.ok)throw new Error(`Server responded with a status of ${s.status}`);return(yield s.json()).result})))({rpcEndpoint:O,sdkInfo:p,method:t,params:e||[]});return c&&Xh(`initializeProvider::ReadOnlyRPCResponse ${r}`),r}catch(e){console.warn(`[initializeMobileProvider: sendRequest()] method=${t} readOnlyRPCRequest failed:`,e)}if((!k||k&&!M)&&t!==Tf.METAMASK_GETPROVIDERSTATE){const c=(null===(h=null==n?void 0:n[0])||void 0===h?void 0:h.params)||[];if(-1!==T.indexOf(t)||e){E(!0);const e=t===Tf.METAMASK_CONNECTWITH,i=`${Date.now()}`;try{yield o.start({wait:!1,connectWith:e?{method:t,id:i,params:c}:void 0}),yield new Promise(((e,t)=>{(null==a?void 0:a.isAuthorized())&&(Xh("[initializeMobileProvider: sendRequest()] already authorized"),e(!0)),null==a||a.getConnector().once(Fc.AUTHORIZED,(()=>{e(!0)})),s.once(Fc.PROVIDER_UPDATE,(e=>{Xh(`[initializeMobileProvider: sendRequest()] PROVIDER_UPDATE --- remote provider request interupted type=${e}`),e===qf.EXTENSION?t(Fc.PROVIDER_UPDATE):t(new Error("Connection Terminated"))}))}))}catch(e){if(qf.EXTENSION===e){if(Xh(`[initializeMobileProvider: sendRequest()] extension provider detect: re-create ${t} on the active provider`),t.toLowerCase()===Tf.METAMASK_CONNECTSIGN.toLowerCase()){const e=yield null===(f=s.getProvider())||void 0===f?void 0:f.request({method:Tf.ETH_REQUESTACCOUNTS,params:[]});if(!e.length)throw new Error("SDK state invalid -- undefined accounts");const t=yield null===(v=s.getProvider())||void 0===v?void 0:v.request({method:Tf.PERSONAL_SIGN,params:[c[0],e[0]]});return s.emit(bf.ConnectWithResponse,t),t}if(t.toLowerCase()===Tf.METAMASK_CONNECTWITH.toLowerCase()){const[e]=c,t=yield(({method:e,sdk:t,params:n})=>xr(void 0,void 0,void 0,(function*(){var r,i,o,s;if(!t.isExtensionActive())throw new Error("SDK state invalid -- extension is not active");Xh("[MetaMaskProvider: extensionConnectWithOverwrite()] Overwriting request method",e,n);const a=yield null===(r=t.getProvider())||void 0===r?void 0:r.request({method:Tf.ETH_REQUESTACCOUNTS,params:[]});if(!a.length)throw new Error("SDK state invalid -- undefined accounts");if((null==e?void 0:e.toLowerCase())===Tf.PERSONAL_SIGN.toLowerCase()){const r={method:e,params:[n[0],a[0]]};return yield null===(i=t.getProvider())||void 0===i?void 0:i.request(r)}if((null==e?void 0:e.toLowerCase())===Tf.ETH_SENDTRANSACTION.toLowerCase()){const r={method:e,params:[Object.assign(Object.assign({},n[0]),{from:a[0]})]};return yield null===(o=t.getProvider())||void 0===o?void 0:o.request(r)}return Nf.includes(e.toLowerCase())?(console.warn(`MetaMaskSDK connectWith method=${e} -- not handled by the extension -- call separately`),a):yield null===(s=t.getProvider())||void 0===s?void 0:s.request({method:e,params:n})})))({method:e.method,sdk:s,params:e.params});return s.emit(bf.ConnectWithResponse,t),t}return Xh(`[initializeMobileProvider: sendRequest()] sending '${t}' on active provider`,c),yield null===(b=s.getProvider())||void 0===b?void 0:b.request({method:t,params:c})}if(e===Fc.REJECTED)throw null==a||a.closeModal(),null===(_=s.getProvider())||void 0===_||_.handleDisconnect({terminate:!1}),Object.assign(new Error("User rejected connection"),{code:4001});throw Xh(`[initializeMobileProvider: sendRequest()] failed to start installer: ${e}`),e}finally{E(!1)}if(t===Tf.ETH_REQUESTACCOUNTS)return x=yield new Promise((e=>{const t=setInterval((()=>{const{accounts:n}=A.getState();n&&(clearInterval(t),e(n))}),100)})),Xh(`[initializeMobileProvider: sendRequest()] selectedAddress: ${R} --- SKIP rpc call`),x;if(t===Tf.METAMASK_CONNECTWITH)try{let e=0;const t=5,n=({resolve:n,reject:r})=>{e+=1;const o=null==a?void 0:a.getConnector().getRPCMethodTracker(),c=null==o?void 0:o[i];return Xh(`TRACKER: update method ${i}`,c),(null==c?void 0:c.result)?(Xh("[initializeMobileProvider: sendRequest()] found result",c.result),s.emit(bf.ConnectWithResponse,c.result),void n(c.result)):(null==c?void 0:c.error)?(Xh("[initializeMobileProvider: sendRequest()] found error",c.error),void r(c.error)):e>=t?(Xh("[initializeMobileProvider: sendRequest()] max message count reached without result"),void r(new Error("Max message count reached without result"))):void Xh("[initializeMobileProvider: sendRequest()] not found yet, need to wait for next update")};let r,o;const c=yield new Promise(((e,t)=>{const s=null==a?void 0:a.getConnector().getRPCMethodTracker();Xh(`TRACKER: method ${i}`,s),(null==s?void 0:s[i].result)?(Xh("[initializeMobileProvider: sendRequest()] found result",null==s?void 0:s[i].result),e(null==s?void 0:s[i].result)):(null==s?void 0:s[i].error)&&(Xh("[initializeMobileProvider: sendRequest()] found error",null==s?void 0:s[i].error),t(null==s?void 0:s[i].error)),o=()=>n({resolve:e,reject:t}),r=null==a?void 0:a.getConnector().on(Fc.RPC_UPDATE,o)}));return o&&(null==r||r.off(Fc.RPC_UPDATE,o)),Xh("TRACKER: result",c),c}catch(e){throw Xh("[initializeMobileProvider: sendRequest()] error:",e),e}return n[0]&&"object"==typeof n[0]&&(n[0].params={__triggeredInstaller:!0,wrappedParams:n[0].params}),r(...n)}if(i.isSecure()&&If[t])return r(...n);if(s.isExtensionActive())return Xh(`[initializeMobileProvider: sendRequest()] EXTENSION active - redirect request '${t}' to it`,n,c),yield null===(C=s.getProvider())||void 0===C?void 0:C.request({method:t,params:c});throw Xh(`[initializeMobileProvider: sendRequest()] method=${t} --- skip --- not connected/installed`),new Error("MetaMask is not connected/installed, please call eth_requestAccounts to connect first.")}try{const e=yield r(...n);if(Xh(`[initializeMobileProvider: sendRequest()] method=${t} rpcResponse`,e),t===Tf.WALLET_REQUESTPERMISSIONS){const t=e.reduce(((e,t)=>{var n;if("eth_accounts"===t.parentCapability){const r=null===(n=t.caveats.find((e=>"restrictReturnedAccounts"===e.type)))||void 0===n?void 0:n.value;r&&e.push(...r)}return e}),[]);Xh("[initializeMobileProvider: sendRequest()] accountsToPersist:",t),t.length>0&&(A.handleAccountsChanged(t,!1),null==y||y.persistAccounts(t))}return e}catch(e){throw console.error("[initializeMobileProvider: sendRequest()] error:",e),e}})),{request:C}=b;b.request=(...e)=>xr(void 0,void 0,void 0,(function*(){return _(null==e?void 0:e[0].method,e,C,c)}));const{send:A}=b;return b.send=(...e)=>xr(void 0,void 0,void 0,(function*(){return _(null==e?void 0:e[0],e,A,c)})),Xh("[initializeMobileProvider: sendRequest()] metamaskStream.start()"),d.start(),b}));class Qf{constructor({serverUrl:e,enabled:t,originatorInfo:n}){this.serverURL=Oc,this.serverURL=e,this.originatorInfo=n,this.enabled=null==t||t}send({event:e,params:t}){if(!this.enabled)return;const n=Object.assign(Object.assign({id:"sdk",event:e,sdkVersion:Af.version},this.originatorInfo),{params:t});Xh(`[Analytics: send()] event: ${e}`,n),Pc(n,this.serverURL).catch((e=>{Xh(`[Analytics: send()] error: ${e}`)}))}}function Xf(e){var t,n,r;const{dappMetadata:i}=e,o=function({url:e,name:t}){var n;const r=Vf(e+t);if(!localStorage)return"";let i=null!==(n=localStorage.getItem(r))&&void 0!==n?n:"";if(!i){i=Vt();try{localStorage.setItem(r,i)}catch(e){return""}}return i}({url:null!==(t=null==i?void 0:i.url)&&void 0!==t?t:"no_url",name:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:"no_name"}),s=null===(r=e.platformManager)||void 0===r?void 0:r.getPlatformType(),a=s===cl.DesktopWeb,c=s===cl.MetaMaskMobileWebview;let l="N/A";return a?l="extension":c&&(l="mobile"),{id:o,from:l}}const ep=(e,t,n)=>{if(jc(e))if(n||t&&"object"==typeof t&&null!==t&&"error"in t){const r=n||(null==t?void 0:t.error);r&&4001===r.code?_t.analytics.track("sdk_action_rejected",{action:e}):_t.analytics.track("sdk_action_failed",{action:e})}else _t.analytics.track("sdk_action_succeeded",{action:e})},tp=({provider:e,sdkInstance:t})=>{if("state"in e)throw new Error("INVALID EXTENSION PROVIDER");return new Proxy(e,{get:(n,r)=>"request"===r?function(e){var r,i;return xr(this,void 0,void 0,(function*(){Xh("[wrapExtensionProvider()] Overwriting request method",e);const{method:o,params:s}=e,a=Of.includes(o.toLowerCase()),{id:c,from:l}=Xf(t);if(a&&(null===(r=t.analytics)||void 0===r||r.send({event:Wc.SDK_RPC_REQUEST,params:{method:o,from:l,id:c}})),jc(o)&&_t.analytics.track("sdk_action_requested",{action:o}),o===Tf.METAMASK_BATCH&&Array.isArray(s))return(({target:e,args:t,trackEvent:n,sdkInstance:r})=>xr(void 0,void 0,void 0,(function*(){var i,o;if("metamask_batch"!==t.method)throw new Error("Invalid usage");const s=[],a=null!==(i=null==t?void 0:t.params)&&void 0!==i?i:[];for(const t of a){const n=yield null==e?void 0:e.request({method:t.method,params:t.params});s.push(n)}const{id:c,from:l}=Xf(r);n&&(null===(o=r.analytics)||void 0===o||o.send({event:Wc.SDK_RPC_REQUEST_DONE,params:{method:t.method,from:l,id:c}}));for(const e of s)ep(t.method,e,null);return s})))({target:n,args:e,trackEvent:a,sdkInstance:t});if(o.toLowerCase()===Tf.METAMASK_CONNECTSIGN.toLowerCase()&&Array.isArray(s))return(({target:e,params:t})=>xr(void 0,void 0,void 0,(function*(){let n,r=null;try{const r=yield e.request({method:Tf.ETH_REQUESTACCOUNTS,params:[]});if(!r.length)throw new Error("SDK state invalid -- undefined accounts");return n=yield e.request({method:Tf.PERSONAL_SIGN,params:[t[0],r[0]]}),n}catch(e){throw r=e,e}finally{ep(Tf.PERSONAL_SIGN,n,r)}})))({target:n,params:s});if(o.toLowerCase()===Tf.METAMASK_CONNECTWITH.toLowerCase()&&Array.isArray(s))return(({target:e,params:t})=>xr(void 0,void 0,void 0,(function*(){const[n]=t,r=n.method,i=n.params;let o,s=null;try{const t=yield e.request({method:Tf.ETH_REQUESTACCOUNTS,params:[]});if(!Array.isArray(t)||!t.length)throw new Error("SDK state invalid -- undefined accounts");return(null==r?void 0:r.toLowerCase())===Tf.PERSONAL_SIGN.toLowerCase()?(o=yield e.request({method:r,params:[i[0],t[0]]}),o):(null==r?void 0:r.toLowerCase())===Tf.ETH_SENDTRANSACTION.toLowerCase()?(o=yield e.request({method:r,params:[Object.assign(Object.assign({},i[0]),{from:t[0]})]}),o):Nf.includes(r.toLowerCase())?(console.warn(`MetaMaskSDK connectWith method=${r} -- not handled by the extension -- call separately`),o=t,o):(o=yield e.request({method:r,params:i}),o)}catch(e){throw s=e,e}finally{ep(r,o,s)}})))({target:n,params:s});let u,d=null;try{return u=yield n.request(e),u}catch(e){throw d=e,e}finally{a&&(null===(i=t.analytics)||void 0===i||i.send({event:Wc.SDK_RPC_REQUEST_DONE,params:{method:o,from:l,id:c}})),ep(o,u,d)}}))}:"getChainId"===r?function(){return e.chainId}:"getNetworkVersion"===r?function(){return e.networkVersion}:"getSelectedAddress"===r?function(){return e.selectedAddress}:"isConnected"===r?function(){return e._state.isConnected}:n[r]})};var np;!function(e){e.Announce="eip6963:announceProvider",e.Request="eip6963:requestProvider"}(np||(np={}));var rp,ip=(rp=yf)&&"object"==typeof rp&&"default"in rp?rp.default:rp;var op="INSTALLED",sp="NOT_INSTALLED",ap="REGISTERED",cp="REGISTERING",lp="RELOADING",up={CHROME:"https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn",FIREFOX:"https://addons.mozilla.org/firefox/addon/ether-metamask/",DEFAULT:"https://metamask.io"},dp="REGISTRATION_IN_PROGRESS",hp="FORWARDER_ID",fp=function(){function e(t){var n=void 0===t?{}:t,r=n.forwarderOrigin,i=void 0===r?"https://fwd.metamask.io":r,o=n.forwarderMode,s=void 0===o?e.FORWARDER_MODE.INJECT:o;this.forwarderOrigin=i,this.forwarderMode=s,this.state=e.isMetaMaskInstalled()?op:sp;var a=e._detectBrowser();this.downloadUrl=a?up[a]:up.DEFAULT,this._onMessage=this._onMessage.bind(this),this._onMessageFromForwarder=this._onMessageFromForwarder.bind(this),this._openForwarder=this._openForwarder.bind(this),this._openDownloadPage=this._openDownloadPage.bind(this),this.startOnboarding=this.startOnboarding.bind(this),this.stopOnboarding=this.stopOnboarding.bind(this),window.addEventListener("message",this._onMessage),s===e.FORWARDER_MODE.INJECT&&"true"===sessionStorage.getItem(dp)&&e._injectForwarder(this.forwarderOrigin)}return e.prototype._onMessage=function(e){if(e.origin===this.forwarderOrigin)return"metamask:reload"===e.data.type?this._onMessageFromForwarder(e):void console.debug("Unknown message from '"+e.origin+"' with data "+JSON.stringify(e.data))},e.prototype._onMessageUnknownStateError=function(e){throw new Error("Unknown state: '"+e+"'")},e.prototype._onMessageFromForwarder=function(t){return function(e,t,n,r){return new(n||(n=Promise))((function(t,i){function o(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(o,s)}a((r=r.apply(e,[])).next())}))}(this,0,void 0,(function(){return function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(n){switch(n.label){case 0:switch(this.state){case lp:return[3,1];case sp:return[3,2];case op:return[3,3];case cp:return[3,5];case ap:return[3,6]}return[3,7];case 1:return console.debug("Ignoring message while reloading"),[3,8];case 2:return console.debug("Reloading now to register with MetaMask"),this.state=lp,location.reload(),[3,8];case 3:return console.debug("Registering with MetaMask"),this.state=cp,[4,e._register()];case 4:return n.sent(),this.state=ap,t.source.postMessage({type:"metamask:registrationCompleted"},t.origin),this.stopOnboarding(),[3,8];case 5:return console.debug("Already registering - ignoring reload message"),[3,8];case 6:return console.debug("Already registered - ignoring reload message"),[3,8];case 7:this._onMessageUnknownStateError(this.state),n.label=8;case 8:return[2]}}))}))},e.prototype.startOnboarding=function(){sessionStorage.setItem(dp,"true"),this._openDownloadPage(),this._openForwarder()},e.prototype.stopOnboarding=function(){"true"===sessionStorage.getItem(dp)&&(this.forwarderMode===e.FORWARDER_MODE.INJECT&&(console.debug("Removing forwarder"),e._removeForwarder()),sessionStorage.setItem(dp,"false"))},e.prototype._openForwarder=function(){this.forwarderMode===e.FORWARDER_MODE.OPEN_TAB?window.open(this.forwarderOrigin,"_blank"):e._injectForwarder(this.forwarderOrigin)},e.prototype._openDownloadPage=function(){window.open(this.downloadUrl,"_blank")},e.isMetaMaskInstalled=function(){return Boolean(window.ethereum&&window.ethereum.isMetaMask)},e._register=function(){return window.ethereum.request({method:"wallet_registerOnboarding"})},e._injectForwarder=function(e){var t=document.body,n=document.createElement("iframe");n.setAttribute("height","0"),n.setAttribute("width","0"),n.setAttribute("style","display: none;"),n.setAttribute("src",e),n.setAttribute("id",hp),t.insertBefore(n,t.children[0])},e._removeForwarder=function(){var e;null===(e=document.getElementById(hp))||void 0===e||e.remove()},e._detectBrowser=function(){var e=ip.parse(window.navigator.userAgent);return"Firefox"===e.browser.name?"FIREFOX":["Chrome","Chromium"].includes(e.browser.name||"")?"CHROME":null},e.FORWARDER_MODE={INJECT:"INJECT",OPEN_TAB:"OPEN_TAB"},e}(),pp=Tr(fp);class gp{constructor({remote:e,preferDesktop:t,platformManager:n,debug:r=!1}){this.state={isInstalling:!1,hasInstalled:!1,resendRequest:null,preferDesktop:!1,platformManager:null,remote:null,debug:!1,connectWith:void 0},this.state.remote=e,this.state.preferDesktop=t,this.state.platformManager=n,this.state.debug=r}startDesktopOnboarding(){return function(){return xr(this,void 0,void 0,(function*(){Xh("[MetamaskInstaller: startDesktopOnboarding() starting desktop onboarding"),window.ethereum&&(window.ethereum=void 0),(new pp).startOnboarding()}))}()}redirectToProperInstall(){return xr(this,void 0,void 0,(function*(){return function(e){var t,n;return xr(this,void 0,void 0,(function*(){const{state:r}=e,i=null===(t=r.platformManager)||void 0===t?void 0:t.getPlatformType();if(Xh(`[MetamaskInstaller: redirectToProperInstall()] platform=${i}`),i===cl.MetaMaskMobileWebview)return!1;r.isInstalling=!0;try{yield null===(n=r.remote)||void 0===n?void 0:n.startConnection({connectWith:r.connectWith}),r.isInstalling=!1,r.hasInstalled=!0}catch(e){throw r.isInstalling=!1,e}return!0}))}(this)}))}checkInstallation(){return xr(this,void 0,void 0,(function*(){return function(e){var t;return xr(this,void 0,void 0,(function*(){const{state:n}=e,r=null===(t=n.platformManager)||void 0===t?void 0:t.isMetaMaskInstalled();return Xh(`[MetamaskInstaller: checkInstallation()] isInstalled=${r}`),!!r||(yield e.redirectToProperInstall())}))}(this)}))}start({wait:e=!1,connectWith:t}){return xr(this,void 0,void 0,(function*(){this.state.connectWith=t,Xh(`[MetaMaskInstaller: start()] wait=${e}`,t),yield function(e,{wait:t=!1}){return xr(this,void 0,void 0,(function*(){return Xh(`[MetamaskInstaller: startInstaller()] wait=${t}`),t&&(yield Jf(1e3)),yield e.checkInstallation()}))}(this,{wait:e})}))}}const mp=({link:e})=>(Xh(`[UI: InstallModal-nonweb()] INSTALL MODAL link=${e}`),{unmount:()=>{}}),yp=()=>(Xh("[UI: pendingModal-nodejs: PendingModal()] Please open the MetaMask wallet app and confirm the connection. Thank you!"),{unmount:()=>!1,updateOTPValue:e=>{""!==e&&Xh(`[UI: pendingModal-nodejs: PendingModal()] Choose the following value on your metamask mobile wallet: ${e}`)},mount:()=>!1});function vp(e,t){var n,r,i,o;e.connector||(Xh("[RemoteConnection: initializeConnector()] initialize connector"),e.connector=new Sl({anonId:t.anonId,platformType:t.platformManager.getPlatformType(),communicationLayerPreference:t.communicationLayerPreference,transports:t.transports,dappMetadata:Object.assign(Object.assign({},t.dappMetadata),{source:t._source}),analytics:t.enableAnalytics,communicationServerUrl:t.communicationServerUrl,sdkVersion:Af.version,context:"dapp",ecies:t.ecies,storage:t.storage,logging:t.logging}),t.timer&&(Xh("[RemoteConnection: initializeConnector()] reset background timer",t.timer),null===(r=null===(n=t.timer)||void 0===n?void 0:n.stopBackgroundTimer)||void 0===r||r.call(n),null===(o=null===(i=t.timer)||void 0===i?void 0:i.runBackgroundTimer)||void 0===o||o.call(i,(()=>!1),1e4)))}function bp(e){e.listeners.forEach((({event:t,handler:n})=>{var r;null===(r=e.connector)||void 0===r||r.off(t,n)})),e.listeners=[]}function wp(e,t){function n(t,n){var r;null===(r=e.connector)||void 0===r||r.on(t,n),e.listeners.push({event:t,handler:n})}e.connector&&(bp(e),n(Fc.WALLET_INIT,(({accounts:e,chainId:t})=>xr(this,void 0,void 0,(function*(){Xh(`[RemoteConnection: setupListeners() => EventType.WALLET_INIT] 'wallet_init' accounts=${e} chainId=${t}`);const n=wf.getProvider();n._setConnected();const r={accounts:e,chainId:t,isUnlocked:!1};n._initializeState(r),n.emit("chainChanged",t),n.emit("accountsChanged",e)})))),n(Fc.AUTHORIZED,(()=>xr(this,void 0,void 0,(function*(){var t,n,r,i;try{Xh("[RemoteConnection: setupListeners() => EventType.AUTHORIZED] 'authorized' closing modals",e.pendingModal,e.installModal);const o=wf.getProvider();o._setConnected(),null===(n=null===(t=e.pendingModal)||void 0===t?void 0:t.unmount)||void 0===n||n.call(t),null===(i=null===(r=e.installModal)||void 0===r?void 0:r.unmount)||void 0===i||i.call(r,!1),e.otpAnswer=void 0,e.authorized=!0,Xh("[RemoteConnection: setupListeners() => EventType.AUTHORIZED] 'authorized' provider.state",o.getState()),yield o.forceInitializeState()}catch(e){}})))),n(Fc.TERMINATE,(()=>{var t,n,r,i,o;null===(n=null===(t=e.pendingModal)||void 0===t?void 0:t.unmount)||void 0===n||n.call(t),null===(i=null===(r=e.installModal)||void 0===r?void 0:r.unmount)||void 0===i||i.call(r,!0),e.pendingModal=void 0,e.installModal=void 0,e.otpAnswer=void 0,null===(o=e.connector)||void 0===o||o.disconnect({terminate:!0}),e.authorized=!1,wf.getProvider().handleDisconnect({terminate:!0}),bp(e),Xh("[RemoteConnection: setupListeners()] All listeners cleaned up")})))}function Ep(e,t,{initialCheck:n,connectWith:r}={}){var i,o,s,a,c,l,u,d,h,f,p,g,m,y,v,b,w,E,S;return xr(this,void 0,void 0,(function*(){try{if(vp(e,t),!e.connector)throw new Error("no connector defined");wp(e);const _=wf.getProvider();e.authorized=!1,_.emit("connecting");const C=yield null===(i=e.connector)||void 0===i?void 0:i.originatorSessionConnect();Xh(`[RemoteConnection: startConnection()] after originatorSessionConnect initialCheck=${n}`,C);let A=null!==(o=null==C?void 0:C.channelId)&&void 0!==o?o:"",k=null!==(a=null===(s=e.connector.getKeyInfo())||void 0===s?void 0:s.ecies.public)&&void 0!==a?a:"",M=null!==(l=null===(c=e.connector.getKeyInfo())||void 0===c?void 0:c.ecies.private)&&void 0!==l?l:"";if(n&&!C)return Promise.resolve();if(!C&&!n){const t=yield e.connector.generateChannelIdConnect();A=null!==(u=t.channelId)&&void 0!==u?u:"",k=null!==(d=t.pubKey)&&void 0!==d?d:"",M=null!==(h=t.privKey)&&void 0!==h?h:"";const n=Date.now();null===(f=e.connector.state.storageManager)||void 0===f||f.persistChannelConfig({channelId:A,localKey:M,lastActive:n,validUntil:n+Lc})}if(n&&(null==C?void 0:C.channelId))return(null===(p=e.connector)||void 0===p?void 0:p.isConnected())||(Xh(`[RemoteConnection: startConnection()] reconnecting to channel initialCheck=${n}`,C),yield null===(g=e.connector)||void 0===g?void 0:g.connectToChannel({channelId:A})),Promise.resolve();C&&!(null===(m=e.connector)||void 0===m?void 0:m.isConnected())&&(Xh("[RemoteConnection: startConnection()] reconnecting to channel",C),yield null===(y=e.connector)||void 0===y?void 0:y.connectToChannel({channelId:A}));const R=(null===(v=e.platformManager)||void 0===v?void 0:v.isSecure())?"":"&t=q",x=Af.version,{iconUrl:P,name:T,url:I,scheme:O}=t.dappMetadata||{},N=null===(b=e.platformManager)||void 0===b?void 0:b.getPlatformType();let L="N/A";"undefined"!=typeof window&&window.location&&window.location.hostname?L=window.location.hostname:void 0!==T?L=T:void 0!==I&&(L=I);const B={url:null!=I?I:"",title:null!=T?T:"",icon:P,scheme:null!=O?O:"",apiVersion:x,dappId:L||I||"N/A",anonId:t.anonId,platform:null!=N?N:"",source:null!==(w=t._source)&&void 0!==w?w:""},D=Vf(JSON.stringify(B));let K=`channelId=${A}&v=2&comm=${null!==(E=e.communicationLayerPreference)&&void 0!==E?E:""}&pubkey=${k}${R}&originatorInfo=${D}`;if(r){K+=`&rpc=${Vf(JSON.stringify(r))}`;const t=e.connector.getRPCMethodTracker();t&&(t[`${r.id}`]=Object.assign(Object.assign({},r),{id:`${r.id}`,timestamp:Date.now()}))}const j=encodeURI(K),U=`${e.useDeeplink?Rf:Mf}?${K}`;if(e.qrcodeLink=U,e.developerMode&&Xh(`[RemoteConnection: startConnection()] qrcodeLink=${j}`),_.emit("display_uri",U),_t.analytics.track("sdk_connection_initiated",{transport_type:"websocket"}),null===(S=e.platformManager)||void 0===S?void 0:S.isSecure()){const t=setTimeout((()=>{_t.analytics.track("sdk_connection_failed",{transport_type:"websocket"})}),6e4);return yield function(e,t){var n,r;return xr(this,void 0,void 0,(function*(){const i=`${Mf}?${t}`,o=`${Rf}?${t}`;null===(r=null===(n=e.platformManager)||void 0===n?void 0:n.openDeeplink)||void 0===r||r.call(n,i,o,"_self")}))}(e,j),new Promise(((n,r)=>{var i,o,s;if(null===(i=e.connector)||void 0===i?void 0:i.isAuthorized())return clearTimeout(t),void n();null===(o=e.connector)||void 0===o||o.once(Fc.AUTHORIZED,(()=>{clearTimeout(t),n()})),null===(s=e.connector)||void 0===s||s.once(Fc.REJECTED,(()=>{clearTimeout(t),r(Fc.REJECTED)}))}))}return function(e,t,n){return xr(this,void 0,void 0,(function*(){const r=setTimeout((()=>{_t.analytics.track("sdk_connection_failed",{transport_type:"websocket"})}),6e4);return new Promise(((i,o)=>{if(!e.connector)return void o(new Error("No connector available"));Xh("[RemoteConnection: connectWithModalInstaller()]",{state:e,options:t,linkParams:n});const s=`${e.useDeeplink?Rf:Mf}?${n}`;!function(e,t,n){var r,i,o,s;e.installModal=null===(i=(r=t.modals).install)||void 0===i?void 0:i.call(r,{link:n,preferDesktop:e.preferDesktop,installer:t.getMetaMaskInstaller(),terminate:()=>{Xh("[RemoteConnection: showInstallModal() => terminate()] terminate connection"),t.sdk.terminate().catch((e=>{console.warn("[MMSDK] failed to terminate connection",e)}))},debug:e.developerMode,connectWithExtension:()=>{var e;return null===(e=t.connectWithExtensionProvider)||void 0===e||e.call(t),!1},onAnalyticsEvent:({event:n,params:r})=>{var i,o,s;const a=Object.assign(Object.assign({},r),{sdkVersion:t.sdk.getVersion(),dappId:null===(i=t.dappMetadata)||void 0===i?void 0:i.name,source:t._source,url:null===(o=t.dappMetadata)||void 0===o?void 0:o.url});null===(s=e.analytics)||void 0===s||s.send({event:n,params:a})}}),null===(s=null===(o=e.installModal)||void 0===o?void 0:o.mount)||void 0===s||s.call(o,n)}(e,t,s),t.sdk.once(Fc.PROVIDER_UPDATE,(e=>xr(this,void 0,void 0,(function*(){if(Xh("[RemoteConnection: connectWithModalInstaller()] once provider_update -- resolving startConnection promise"),e===qf.TERMINATE){const e={code:4001,message:"User rejected the request."};return clearTimeout(r),void o(e)}o(e)})))),e.connector.once(Fc.AUTHORIZED,(()=>{clearTimeout(r),i()})),e.connector.once(Fc.REJECTED,(()=>{clearTimeout(r),o(Fc.REJECTED)})),e.connector.once(Fc.CLIENTS_READY,(()=>xr(this,void 0,void 0,(function*(){Xh("[RemoteConnection: connectWithModalInstaller()] once clients_ready -- resolving startConnection promise"),clearTimeout(r),i()}))))}))}))}(e,t,j)}catch(e){throw console.error("[startConnection] error",e),e}}))}class Sp{constructor(e){var t,n,r;this.state={connector:void 0,qrcodeLink:void 0,analytics:void 0,developerMode:!1,authorized:!1,reconnection:!1,preferDesktop:!1,deeplinkProtocol:!1,listeners:[],communicationLayerPreference:void 0,platformManager:void 0,pendingModal:void 0,installModal:void 0,otpAnswer:void 0},this.options=e;const i=!0===(null===(t=e.logging)||void 0===t?void 0:t.developerMode)||!0===(null===(n=e.logging)||void 0===n?void 0:n.sdk);this.state.developerMode=i,this.state.analytics=e.analytics,this.state.preferDesktop=null!==(r=e.preferDesktop)&&void 0!==r&&r,this.state.useDeeplink=e.sdk.options.useDeeplink,this.state.communicationLayerPreference=e.communicationLayerPreference,this.state.platformManager=e.platformManager,e.modals.install||(e.modals.install=mp),e.modals.otp||(e.modals.otp=yp)}startConnection(e){return xr(this,void 0,void 0,(function*(){return Ep(this.state,this.options,e)}))}initRemoteCommunication({sdkInstance:e}){var t,n,r;return xr(this,void 0,void 0,(function*(){const i=yield null===(n=null===(t=e.options.storage)||void 0===t?void 0:t.storageManager)||void 0===n?void 0:n.getPersistedChannelConfig();if(!this.options.ecies){const e={privateKey:null==i?void 0:i.localKey};this.options.ecies=e}vp(this.state,this.options),yield null===(r=this.getConnector())||void 0===r?void 0:r.initFromDappStorage(),wp(this.state,this.options)}))}showActiveModal(){return function(e){var t,n,r,i;e.authorized?Xh("[RemoteConnection: showActiveModal()] already authorized"):e.pendingModal?null===(n=(t=e.pendingModal).mount)||void 0===n||n.call(t):e.installModal&&(null===(i=(r=e.installModal).mount)||void 0===i||i.call(r,e.qrcodeLink||""))}(this.state)}closeModal(){var e,t,n,r;null===(t=null===(e=this.state.pendingModal)||void 0===e?void 0:e.unmount)||void 0===t||t.call(e),null===(r=null===(n=this.state.installModal)||void 0===n?void 0:n.unmount)||void 0===r||r.call(n,!1)}getUniversalLink(){if(!this.state.qrcodeLink)throw new Error("connection not started. run startConnection() first.");return this.state.qrcodeLink}getChannelConfig(){var e;return null===(e=this.state.connector)||void 0===e?void 0:e.getChannelConfig()}getKeyInfo(){var e;return null===(e=this.state.connector)||void 0===e?void 0:e.getKeyInfo()}getConnector(){if(!this.state.connector)throw new Error("invalid remote connector");return this.state.connector}getPlatformManager(){if(!this.state.platformManager)throw new Error("PlatformManager not available");return this.state.platformManager}isConnected(){var e;return(null===(e=this.state.connector)||void 0===e?void 0:e.isReady())||!1}isAuthorized(){var e;return(null===(e=this.state.connector)||void 0===e?void 0:e.isAuthorized())||!1}isPaused(){var e;return null===(e=this.state.connector)||void 0===e?void 0:e.isPaused()}disconnect(e){var t,n,r;Xh("[RemoteConnection: disconnect()]",e),(null==e?void 0:e.terminate)&&(wf.getProvider().handleDisconnect({terminate:!0}),null===(n=null===(t=this.state.pendingModal)||void 0===t?void 0:t.unmount)||void 0===n||n.call(t),this.state.otpAnswer=void 0),null===(r=this.state.connector)||void 0===r||r.disconnect(e),function(e){Xh("[RemoteConnection: cleanupConnector()] cleaning up connector"),e.connector&&(bp(e),e.connector.disconnect({terminate:!0}).catch((e=>{Xh("[RemoteConnection: cleanupConnector()] error disconnecting connector",e)})))}(this.state)}}function _p(e){var t,n,r,i,o,s,a,c,l,u,d;return xr(this,void 0,void 0,(function*(){const{options:h}=e;if(h.logging=null!==(t=h.logging)&&void 0!==t?t:{},h.communicationLayerPreference=null!==(n=h.communicationLayerPreference)&&void 0!==n?n:al.SOCKET,void 0!==h.enableDebug&&(He.enable("MM_SDK"),console.warn("enableDebug is removed. Please use enableAnalytics instead.")),h.enableAnalytics=null===(r=h.enableAnalytics)||void 0===r||r,h.injectProvider=null===(i=h.injectProvider)||void 0===i||i,h.shouldShimWeb3=null===(o=h.shouldShimWeb3)||void 0===o||o,h.extensionOnly=null===(s=h.extensionOnly)||void 0===s||s,h.useDeeplink=null===(a=h.useDeeplink)||void 0===a||a,h.storage=null!==(c=h.storage)&&void 0!==c?c:{enabled:!0},h.headless){He("[MetaMaskSDK: performSDKInitialization()] headless mode enabled");const e=()=>{},t={install:()=>({mount:e,unmount:e})},n={installer:e};h.modals=t,h.ui=n}const f=!0===(null===(l=h.logging)||void 0===l?void 0:l.developerMode);e.debug=(null===(u=h.logging)||void 0===u?void 0:u.sdk)||f,Xh("[MetaMaskSDK: performSDKInitialization()] options",e.options);const p=Object.assign({},h.logging);f&&(p.sdk=!0,p.eciesLayer=!0,p.keyExchangeLayer=!0,p.remoteLayer=!0,p.serviceLayer=!0,p.plaintext=!0),yield function(e){var t;return xr(this,void 0,void 0,(function*(){const{options:n}=e;e.platformManager=new Ef({useDeepLink:null!==(t=n.useDeeplink)&&void 0!==t&&t,preferredOpenLink:n.openDeeplink,debug:e.debug})}))}(e),yield function(e){var t,n,r,i,o;return xr(this,void 0,void 0,(function*(){const{options:s}=e,a=null===(t=e.platformManager)||void 0===t?void 0:t.getPlatformType();e.analytics=new Qf({serverUrl:null!==(n=s.communicationServerUrl)&&void 0!==n?n:Oc,enabled:s.enableAnalytics,originatorInfo:{url:null!==(r=s.dappMetadata.url)&&void 0!==r?r:"",title:null!==(i=s.dappMetadata.name)&&void 0!==i?i:"",dappId:e.getDappId(),platform:null!=a?a:"",source:null!==(o=s._source)&&void 0!==o?o:"",anonId:""}})}))}(e),yield function(e){var t,n,r;return xr(this,void 0,void 0,(function*(){if(!e.options.enableAnalytics)return;if(!(null===(t=e.platformManager)||void 0===t?void 0:t.isBrowser())&&!(null===(n=e.platformManager)||void 0===n?void 0:n.isReactNative()))return;const i=e.getVersion(),o=e.getDappId(),s=yield e.getAnonId(),a=null===(r=e.platformManager)||void 0===r?void 0:r.getPlatformType(),c=e.options._source;_t.analytics.setGlobalProperty("sdk_version",i),_t.analytics.setGlobalProperty("dapp_id",o),_t.analytics.setGlobalProperty("anon_id",s),_t.analytics.setGlobalProperty("platform",a),_t.analytics.setGlobalProperty("integration_type",c),_t.analytics.enable(),_t.analytics.track("sdk_initialized",{})}))}(e),yield function(e){var t;return xr(this,void 0,void 0,(function*(){const{options:n}=e;!0!==(null===(t=n.storage)||void 0===t?void 0:t.enabled)||n.storage.storageManager||(n.storage.storageManager=yield Sf(n.storage))}))}(e),yield function(e){return xr(this,void 0,void 0,(function*(){const{options:t}=e,n=/^(http|https):\/\/[^\s]*$/;if(t.dappMetadata){t.dappMetadata.iconUrl&&!n.test(t.dappMetadata.iconUrl)&&(console.warn("Invalid dappMetadata.iconUrl: URL must start with http:// or https://"),t.dappMetadata.iconUrl=void 0),t.dappMetadata.base64Icon&&t.dappMetadata.base64Icon.length>163400&&(console.warn("Invalid dappMetadata.base64Icon: Base64-encoded icon string length must be less than 163400 characters"),t.dappMetadata.base64Icon=void 0),t.dappMetadata.url&&!n.test(t.dappMetadata.url)&&console.warn("Invalid dappMetadata.url: URL must start with http:// or https://");const e=(()=>{if("undefined"==typeof document)return;let e;const t=document.getElementsByTagName("link");for(let n=0;n<t.length;n++)"icon"!==t[n].getAttribute("rel")&&"shortcut icon"!==t[n].getAttribute("rel")||(e=t[n].getAttribute("href"));return e})();if(e&&!t.dappMetadata.iconUrl&&!t.dappMetadata.base64Icon){const n=`${window.location.protocol}//${window.location.host}${e}`;t.dappMetadata.iconUrl=n}}e.dappMetadata=t.dappMetadata}))}(e),yield(e=>xr(void 0,void 0,void 0,(function*(){const{options:t}=e,{infuraAPIKey:n}=t;if(!n)return;const r={"0x1":`https://mainnet.infura.io/v3/${n}`,"0x5":`https://goerli.infura.io/v3/${n}`,"0xaa36a7":`https://sepolia.infura.io/v3/${n}`,"0xe708":`https://linea-mainnet.infura.io/v3/${n}`,"0xe704":`https://linea-goerli.infura.io/v3/${n}`,"0x89":`https://polygon-mainnet.infura.io/v3/${n}`,"0x13881":`https://polygon-mumbai.infura.io/v3/${n}`,"0x45":`https://optimism-mainnet.infura.io/v3/${n}`,"0x1a4":`https://optimism-goerli.infura.io/v3/${n}`,"0xa4b1":`https://arbitrum-mainnet.infura.io/v3/${n}`,"0x66eed":`https://arbitrum-goerli.infura.io/v3/${n}`,"0x2a15c308d":`https://palm-mainnet.infura.io/v3/${n}`,"0x2a15c3083":`https://palm-testnet.infura.io/v3/${n}`,"0xa86a":`https://avalanche-mainnet.infura.io/v3/${n}`,"0xa869":`https://avalanche-fuji.infura.io/v3/${n}`,"0x4e454152":`https://aurora-mainnet.infura.io/v3/${n}`,"0x4e454153":`https://aurora-testnet.infura.io/v3/${n}`,"0x534e5f4d41494e":`https://starknet-mainnet.infura.io/v3/${n}`,"0x534e5f474f45524c49":`https://starknet-goerli.infura.io/v3/${n}`,"0x534e5f474f45524c4932":`https://starknet-goerli2.infura.io/v3/${n}`,"0xa4ec":`https://celo-mainnet.infura.io/v3/${n}`,"0xaef3":`https://celo-alfajores.infura.io/v3/${n}`};e.options.readonlyRPCMap?e.options.readonlyRPCMap=Object.assign(Object.assign({},e.options.readonlyRPCMap),r):e.options.readonlyRPCMap=r})))(e),yield(e=>xr(void 0,void 0,void 0,(function*(){const{options:t}=e,{readonlyRPCMap:n}=t;if(n)try{Xh("[MetaMaskSDK: setupReadOnlyRPCProviders()] Setting up Readonly RPC Providers",n),e.setReadOnlyRPCCalls(!0)}catch(e){throw new Error("Invalid Infura Settings")}})))(e);const{metamaskBrowserExtension:g,preferExtension:m,shouldReturn:y}=yield function(e){var t,n,r,i;return xr(this,void 0,void 0,(function*(){const{options:o}=e;let s,a=!1,c=!1;if("undefined"!=typeof window&&window.ethereum&&!(null===(t=e.platformManager)||void 0===t?void 0:t.isMetaMaskMobileWebView())){a="extension"===localStorage.getItem(Bf);try{s=yield function({mustBeMetaMask:e,sdkInstance:t}){return xr(this,void 0,void 0,(function*(){if("undefined"==typeof window)throw new Error("window not available");try{const e=yield new Promise(((e,t)=>{const n=setTimeout((()=>{t(new Error("eip6963RequestProvider timed out"))}),500);window.addEventListener(np.Announce,(t=>{const r=t,{detail:{info:i,provider:o}={}}=r,{name:s,rdns:a,uuid:c}=null!=i?i:{};Pf.test(c)&&s.startsWith(xf.NAME)&&xf.RDNS.includes(a)&&(clearTimeout(n),e(o))})),window.dispatchEvent(new Event(np.Request))}));return tp({provider:e,sdkInstance:t})}catch(n){if(!e&&window.ethereum)return tp({provider:window.ethereum,sdkInstance:t});throw new Error("Provider not found")}}))}({mustBeMetaMask:!0,sdkInstance:e}),window.extension=s,s.on(jf,(t=>{Xh(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE chainChanged chainId=${t}`),Boolean(e.sdkProvider)&&e.getMobileProvider().emit(jf,t)})),s.on(Uf,(t=>xr(this,void 0,void 0,(function*(){var n;Xh(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE accountsChanged accounts=${t}`);const r=Boolean(e.sdkProvider),i=Boolean(e.extensionActive);if(r&&e.getMobileProvider().emit(Uf,t),i&&0===(null==t?void 0:t.length)&&0===(yield null===(n=e.getProvider())||void 0===n?void 0:n.request({method:Tf.WALLET_GETPERMISSIONS,params:[]})).length)try{yield e.terminate()}catch(e){Xh("[MetaMaskSDK: setupExtensionPreferences()] error terminating on permissions revoked",e)}})))),s.on($f,(t=>{Xh(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE disconnect error=${t}`),Boolean(e.sdkProvider)&&e.getMobileProvider().emit($f,t)})),s.on(Ff,(t=>{Xh(`[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE connect args=${t}`),Boolean(e.sdkProvider)&&e.getMobileProvider().emit(Ff,t)})),s.on(Hf,(t=>{Xh("[MetaMaskSDK: setupExtensionPreferences()] PROPAGATE connected",t),Boolean(e.sdkProvider)&&e.getMobileProvider().emit(Hf,t)}))}catch(e){window.extension=void 0}}else(null===(n=e.platformManager)||void 0===n?void 0:n.isMetaMaskMobileWebView())&&(null===(r=e.analytics)||void 0===r||r.send({event:Wc.SDK_USE_INAPP_BROWSER}),e.activeProvider=tp({provider:window.ethereum,sdkInstance:e}),e._initialized=!0,c=!0);return s&&o.extensionOnly&&(Xh("[MetaMaskSDK: setupExtensionPreferences()] EXTENSION ONLY --- prevent sdk initialization"),null===(i=e.analytics)||void 0===i||i.send({event:Wc.SDK_USE_EXTENSION}),e.activeProvider=s,e.extensionActive=!0,e.extension=s,e._initialized=!0,c=!0),{preferExtension:a,shouldReturn:c,metamaskBrowserExtension:s}}))}(e);if(y)Xh("[MetaMaskSDK: performSDKInitialization()] shouldReturn=true --- prevent sdk initialization");else{yield function(e,t){var n,r,i,o,s;return xr(this,void 0,void 0,(function*(){const{options:a}=e,c=Object.assign({},a.logging);e.remoteConnection=new Sp({anonId:yield e.getAnonId(),preferDesktop:null!==(n=a.preferDesktop)&&void 0!==n&&n,communicationLayerPreference:null!==(r=a.communicationLayerPreference)&&void 0!==r?r:al.SOCKET,analytics:e.analytics,dappMetadata:a.dappMetadata,_source:a._source,enableAnalytics:null===(i=a.enableAnalytics)||void 0===i||i,timer:a.timer,sdk:e,platformManager:e.platformManager,transports:a.transports,communicationServerUrl:a.communicationServerUrl,storage:null!==(o=a.storage)&&void 0!==o?o:{enabled:!0},getMetaMaskInstaller:()=>{if(!e.installer)throw new Error("Invalid SDK status -- installer not initialized");return e.installer},logging:c,connectWithExtensionProvider:void 0===t?void 0:()=>Wf(e),modals:Object.assign(Object.assign({},a.modals),{onPendingModalDisconnect:e.terminate.bind(e)})}),yield e.remoteConnection.initRemoteCommunication({sdkInstance:e}),e.installer=new gp({remote:e.remoteConnection,preferDesktop:null!==(s=a.preferDesktop)&&void 0!==s&&s,platformManager:e.platformManager,debug:e.debug})}))}(e,g),yield function(e){var t,n,r,i;return xr(this,void 0,void 0,(function*(){const{options:o}=e,s={communicationLayerPreference:null!==(t=o.communicationLayerPreference)&&void 0!==t?t:al.SOCKET,platformManager:e.platformManager,sdk:e,checkInstallationOnAllCalls:o.checkInstallationOnAllCalls,injectProvider:null===(n=o.injectProvider)||void 0===n||n,shouldShimWeb3:null===(r=o.shouldShimWeb3)||void 0===r||r,extensionOnly:null===(i=o.extensionOnly)||void 0===i||i,installer:e.installer,remoteConnection:e.remoteConnection,debug:e.debug},a=yield Zf(s);e.activeProvider=a,function(e){var t,n,r,i;null===(n=null===(t=e.remoteConnection)||void 0===t?void 0:t.getConnector())||void 0===n||n.on(bf.ConnectionStatus,(t=>{e.emit(bf.ConnectionStatus,t)})),null===(i=null===(r=e.remoteConnection)||void 0===r?void 0:r.getConnector())||void 0===i||i.on(bf.ServiceStatus,(t=>{e.emit(bf.ServiceStatus,t)}))}(e)}))}(e),yield function(e,t){var n,r;return xr(this,void 0,void 0,(function*(){const{options:i}=e;t?(Xh("[MetaMaskSDK: handleAutoAndExtensionConnections()] preferExtension is detected -- connect with it."),null===(n=e.analytics)||void 0===n||n.send({event:Wc.SDK_EXTENSION_UTILIZED}),Wf(e).catch((e=>{console.warn("Can't connect with MetaMask extension...",e),localStorage.removeItem(Bf)}))):i.checkInstallationImmediately&&((null===(r=e.platformManager)||void 0===r?void 0:r.isDesktopWeb())?(Xh("[MetaMaskSDK: handleAutoAndExtensionConnections()] checkInstallationImmediately"),e.connect().catch((e=>{Xh(`[MetaMaskSDK: handleAutoAndExtensionConnections()] checkInstallationImmediately --- IGNORED --- error on autoconnect _err=${e}`)}))):console.warn("[handleAutoAndExtensionConnections()] checkInstallationImmediately --- IGNORED --- only for web desktop")),e._initialized=!0}))}(e,m);try{yield null===(d=e.remoteConnection)||void 0===d?void 0:d.startConnection({initialCheck:!0})}catch(e){console.error("[MetaMaskSDK: setupRemoteConnectionAndInstaller()] Error while checking installation",e)}e.emit(bf.ProviderUpdate,qf.INITIALIZED)}}))}class Cp extends Tt{constructor(e={storage:{enabled:!0},injectProvider:!0,forceInjectProvider:!1,enableAnalytics:!0,shouldShimWeb3:!0,useDeeplink:!0,extensionOnly:!0,headless:!1,dappMetadata:{name:"",url:"",iconUrl:""},_source:kf,i18nOptions:{enabled:!1}}){var t,n,r;super(),this.extensionActive=!1,this._initialized=!1,this.sdkInitPromise=void 0,this.debug=!1,this.readonlyRPCCalls=!1,this.availableLanguages=["en"],this.ANON_ID_STORAGE_KEY="mm-sdk-anon-id",He.disable();const i=!0===(null===(t=e.logging)||void 0===t?void 0:t.developerMode);if(((null===(n=e.logging)||void 0===n?void 0:n.sdk)||i)&&He.enable("MM_SDK"),Xh("[MetaMaskSDK: constructor()]: begin."),this.setMaxListeners(50),!(null===(r=e.dappMetadata)||void 0===r?void 0:r.url)){if("undefined"==typeof window||"undefined"==typeof document)throw new Error("You must provide dAppMetadata url");e.dappMetadata=Object.assign(Object.assign({},e.dappMetadata),{url:`${window.location.protocol}//${window.location.host}`})}this.options=e,this.options._source||(e._source=kf),this.init().then((()=>{Xh("[MetaMaskSDK: constructor()]: initialized successfully."),"undefined"!=typeof window&&(window.mmsdk=this)})).catch((e=>{console.error("[MetaMaskSDK: constructor()] error during initialization",e)}))}init(){return xr(this,void 0,void 0,(function*(){return function(e){var t;return xr(this,void 0,void 0,(function*(){if("undefined"!=typeof window&&(null===(t=window.mmsdk)||void 0===t?void 0:t.isInitialized()))return Xh("[MetaMaskSDK: initializeMetaMaskSDK()] already initialized"),Promise.resolve(window.mmsdk);if(e._initialized)return Xh("[MetaMaskSDK: initializeMetaMaskSDK()] already initialized"),e.sdkInitPromise;if(e.sdkInitPromise)return Xh("[MetaMaskSDK: initializeMetaMaskSDK()] already initializing"),e.sdkInitPromise;try{e.sdkInitPromise=_p(e),yield e.sdkInitPromise}catch(e){throw console.error(e),e}return e.sdkInitPromise}))}(this)}))}isExtensionActive(){return this.extensionActive}checkExtensionAvailability(){var e;return"undefined"!=typeof window&&Boolean(null===(e=window.ethereum)||void 0===e?void 0:e.isMetaMask)}connect(){return xr(this,void 0,void 0,(function*(){return function(e){return xr(this,void 0,void 0,(function*(){if(e._initialized||(Xh("[MetaMaskSDK: connect()] provider not ready -- wait for init()"),yield e.init()),Xh(`[MetaMaskSDK: connect()] isExtensionActive=${e.isExtensionActive()} activeProvider`,e.activeProvider),!e.activeProvider)throw new Error("SDK state invalid -- undefined provider");const t=e.activeProvider.getSelectedAddress();return t?[t]:e.activeProvider.request({method:Tf.ETH_REQUESTACCOUNTS,params:[]})}))}(this)}))}connectAndSign({msg:e}){return xr(this,void 0,void 0,(function*(){return function({instance:e,msg:t}){return xr(this,void 0,void 0,(function*(){if(e._initialized||(Xh("[MetaMaskSDK: connectAndSign()] provider not ready -- wait for init()"),yield e.init()),Xh(`[MetaMaskSDK: connectAndSign()] activeProvider=${e.activeProvider}`),!e.activeProvider)throw new Error("SDK state invalid -- undefined provider");const n=/^0x([0-9A-Fa-f]{2})*$/u.test(t)?t:function(e){let t;if(void 0!==R)t=R.from(e,"utf8").toString("hex");else if("undefined"!=typeof TextEncoder){const n=(new TextEncoder).encode(e);t=Array.from(n).map((e=>e.toString(16).padStart(2,"0"))).join("")}else{if("object"!=typeof p||!("Buffer"in p))throw new Error("Unable to convert string to hex: No available method.");t=p.Buffer.from(e,"utf8").toString("hex")}return`0x${t}`}(t);return e.activeProvider.request({method:Tf.METAMASK_CONNECTWITH,params:[{method:Tf.PERSONAL_SIGN,params:[n]}]})}))}({instance:this,msg:e})}))}connectWith(e){return xr(this,void 0,void 0,(function*(){return function({instance:e,rpc:t}){return xr(this,void 0,void 0,(function*(){if(e._initialized||(Xh("[MetaMaskSDK: connectWith()] provider not ready -- wait for init()"),yield e.init()),Xh(`[MetaMaskSDK: connectWith()] method: ${t.method} rpc=${t}`),!e.activeProvider)throw new Error("SDK state invalid -- undefined provider");return e.activeProvider.request({method:Tf.METAMASK_CONNECTWITH,params:[t]})}))}({instance:this,rpc:e})}))}resume(){return function(e){var t,n,r;return xr(this,void 0,void 0,(function*(){if(!(null===(n=null===(t=e.remoteConnection)||void 0===t?void 0:t.getConnector())||void 0===n?void 0:n.isReady()))return Xh("[MetaMaskSDK: resume()] channel is not ready -- starting connection"),void(null===(r=e.remoteConnection)||void 0===r||r.startConnection());Xh("[MetaMaskSDK: resume()] channel is ready")}))}(this)}disconnect(){return console.warn("MetaMaskSDK.disconnect() is deprecated, use terminate()"),this.terminate()}isAuthorized(){var e;null===(e=this.remoteConnection)||void 0===e||e.isAuthorized()}terminate(){return function(e){var t,n,r;return xr(this,void 0,void 0,(function*(){if(!(null===(t=e.platformManager)||void 0===t?void 0:t.isMetaMaskMobileWebView())){if(zf&&(window.localStorage.removeItem(Bf),window.localStorage.removeItem(Kf),window.localStorage.removeItem(Df)),e.extensionActive){try{yield null===(n=e.activeProvider)||void 0===n?void 0:n.request({method:Tf.WALLET_REVOKEPERMISSIONS,params:[{eth_accounts:{}}]})}catch(e){Xh("[MetaMaskSDK: terminate()] error revoking permissions",e)}return e.options.extensionOnly?(e.emit(bf.ProviderUpdate,qf.TERMINATE),void Xh("[MetaMaskSDK: terminate()] extensionOnly --- prevent switching providers")):(e.activeProvider=e.sdkProvider,window.ethereum=e.activeProvider,e.extensionActive=!1,void e.emit(bf.ProviderUpdate,qf.TERMINATE))}e.emit(bf.ProviderUpdate,qf.TERMINATE),Xh(`[MetaMaskSDK: terminate()] remoteConnection=${e.remoteConnection}`),null===(r=e.remoteConnection)||void 0===r||r.disconnect({terminate:!0,sendMessage:!0})}}))}(this)}isInitialized(){return this._initialized}setReadOnlyRPCCalls(e){this.readonlyRPCCalls=e}hasReadOnlyRPCCalls(){return this.readonlyRPCCalls}getProvider(){if(this.activeProvider)return this.activeProvider;console.warn("MetaMaskSDK: No active provider found")}getMobileProvider(){if(!this.sdkProvider)throw new Error("SDK state invalid -- undefined mobile provider");return this.sdkProvider}getUniversalLink(){var e;const t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getUniversalLink();if(!t)throw new Error("No Universal Link available, please call eth_requestAccounts first.");return t}getChannelId(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getChannelConfig())||void 0===t?void 0:t.channelId}getRPCHistory(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t?void 0:t.getRPCMethodTracker()}getVersion(){return Af.version}getDappId(){var e,t,n,r;return"undefined"==typeof window||void 0===window.location?null!==(r=null!==(t=null===(e=this.options.dappMetadata)||void 0===e?void 0:e.name)&&void 0!==t?t:null===(n=this.options.dappMetadata)||void 0===n?void 0:n.url)&&void 0!==r?r:"N/A":window.location.hostname}getAnonId(){var e,t;return xr(this,void 0,void 0,(function*(){if(this._anonId)return this._anonId;let n;return n=(null===(e=this.platformManager)||void 0===e?void 0:e.isBrowser())?this.getBrowserAnonId():(null===(t=this.platformManager)||void 0===t?void 0:t.isReactNative())?yield this.getReactNativeAnonId():Vt(),this._anonId=n,n}))}getBrowserAnonId(){const e=this.ANON_ID_STORAGE_KEY;try{const t=localStorage.getItem(e);if(t)return t;const n=Vt();return localStorage.setItem(e,n),n}catch(e){return console.error("[MetaMaskSDK: getBrowserAnonId()] LocalStorage access error:",e),Vt()}}getReactNativeAnonId(){return xr(this,void 0,void 0,(function*(){const e=this.ANON_ID_STORAGE_KEY;try{const t=require("@react-native-async-storage/async-storage").default,n=yield t.getItem(e);if(n)return n;const r=Vt();return yield t.setItem(e,r),r}catch(e){return console.error("[MetaMaskSDK: getReactNativeAnonId()] Error accessing AsyncStorage:",e),Vt()}}))}getWalletStatus(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t?void 0:t.getConnectionStatus()}_getChannelConfig(){var e;return null===(e=this.remoteConnection)||void 0===e?void 0:e.getChannelConfig()}_ping(){var e,t;null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t||t.ping()}_keyCheck(){var e,t;null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t||t.keyCheck()}_getServiceStatus(){var e,t;return null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t?void 0:t.getServiceStatus()}_getRemoteConnection(){return this.remoteConnection}_getDappMetadata(){return this.dappMetadata}_getKeyInfo(){var e;return null===(e=this.remoteConnection)||void 0===e?void 0:e.getKeyInfo()}_resetKeys(){var e,t;null===(t=null===(e=this.remoteConnection)||void 0===e?void 0:e.getConnector())||void 0===t||t.resetKeys()}_getConnection(){return this.remoteConnection}emit(e,t){return super.emit(e,t)}on(e,t){return super.on(e,t)}}class Ap{constructor({enabled:e}={enabled:!1}){this.enabled=!1,this.enabled=e}persistChannelConfig(e,t){return xr(this,void 0,void 0,(function*(){const n=JSON.stringify(e);Xh(`[StorageManagerAS: persistChannelConfig()] context=${t} enabled=${this.enabled}`,e),yield o.setItem(Lf,n)}))}persistAccounts(e,t){return xr(this,void 0,void 0,(function*(){Xh(`[StorageManagerAS: persistAccounts()] context=${t} enabled=${this.enabled}`,e);try{const t=JSON.stringify(e);yield o.setItem(Df,t)}catch(e){console.error("[StorageManagerAS: persistAccounts()] Error persisting accounts",e)}}))}getCachedAccounts(){return xr(this,void 0,void 0,(function*(){let e;try{return e=yield o.getItem(Df),e?JSON.parse(e):[]}catch(e){return console.error("[StorageManagerAS: getCachedAccounts()] Error getting cached accounts",e),[]}}))}getCachedChainId(){var e;return xr(this,void 0,void 0,(function*(){try{const t=null!==(e=yield o.getItem(Kf))&&void 0!==e?e:void 0;return-1!==(null==t?void 0:t.indexOf("0x"))?t:void 0}catch(e){return void console.error("[StorageManagerAS: getCachedChainId()] Error getting cached chainId",e)}}))}persistChainId(e,t){return xr(this,void 0,void 0,(function*(){Xh(`[StorageManagerAS: persistChainId()] context=${t} enabled=${this.enabled}`,e);try{yield o.setItem(Kf,e)}catch(e){console.error("[StorageManagerAS: persistChainId()] Error persisting chainId",e)}}))}getPersistedChannelConfig(e){return xr(this,void 0,void 0,(function*(){let t;const{context:n}=e||{};try{if(Xh(`[StorageManagerAS: getPersistedChannelConfig()] context=${n} enabled=${this.enabled}`),t=yield o.getItem(Lf),!t)return;const e=JSON.parse(t);return Xh(`[StorageManagerAS: getPersistedChannelConfig()] context=${n}  channelConfig`,e),e}catch(e){return void console.error("[StorageManagerAS: getPersistedChannelConfig()] Can't find existing channel config",e)}}))}terminate(){return xr(this,void 0,void 0,(function*(){Xh(`[StorageManagerAS: terminate()] enabled=${this.enabled}`),yield o.removeItem(Lf),yield o.removeItem(Kf),yield o.removeItem(Df)}))}}var kp,Mp,Rp=Object.freeze({__proto__:null,StorageManagerWeb:class{constructor({enabled:e}={enabled:!1}){this.enabled=!1,this.enabled=e}persistChannelConfig(e){return xr(this,void 0,void 0,(function*(){const t=JSON.stringify(e);Xh(`[StorageManagerWeb: persistChannelConfig()] enabled=${this.enabled}`,e),localStorage.setItem(Lf,t)}))}getPersistedChannelConfig(){return xr(this,void 0,void 0,(function*(){let e;try{if(Xh(`[StorageManagerWeb: getPersistedChannelConfig()] enabled=${this.enabled}`),e=localStorage.getItem(Lf),Xh("[StorageManagerWeb: getPersistedChannelConfig()]",e),!e)return;const t=JSON.parse(e);return Xh("[StorageManagerWeb: getPersistedChannelConfig()] channelConfig",t),t}catch(e){return void console.error("[StorageManagerWeb: getPersistedChannelConfig()] Can't find existing channel config",e)}}))}persistAccounts(e){return xr(this,void 0,void 0,(function*(){Xh(`[StorageManagerWeb: persistAccounts()] enabled=${this.enabled}`,e);const t=JSON.stringify(e);localStorage.setItem(Df,t)}))}getCachedAccounts(){return xr(this,void 0,void 0,(function*(){try{const e=localStorage.getItem(Df);return e?JSON.parse(e):[]}catch(e){throw console.error("[StorageManagerWeb: getCachedAccounts()] Error reading cached accounts",e),e}}))}persistChainId(e){return xr(this,void 0,void 0,(function*(){Xh(`[StorageManagerWeb: persistChainId()] enabled=${this.enabled}`,e),localStorage.setItem(Kf,e)}))}getCachedChainId(){return xr(this,void 0,void 0,(function*(){try{const e=localStorage.getItem(Kf);return null!=e?e:void 0}catch(e){throw console.error("[StorageManagerWeb: getCachedChainId()] Error reading cached chainId",e),e}}))}terminate(){return xr(this,void 0,void 0,(function*(){Xh(`[StorageManagerWeb: terminate()] enabled=${this.enabled}`),localStorage.removeItem(Lf)}))}}}),xp={exports:{}};function Pp(){if(Mp)return kp;Mp=1;var e=1e3,t=60*e,n=60*t,r=24*n,i=7*r,o=365.25*r;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}return kp=function(a,c){c=c||{};var l=typeof a;if("string"===l&&a.length>0)return function(s){if((s=String(s)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(a);if("number"===l&&isFinite(a))return c.long?function(i){var o=Math.abs(i);if(o>=r)return s(i,o,r,"day");if(o>=n)return s(i,o,n,"hour");if(o>=t)return s(i,o,t,"minute");if(o>=e)return s(i,o,e,"second");return i+" ms"}(a):function(i){var o=Math.abs(i);if(o>=r)return Math.round(i/r)+"d";if(o>=n)return Math.round(i/n)+"h";if(o>=t)return Math.round(i/t)+"m";if(o>=e)return Math.round(i/e)+"s";return i+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))},kp}var Tp=function(e){function t(e){let r,i,o,s=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),o=i-(r||i);n.diff=o,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];r=o.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Pp(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==Le&&"env"in Le&&(e=Le.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Tp(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(xp,xp.exports);var Ip=xp.exports;const Op=Ip("MM_SDK-React");Op.color="#CC5500";const Np=c({ready:!1,extensionActive:!1,connected:!1,connecting:!1,readOnlyCalls:!1}),Lp=({children:e,sdkOptions:t,debug:n})=>{const[r,i]=l(),[o,c]=l(""),[f,p]=l(!1),[g,m]=l(!1),[y,v]=l(!1),[b,w]=l(!1),[E,S]=l(1),[_,C]=l(),[A,k]=l(),[M,R]=l(!1),[x,P]=l(""),[T,I]=l(),[O,N]=l(),[L,B]=l(),[D,K]=l(),[j,U]=l(),[$,F]=l({}),[H,q]=l(!1),z=d(!1);u((()=>{Ip.enable("MM_SDK-React")}),[n]);const W={setConnecting:v,setConnected:w,setChainId:C,setError:B,setAccount:I,setStatus:U,setTrigger:S,setRPCHistory:F,debug:n,chainId:_,activeProvider:void 0,sdk:r},V=(({debug:e,setConnected:t,setConnecting:n,setError:r})=>a((()=>{Op("[MetaMaskProvider: useHandleOnConnectingEvent()] on 'connecting' event."),t(!1),n(!0),r(void 0)}),[e,t,n,r]))(W),G=(({debug:e,setConnecting:t,setAccount:n,activeProvider:r,setConnected:i,setError:o})=>a((()=>{Op("[MetaMaskProvider: useHandleInitializedEvent()] on '_initialized' event."),t(!1),i(!0),o(void 0)}),[e,t,n,r,i,o]))(W),Y=(({debug:e,setConnecting:t,setConnected:n,setChainId:r,setError:i,chainId:o})=>a((e=>{Op("[MetaMaskProvider: useHandleConnectEvent()] on 'connect' event.",e);const o=e.chainId;t(!1),n(!0),r(o),i(void 0)}),[e,t,n,r,i,o]))(W),J=(({debug:e,setConnecting:t,setConnected:n,setError:r})=>a((e=>{Op("[MetaMaskProvider: useHandleDisconnectEvent()] on 'disconnect' event.",e),t(!1),n(!1),r(e)}),[e,t,n,r]))(W),Z=(({debug:e,setConnecting:t,setConnected:n,setError:r})=>a((e=>{Op("[MetaMaskProvider: useHandleTerminateEvent()] on 'terminate' event.",e),t(!1),n(!1),r(e)}),[e,t,n,r]))(W),Q=(({debug:e,setAccount:t,setConnected:n,setConnecting:r,setError:i})=>a((e=>{Op("[MetaMaskProvider: useHandleAccountsChangedEvent()] on 'accountsChanged' event.",e),t(e?.[0]),n(!0),r(!1),i(void 0)}),[e,t,n,i]))(W),X=(({debug:e,setChainId:t,setConnected:n,setConnecting:r,setError:i})=>a((e=>{Op("[MetaMaskProvider: useHandleChainChangedEvent()] on 'chainChanged' event.",e),t("object"==typeof e&&e?.chainId?e.chainId:e),n(!0),r(!1),i(void 0)}),[e,t,n,i,r]))(W),ee=(({debug:e,setStatus:t})=>a((e=>{Op(`[MetaMaskProvider: useHandleSDKStatusEvent()] on '${Fc.SERVICE_STATUS}/${e.connectionStatus}' event.`,e);try{const n=JSON.parse(JSON.stringify(e??{}));t(n)}catch(e){console.error(e)}}),[e,t]))(W),te=(({debug:e,setConnecting:t,setConnected:n,setTrigger:r,setError:i,setChainId:o,setAccount:s,setRPCHistory:c,sdk:l})=>a((e=>{if(Op(`[MetaMaskProvider: useHandleProviderEvent()] on '${Fc.PROVIDER_UPDATE}' event.`,e),e===qf.TERMINATE)t(!1);else if(e===qf.EXTENSION){t(!1),n(!0),i(void 0);const e=l?.getProvider(),r=e?.getChainId()||void 0,a=e?.getSelectedAddress()||void 0;Op(`[MetaMaskProvider: useHandleProviderEvent()] extensionProvider chainId=${r} selectedAddress=${a}`),o(r),s(a)}c({}),r((e=>e+1))}),[e,t,r,n,i]))(W),ne=h((()=>{const e=j?.connectionStatus===$c.DISCONNECTED;let t=!1;for(const n in $){const r=$[n];if(void 0===r.result&&void 0===r.error){t=!0,e&&console.warn(`[MetamaskProvider] socket disconnected but rpc ${n} not processed yet`);break}}return t}),[$,j]);return u((()=>{const e=D?.getSelectedAddress();e&&e!=T?.toLowerCase()&&(Op(`[MetaMaskProviderClient] account changed detected from ${T} to ${e}`),I(e))}),[$]),u((()=>{j?.connectionStatus!==$c.DISCONNECTED&&j?.connectionStatus!==$c.TERMINATED||(w(!1),v(!1))}),[j]),u((()=>{const e=`${T}${_}`;N(r?.getChannelId()),T?.startsWith("0x")&&_?.startsWith("0x")&&e!==x?(R(!0),Op(`[MetaMaskProviderClient] retrieving balance of ${T} on chain ${_}`),P(e),D?.request({method:"eth_getBalance",params:[T,"latest"]}).then((e=>{Op(`[MetaMaskProviderClient] balance of ${T} is ${e}`),k(e)})).catch((e=>{console.warn(`[MetamaskProvider] error retrieving balance of ${T}`,e)})).finally((()=>{R(!1)}))):k(void 0)}),[T,D,_,x]),u((()=>{if(z.current)return void Op("[MetaMaskProviderClient] sdk already initialized");z.current=!0;const e=new Cp({...t});e.init().then((()=>{i(e),p(!0),m(e.hasReadOnlyRPCCalls())})).catch((e=>{console.error("[MetaMaskProviderClient] error initializing SDK",e)}))}),[t]),u((()=>{if(!f||!r)return;Op("[MetaMaskProviderClient] init SDK Provider listeners",r),q(r.isExtensionActive());const e=r.getProvider();if(!e)return void console.warn("[MetaMaskProviderClient] activeProvider is undefined.");const t=r.isExtensionActive()?!!e.getSelectedAddress():e.isConnected();return w(t),I(e.getSelectedAddress()||void 0),K(e),C(e.getChainId()||void 0),e.on("_initialized",G),e.on("terminate",Z),e.on("connecting",V),e.on("connect",Y),e.on("disconnect",J),e.on("accountsChanged",Q),e.on("chainChanged",X),r.on(Fc.SERVICE_STATUS,ee),r._getConnection()?.getConnector().on(Fc.RPC_UPDATE,(e=>{void 0!==e.result||void 0!==e.error?e.id===o&&c(""):c(e.id);const t=JSON.parse(JSON.stringify(r.getRPCHistory()??{}));F(t)})),()=>{e.removeListener("_initialized",G),e.removeListener("connecting",V),e.removeListener("connect",Y),e.removeListener("disconnect",J),e.removeListener("terminate",Z),e.removeListener("accountsChanged",Q),e.removeListener("chainChanged",X),r.removeListener(Fc.SERVICE_STATUS,ee)}}),[E,r,f]),u((()=>{if(f&&r)return r.on(Fc.PROVIDER_UPDATE,te),()=>{r.removeListener(Fc.PROVIDER_UPDATE,te)}}),[r,f]),s.createElement(Np.Provider,{value:{sdk:r,ready:f,connected:b,readOnlyCalls:g,provider:D,rpcHistory:$,connecting:y,channelId:O,account:T,balance:A,balanceProcessing:M,extensionActive:H,chainId:_,error:L,status:j,syncing:ne}},e)},Bp=({children:e,sdkOptions:t,debug:n})=>{const[r,i]=l(!1);return u((()=>{i(!0)}),[]),s.createElement(s.Fragment,null,r?s.createElement(Lp,{debug:n,sdkOptions:t},e):s.createElement(s.Fragment,null,e))},Dp={socketServer:Oc,useDeeplink:!0,extensionOnly:!0,checkInstallationImmediately:!1,debug:!0,logs:{sdk:!0,provider:!0,commLayer:!0},lang:"en"},Kp=c({...Dp,setAppContext:e=>{},reset:()=>{}}),jp="appContext",Up=({initialSocketServer:e,initialInfuraKey:t,children:n})=>{const[r,i]=l({...Dp,socketServer:e??Oc,infuraAPIKey:t});u((()=>{"undefined"!=typeof window&&"undefined"!=typeof localStorage&&(()=>{const n=localStorage?.getItem(jp),r=n?JSON.parse(n):{infuraAPIKey:t,socketServer:e};r.infuraAPIKey||(r.infuraAPIKey=t),Op("[SDKConfigProvider] initialContext",r);const o=new URLSearchParams(window.location.search),s=Array.from(o.keys()).reduce(((e,t)=>{try{e[t]=JSON.parse(decodeURIComponent(o.get(t)||""))}catch(e){console.error(`Error parsing URL param ${t}`,e)}return e}),{});Op("[SDKConfigProvider] urlContext",s);const a={...Dp,...r,...s};Op("[SDKConfigProvider] computedContext",a),i(a)})()}),[]);const o=e=>{i((t=>{const n={...t,...e};return(e=>{if("undefined"==typeof window||"undefined"==typeof localStorage)return;const t=new URLSearchParams;for(const[n,r]of Object.entries(e))t.set(n,encodeURIComponent(JSON.stringify(r)));localStorage.setItem(jp,JSON.stringify(e));const n=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${t.toString()}`;window.history.pushState({path:n},"",n)})(n),setTimeout((()=>{"undefined"!=typeof window&&void 0!==window.location&&void 0!==window.location.reload?window.location.reload():console.warn("[SDKConfigProvider] updateAppContext not implemented")}),100),n}))},a={...r,reset:()=>{o({...Dp,socketServer:e??Oc,infuraAPIKey:t})},setAppContext:o};return s.createElement(Kp.Provider,{value:a},n)},$p=()=>{const e=f(Np);if(void 0===e)throw new Error("SDK context is missing, must be within provide");return e},Fp=()=>{const e=f(Kp);if(void 0===e)throw new Error("useSDKConfig must be used within a SDKConfigContext");return e};export{al as CommunicationLayerPreference,$c as ConnectionStatus,Oc as DEFAULT_SERVER_URL,Fc as EventType,zc as MessageType,Bp as MetaMaskProvider,Cp as MetaMaskSDK,bf as MetaMaskSDKEvent,qf as PROVIDER_UPDATE_TYPE,cl as PlatformType,Kp as SDKConfigContext,Up as SDKConfigProvider,Np as SDKContext,_f as SDKProvider,Ap as StorageManagerAS,$p as useSDK,Fp as useSDKConfig};
//# sourceMappingURL=metamask-sdk-react.js.map
