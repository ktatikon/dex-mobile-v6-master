# =============================================================================
# DEX MOBILE V6 - STAGING ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env.staging and fill in the actual values
# This environment is for pre-production testing and validation

# =============================================================================
# ENVIRONMENT SETTINGS
# =============================================================================
NODE_ENV=staging
ENVIRONMENT=staging
LOG_LEVEL=debug
DEBUG=true

# =============================================================================
# AWS CONFIGURATION
# =============================================================================
AWS_REGION=us-west-2
AWS_ACCOUNT_ID=your-aws-account-id

# =============================================================================
# DATABASE CONFIGURATION (RDS PostgreSQL)
# =============================================================================
POSTGRES_HOST=staging-dex-postgres.cluster-xxxxx.us-west-2.rds.amazonaws.com
POSTGRES_PORT=5432
POSTGRES_DB=dex_mobile_staging
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-staging-database-password
POSTGRES_URL=postgresql://postgres:your-staging-database-password@staging-dex-postgres.cluster-xxxxx.us-west-2.rds.amazonaws.com:5432/dex_mobile_staging
POSTGRES_SSL=true
POSTGRES_MAX_CONNECTIONS=10
POSTGRES_IDLE_TIMEOUT=30000
POSTGRES_CONNECTION_TIMEOUT=60000

# =============================================================================
# REDIS CONFIGURATION (ElastiCache)
# =============================================================================
REDIS_HOST=staging-dex-redis.xxxxx.cache.amazonaws.com
REDIS_PORT=6379
REDIS_PASSWORD=your-staging-redis-password
REDIS_URL=redis://:your-staging-redis-password@staging-dex-redis.xxxxx.cache.amazonaws.com:6379
REDIS_DB=0
REDIS_KEY_PREFIX=dex_mobile_staging:
REDIS_TTL=1800
REDIS_MAX_RETRIES=3
REDIS_RETRY_DELAY=1000

# =============================================================================
# SUPABASE CONFIGURATION
# =============================================================================
SUPABASE_URL=https://your-staging-project-id.supabase.co
SUPABASE_ANON_KEY=your-staging-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-staging-supabase-service-role-key

# =============================================================================
# MICROSERVICES PORTS
# =============================================================================
BLOCKCHAIN_SERVICE_PORT=5001
KYC_SERVICE_PORT=4001
AML_SERVICE_PORT=4002
CHART_API_SERVICE_PORT=4000
MONITORING_SERVICE_PORT=3001

# =============================================================================
# BLOCKCHAIN SERVICE CONFIGURATION (TESTNETS)
# =============================================================================
# Ethereum Goerli Testnet
ETHEREUM_RPC_URL=https://goerli.infura.io/v3/your-infura-project-id
ETHEREUM_CHAIN_ID=5
ETHEREUM_BLOCK_CONFIRMATIONS=3

# Polygon Mumbai Testnet
POLYGON_RPC_URL=https://polygon-mumbai.infura.io/v3/your-infura-project-id
POLYGON_CHAIN_ID=80001
POLYGON_BLOCK_CONFIRMATIONS=5

# BSC Testnet
BSC_RPC_URL=https://data-seed-prebsc-1-s1.binance.org:8545/
BSC_CHAIN_ID=97
BSC_BLOCK_CONFIRMATIONS=3

# Arbitrum Goerli Testnet
ARBITRUM_RPC_URL=https://goerli-rollup.arbitrum.io/rpc
ARBITRUM_CHAIN_ID=421613
ARBITRUM_BLOCK_CONFIRMATIONS=1

# Blockchain Service Settings
BLOCKCHAIN_REQUEST_TIMEOUT=30000
BLOCKCHAIN_MAX_RETRIES=3
BLOCKCHAIN_CIRCUIT_BREAKER_THRESHOLD=5
BLOCKCHAIN_CIRCUIT_BREAKER_TIMEOUT=30000

# =============================================================================
# KYC SERVICE CONFIGURATION (SANDBOX)
# =============================================================================
# IDfy API Configuration (Sandbox)
IDFY_API_KEY=your-idfy-sandbox-api-key
IDFY_BASE_URL=https://eve.idfy.com/v3.0/api
IDFY_ACCOUNT_ID=your-idfy-sandbox-account-id
IDFY_WEBHOOK_SECRET=your-idfy-sandbox-webhook-secret

# KYC Settings (Relaxed for testing)
KYC_DOCUMENT_UPLOAD_MAX_SIZE=10485760  # 10MB
KYC_DOCUMENT_ALLOWED_TYPES=image/jpeg,image/png,application/pdf
KYC_VERIFICATION_TIMEOUT=300000  # 5 minutes
KYC_MAX_RETRY_ATTEMPTS=5

# =============================================================================
# AML SERVICE CONFIGURATION (SANDBOX)
# =============================================================================
# Signzy API Configuration (Sandbox)
SIGNZY_API_KEY=your-signzy-sandbox-api-key
SIGNZY_BASE_URL=https://preproduction.signzy.tech/api/v2
SIGNZY_WEBHOOK_SECRET=your-signzy-sandbox-webhook-secret

# AML Settings (Relaxed for testing)
AML_SCREENING_TIMEOUT=120000  # 2 minutes
AML_RISK_THRESHOLD=50  # Lower threshold for testing
AML_PERIODIC_SCREENING_INTERVAL=86400000  # 1 day for testing

# =============================================================================
# CHART API SERVICE CONFIGURATION
# =============================================================================
# CoinGecko API Configuration (Demo tier)
COINGECKO_API_KEY=your-coingecko-demo-api-key
COINGECKO_BASE_URL=https://api.coingecko.com/api/v3
COINGECKO_RATE_LIMIT_PER_MINUTE=30
COINGECKO_TIMEOUT_MS=15000

# Chart API Settings
CHART_CACHE_TTL_SECONDS=600  # Longer cache for testing
CHART_CACHE_MAX_SIZE=500
CHART_RATE_LIMIT_WINDOW_MS=60000
CHART_RATE_LIMIT_MAX_REQUESTS=50
CHART_CIRCUIT_BREAKER_THRESHOLD=3
CHART_CIRCUIT_BREAKER_TIMEOUT_MS=30000

# =============================================================================
# MONITORING SERVICE CONFIGURATION
# =============================================================================
MONITORING_HEALTH_CHECK_INTERVAL=60000  # Less frequent checks
MONITORING_ALERT_THRESHOLD_CPU=85
MONITORING_ALERT_THRESHOLD_MEMORY=90
MONITORING_ALERT_THRESHOLD_DISK=95
MONITORING_SERVICES_TO_MONITOR=kyc-service:4001,aml-service:4002,chart-api-service:4000,blockchain-service:5001

# Prometheus Configuration
PROMETHEUS_URL=http://prometheus:9090
PROMETHEUS_SCRAPE_INTERVAL=30s
PROMETHEUS_RETENTION_TIME=7d

# Grafana Configuration
GRAFANA_URL=http://grafana:3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=staging-grafana-password

# =============================================================================
# SECURITY CONFIGURATION (STAGING)
# =============================================================================
# Encryption Keys (Use different keys from production)
ENCRYPTION_KEY=staging-32-character-encryption-key
JWT_SECRET=staging-jwt-secret-key-here
JWT_REFRESH_SECRET=staging-jwt-refresh-secret-key
JWT_EXPIRES_IN=2h  # Longer for testing
JWT_REFRESH_EXPIRES_IN=14d

# API Security (Relaxed for testing)
API_RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
API_RATE_LIMIT_MAX_REQUESTS=200  # Higher limit for testing
API_CORS_ORIGIN=https://staging.your-frontend-domain.com,http://localhost:3000
API_CORS_CREDENTIALS=true

# Session Configuration
SESSION_SECRET=staging-session-secret-key
SESSION_MAX_AGE=172800000  # 48 hours for testing
SESSION_SECURE=false  # Allow HTTP for local testing
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax

# =============================================================================
# WEBHOOK CONFIGURATION
# =============================================================================
WEBHOOK_BASE_URL=https://staging-api.your-domain.com
WEBHOOK_SECRET=staging-webhook-secret-key
WEBHOOK_TIMEOUT=30000
WEBHOOK_MAX_RETRIES=5  # More retries for testing

# =============================================================================
# NOTIFICATION CONFIGURATION
# =============================================================================
# Email Configuration (SES Sandbox)
EMAIL_FROM=staging-noreply@your-domain.com
EMAIL_REPLY_TO=staging-support@your-domain.com
SES_REGION=us-west-2

# SMS Configuration (SNS Sandbox)
SMS_REGION=us-west-2
SMS_SENDER_ID=DEX-Staging

# Slack Notifications (Staging channel)
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/your/staging/webhook
SLACK_CHANNEL=#dex-staging
SLACK_USERNAME=DEX-Staging-Bot

# =============================================================================
# EXTERNAL API CONFIGURATION
# =============================================================================
# Third-party API timeouts and retries (More lenient)
EXTERNAL_API_TIMEOUT=45000
EXTERNAL_API_MAX_RETRIES=5
EXTERNAL_API_RETRY_DELAY=2000

# Rate limiting for external APIs (Higher limits)
EXTERNAL_API_RATE_LIMIT=200
EXTERNAL_API_RATE_WINDOW=60000

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_COLORIZE=true  # Enable colors for staging
LOG_MAX_SIZE=50m
LOG_MAX_FILES=5
LOG_DATE_PATTERN=YYYY-MM-DD

# CloudWatch Logs
CLOUDWATCH_LOG_GROUP=/aws/dex-mobile/staging
CLOUDWATCH_LOG_STREAM=staging-logs
CLOUDWATCH_LOG_REGION=us-west-2

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================
# Node.js Performance (Lower limits for staging)
NODE_OPTIONS=--max-old-space-size=1024
UV_THREADPOOL_SIZE=64

# Connection Pooling (Smaller pools)
DB_POOL_MIN=2
DB_POOL_MAX=10
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_ACQUIRE_TIMEOUT=60000

# Cache Configuration
CACHE_DEFAULT_TTL=1800
CACHE_MAX_KEYS=5000
CACHE_CHECK_PERIOD=300

# =============================================================================
# COMPLIANCE CONFIGURATION
# =============================================================================
# Data Retention (Shorter for staging)
DATA_RETENTION_PERIOD=90  # 3 months for staging
LOG_RETENTION_PERIOD=30
AUDIT_LOG_RETENTION_PERIOD=90

# Compliance Features (All enabled for testing)
ENABLE_AUDIT_LOGGING=true
ENABLE_DATA_ENCRYPTION=true
ENABLE_PII_MASKING=true
ENABLE_GDPR_COMPLIANCE=true

# =============================================================================
# FEATURE FLAGS (MORE PERMISSIVE FOR TESTING)
# =============================================================================
ENABLE_SWAGGER_DOCS=true  # Enable API docs in staging
ENABLE_METRICS_ENDPOINT=true
ENABLE_HEALTH_CHECKS=true
ENABLE_GRACEFUL_SHUTDOWN=true
ENABLE_REQUEST_LOGGING=true
ENABLE_ERROR_TRACKING=true
ENABLE_DEBUG_ENDPOINTS=true  # Special debug endpoints for staging

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================
DEPLOYMENT_ENVIRONMENT=staging
DEPLOYMENT_VERSION=1.0.0-staging
DEPLOYMENT_BUILD_NUMBER=latest
DEPLOYMENT_COMMIT_SHA=latest

# Container Configuration (Smaller resources)
CONTAINER_MEMORY_LIMIT=1024m
CONTAINER_CPU_LIMIT=500m
CONTAINER_RESTART_POLICY=always

# =============================================================================
# MONITORING AND ALERTING (LESS AGGRESSIVE)
# =============================================================================
# Alert Thresholds (Higher thresholds for staging)
ALERT_CPU_THRESHOLD=90
ALERT_MEMORY_THRESHOLD=95
ALERT_DISK_THRESHOLD=95
ALERT_ERROR_RATE_THRESHOLD=10
ALERT_RESPONSE_TIME_THRESHOLD=5000

# Alert Destinations (Staging channels)
ALERT_EMAIL=staging-alerts@your-domain.com
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/your/staging-alert/webhook

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 4 * * *  # Daily at 4 AM
BACKUP_RETENTION_DAYS=7  # Shorter retention for staging
BACKUP_S3_BUCKET=staging-dex-backups
BACKUP_ENCRYPTION_ENABLED=true

# =============================================================================
# LOAD BALANCER CONFIGURATION
# =============================================================================
LB_HEALTH_CHECK_PATH=/health
LB_HEALTH_CHECK_INTERVAL=30
LB_HEALTH_CHECK_TIMEOUT=10  # More lenient timeout
LB_HEALTHY_THRESHOLD=2
LB_UNHEALTHY_THRESHOLD=5  # More tolerant of failures

# =============================================================================
# AUTO SCALING CONFIGURATION (SMALLER SCALE)
# =============================================================================
AUTOSCALING_MIN_CAPACITY=1
AUTOSCALING_MAX_CAPACITY=5
AUTOSCALING_TARGET_CPU=80
AUTOSCALING_TARGET_MEMORY=85
AUTOSCALING_SCALE_OUT_COOLDOWN=300
AUTOSCALING_SCALE_IN_COOLDOWN=300

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================
# Test-specific settings
ENABLE_TEST_ENDPOINTS=true
TEST_DATA_CLEANUP_INTERVAL=3600000  # 1 hour
MOCK_EXTERNAL_APIS=false  # Use real APIs but in sandbox mode
ENABLE_PERFORMANCE_TESTING=true
ENABLE_LOAD_TESTING=true

# Test User Accounts
TEST_USER_EMAIL=test@your-domain.com
TEST_ADMIN_EMAIL=admin@your-domain.com

# =============================================================================
# DEVELOPMENT HELPERS
# =============================================================================
# Development and debugging features enabled in staging
ENABLE_HOT_RELOAD=false
ENABLE_SOURCE_MAPS=true
ENABLE_PROFILING=true
ENABLE_MEMORY_MONITORING=true
ENABLE_CPU_PROFILING=false

# API Documentation
SWAGGER_ENABLED=true
SWAGGER_PATH=/api-docs
SWAGGER_TITLE=DEX Mobile API - Staging
SWAGGER_VERSION=1.0.0

# =============================================================================
# THIRD-PARTY INTEGRATIONS (SANDBOX/TEST MODES)
# =============================================================================
# Payment Gateways (Test mode)
PAYPAL_MODE=sandbox
PAYPAL_CLIENT_ID=your-paypal-sandbox-client-id
PAYPAL_CLIENT_SECRET=your-paypal-sandbox-client-secret

PHONEPE_MODE=sandbox
PHONEPE_MERCHANT_ID=your-phonepe-sandbox-merchant-id
PHONEPE_API_KEY=your-phonepe-sandbox-api-key

# Analytics (Test/Development tracking)
GOOGLE_ANALYTICS_ID=UA-XXXXXXXX-2  # Staging GA property
MIXPANEL_TOKEN=your-mixpanel-staging-token

# Error Tracking (Staging environment)
SENTRY_DSN=https://your-sentry-staging-dsn@sentry.io/project-id
SENTRY_ENVIRONMENT=staging
SENTRY_RELEASE=1.0.0-staging
